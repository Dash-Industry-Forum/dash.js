!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.dashjs=e():t.dashjs=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=72)}({1:function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.init()}var e,n,a;return e=t,(n=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4}}}])&&r(e.prototype,n),a&&r(e,a),t}());e.a=a},13:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var r=n(1);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(a(t)!==e)throw r.a.BAD_ARGUMENT_ERROR}function o(t){if(!(null!==t&&!isNaN(t)&&t%1==0))throw r.a.BAD_ARGUMENT_ERROR+" : argument is not an integer"}},16:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=s(t);if(e){var a=s(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return o(this,n)}}function o(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=new(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(n,t);var e=i(n);function n(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(t=e.call(this)).METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",t.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",t.CMCD_DATA_GENERATED="cmcdDataGenerated",t}return n}(n(17).a));e.a=c},17:function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,a;return e=t,(n=[{key:"extend",value:function(t,e){if(t){var n=!!e&&e.override,r=!!e&&e.publicOnly;for(var a in t)!t.hasOwnProperty(a)||this[a]&&!n||r&&-1===t[a].indexOf("public_")||(this[a]=t[a])}}}])&&r(e.prototype,n),a&&r(e,a),t}();e.a=a},3:function(t,e,n){"use strict";var r=function(){var t,e=[],n={},r={};function a(t,n){for(var r in e){var a=e[r];if(a.context===t&&a.name===n)return a.instance}return null}function i(t,e){return e[t]}function o(t,e,n){t in n&&(n[t]=e)}function s(e,n,r){var a,i=e.__dashjs_factory_name,o=n[i];if(o){var s=o.instance;if(!o.override)return s.apply({context:n,factory:t},r);for(var c in a=e.apply({context:n},r),s=s.apply({context:n,factory:t,parent:a},r))a.hasOwnProperty(c)&&(a[c]=s[c])}else a=e.apply({context:n},r);return a.getClassName=function(){return i},a}return t={extend:function(t,e,n,r){!r[t]&&e&&(r[t]={instance:e,override:n})},getSingletonInstance:a,setSingletonInstance:function(t,n,r){for(var a in e){var i=e[a];if(i.context===t&&i.name===n)return void(e[a].instance=r)}e.push({name:n,context:t,instance:r})},deleteSingletonInstances:function(t){e=e.filter((function(e){return e.context!==t}))},getSingletonFactory:function(t){var r=i(t.__dashjs_factory_name,n);return r||(r=function(n){var r;return void 0===n&&(n={}),{getInstance:function(){return r||(r=a(n,t.__dashjs_factory_name)),r||(r=s(t,n,arguments),e.push({name:t.__dashjs_factory_name,context:n,instance:r})),r}}},n[t.__dashjs_factory_name]=r),r},getSingletonFactoryByName:function(t){return i(t,n)},updateSingletonFactory:function(t,e){o(t,e,n)},getClassFactory:function(t){var e=i(t.__dashjs_factory_name,r);return e||(e=function(e){return void 0===e&&(e={}),{create:function(){return s(t,e,arguments)}}},r[t.__dashjs_factory_name]=e),e},getClassFactoryByName:function(t){return i(t,r)},updateClassFactory:function(t,e){o(t,e,r)}}}();e.a=r},45:function(t,e,n){"use strict";var r=n(3),a=n(13);function i(){return{customTimeRangeArray:[],length:0,add:function(t,e){var n=0;for(n=0;n<this.customTimeRangeArray.length&&t>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:t,end:e}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(t,e){for(var n=0;n<this.customTimeRangeArray.length;n++)if(t<=this.customTimeRangeArray[n].start&&e>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(t>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:e,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=t;break}t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=t:e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=e)}this.length=this.customTimeRangeArray.length},mergeRanges:function(t,e){var n=this.customTimeRangeArray[t],r=this.customTimeRangeArray[e];return n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(n.end=r.end,this.customTimeRangeArray.splice(e,1),!0):r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(n.start=r.start,this.customTimeRangeArray.splice(e,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end?(this.customTimeRangeArray.splice(t,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end&&(this.customTimeRangeArray.splice(e,1),!0)},start:function(t){return Object(a.a)(t),t>=this.customTimeRangeArray.length||t<0?NaN:this.customTimeRangeArray[t].start},end:function(t){return Object(a.a)(t),t>=this.customTimeRangeArray.length||t<0?NaN:this.customTimeRangeArray[t].end}}}i.__dashjs_factory_name="CustomTimeRanges",e.a=r.a.getClassFactory(i)},72:function(t,e,n){"use strict";n.r(e);var r=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};r.SSL_CONNECTION_FAILED_PREFIX="SSL",r.DNS_RESOLUTION_FAILED="C00",r.HOST_UNREACHABLE="C01",r.CONNECTION_REFUSED="C02",r.CONNECTION_ERROR="C03",r.CORRUPT_MEDIA_ISOBMFF="M00",r.CORRUPT_MEDIA_OTHER="M01",r.BASE_URL_CHANGED="F00",r.BECAME_REPORTER="S00";var a=r,i=n(16);function o(t){var e,n,r=(t=t||{}).eventBus,o=t.dashMetrics,s=t.metricsConstants,c=t.events;function u(t){var e=new a;if(n){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.mpdurl||(e.mpdurl=n.originalUrl||n.url),e.terror||(e.terror=new Date),o.addDVBErrors(e)}}function f(t){t.error||(n=t.manifest)}function l(t){u({errorcode:a.BASE_URL_CHANGED,servicelocation:t.entry})}function _(){u({errorcode:a.BECAME_REPORTER})}function h(t){switch(t.metric){case s.HTTP_REQUEST:(0===(e=t.value).responsecode||null==e.responsecode||e.responsecode>=400||e.responsecode<100||e.responsecode>=600)&&u({errorcode:e.responsecode||a.CONNECTION_ERROR,url:e.url,terror:e.tresponse,servicelocation:e._serviceLocation})}var e}function E(t){var e;switch(t.error?t.error.code:0){case MediaError.MEDIA_ERR_NETWORK:e=a.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:e=a.CORRUPT_MEDIA_OTHER;break;default:return}u({errorcode:e})}return e={initialise:function(){r.on(c.MANIFEST_UPDATED,f,e),r.on(c.SERVICE_LOCATION_BLACKLIST_CHANGED,l,e),r.on(c.METRIC_ADDED,h,e),r.on(c.METRIC_UPDATED,h,e),r.on(c.PLAYBACK_ERROR,E,e),r.on(i.a.BECAME_REPORTING_PLAYER,_,e)},reset:function(){r.off(c.MANIFEST_UPDATED,f,e),r.off(c.SERVICE_LOCATION_BLACKLIST_CHANGED,l,e),r.off(c.METRIC_ADDED,h,e),r.off(c.METRIC_UPDATED,h,e),r.off(c.PLAYBACK_ERROR,E,e),r.off(i.a.BECAME_REPORTING_PLAYER,_,e)}}}o.__dashjs_factory_name="DVBErrorsTranslator";var s=dashjs.FactoryMaker.getSingletonFactory(o),c=n(45);function u(t){t=t||{};var e,n,r=!1,a=this.context,i=t.mediaElement;return e={initialize:function(t){t&&t.length&&(t.forEach((function(t){var e=t.starttime,r=e+t.duration;n.add(e,r)})),r=!!t[0]._useWallClockTime)},reset:function(){n.clear()},isEnabled:function(){var t,e=n.length;if(!e)return!0;t=r?(new Date).getTime()/1e3:i.currentTime;for(var a=0;a<e;a+=1){var o=n.start(a),s=n.end(a);if(o<=t&&t<s)return!0}return!1}},n=Object(c.a)(a).create(),e}u.__dashjs_factory_name="RangeController";var f=dashjs.FactoryMaker.getClassFactory(u);function l(){return{serialise:function t(e){var n,r,a=[],i=[];for(n in e)if(e.hasOwnProperty(n)&&0!==n.indexOf("_")){if(null==(r=e[n])&&(r=""),Array.isArray(r)){if(!r.length)continue;i=[],r.forEach((function(e){var n="Object"!==Object.prototype.toString.call(e).slice(8,-1);i.push(n?e:t(e))})),r=i.map(encodeURIComponent).join(",")}else"string"==typeof r?r=encodeURIComponent(r):r instanceof Date?r=r.toISOString():"number"==typeof r&&(r=Math.round(r));a.push(n+"="+r)}return a.join("&")}}}l.__dashjs_factory_name="MetricSerialiser";var _=dashjs.FactoryMaker.getSingletonFactory(l);function h(){var t,e,n,r=window.crypto||window.msCrypto,a=Uint32Array,i=Math.pow(2,8*a.BYTES_PER_ELEMENT)-1;function o(){r&&(t||(t=new a(10)),r.getRandomValues(t),e=0)}return n={random:function(n,a){var s;return n||(n=0),a||(a=1),r?(e===t.length&&o(),s=t[e]/i,e+=1):s=Math.random(),s*(a-n)+n}},o(),n}h.__dashjs_factory_name="RNG";var E=dashjs.FactoryMaker.getSingletonFactory(h);function d(t){var e;t=t||{};var n,r,a,i,o,s,c=this.context,u=[],f=t.metricsConstants;function l(){a=!1,i=!1,o=null,s=null}return e={report:function(t,e){Array.isArray(e)||(e=[e]),i&&s.isEnabled()&&e.forEach((function(e){var r=n.serialise(e);t!==f.DVB_ERRORS&&(r="metricname=".concat(t,"&").concat(r)),function(t,e,n){var r=new XMLHttpRequest,a=function(){var t=u.indexOf(r);-1!==t&&(u.splice(t,1),r.status>=200&&r.status<300?e&&e():n&&n())};u.push(r);try{r.open("GET",t),r.onloadend=a,r.onerror=a,r.send()}catch(t){r.onerror()}}(r="".concat(o,"?").concat(r),null,(function(){i=!1}))}))},initialize:function(t,e){var n;if(s=e,!(o=t.dvb_reportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");a||((n=t.dvb_probability)&&(1e3===n||n/1e3>=r.random())&&(i=!0),a=!0)},reset:function(){l()}},n=_(c).getInstance(),r=E(c).getInstance(),l(),e}d.__dashjs_factory_name="DVBReporting";var y=dashjs.FactoryMaker.getClassFactory(d);function R(t){t=t||{};var e,n={"urn:dvb:dash:reporting:2014":y},r=this.context,a=t.debug?t.debug.getLogger(e):{},i=t.metricsConstants;return e={create:function(t,e){var o;try{(o=n[t.schemeIdUri](r).create({metricsConstants:i})).initialize(t,e)}catch(e){o=null,a.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(t.schemeIdUri," (").concat(e.message,")"))}return o},register:function(t,e){n[t]=e},unregister:function(t){delete n[t]}}}R.__dashjs_factory_name="ReportingFactory";var T=dashjs.FactoryMaker.getSingletonFactory(R);function m(t){var e=[],n=T(this.context).getInstance(t);return{initialize:function(t,r){t.some((function(t){var a=n.create(t,r);if(a)return e.push(a),!0}))},reset:function(){e.forEach((function(t){return t.reset()})),e=[]},report:function(t,n){e.forEach((function(e){return e.report(t,n)}))}}}m.__dashjs_factory_name="ReportingController";var g=dashjs.FactoryMaker.getClassFactory(m);function A(){return{reconstructFullMetricName:function(t,e,n){var r=t;return e&&(r+="("+e,n&&n.length&&(r+=","+n),r+=")"),r},validateN:function(t){if(!t)throw new Error("missing n");if(isNaN(t))throw new Error("n is NaN");if(t<0)throw new Error("n must be positive");return t}}}A.__dashjs_factory_name="HandlerHelpers";var p=dashjs.FactoryMaker.getSingletonFactory(A);function v(t){var e,n,r,a,i;t=t||{};var o=this.context,s=p(o).getInstance(),c=[],u=t.metricsConstants;function f(){var t=function(){try{return Object.keys(c).map((function(t){return c[t]})).reduce((function(t,e){return t.level<e.level?t:e}))}catch(t){return}}();t&&i!==t.t&&(i=t.t,e.report(r,t))}return{initialize:function(t,i,o){i&&(n=s.validateN(o),e=i,r=s.reconstructFullMetricName(t,o),a=setInterval(f,n))},reset:function(){clearInterval(a),a=null,n=0,e=null,i=null},handleNewMetric:function(t,e,n){t===u.BUFFER_LEVEL&&(c[n]=e)}}}v.__dashjs_factory_name="BufferLevelHandler";var C=dashjs.FactoryMaker.getClassFactory(v);var I=dashjs.FactoryMaker.getClassFactory((function(t){var e,n=(t=t||{}).eventBus,r=t.metricsConstants;function a(){n.off(i.a.METRICS_INITIALISATION_COMPLETE,a,this),n.trigger(i.a.BECAME_REPORTING_PLAYER)}return{initialize:function(t,r){r&&(e=r,n.on(i.a.METRICS_INITIALISATION_COMPLETE,a,this))},reset:function(){e=null},handleNewMetric:function(t,n){t===r.DVB_ERRORS&&e&&e.report(t,n)}}}));function O(t){var e,n,r,a,i;t=t||{};var o=[],s=p(this.context).getInstance(),c=t.metricsConstants;function u(){var t=o;t.length&&e&&e.report(a,t),o=[]}return{initialize:function(t,o,c,f){o&&(n=s.validateN(c),e=o,f&&f.length&&(r=f),a=s.reconstructFullMetricName(t,c,f),i=setInterval(u,n))},reset:function(){clearInterval(i),i=null,n=null,r=null,o=[],e=null},handleNewMetric:function(t,e){t===c.HTTP_REQUEST&&(r&&r!==e.type||o.push(e))}}}O.__dashjs_factory_name="HttpListHandler";var M=dashjs.FactoryMaker.getClassFactory(O);function S(){var t,e;return{initialize:function(n,r){t=n,e=r},reset:function(){e=null,t=void 0},handleNewMetric:function(n,r){n===t&&e&&e.report(t,r)}}}S.__dashjs_factory_name="GenericMetricHandler";var D=dashjs.FactoryMaker.getClassFactory(S);function b(t){var e,n=(t=t||{}).debug?t.debug.getLogger(e):{},r=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,a=this.context,i={BufferLevel:C,DVBErrors:I,HttpList:M,PlayList:D,RepSwitchList:D,TcpList:D};return e={create:function(e,o){var s,c=e.match(r);if(c){try{(s=i[c[1]](a).create({eventBus:t.eventBus,metricsConstants:t.metricsConstants})).initialize(c[1],o,c[3],c[5])}catch(t){s=null,n.error("MetricsHandlerFactory: Could not create handler for type ".concat(c[1]," with args ").concat(c[3],", ").concat(c[5]," (").concat(t.message,")"))}return s}},register:function(t,e){i[t]=e},unregister:function(t){delete i[t]}}}b.__dashjs_factory_name="MetricsHandlerFactory";var N=dashjs.FactoryMaker.getSingletonFactory(b);function L(t){t=t||{};var e,n=[],r=this.context,a=t.eventBus,i=t.events,o=N(r).getInstance({debug:t.debug,eventBus:t.eventBus,metricsConstants:t.metricsConstants});function s(t){n.forEach((function(e){e.handleNewMetric(t.metric,t.value,t.mediaType)}))}return e={initialize:function(t,r){t.split(",").forEach((function(t,e,a){var i;if(-1!==t.indexOf("(")&&-1===t.indexOf(")")){var s=a[e+1];s&&-1===s.indexOf("(")&&-1!==s.indexOf(")")&&(t+=","+s,delete a[e+1])}(i=o.create(t,r))&&n.push(i)})),a.on(i.METRIC_ADDED,s,e),a.on(i.METRIC_UPDATED,s,e)},reset:function(){a.off(i.METRIC_ADDED,s,e),a.off(i.METRIC_UPDATED,s,e),n.forEach((function(t){return t.reset()})),n=[]}}}L.__dashjs_factory_name="MetricsHandlersController";var P=dashjs.FactoryMaker.getClassFactory(L);function F(t){var e,n,r;t=t||{};var a=this.context;function i(){e&&e.reset(),n&&n.reset(),r&&r.reset()}return{initialize:function(o){try{(r=f(a).create({mediaElement:t.mediaElement})).initialize(o.Range),(n=g(a).create({debug:t.debug,metricsConstants:t.metricsConstants})).initialize(o.Reporting,r),(e=P(a).create({debug:t.debug,eventBus:t.eventBus,metricsConstants:t.metricsConstants,events:t.events})).initialize(o.metrics,n)}catch(t){throw i(),t}},reset:i}}F.__dashjs_factory_name="MetricsController";var w=dashjs.FactoryMaker.getClassFactory(F);var j=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.metrics="",this.Range=[],this.Reporting=[]};var B=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1};var U=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.schemeIdUri="",this.value="",this.dvb_reportingUrl="",this.dvb_probability=1e3};function H(t){var e=(t=t||{}).adapter,n=t.constants;return{getMetrics:function(t){var r=[];return t&&t.Metrics_asArray&&t.Metrics_asArray.forEach((function(a){var i=new j,o=e.getIsDynamic(t);a.hasOwnProperty("metrics")&&(i.metrics=a.metrics,a.Range_asArray&&a.Range_asArray.forEach((function(r){var a=new B;a.starttime=function(t,r,a){var i,o,s=0;return r?s=e.getAvailabilityStartTime(t)/1e3:(i=e.getRegularPeriods(t)).length&&(s=i[0].start),o=s,a&&a.hasOwnProperty(n.START_TIME)&&(o+=a.starttime),o}(t,o,r),r.hasOwnProperty("duration")?a.duration=r.duration:a.duration=e.getDuration(t),a._useWallClockTime=o,i.Range.push(a)})),a.Reporting_asArray&&(a.Reporting_asArray.forEach((function(t){var e=new U;t.hasOwnProperty(n.SCHEME_ID_URI)&&(e.schemeIdUri=t.schemeIdUri,t.hasOwnProperty("value")&&(e.value=t.value),t.hasOwnProperty(n.DVB_REPORTING_URL)&&(e.dvb_reportingUrl=t[n.DVB_REPORTING_URL]),t.hasOwnProperty(n.DVB_PROBABILITY)&&(e.dvb_probability=t[n.DVB_PROBABILITY]),i.Reporting.push(e))})),r.push(i)))})),r}}}H.__dashjs_factory_name="ManifestParsing";var G=dashjs.FactoryMaker.getSingletonFactory(H);function x(t){var e;t=t||{};var n={},r=this.context,a=t.eventBus,o=t.events;function s(e){if(!e.error){var o=Object.keys(n);G(r).getInstance({adapter:t.adapter,constants:t.constants}).getMetrics(e.manifest).forEach((function(e){var a=JSON.stringify(e);if(n.hasOwnProperty(a))o.splice(a,1);else try{var i=w(r).create(t);i.initialize(e),n[a]=i}catch(t){}})),o.forEach((function(t){n[t].reset(),delete n[t]})),a.trigger(i.a.METRICS_INITIALISATION_COMPLETE)}}function c(){Object.keys(n).forEach((function(t){n[t].reset()})),n={}}return e={reset:function(){a.off(o.MANIFEST_UPDATED,s,e),a.off(o.STREAM_TEARDOWN_COMPLETE,c,e)}},a.on(o.MANIFEST_UPDATED,s,e),a.on(o.STREAM_TEARDOWN_COMPLETE,c,e),e}x.__dashjs_factory_name="MetricsCollectionController";var k=dashjs.FactoryMaker.getClassFactory(x);function V(){var t=this.context;return{createMetricsReporting:function(e){return s(t).getInstance({eventBus:e.eventBus,dashMetrics:e.dashMetrics,metricsConstants:e.metricsConstants,events:e.events}).initialise(),k(t).create(e)},getReportingFactory:function(){return T(t).getInstance()},getMetricsHandlerFactory:function(){return N(t).getInstance()}}}V.__dashjs_factory_name="MetricsReporting";var Y=dashjs.FactoryMaker.getClassFactory(V);Y.events=i.a,dashjs.FactoryMaker.updateClassFactory(V.__dashjs_factory_name,Y);e.default=Y}}).default}));
//# sourceMappingURL=dash.reporting.min.js.map