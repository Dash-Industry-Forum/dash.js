!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(b.dashjs||(b.dashjs={})).Protection=a()}}(function(){return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(b,c,d){"use strict";var e={};e.encode=function(a){for(var b=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);128>d?b.push(d):2048>d?(b.push(192|d>>6),b.push(128|63&d)):65536>d?(b.push(224|d>>12),b.push(128|63&d>>6),b.push(128|63&d)):(b.push(240|d>>18),b.push(128|63&d>>12),b.push(128|63&d>>6),b.push(128|63&d))}return b},e.decode=function(a){for(var b=[],c=0;c<a.length;){var d=a[c++];128>d||(224>d?(d=(31&d)<<6,d|=63&a[c++]):240>d?(d=(15&d)<<12,d|=(63&a[c++])<<6,d|=63&a[c++]):(d=(7&d)<<18,d|=(63&a[c++])<<12,d|=(63&a[c++])<<6,d|=63&a[c++])),b.push(String.fromCharCode(d))}return b.join("")};var f={};!function(b){var c=function(a){for(var c=0,d=[],e=0|a.length/3;0<e--;){var f=(a[c]<<16)+(a[c+1]<<8)+a[c+2];c+=3,d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push(b.charAt(63&f))}if(2==a.length-c){var f=(a[c]<<16)+(a[c+1]<<8);d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push("=")}else if(1==a.length-c){var f=a[c]<<16;d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push("==")}return d.join("")},d=function(){for(var a=[],c=0;c<b.length;++c)a[b.charCodeAt(c)]=c;return a["=".charCodeAt(0)]=0,a}(),g=function(a){for(var b=0,c=[],e=0|a.length/4;0<e--;){var f=(d[a.charCodeAt(b)]<<18)+(d[a.charCodeAt(b+1)]<<12)+(d[a.charCodeAt(b+2)]<<6)+d[a.charCodeAt(b+3)];c.push(255&f>>16),c.push(255&f>>8),c.push(255&f),b+=4}return c&&("="==a.charAt(b-2)?(c.pop(),c.pop()):"="==a.charAt(b-1)&&c.pop()),c},h={};h.encode=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b},h.decode=function(b){for(var c=0;c<s.length;++c)a[c]=String.fromCharCode(a[c]);return a.join("")},f.decodeArray=function(a){var b=g(a);return new Uint8Array(b)},f.encodeASCII=function(a){var b=h.encode(a);return c(b)},f.decodeASCII=function(a){var b=g(a);return h.decode(b)},f.encode=function(a){var b=e.encode(a);return c(b)},f.decode=function(a){var b=g(a);return e.decode(b)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),"undefined"!=typeof d&&(d.decode=f.decode,d.decodeArray=f.decodeArray)},{}],2:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a,b,c){if(!a)throw new Error("event type cannot be null or undefined");if(!b||"function"!=typeof b)throw new Error("listener must be a function: "+b);if(!(e(a,b,c)>=0)){var d={callback:b,scope:c};g[a]=g[a]||[],g[a].push(d)}}function b(a,b,c){if(a&&b&&g[a]){var d=e(a,b,c);0>d||g[a].splice(d,1)}}function c(a,b){if(a&&g[a]){if(b=b||{},b.hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");b.type=a,g[a].forEach(function(a){a.callback.call(a.scope,b)})}}function d(){g={}}function e(a,b,c){var d=g[a],e=-1;if(!d||0===d.length)return e;for(var f=0;f<d.length;f++)if(d[f].callback===b&&(!c||c===d[f].scope))return f;return e}var f=void 0,g={};return f={on:a,off:b,trigger:c,reset:d}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("./FactoryMaker.js"),g=d(f);e.__dashjs_factory_name="EventBus",c["default"]=g["default"].getSingletonFactory(e),b.exports=c["default"]},{"./FactoryMaker.js":3}],3:[function(a,b,c){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d=function(){function a(a,b,c,d){var e=g(d);!e[a]&&b&&(e[a]={instance:b,override:c})}function b(a,b){for(var c in j){var d=j[c];if(d.context===a&&d.name===b)return d.instance}return null}function c(a,b,c){for(var d in j){var e=j[d];if(e.context===a&&e.name===b)return void(j[d].instance=c)}j.push({name:b,context:a,instance:c})}function d(a){return function(b){return void 0===b&&(b={}),{create:function(){return f(a.__dashjs_factory_name,a.apply({context:b},arguments),b,arguments)}}}}function e(a){return function(c){var d=void 0;return void 0===c&&(c={}),{getInstance:function(){return d||(d=b(c,a.__dashjs_factory_name)),d||(d=f(a.__dashjs_factory_name,a.apply({context:c},arguments),c,arguments),j.push({name:a.__dashjs_factory_name,context:c,instance:d})),d}}}}function f(a,b,c,d){var e=g(c),f=e[a];if(f){var i=f.instance;if(!f.override)return i.apply({context:c,factory:h},d);i=i.apply({context:c,factory:h,parent:b},d);for(var j in i)b.hasOwnProperty(j)&&(b[j]=i[j])}return b}function g(a){var b=void 0;return i.forEach(function(c){c===a&&(b=c)}),b||(b=i.push(a)),b}var h=void 0,i=[],j=[];return h={extend:a,getSingletonInstance:b,setSingletonInstance:c,getSingletonFactory:e,getClassFactory:d}}();c["default"]=d,b.exports=c["default"]},{}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},h=a("./EventsBase.js"),i=d(h),j=function(a){function b(){e(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this.AST_IN_FUTURE="astinfuture",this.BUFFERING_COMPLETED="bufferingCompleted",this.BUFFER_CLEARED="bufferCleared",this.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",this.BYTES_APPENDED="bytesAppended",this.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",this.CHUNK_APPENDED="chunkAppended",this.CURRENT_TRACK_CHANGED="currenttrackchanged",this.DATA_UPDATE_COMPLETED="dataUpdateCompleted",this.DATA_UPDATE_STARTED="dataUpdateStarted",this.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",this.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",this.INITIALIZATION_LOADED="initializationLoaded",this.INIT_FRAGMENT_LOADED="initFragmentLoaded",this.INIT_REQUESTED="initRequested",this.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",this.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",this.LOADING_COMPLETED="loadingCompleted",this.LOADING_PROGRESS="loadingProgress",this.MANIFEST_UPDATED="manifestUpdated",this.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",this.QUALITY_CHANGED="qualityChanged",this.QUOTA_EXCEEDED="quotaExceeded",this.REPRESENTATION_UPDATED="representationUpdated",this.SEGMENTS_LOADED="segmentsLoaded",this.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",this.SOURCEBUFFER_APPEND_COMPLETED="sourceBufferAppendCompleted",this.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",this.STREAMS_COMPOSED="streamsComposed",this.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",this.STREAM_COMPLETED="streamCompleted",this.STREAM_INITIALIZED="streaminitialized",this.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",this.TIMED_TEXT_REQUESTED="timedTextRequested",this.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",this.URL_RESOLUTION_FAILED="urlResolutionFailed",this.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",this.XLINK_ALL_ELEMENTS_LOADED="xlinkAllElementsLoaded",this.XLINK_ELEMENT_LOADED="xlinkElementLoaded",this.XLINK_READY="xlinkReady"}return f(b,a),b}(i["default"]);c["default"]=j,b.exports=c["default"]},{"./EventsBase.js":6}],5:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},h=a("./CoreEvents.js"),i=d(h),j=function(a){function b(){e(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return f(b,a),b}(i["default"]),k=new j;c["default"]=k,b.exports=c["default"]},{"./CoreEvents.js":4}],6:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(){d(this,a)}return e(a,[{key:"extend",value:function(a,b){if(a){var c=b?b.override:!1,d=b?b.publicOnly:!1;for(var e in a)!a.hasOwnProperty(e)||this[e]&&!c||d&&-1===a[e].indexOf("public_")||(this[e]=a[e])}}}]),a}();c["default"]=f,b.exports=c["default"]},{}],7:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=a("../../../externals/base64.js"),h=d(g),i=function(){function a(){e(this,a)}return f(a,null,[{key:"findCencContentProtection",value:function(a){for(var b=null,c=0;c<a.length;++c){var d=a[c];"urn:mpeg:dash:mp4protection:2011"===d.schemeIdUri.toLowerCase()&&"cenc"===d.value.toLowerCase()&&(b=d)}return b}},{key:"getPSSHData",value:function(a){var b=8,c=new DataView(a),d=c.getUint8(b);return b+=20,d>0&&(b+=4+16*c.getUint32(b)),b+=4,a.slice(b)}},{key:"getPSSHForKeySystem",value:function(b,c){var d=a.parsePSSHList(c);return d.hasOwnProperty(b.uuid.toLowerCase())?d[b.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(a){return"pssh"in a?h["default"].decodeArray(a.pssh.__text).buffer:null}},{key:"parsePSSHList",value:function(a){if(null===a)return[];for(var b=new DataView(a),c=!1,d={},e=0;!c;){var f,g,h,i,j,k=e;if(e>=b.buffer.byteLength)break;if(f=b.getUint32(e),g=e+f,e+=4,1886614376===b.getUint32(e))if(e+=4,h=b.getUint8(e),0===h||1===h){e++,e+=3,i="";var l,m;for(l=0;4>l;l++)m=b.getUint8(e+l).toString(16),i+=1===m.length?"0"+m:m;for(e+=4,i+="-",l=0;2>l;l++)m=b.getUint8(e+l).toString(16),i+=1===m.length?"0"+m:m;for(e+=2,i+="-",l=0;2>l;l++)m=b.getUint8(e+l).toString(16),i+=1===m.length?"0"+m:m;for(e+=2,i+="-",l=0;2>l;l++)m=b.getUint8(e+l).toString(16),i+=1===m.length?"0"+m:m;for(e+=2,i+="-",l=0;6>l;l++)m=b.getUint8(e+l).toString(16),i+=1===m.length?"0"+m:m;e+=6,i=i.toLowerCase(),j=b.getUint32(e),e+=4,d[i]=b.buffer.slice(k,g),e=g}else e=g;else e=g}return d}}]),a}();c["default"]=i,b.exports=c["default"]},{"../../../externals/base64.js":1}],8:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){var c=null,d=(0,i["default"])(e).getInstance();d.setConfig({log:a.log}),d.initialize();var f=b(a);return!c&&f&&(c=(0,g["default"])(e).create({protectionModel:f,protectionKeyController:d,adapter:a.adapter,eventBus:a.eventBus,log:a.log}),a.capabilities.setEncryptedMediaSupported(!0)),c}function b(a){var b=a.log,d=a.eventBus,f=a.videoModel.getElement();return void 0!==f.onencrypted&&void 0!==f.mediaKeys&&void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess?(b("EME detected on this user agent! (ProtectionModel_21Jan2015)"),(0,m["default"])(e).create({log:b,eventBus:d})):c(f,u)?(b("EME detected on this user agent! (ProtectionModel_3Feb2014)"),(0,o["default"])(e).create({log:b,eventBus:d,api:c(f,u)})):c(f,t)?(b("EME detected on this user agent! (ProtectionModel_01b)"),(0,q["default"])(e).create({log:b,eventBus:d,api:c(f,t)})):(b("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null)}function c(a,b){for(var c=0;c<b.length;c++){var d=b[c];if("function"==typeof a[d[Object.keys(d)[0]]])return d}return null}var d=void 0,e=this.context;return d={createProtectionSystem:a}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("./controllers/ProtectionController.js"),g=d(f),h=a("./controllers/ProtectionKeyController.js"),i=d(h),j=a("./ProtectionEvents.js"),k=d(j),l=a("./models/ProtectionModel_21Jan2015.js"),m=d(l),n=a("./models/ProtectionModel_3Feb2014.js"),o=d(n),p=a("./models/ProtectionModel_01b.js"),q=d(p),r=a("../../core/FactoryMaker.js"),s=d(r),t=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],u=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];e.__dashjs_factory_name="Protection";var v=s["default"].getClassFactory(e);v.events=k["default"],c["default"]=v,b.exports=c["default"]},{"../../core/FactoryMaker.js":3,"./ProtectionEvents.js":9,"./controllers/ProtectionController.js":10,"./controllers/ProtectionKeyController.js":11,"./models/ProtectionModel_01b.js":15,"./models/ProtectionModel_21Jan2015.js":16,"./models/ProtectionModel_3Feb2014.js":17}],9:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(c,"__esModule",{value:!0});var g=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;if(void 0===i)return;return i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return;a=j,b=f,c=g,d=!0,h=j=void 0}},h=a("../../core/events/EventsBase.js"),i=d(h),j=function(a){function b(){e(this,b),g(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this.INTERNAL_KEY_MESSAGE="internalKeyMessage",this.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",this.KEY_ADDED="public_keyAdded",this.KEY_ERROR="public_keyError",this.KEY_MESSAGE="public_keyMessage",this.KEY_SESSION_CLOSED="public_keySessionClosed",this.KEY_SESSION_CREATED="public_keySessionCreated",this.KEY_SESSION_REMOVED="public_keySessionRemoved",this.KEY_STATUSES_CHANGED="public_keyStatusesChanged",this.KEY_SYSTEM_ACCESS_COMPLETE="keySystemAccessComplete",this.KEY_SYSTEM_SELECTED="public_keySystemSelected",this.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",this.NEED_KEY="needkey",this.PROTECTION_CREATED="public_protectioncreated",this.PROTECTION_DESTROYED="public_protectiondestroyed",this.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",this.TEARDOWN_COMPLETE="protectionTeardownComplete",this.VIDEO_ELEMENT_SELECTED="videoElementSelected"}return f(b,a),b}(i["default"]),k=new j;c["default"]=k,b.exports=c["default"]},{"../../core/events/EventsBase.js":6}],10:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){function b(){C=w.getKeySystems(),D=[],H=!1,I="temporary",i["default"].extend(q["default"].events)}function c(a,b,c){if(!H){var d;b||c||(d=y.getStreamsInfo(a)[0]),E=b||(d?y.getMediaInfoForType(a,d,"audio"):null),F=c||(d?y.getMediaInfoForType(a,d,"video"):null);var e=F?F:E,f=w.getSupportedKeySystemsFromContentProtection(e.contentProtection);f&&f.length>0&&s(f,!0),H=!0}}function d(a){var b=g["default"].getPSSHForKeySystem(J,a);if(b){for(var c=x.getAllInitData(),d=0;d<c.length;d++)if(w.initDataEquals(b,c[d]))return void A("DRM: Ignoring initData because we have already seen it!");try{x.createKeySession(b,I)}catch(e){z.trigger(i["default"].KEY_SESSION_CREATED,{data:null,error:"Error creating key session! "+e.message})}}else z.trigger(i["default"].KEY_SESSION_CREATED,{data:null,error:"Selected key system is "+J.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!"})}function e(a){x.loadKeySession(a)}function f(a){x.removeKeySession(a)}function h(a){x.closeKeySession(a)}function j(a){x.setServerCertificate(a)}function l(a){a?(x.setMediaElement(a),z.on(i["default"].NEED_KEY,v,this),z.on(i["default"].INTERNAL_KEY_MESSAGE,u,this)):null===a&&(x.setMediaElement(a),z.off(i["default"].NEED_KEY,v,this),z.off(i["default"].INTERNAL_KEY_MESSAGE,u,this))}function n(a){I=a}function o(a){G=a}function p(){l(null),J=void 0,x&&(x.reset(),x=null)}function r(a){var b=null,c=a.systemString;return G&&(b=c in G?G[c]:null),b}function s(a,b){var c=this,e=[],f=[];F&&f.push(new k["default"](F.codec)),E&&e.push(new k["default"](E.codec));var g,h=new m["default"](e,f,"optional","temporary"===I?"optional":"required",[I]),j=[];if(J){for(g=0;g<a.length;g++)if(J===a[g].ks){var l=function(){j.push({ks:a[g].ks,configs:[h]});var e=function f(e){z.off(i["default"].KEY_SYSTEM_ACCESS_COMPLETE,f,c),e.error?b||z.trigger(i["default"].KEY_SYSTEM_SELECTED,{error:"DRM: KeySystem Access Denied! -- "+e.error}):(A("DRM: KeySystem Access Granted"),z.trigger(i["default"].KEY_SYSTEM_SELECTED,{data:e.data}),d(a[g].initData))};return z.on(i["default"].KEY_SYSTEM_ACCESS_COMPLETE,e,c),x.requestKeySystemAccess(j),"break"}();if("break"===l)break}}else if(void 0===J){J=null,D.push(a);for(var n=0;n<a.length;n++)j.push({ks:a[n].ks,configs:[h]});var o,p=function r(a){z.off(i["default"].KEY_SYSTEM_ACCESS_COMPLETE,r,c),a.error?(J=void 0,z.off(i["default"].INTERNAL_KEY_SYSTEM_SELECTED,q,c),b||z.trigger(i["default"].KEY_SYSTEM_SELECTED,{data:null,error:"DRM: KeySystem Access Denied! -- "+a.error})):(o=a.data,A("DRM: KeySystem Access Granted ("+o.keySystem.systemString+")!  Selecting key system..."),x.selectKeySystem(o))},q=function s(a){if(z.off(i["default"].INTERNAL_KEY_SYSTEM_SELECTED,s,c),z.off(i["default"].KEY_SYSTEM_ACCESS_COMPLETE,p,c),a.error)J=void 0,b||z.trigger(i["default"].KEY_SYSTEM_SELECTED,{data:null,error:"DRM: Error selecting key system! -- "+a.error});else{J=x.getKeySystem(),z.trigger(i["default"].KEY_SYSTEM_SELECTED,{data:o});for(var e=0;e<D.length;e++)for(g=0;g<D[e].length;g++)if(J===D[e][g].ks){d(D[e][g].initData);break}}};z.on(i["default"].INTERNAL_KEY_SYSTEM_SELECTED,q,c),z.on(i["default"].KEY_SYSTEM_ACCESS_COMPLETE,p,c),x.requestKeySystemAccess(j)}else D.push(a)}function t(a,b){z.trigger(i["default"].LICENSE_REQUEST_COMPLETE,{data:a,error:b})}function u(a){if(A("DRM: onKeyMessage"),a.error)return void A(a.error);var b=a.data;z.trigger(i["default"].KEY_MESSAGE,{data:b});var c=b.messageType?b.messageType:"license-request",d=b.message,e=b.sessionToken,f=r(J),h=J.systemString,j=w.getLicenseServer(J,f,c),k={sessionToken:e,messageType:c};if(!j)return A("DRM: License server request not required for this message (type = "+a.data.messageType+").  Session ID = "+e.getSessionID()),void t(k);if(w.isClearKey(J)){var l=w.processClearKeyLicenseRequest(f,d);if(l)return A("DRM: ClearKey license request handled by application!"),t(k),void x.updateKeySession(e,l)}var m=new XMLHttpRequest,n=null;if(f)if(f.serverURL){var o=f.serverURL;"string"==typeof o&&""!==o?n=o:"object"==typeof o&&o.hasOwnProperty(c)&&(n=o[c])}else f.laURL&&""!==f.laURL&&(n=f.laURL);else n=J.getLicenseServerURLFromInitData(g["default"].getPSSHData(e.initData)),n||(n=a.data.laURL);if(n=j.getServerURLFromMessage(n,d,c),!n)return void t(k,"DRM: No license server URL specified!");m.open(j.getHTTPMethod(c),n,!0),m.responseType=j.getResponseType(h,c),m.onload=function(){200==this.status?(t(k),x.updateKeySession(e,j.getLicenseMessage(this.response,h,c))):t(k,"DRM: "+h+' update, XHR status is "'+this.statusText+'" ('+this.status+"), expected to be 200. readyState is "+this.readyState+".  Response is "+(this.response?j.getErrorResponse(this.response,h,c):"NONE"))},m.onabort=function(){t(k,"DRM: "+h+' update, XHR aborted. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},m.onerror=function(){t(k,"DRM: "+h+' update, XHR error. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)};var p=function(a){var b;if(a)for(b in a)"authorization"===b.toLowerCase()&&(m.withCredentials=!0),m.setRequestHeader(b,a[b])};f&&p(f.httpRequestHeaders),p(J.getRequestHeadersFromMessage(d)),f&&f.withCredentials&&(m.withCredentials=!0),m.send(J.getLicenseRequestFromMessage(d))}function v(a){if(A("DRM: onNeedKey"),"cenc"!==a.key.initDataType)return void A("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+a.key.initDataType);var b=a.key.initData;ArrayBuffer.isView(b)&&(b=b.buffer),A("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(b)));var c=w.getSupportedKeySystems(b);return 0===c.length?void A("DRM: Received needkey event with initData, but we don't support any of the key systems!"):void s(c,!1)}var w=a.protectionKeyController,x=a.protectionModel,y=a.adapter,z=a.eventBus,A=a.log,B=void 0,C=void 0,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0;return B={initialize:c,createKeySession:d,loadKeySession:e,removeKeySession:f,closeKeySession:h,setServerCertificate:j,setMediaElement:l,setSessionType:n,setProtectionData:o,reset:p},b(),B}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../CommonEncryption.js"),g=d(f),h=a("../../../core/events/Events.js"),i=d(h),j=a("../vo/MediaCapability.js"),k=d(j),l=a("../vo/KeySystemConfiguration.js"),m=d(l),n=a("../../../core/FactoryMaker.js"),o=d(n),p=a("../Protection.js"),q=d(p);e.__dashjs_factory_name="ProtectionController",c["default"]=o["default"].getClassFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"../../../core/events/Events.js":5,"../CommonEncryption.js":7,"../Protection.js":8,"../vo/KeySystemConfiguration.js":27,"../vo/MediaCapability.js":28}],11:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){a&&a.log&&(t=a.log)}function b(){v=[];var a;a=(0,m["default"])(p).getInstance(),v.push(a),a=(0,k["default"])(p).getInstance(),v.push(a),a=(0,i["default"])(p).getInstance(),v.push(a),w=a}function c(){return v}function d(a){for(var b=0;b<v.length;b++)if(v[b].systemString===a)return v[b];return null}function e(a){return a===w}function f(a,b){if(a.byteLength===b.byteLength){for(var c=new Uint8Array(a),d=new Uint8Array(b),e=0;e<c.length;e++)if(c[e]!==d[e])return!1;return!0}return!1}function h(a){var b,c,d,e,f=[];if(a)for(d=0;d<v.length;++d)for(c=v[d],e=0;e<a.length;++e)if(b=a[e],b.schemeIdUri.toLowerCase()===c.schemeIdURI){var g=c.getInitData(b);g&&f.push({ks:v[d],initData:g})}return f}function j(a){var b,c=[],d=g["default"].parsePSSHList(a);for(b=0;b<v.length;++b)v[b].uuid in d&&c.push({ks:v[b],initData:d[v[b].uuid]});return c}function l(a,b,c){if("license-release"===c||"individualization-request"==c)return null;var d=null;return b&&b.hasOwnProperty("drmtoday")?d=(0,o["default"])(p).getInstance():"com.widevine.alpha"===a.systemString?d=(0,s["default"])(p).getInstance():"com.microsoft.playready"===a.systemString?d=(0,q["default"])(p).getInstance():"org.w3.clearkey"===a.systemString&&(d=(0,u["default"])(p).getInstance()),d}function n(a,b){try{return w.getClearKeysFromProtectionData(a,b)}catch(c){return t("Failed to retrieve clearkeys from ProtectionData"),null}}var p=this.context,r=void 0,t=void 0,v=void 0,w=void 0;return r={initialize:b,isClearKey:e,initDataEquals:f,getKeySystems:c,getKeySystemBySystemString:d,getSupportedKeySystemsFromContentProtection:h,getSupportedKeySystems:j,getLicenseServer:l,processClearKeyLicenseRequest:n,setConfig:a}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("./../CommonEncryption.js"),g=d(f),h=a("./../drm/KeySystemClearKey.js"),i=d(h),j=a("./../drm/KeySystemWidevine.js"),k=d(j),l=a("./../drm/KeySystemPlayReady.js"),m=d(l),n=a("./../servers/DRMToday.js"),o=d(n),p=a("./../servers/PlayReady.js"),q=d(p),r=a("./../servers/Widevine.js"),s=d(r),t=a("./../servers/ClearKey.js"),u=d(t),v=a("../../../core/FactoryMaker.js"),w=d(v);e.__dashjs_factory_name="ProtectionKeyController",c["default"]=w["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"./../CommonEncryption.js":7,"./../drm/KeySystemClearKey.js":12,"./../drm/KeySystemPlayReady.js":13,"./../drm/KeySystemWidevine.js":14,"./../servers/ClearKey.js":18,"./../servers/DRMToday.js":19,"./../servers/PlayReady.js":20,"./../servers/Widevine.js":21}],12:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a,b){var c=null;if(a){for(var d=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(b))),e=[],f=0;f<d.kids.length;f++){var h=d.kids[f],j=a.clearkeys.hasOwnProperty(h)?a.clearkeys[h]:null;if(!j)throw new Error("DRM: ClearKey keyID ("+h+") is not known!");e.push(new g["default"](h,j))}c=new i["default"](e)}return c}function b(a){return k["default"].parseInitDataFromContentProtection(a)}function c(){return null}function d(a){return new Uint8Array(a)}function e(){return null}var f=void 0;return f={uuid:n,schemeIdURI:p,systemString:o,getInitData:b,getRequestHeadersFromMessage:c,getLicenseRequestFromMessage:d,getLicenseServerURLFromInitData:e,getClearKeysFromProtectionData:a}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../vo/KeyPair.js"),g=d(f),h=a("../vo/ClearKeyKeySet.js"),i=d(h),j=a("../CommonEncryption.js"),k=d(j),l=a("../../../core/FactoryMaker.js"),m=d(l),n="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",o="org.w3.clearkey",p="urn:uuid:"+n;e.__dashjs_factory_name="KeySystemClearKey",c["default"]=m["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"../CommonEncryption.js":7,"../vo/ClearKeyKeySet.js":22,"../vo/KeyPair.js":25}],13:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){var b,c,d={},e=new DOMParser,f="utf16"===h?new Uint16Array(a):new Uint8Array(a);b=String.fromCharCode.apply(null,f),c=e.parseFromString(b,"application/xml");for(var g=c.getElementsByTagName("name"),i=c.getElementsByTagName("value"),j=0;j<g.length;j++)d[g[j].childNodes[0].nodeValue]=i[j].childNodes[0].nodeValue;return d.hasOwnProperty("Content")&&(d["Content-Type"]=d.Content,delete d.Content),d}function b(a){var b,c,d=null,e=new DOMParser,f="utf16"===h?new Uint16Array(a):new Uint8Array(a);if(b=String.fromCharCode.apply(null,f),c=e.parseFromString(b,"application/xml"),c.getElementsByTagName("Challenge")[0]){var g=c.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;g&&(d=m["default"].decode(g))}return d}function c(a){if(a)for(var b=new DataView(a),c=b.getUint16(4,!0),d=6,e=new DOMParser,f=0;c>f;f++){var g=b.getUint16(d,!0);d+=2;var h=b.getUint16(d,!0);if(d+=2,1===g){var i=a.slice(d,d+h),j=String.fromCharCode.apply(null,new Uint16Array(i)),k=e.parseFromString(j,"application/xml");if(k.getElementsByTagName("LA_URL")[0]){var l=k.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(l)return l}if(k.getElementsByTagName("LUI_URL")[0]){var m=k.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(m)return m}}else d+=h}return null}function d(a){var b,c,d,e,f,h=new Uint8Array([112,115,115,104,0,0,0,0]),i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),j=0,k=null;if("pssh"in a)return g["default"].parseInitDataFromContentProtection(a);if("pro"in a)k=m["default"].decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;k=m["default"].decodeArray(a.prheader.__text)}return b=k.length,c=4+h.length+i.length+4+b,d=new ArrayBuffer(c),e=new Uint8Array(d),f=new DataView(d),f.setUint32(j,c),j+=4,e.set(h,j),j+=h.length,e.set(i,j),j+=i.length,f.setUint32(j,b),j+=4,e.set(k,j),j+=b,e.buffer}function e(a){if("utf8"!==a&&"utf16"!==a)throw new i["default"]("Illegal PlayReady message format! -- "+a);h=a}var f=void 0,h="utf16";return f={uuid:n,schemeIdURI:p,systemString:o,getInitData:d,getRequestHeadersFromMessage:a,getLicenseRequestFromMessage:b,getLicenseServerURLFromInitData:c,setPlayReadyMessageFormat:e}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../CommonEncryption.js"),g=d(f),h=a("../../vo/Error.js"),i=d(h),j=a("../../../core/FactoryMaker.js"),k=d(j),l=a("../../../../externals/base64.js"),m=d(l),n="9a04f079-9840-4286-ab92-e65be0885f95",o="com.microsoft.playready",p="urn:uuid:"+n;e.__dashjs_factory_name="KeySystemPlayReady",c["default"]=k["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../../externals/base64.js":1,"../../../core/FactoryMaker.js":3,"../../vo/Error.js":31,"../CommonEncryption.js":7}],14:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){return g["default"].parseInitDataFromContentProtection(a)}function b(){return null}function c(a){return new Uint8Array(a)}function d(){return null}var e=void 0;return e={uuid:j,schemeIdURI:l,systemString:k,getInitData:a,getRequestHeadersFromMessage:b,getLicenseRequestFromMessage:c,getLicenseServerURLFromInitData:d}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../CommonEncryption.js"),g=d(f),h=a("../../../core/FactoryMaker.js"),i=d(h),j="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",k="com.widevine.alpha",l="urn:uuid:"+j;e.__dashjs_factory_name="KeySystemWidevine",c["default"]=i["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"../CommonEncryption.js":7}],15:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){function b(){E=null,F=null,I=[],J=[],G=(0,g["default"])(z).getInstance(),H=(0,u["default"])(z).getInstance(),L=w()}function c(){E&&y();for(var a=0;a<J.length;a++)p(J[a]);A.trigger(s["default"].TEARDOWN_COMPLETE)}function d(){return F}function e(){for(var a=[],b=0;b<I.length;b++)a.push(I[b].initData);for(var b=0;b<J.length;b++)a.push(J[b].initData);return a}function f(a){var b=E;b||(b=document.createElement("video"));for(var c=!1,d=0;d<a.length;d++)for(var e=a[d].ks.systemString,f=a[d].configs,g=null,h=null,i=0;i<f.length;i++){var j=f[i].videoCapabilities;if(j&&0!==j.length){h=[];for(var k=0;k<j.length;k++)""!==b.canPlayType(j[k].contentType,e)&&h.push(j[k]);
}if(!(!g&&!h||g&&0===g.length||h&&0===h.length)){c=!0;var l=new o["default"](g,h),m=G.getKeySystemBySystemString(e);A.trigger(s["default"].KEY_SYSTEM_ACCESS_COMPLETE,{data:new q["default"](m,l)});break}}c||A.trigger(s["default"].KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})}function h(a){F=a.keySystem,A.trigger(s["default"].INTERNAL_KEY_SYSTEM_SELECTED)}function j(a){E!==a&&(E&&y(),E=a,E&&(E.addEventListener(C.keyerror,L),E.addEventListener(C.needkey,L),E.addEventListener(C.keymessage,L),E.addEventListener(C.keyadded,L),A.trigger(s["default"].VIDEO_ELEMENT_SELECTED)))}function l(a){if(!F)throw new Error("Can not create sessions until you have selected a key system");if(K||0===J.length){var b={sessionID:null,initData:a,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return I.push(b),E[C.generateKeyRequest](F.systemString,new Uint8Array(a)),b}throw new Error("Multiple sessions not allowed!")}function n(a,b){var c=a.sessionID;if(G.isClearKey(F))for(var d=0;d<b.keyPairs.length;d++)E[C.addKey](F.systemString,b.keyPairs[d].key,b.keyPairs[d].keyID,c);else E[C.addKey](F.systemString,new Uint8Array(b),a.initData,c)}function p(a){E[C.cancelKeyRequest](F.systemString,a.sessionID)}function r(){}function t(){}function v(){}function w(){return{handleEvent:function(a){var b=null;switch(a.type){case C.needkey:var c=ArrayBuffer.isView(a.initData)?a.initData.buffer:a.initData;A.trigger(s["default"].NEED_KEY,{key:new i["default"](c,"cenc")});break;case C.keyerror:if(b=x(J,a.sessionId),b||(b=x(I,a.sessionId)),b){var d="";switch(a.errorCode.code){case 1:d+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:d+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:d+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:d+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:d+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:d+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}d+="  System Code = "+a.systemCode,A.trigger(s["default"].KEY_ERROR,{data:new k["default"](b,d)})}else B("No session token found for key error");break;case C.keyadded:b=x(J,a.sessionId),b||(b=x(I,a.sessionId)),b?(B("DRM: Key added."),A.trigger(s["default"].KEY_ADDED,{data:b})):B("No session token found for key added");break;case C.keymessage:if(K=null!==a.sessionId&&void 0!==a.sessionId,K?(b=x(J,a.sessionId),!b&&I.length>0&&(b=I.shift(),J.push(b),b.sessionID=a.sessionId)):I.length>0&&(b=I.shift(),J.push(b),0!==I.length&&H.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),b){var e=ArrayBuffer.isView(a.message)?a.message.buffer:a.message;b.keyMessage=e,A.trigger(s["default"].INTERNAL_KEY_MESSAGE,{data:new m["default"](b,e,a.defaultURL)})}else B("No session token found for key message")}}}}function x(a,b){if(b&&a){for(var c=a.length,d=0;c>d;d++)if(a[d].sessionID==b)return a[d];return null}return null}function y(){E.removeEventListener(C.keyerror,L),E.removeEventListener(C.needkey,L),E.removeEventListener(C.keymessage,L),E.removeEventListener(C.keyadded,L)}var z=this.context,A=a.eventBus,B=a.log,C=a.api,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=void 0;return D={getAllInitData:e,requestKeySystemAccess:f,getKeySystem:d,selectKeySystem:h,setMediaElement:j,createKeySession:l,updateKeySession:n,closeKeySession:p,setServerCertificate:r,loadKeySession:t,removeKeySession:v,reset:c},b(),D}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../controllers/ProtectionKeyController.js"),g=d(f),h=a("../vo/NeedKey.js"),i=d(h),j=a("../vo/KeyError.js"),k=d(j),l=a("../vo/KeyMessage.js"),m=d(l),n=a("../vo/KeySystemConfiguration.js"),o=d(n),p=a("../vo/KeySystemAccess.js"),q=d(p),r=a("../../../core/events/Events.js"),s=d(r),t=a("../../utils/ErrorHandler.js"),u=d(t),v=a("../../../core/FactoryMaker.js"),w=d(v);e.__dashjs_factory_name="ProtectionModel_01b",c["default"]=w["default"].getClassFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"../../../core/events/Events.js":5,"../../utils/ErrorHandler.js":30,"../controllers/ProtectionKeyController.js":11,"../vo/KeyError.js":23,"../vo/KeyMessage.js":24,"../vo/KeySystemAccess.js":26,"../vo/KeySystemConfiguration.js":27,"../vo/NeedKey.js":29}],16:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){function b(){A=null,B=null,C=null,D=[],F=(0,g["default"])(G).getInstance(),E=w()}function c(){var a,b=D.length;if(0!==b)for(var c=function(a){x(a),0===D.length&&(B?(B.removeEventListener("encrypted",E),B.setMediaKeys(null).then(function(){H.trigger(q["default"].TEARDOWN_COMPLETE)})):H.trigger(q["default"].TEARDOWN_COMPLETE))},d=0;b>d;d++)a=D[d],function(b){a.session.closed.then(function(){c(b)}),v(a)["catch"](function(){c(b)})}(a);else H.trigger(q["default"].TEARDOWN_COMPLETE)}function d(){return A}function e(){for(var a=[],b=0;b<D.length;b++)a.push(D[b].initData);return a}function f(a){u(a,0)}function h(a){a.mksa.createMediaKeys().then(function(b){A=a.keySystem,C=b,B&&B.setMediaKeys(C),H.trigger(q["default"].INTERNAL_KEY_SYSTEM_SELECTED)})["catch"](function(){H.trigger(q["default"].INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+a.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})}function j(a){B!==a&&(B&&(B.removeEventListener("encrypted",E),B.setMediaKeys(null)),B=a,B&&(B.addEventListener("encrypted",E),C&&B.setMediaKeys(C)))}function l(a){if(!A||!C)throw new Error("Can not set server certificate until you have selected a key system");C.setServerCertificate(a).then(function(){I("DRM: License server certificate successfully updated."),H.trigger(q["default"].SERVER_CERTIFICATE_UPDATED)})["catch"](function(a){H.trigger(q["default"].SERVER_CERTIFICATE_UPDATED,{error:"Error updating server certificate -- "+a.name})})}function n(a,b){if(!A||!C)throw new Error("Can not create sessions until you have selected a key system");var c=C.createSession(b),d=y(c,a,b);c.generateRequest("cenc",a).then(function(){I("DRM: Session created.  SessionID = "+d.getSessionID()),H.trigger(q["default"].KEY_SESSION_CREATED,{data:d})})["catch"](function(a){x(d),H.trigger(q["default"].KEY_SESSION_CREATED,{data:null,error:"Error generating key request -- "+a.name})})}function p(a,b){var c=a.session;F.isClearKey(A)&&(b=b.toJWK()),c.update(b)["catch"](function(b){H.trigger(q["default"].KEY_ERROR,{data:new k["default"](a,"Error sending update() message! "+b.name)})})}function r(a){if(!A||!C)throw new Error("Can not load sessions until you have selected a key system");var b=C.createSession();b.load(a).then(function(c){if(c){var d=y(b);I("DRM: Session created.  SessionID = "+d.getSessionID()),H.trigger(q["default"].KEY_SESSION_CREATED,{data:d})}else H.trigger(q["default"].KEY_SESSION_CREATED,{data:null,error:"Could not load session! Invalid Session ID ("+a+")"})})["catch"](function(b){H.trigger(q["default"].KEY_SESSION_CREATED,{data:null,error:"Could not load session ("+a+")! "+b.name})})}function s(a){var b=a.session;b.remove().then(function(){I("DRM: Session removed.  SessionID = "+a.getSessionID()),H.trigger(q["default"].KEY_SESSION_REMOVED,{data:a.getSessionID()})},function(b){H.trigger(q["default"].KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+a.getSessionID()+"). "+b.name})})}function t(a){v(a)["catch"](function(b){x(a),H.trigger(q["default"].KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+a.getSessionID()+") "+b.name})})}function u(a,b){!function(b){var c=a[b].ks,d=a[b].configs;navigator.requestMediaKeySystemAccess(c.systemString,d).then(function(a){var b="function"==typeof a.getConfiguration?a.getConfiguration():null,d=new o["default"](c,b);d.mksa=a,H.trigger(q["default"].KEY_SYSTEM_ACCESS_COMPLETE,{data:d})})["catch"](function(){++b<a.length?u(a,b):H.trigger(q["default"].KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied!"})})}(b)}function v(a){var b=a.session;return b.removeEventListener("keystatuseschange",a),b.removeEventListener("message",a),b.close()}function w(){return{handleEvent:function(a){switch(a.type){case"encrypted":if(a.initData){var b=ArrayBuffer.isView(a.initData)?a.initData.buffer:a.initData;H.trigger(q["default"].NEED_KEY,{key:new i["default"](b,a.initDataType)})}}}}}function x(a){for(var b=0;b<D.length;b++)if(D[b]===a){D.splice(b,1);break}}function y(a,b,c){var d={session:a,initData:b,handleEvent:function(a){switch(a.type){case"keystatuseschange":H.trigger(q["default"].KEY_STATUSES_CHANGED,{data:this});break;case"message":var b=ArrayBuffer.isView(a.message)?a.message.buffer:a.message;H.trigger(q["default"].INTERNAL_KEY_MESSAGE,{data:new m["default"](this,b,void 0,a.messageType)})}},getSessionID:function(){return a.sessionId},getExpirationTime:function(){return a.expiration},getKeyStatuses:function(){return a.keyStatuses},getSessionType:function(){return c}};return a.addEventListener("keystatuseschange",d),a.addEventListener("message",d),a.closed.then(function(){x(d),I("DRM: Session closed.  SessionID = "+d.getSessionID()),H.trigger(q["default"].KEY_SESSION_CLOSED,{data:d.getSessionID()})}),D.push(d),d}var z,A,B,C,D,E,F,G=this.context,H=a.eventBus,I=a.log;return z={getAllInitData:e,requestKeySystemAccess:f,getKeySystem:d,selectKeySystem:h,setMediaElement:j,setServerCertificate:l,createKeySession:n,updateKeySession:p,loadKeySession:r,removeKeySession:s,closeKeySession:t,reset:c},b(),z}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../controllers/ProtectionKeyController.js"),g=d(f),h=a("../vo/NeedKey.js"),i=d(h),j=a("../vo/KeyError.js"),k=d(j),l=a("../vo/KeyMessage.js"),m=d(l),n=a("../vo/KeySystemAccess.js"),o=d(n),p=a("../../../core/events/Events.js"),q=d(p),r=a("../../../core/FactoryMaker.js"),s=d(r);e.__dashjs_factory_name="ProtectionModel_21Jan2015",c["default"]=s["default"].getClassFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"../../../core/events/Events.js":5,"../controllers/ProtectionKeyController.js":11,"../vo/KeyError.js":23,"../vo/KeyMessage.js":24,"../vo/KeySystemAccess.js":26,"../vo/NeedKey.js":29}],17:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a){function b(){D=null,E=null,F=null,G=null,H=[],J=(0,g["default"])(y).getInstance(),I=v()}function c(){try{for(var a=0;a<H.length;a++)p(H[a]);D&&D.removeEventListener(B.needkey,I),z.trigger(s["default"].TEARDOWN_COMPLETE)}catch(b){z.trigger(s["default"].TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+b.message})}}function d(){return E}function e(){for(var a=[],b=0;b<H.length;b++)a.push(H[b].initData);return a}function f(a){for(var b=!1,c=0;c<a.length;c++)for(var d=a[c].ks.systemString,e=a[c].configs,f=null,g=null,h=0;h<e.length;h++){var i=e[h].audioCapabilities,j=e[h].videoCapabilities;if(i&&0!==i.length){f=[];for(var k=0;k<i.length;k++)window[B.MediaKeys].isTypeSupported(d,i[k].contentType)&&f.push(i[k])}if(j&&0!==j.length){g=[];for(var l=0;l<j.length;l++)window[B.MediaKeys].isTypeSupported(d,j[l].contentType)&&g.push(j[l])}if(!(!f&&!g||f&&0===f.length||g&&0===g.length)){b=!0;var m=new o["default"](f,g),n=J.getKeySystemBySystemString(d);z.trigger(s["default"].KEY_SYSTEM_ACCESS_COMPLETE,{data:new q["default"](n,m)});break}}b||z.trigger(s["default"].KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})}function h(a){try{F=a.mediaKeys=new window[B.MediaKeys](a.keySystem.systemString),E=a.keySystem,G=a,D&&w(),z.trigger(s["default"].INTERNAL_KEY_SYSTEM_SELECTED)}catch(b){z.trigger(s["default"].INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+E.systemString+")! Could not create MediaKeys -- TODO"})}}function j(a){D!==a&&(D&&D.removeEventListener(B.needkey,I),D=a,D&&(D.addEventListener(B.needkey,I),F&&w()))}function l(a){if(!E||!F||!G)throw new Error("Can not create sessions until you have selected a key system");var b=null;if(null!==G.ksConfiguration.videoCapabilities&&G.ksConfiguration.videoCapabilities.length>0&&(b=G.ksConfiguration.videoCapabilities[0]),null===b&&null!==G.ksConfiguration.audioCapabilities&&G.ksConfiguration.audioCapabilities.length>0&&(b=G.ksConfiguration.audioCapabilities[0]),null===b)throw new Error("Can not create sessions for unknown content types.");var c=b.contentType,d=F.createSession(c,new Uint8Array(a)),e=x(d,a);d.addEventListener(B.error,e),d.addEventListener(B.message,e),d.addEventListener(B.ready,e),d.addEventListener(B.close,e),H.push(e),A("DRM: Session created.  SessionID = "+e.getSessionID()),z.trigger(s["default"].KEY_SESSION_CREATED,{data:e})}function n(a,b){var c=a.session;J.isClearKey(E)?c.update(new Uint8Array(b.toJWK())):c.update(new Uint8Array(b))}function p(a){var b=a.session;b.removeEventListener(B.error,a),b.removeEventListener(B.message,a),b.removeEventListener(B.ready,a),b.removeEventListener(B.close,a);for(var c=0;c<H.length;c++)if(H[c]===a){H.splice(c,1);break}b[B.release]()}function r(){}function t(){}function u(){}function v(){return{handleEvent:function(a){switch(a.type){case B.needkey:if(a.initData){var b=ArrayBuffer.isView(a.initData)?a.initData.buffer:a.initData;z.trigger(s["default"].NEED_KEY,{key:new i["default"](b,"cenc")})}}}}}function w(){var a=null,b=function(){D.removeEventListener("loadedmetadata",a),D[B.setMediaKeys](F),z.trigger(s["default"].VIDEO_ELEMENT_SELECTED)};D.readyState>=1?b():(a=b.bind(this),D.addEventListener("loadedmetadata",a))}function x(a,b){return{session:a,initData:b,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(a){switch(a.type){case B.error:var b="KeyError";z.trigger(s["default"].KEY_ERROR,{data:new k["default"](this,b)});break;case B.message:var c=ArrayBuffer.isView(a.message)?a.message.buffer:a.message;z.trigger(s["default"].INTERNAL_KEY_MESSAGE,{data:new m["default"](this,c,a.destinationURL)});break;case B.ready:A("DRM: Key added."),z.trigger(s["default"].KEY_ADDED);break;case B.close:A("DRM: Session closed.  SessionID = "+this.getSessionID()),z.trigger(s["default"].KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}var y=this.context,z=a.eventBus,A=a.log,B=a.api,C=void 0,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0;return C={getAllInitData:e,requestKeySystemAccess:f,getKeySystem:d,selectKeySystem:h,setMediaElement:j,createKeySession:l,updateKeySession:n,closeKeySession:p,setServerCertificate:r,loadKeySession:t,removeKeySession:u,reset:c},b(),C}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../controllers/ProtectionKeyController.js"),g=d(f),h=a("../vo/NeedKey.js"),i=d(h),j=a("../vo/KeyError.js"),k=d(j),l=a("../vo/KeyMessage.js"),m=d(l),n=a("../vo/KeySystemConfiguration.js"),o=d(n),p=a("../vo/KeySystemAccess.js"),q=d(p),r=a("../../../core/events/Events.js"),s=d(r),t=a("../../../core/FactoryMaker.js"),u=d(t);e.__dashjs_factory_name="ProtectionModel_3Feb2014",c["default"]=u["default"].getClassFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"../../../core/events/Events.js":5,"../controllers/ProtectionKeyController.js":11,"../vo/KeyError.js":23,"../vo/KeyMessage.js":24,"../vo/KeySystemAccess.js":26,"../vo/KeySystemConfiguration.js":27,"../vo/NeedKey.js":29}],18:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a,b){var c=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(b)));a+="/?";for(var d=0;d<c.kids.length;d++)a+=c.kids[d]+"&";return a=a.substring(0,a.length-1)}function b(){return"GET"}function c(){return"json"}function d(a){if(!a.hasOwnProperty("keys"))return null;for(var b=[],c=0;c<a.keys.length;c++){var d=a.keys[c],e=d.kid.replace(/=/g,""),f=d.k.replace(/=/g,"");b.push(new g["default"](e,f))}return new i["default"](b)}function e(a){return String.fromCharCode.apply(null,new Uint8Array(a))}var f=void 0;return f={getServerURLFromMessage:a,getHTTPMethod:b,getResponseType:c,getLicenseMessage:d,getErrorResponse:e}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../vo/KeyPair.js"),g=d(f),h=a("../vo/ClearKeyKeySet.js"),i=d(h),j=a("../../../core/FactoryMaker.js"),k=d(j);e.__dashjs_factory_name="ClearKey",c["default"]=k["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3,"../vo/ClearKeyKeySet.js":22,"../vo/KeyPair.js":25}],19:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){return a}function b(){return"POST"}function c(a){return f[a].responseType}function d(a,b){return f[b].getLicenseMessage(a)}function e(a,b){return f[b].getErrorResponse(a)}var f={"com.widevine.alpha":{responseType:"json",getLicenseMessage:function(a){return i["default"].decodeArray(a.license)},getErrorResponse:function(a){return a}},"com.microsoft.playready":{responseType:"arraybuffer",getLicenseMessage:function(a){return a},getErrorResponse:function(a){return String.fromCharCode.apply(null,new Uint8Array(a))}}},g=void 0;return g={getServerURLFromMessage:a,getHTTPMethod:b,getResponseType:c,getLicenseMessage:d,getErrorResponse:e}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../../../core/FactoryMaker.js"),g=d(f),h=a("../../../../externals/base64.js"),i=d(h);e.__dashjs_factory_name="DRMToday",c["default"]=g["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../../externals/base64.js":1,"../../../core/FactoryMaker.js":3}],20:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){return a}function b(){return"POST"}function c(){return"arraybuffer"}function d(a){return a}function e(a){return String.fromCharCode.apply(null,new Uint8Array(a))}var f=void 0;return f={getServerURLFromMessage:a,getHTTPMethod:b,getResponseType:c,getLicenseMessage:d,getErrorResponse:e}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../../../core/FactoryMaker.js"),g=d(f);e.__dashjs_factory_name="PlayReady",c["default"]=g["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3}],21:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){return a}function b(){return"POST"}function c(){return"arraybuffer"}function d(a){return a}function e(a){return String.fromCharCode.apply(null,new Uint8Array(a))}var f=void 0;return f={getServerURLFromMessage:a,getHTTPMethod:b,getResponseType:c,getLicenseMessage:d,getErrorResponse:e}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../../../core/FactoryMaker.js"),g=d(f);e.__dashjs_factory_name="Widevine",c["default"]=g["default"].getSingletonFactory(e),b.exports=c["default"]},{"../../../core/FactoryMaker.js":3}],22:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b,c){if(d(this,a),c&&"persistent"!==c&&"temporary"!==c)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=b,this.type=c}return e(a,[{key:"toJWK",value:function(){var a,b=this.keyPairs.length,c={keys:[]};for(a=0;b>a;a++){var d={kty:"oct",alg:"A128KW",kid:this.keyPairs[a].keyID,k:this.keyPairs[a].key};c.keys.push(d)}this.type&&(c.type=this.type);var e=JSON.stringify(c),f=e.length,g=new ArrayBuffer(f),h=new Uint8Array(g);for(a=0;f>a;a++)h[a]=e.charCodeAt(a);return g}}]),a}();c["default"]=f,b.exports=c["default"]},{}],23:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b){d(this,f),this.sessionToken=a,this.error=b};c["default"]=e,b.exports=c["default"]},{}],24:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b,c,e){d(this,f),this.sessionToken=a,this.message=b,this.defaultURL=c,this.messageType=e?e:"license-request"};c["default"]=e,b.exports=c["default"]},{}],25:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b){d(this,f),this.keyID=a,this.key=b};c["default"]=e,b.exports=c["default"]},{}],26:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b){d(this,f),this.keySystem=a,this.ksConfiguration=b};c["default"]=e,b.exports=c["default"]},{}],27:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b,c,e,g){d(this,f),this.initDataTypes=["cenc"],this.audioCapabilities=a,this.videoCapabilities=b,this.distinctiveIdentifier=c,this.persistentState=e,this.sessionTypes=g};c["default"]=e,b.exports=c["default"]},{}],28:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b){d(this,f),this.contentType=a,this.robustness=b};c["default"]=e,b.exports=c["default"]},{}],29:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b){d(this,f),this.initData=a,this.initDataType=b};c["default"]=e,b.exports=c["default"]},{}],30:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){function a(a){l.trigger(i["default"].ERROR,{error:"capability",event:a})}function b(a,b,c){l.trigger(i["default"].ERROR,{error:"download",event:{id:a,url:b,request:c}})}function c(a,b,c){l.trigger(i["default"].ERROR,{error:"manifestError",event:{message:a,id:b,manifest:c}})}function d(a,b,c){l.trigger(i["default"].ERROR,{error:"cc",event:{message:a,id:b,cc:c}})}function e(a){l.trigger(i["default"].ERROR,{error:"mediasource",event:a})}function f(a){l.trigger(i["default"].ERROR,{error:"key_session",event:a})}function h(a){l.trigger(i["default"].ERROR,{error:"key_message",event:a})}var j=void 0,k=this.context,l=(0,g["default"])(k).getInstance();return j={capabilityError:a,downloadError:b,manifestError:c,timedTextError:d,mediaSourceError:e,mediaKeySessionError:f,mediaKeyMessageError:h}}Object.defineProperty(c,"__esModule",{value:!0});var f=a("../../core/EventBus.js"),g=d(f),h=a("../../core/events/Events.js"),i=d(h),j=a("../../core/FactoryMaker.js"),k=d(j),l="mediasource",m="mediakeys",n="manifest",o="SIDX",p="content",q="initialization",r="xlink",s="codec",t="parse",u="nostreams",v="parse";e.__dashjs_factory_name="ErrorHandler";var w=k["default"].getSingletonFactory(e);w.CAPABILITY_ERROR_MEDIASOURCE=l,w.CAPABILITY_ERROR_MEDIAKEYS=m,w.DOWNLOAD_ERROR_ID_MANIFEST=n,w.DOWNLOAD_ERROR_ID_SIDX=o,w.DOWNLOAD_ERROR_ID_CONTENT=p,w.DOWNLOAD_ERROR_ID_INITIALIZATION=q,w.DOWNLOAD_ERROR_ID_XLINK=r,w.MANIFEST_ERROR_ID_CODEC=s,w.MANIFEST_ERROR_ID_PARSE=t,w.MANIFEST_ERROR_ID_NOSTREAMS=u,w.TIMED_TEXT_ERROR_ID_PARSE=v,c["default"]=w,b.exports=c["default"]},{"../../core/EventBus.js":2,"../../core/FactoryMaker.js":3,"../../core/events/Events.js":5}],31:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function f(a,b,c){d(this,f),this.code=a||null,this.message=b||null,this.data=c||null};c["default"]=e,b.exports=c["default"]},{}]},{},[8])(8)});
//# sourceMappingURL=dash.protection.min.js.map