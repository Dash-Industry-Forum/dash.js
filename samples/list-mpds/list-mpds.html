<!DOCTYPE html>
<html>
    <head>
        <title>List MPDs example</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="container py-4">
          <header class="pb-3 mb-4 border-bottom">
            <img class=""
                 src="../lib/img/dashjs-logo.png"
                 width="200">
          </header>
          <div class="row">
            <div class="col-md-12">
                <div class="h-100 p-5 bg-light border rounded-3">
                  <h3>List MPDs</h3>
                  <p>This sample shows the following use cases of the List MPDs implementation in DASH</p>
                  <ul>
                    <li><p><strong>Case 0: Single Linked Period - </strong>  A MPD with a single Period that links to an Imported MPD.</p></li>
                    <li><p><strong>Case 1: Multiple Linked Period -</strong> A MPD with multiple linked Periods, each pointing to a different Imported MPD.</p></li>
                    <li><p><strong>Case 2: Linked Period + Regular Period -</strong> A MPD with one linked Period followed by a regular Period.</p></li>
                    <li><p><strong>Case 3: Regular Period + Linked Period -</strong>  A MPD with one regular Period followed by a linked Period.</p></li>
                    <li><p><strong>Case 4: EarliestResolutionTime > minBufferTime -</strong> A MPD where the earliestResolutionTime of the linked Period exceeds the min buffer time.</p></li>
                    <li><p><strong>Case 5: EarliestResolutionTime < minBufferTime -</strong> A MPD where the earliestResolutionTime of the linked Period is less than the buffer time.</p></li>
                    <li><p><strong>Case 6: Different Linked Period and Imported Period durations -</strong> An MPD where a Linked Period references an Imported MPD with a duration that does not match the Linked Period's duration in the main manifest</p></li>
                    <li><p><strong>Case 7: First List MPD Period with start time =/ 0 -</strong> The MPD is of type list, and the first Period in the manifest has a start time that is not equal to PT0S (0 seconds).</p></li>
                    <li><p><strong>Case 8: Retry -</strong> The MPD is of type list, and the ImportedMPD should not be downloadable</p></li>
                  </ul>
                </div>
            </div>
          </div>
          <div class="row pt-4">
            <div class="col">
              <div class="row justify-content-around">
                <div class="col-auto">
                  <div class="btn-group mb-2">
                      <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          Select Case
                      </button>
                      <div class="dropdown-menu" id="assetDropdown">
                          <a class="dropdown-item" data-id="case0" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list0.mpd">Case 0: Single Linked Period</a>
                          <a class="dropdown-item" data-id="case1" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list1.mpd">Case 1: Multiple Linked Period</a>
                          <a class="dropdown-item" data-id="case2" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list2.mpd">Case 2: Linked Period + Regular Period</a>
                          <a class="dropdown-item" data-id="case3" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list3.mpd">Case 3: Regular Period + Linked Period</a>
                          <a class="dropdown-item" data-id="case4" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list4.mpd">Case 4: EarliestResolutionTime &gt; minBufferTime</a>
                          <a class="dropdown-item" data-id="case5" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list5.mpd">Case 5: EarliestResolutionTime &lt; minBufferTime</a>
                          <a class="dropdown-item" data-id="case6" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list6.mpd">Case 6: Different Linked Period and Imported Period durations</a>
                          <a class="dropdown-item" data-id="case7" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list7.mpd">Case 7: First List MPD Period with start time =/ 0</a>
                          <a class="dropdown-item" data-id="case8" data-url="https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list8.mpd">Case 8: Retry</a>
                      </div>
                  </div>
                </div>
                <div class="col">
                  <h3 id="casetitle">Case 0: Single Linked Period</h3>
                </div>
              </div>
              <span class="h5">Expected behavior: </span>
              <p id="behavior">The player should download the Imported MPD and reproduce the unique Period.</p>
              <div class="dash-video-player">
                  <div class="videoContainer" id="videoContainer">
                      <video id="main-video" preload="auto" width="100%" controls></video>
                  </div>
              </div>
            </div>
            <div class="col-6">
              <pre style="background-color: #dddddd; height: 100%; overflow: auto; padding: 2em"><div id="manifest" class="text-wrap"></div></pre>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
                <div id="code-output"></div>
            </div>
        </div>
        <footer class="pt-3 mt-4 text-muted border-top">
            &copy; DASH-IF
        </footer>

        <script src="../../dist/modern/umd/dash.all.debug.js"></script>
        <script>      
          async function selectCase(player, currentAsset){
            let manifest = document.getElementById("manifest");
            const response = await fetch(currentAsset);
            manifest.innerText = await response.text();

            const assetDropdown = document.getElementById("assetDropdown");
            assetDropdown.addEventListener("click", async (event) => {
                const target = event.target;
                if (target.tagName === "A" && target.dataset.url) {
                    currentAsset = target.dataset.url;
                    player.attachSource(currentAsset);

                    const response = await fetch(currentAsset);
                    manifest.innerText = await response.text();

                    casetitle.innerText = target.text;
                    
                    const caseId = target.dataset.id;
                    switch(caseId) {
                        case 'case0':
                            behavior.innerText = "The player should download the Imported MPD and reproduce the unique Period.";
                            break;
                        case 'case1':
                            behavior.innerText = "The player should download the first Imported MPD, reproduce its first Period, and, upon completion, download the second Imported MPD and reproduce its first Period.";
                            break;
                        case 'case2':
                            behavior.innerText = "The player should download the first Imported MPD, reproduce its first Period, and, upon completion, play the next regular Period.";
                            break;
                        case 'case3':
                            behavior.innerText = "The player should start by playing the first regular Period as usual and, upon completion, download the linked Imported MPD and reproduce its first Period.";
                            break;
                        case 'case4':
                            behavior.innerText = "The player should start by playing the first regular Period as usual and, upon its completion, download the linked Imported MPD at startTime - earliestResolutionTime and reproduce its first Period";
                            break;
                        case 'case5':
                            behavior.innerText = "The player should start by playing the first regular Period as usual and, upon its completion, download the linked Imported MPD at with earliestResolutionTime = 0 and reproduce its first Period.";
                            break;
                        case 'case6':
                            behavior.innerText = "The player must respect the shortest duration between the Linked Period in the main manifest and the Imported MPD. Playback should seamlessly stop at the shorter duration, ensuring no content extends beyond the specified boundaries.";
                            break;
                        case 'case7':
                            behavior.innerText = "The player should throw an error indicating that the start time of the first period in a list type MPD manifest is invalid.";
                            break;
                        case 'case8':
                            behavior.innerText = "The player should attempt to download the manifest four times before failing.";
                            break;
                    }
                }
            });
          }
        </script>
        <script class="code">
          const video = document.querySelector("video");
          
          const player = dashjs.MediaPlayer().create();
          player.initialize();
          player.updateSettings({
              debug: {
                  logLevel: dashjs.Debug.LOG_LEVEL_DEBUG,
              },
          });
          player.setAutoPlay(false);
          player.attachView(video);

          let currentAsset = "https://comcast-dash-6-assets.s3.us-east-2.amazonaws.com/ListMPDs/bbb/list0.mpd";
          player.attachSource(currentAsset);
          
          selectCase(player, currentAsset) // Select Case functionality only
        </script>
        <script src="../highlighter.js"></script>
        
    </body>
</html>
