<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>HDR Properties PlugIn sample</title>
    <script class="" src="../../contrib/akamai/controlbar/ControlBar.js"></script>
    <script src="../../dist/dash.all.debug.js"></script>

    <!-- Bootstrap core CSS -->
    <link href="../lib/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../../contrib/akamai/controlbar/controlbar.css">
    <link href="../lib/main.css" rel="stylesheet">

    <style>
        video {
            width: 100%;
        }

        .dash-video-player {
            position: relative;
            /* This position relative is needed to position the menus */
            margin: 0 auto;
            line-height: 1;
        }
    </style>

    <script>
        function printInfosToPage() {
            let elMpdTrack = document.getElementById('ulMpdTrackList');
            if (elMpdTrack) {
                let adapter = player.getDashAdapter();
                let mpd = adapter.getMpd();

                let tracks = mpd.manifest.Period[0].AdaptationSet.filter(t => t.mimeType === 'video/mp4');
                console.log("[HdrPlugIn] video-tracks: %o", tracks);

                tracks.forEach(t => {
                    let li = document.createElement('li');
                    li.innerHTML = '<pre>' + t.Label[0].__text + '</pre>';
                    elMpdTrack.appendChild(li);
                })
            }

            elSupportedTrack = document.getElementById('ulSupportedTrackList');
            if (elSupportedTrack) {
                let tracks = player.getTracksFor('video');
                tracks.forEach(t => {
                    let li = document.createElement('li');
                    li.innerHTML = '<pre>' + t.labels[0].text + '</pre>';
                    elSupportedTrack.appendChild(li);
                })
            };

            elCurrTrack = document.getElementById('elCurrTrack');
            if (elCurrTrack) {
                let currTrack = player.getCurrentTrackFor('video');
                elCurrTrack.innerHTML = '<pre>' + currTrack.labels[0].text + '</pre>';
            }
        }
    </script>

    <script class="code">
        var player = null;

        function init() {
            var url = 'https://webapi.streaming.dolby.com/v0_9/sources/media/v01/dash/hdr_essentialProps.mpd';
            var videoElement = document.querySelector('.videoContainer video');
            player = dashjs.MediaPlayer().create();

            player.initialize(videoElement, url, false);
            player.updateSettings({
                'streaming': {
                    'capabilities': {
                        'filterHDREssentialProperties': true,
                        'useMediaCapabilitiesApi': true
                    }
                },
                'debug': {
                    'logLevel': dashjs.Debug.LOG_LEVEL_INFO
                }
            });

            var controlbar = new ControlBar(player);
            controlbar.initialize();

            player.on(dashjs.MediaPlayer.events['STREAM_INITIALIZED'], printInfosToPage);

            player.play();
        }
    </script>
</head>

<body>

    <main>
        <div class="container py-4">
            <header class="pb-3 mb-4 border-bottom">
                <img class="" src="../lib/img/dashjs-logo.png" width="200">
            </header>
            <div class="row">
                <div class="col-md-4">
                    <div class="h-100 p-5 bg-light border rounded-3">
                        <h3>Using the HDR Properties signaling PlugIn</h3>
                        <p>This example shows how to add and configure the HDR properties signaling plugin with the
                            dash.js player</p>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="dash-video-player">
                        <div class="videoContainer" id="videoContainer">
                            <video preload="auto" autoplay></video>
                            <div id="videoController" class="video-controller unselectable">
                                <div id="playPauseBtn" class="btn-play-pause" title="Play/Pause">
                                    <span id="iconPlayPause" class="icon-play"></span>
                                </div>
                                <span id="videoTime" class="time-display">00:00:00</span>
                                <div id="fullscreenBtn" class="btn-fullscreen control-icon-layout" title="Fullscreen">
                                    <span class="icon-fullscreen-enter"></span>
                                </div>
                                <div id="bitrateListBtn" class="control-icon-layout" title="Bitrate List">
                                    <span class="icon-bitrate"></span>
                                </div>
                                <input type="range" id="volumebar" class="volumebar" value="1" min="0" max="1"
                                    step=".01" />
                                <div id="muteBtn" class="btn-mute control-icon-layout" title="Mute">
                                    <span id="iconMute" class="icon-mute-off"></span>
                                </div>
                                <div id="trackSwitchBtn" class="control-icon-layout" title="A/V Tracks">
                                    <span class="icon-tracks"></span>
                                </div>
                                <div id="captionBtn" class="btn-caption control-icon-layout" title="Closed Caption">
                                    <span class="icon-caption"></span>
                                </div>
                                <span id="videoDuration" class="duration-display">00:00:00</span>
                                <div class="seekContainer">
                                    <div id="seekbar" class="seekbar seekbar-complete">
                                        <div id="seekbar-buffer" class="seekbar seekbar-buffer"></div>
                                        <div id="seekbar-play" class="seekbar seekbar-play"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="h-100 p-5 border rounded-3">
                    <h3>Get video streams from Manifest</h3>
                    <label for="mediaSettings">retured label of <code>getStreamsFromManifest()</code>, filtered for
                        video:</label>
                    <ul id="ulMpdTrackList"></ul>
                    <p>This appears to show the video AdaptationSets after Capability filtering.</p>

                    <h3>Get supported Tracks for Video</h3>
                    <label for="mediaSettings">retured label(s) of <code>getTracksFor('video')</code>:</label>
                    <ul id="ulSupportedTrackList"></ul>

                    <h3>Current video track</h3>
                    <label for="mediaSettings">retured label of <code>getCurrentTrackFor('video')</code>:</label>
                    <ul id="elCurrTrack"></ul>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div id="code-output"></div>
                </div>
            </div>
            <footer class="pt-3 mt-4 text-muted border-top">
                &copy; DASH-IF
            </footer>
        </div>
    </main>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            init();
        });
    </script>
    <script src="../highlighter.js"></script>
</body>

</html>
