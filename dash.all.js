






function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=f.childNodes,o=0;o<n.length;o++){var l=n.item(o),m=d(l);if(i.__cnt++,null==i[m])i[m]=h(l),i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m];else{if(null!=i[m]&&!(i[m]instanceof Array)){var p=i[m];i[m]=new Array,i[m][0]=p,i[m+"_asArray"]=i[m]}for(var q=0;null!=i[m][q];)q++;i[m][q]=h(l)}}for(var r=0;r<f.attributes.length;r++){var s=f.attributes.item(r);i.__cnt++;for(var v=s.value,w=0,x=a.length;x>w;w++){var y=a[w];y.test.call(this,s.value)&&(v=y.converter.call(this,s.value))}i[b+s.name]=v}var z=e(f);return null!=z&&""!=z&&(i.__cnt++,i.__prefix=z),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function ObjectIron(a){var b;for(b=[],i=0,len=a.length;len>i;i+=1)b.push(a[i].isRoot?"root":a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):d[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)){if(h=b.indexOf(i),-1!==h)if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}if(function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){"undefined"==typeof b&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(null==d.object&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):c=d.clazz?this._createAndSetupInstance(a,d.clazz):d.object,c},mapOutlet:function(a,b,c){if("undefined"==typeof a)throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if("undefined"==typeof a)throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if("undefined"==typeof a)throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if("undefined"==typeof a)throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if("undefined"==typeof a)throw new Error(1050);if("undefined"==typeof b)throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if("undefined"==typeof a)throw new Error(1060);if("undefined"==typeof b)throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if("undefined"==typeof a)throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if("undefined"==typeof a)throw new Error(1080);if("object"==typeof a){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),"undefined"!=typeof b&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];(!this.strictInjections||f in a)&&(a[f]=this.getObject(g))}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if("undefined"==typeof a)throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if("undefined"==typeof a)throw new Error(1100);if("undefined"==typeof b)throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if("undefined"==typeof a)throw new Error(1110);return b=b||"global",c=c||a,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if("undefined"==typeof a)throw new Error(1120);if(b=b||"global",c=c||a,this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){var f=d[e];if(f.handler===c){d.splice(e,1);break}}}return this},notify:function(a){if("undefined"==typeof a)throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f,g=d[e];"global"!==e&&(f=this.getObject(e));var h,i,j=[];for(h=0,i=g.length;i>h;h++){var k,l=g[h];k=f&&"string"==typeof l.handler?f[l.handler]:l.handler,l.oneShot&&j.unshift(h),l.passEvent?k.apply(f,b):k.apply(f,c)}for(h=0,i=j.length;i>h;h++)g.splice(j[h],1)}}return this}},a.dijon=b}(this),"undefined"==typeof utils)var utils={};"undefined"==typeof utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(a,b){var c,d,e;return c=new goog.math.Long(0,b),d=new goog.math.Long(a,0),e=c.add(d),e.toNumber()},goog={},goog.math={},goog.math.Long=function(a,b){this.low_=0|a,this.high_=0|b},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(a){if(a>=-128&&128>a){var b=goog.math.Long.IntCache_[a];if(b)return b}var c=new goog.math.Long(0|a,0>a?-1:0);return a>=-128&&128>a&&(goog.math.Long.IntCache_[a]=c),c},goog.math.Long.fromNumber=function(a){return isNaN(a)||!isFinite(a)?goog.math.Long.ZERO:a<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:a+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>a?goog.math.Long.fromNumber(-a).negate():new goog.math.Long(a%goog.math.Long.TWO_PWR_32_DBL_|0,a/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(a,b){return new goog.math.Long(a,b)},goog.math.Long.fromString=function(a,b){if(0==a.length)throw Error("number format error: empty string");var c=b||10;if(2>c||c>36)throw Error("radix out of range: "+c);if("-"==a.charAt(0))return goog.math.Long.fromString(a.substring(1),c).negate();if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+a);for(var d=goog.math.Long.fromNumber(Math.pow(c,8)),e=goog.math.Long.ZERO,f=0;f<a.length;f+=8){var g=Math.min(8,a.length-f),h=parseInt(a.substring(f,f+g),c);if(8>g){var i=goog.math.Long.fromNumber(Math.pow(c,g));e=e.multiply(i).add(goog.math.Long.fromNumber(h))}else e=e.multiply(d),e=e.add(goog.math.Long.fromNumber(h))}return e},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(a){var b=a||10;if(2>b||b>36)throw Error("radix out of range: "+b);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var c=goog.math.Long.fromNumber(b),d=this.div(c),e=d.multiply(c).subtract(this);return d.toString(b)+e.toInt().toString(b)}return"-"+this.negate().toString(b)}for(var f=goog.math.Long.fromNumber(Math.pow(b,6)),e=this,g="";;){var h=e.div(f),i=e.subtract(h.multiply(f)).toInt(),j=i.toString(b);if(e=h,e.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var a=0!=this.high_?this.high_:this.low_,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high_?b+33:b+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(a){return this.high_==a.high_&&this.low_==a.low_},goog.math.Long.prototype.notEquals=function(a){return this.high_!=a.high_||this.low_!=a.low_},goog.math.Long.prototype.lessThan=function(a){return this.compare(a)<0},goog.math.Long.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},goog.math.Long.prototype.greaterThan=function(a){return this.compare(a)>0},goog.math.Long.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},goog.math.Long.prototype.compare=function(a){if(this.equals(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.subtract(a).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(a){var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e+i,l+=m>>>16,m&=65535,l+=d+h,k+=l>>>16,l&=65535,k+=c+g,j+=k>>>16,k&=65535,j+=b+f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.subtract=function(a){return this.add(a.negate())},goog.math.Long.prototype.multiply=function(a){if(this.isZero())return goog.math.Long.ZERO;if(a.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return a.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(a.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().multiply(a.negate()):this.negate().multiply(a).negate();if(a.isNegative())return this.multiply(a.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&a.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*a.toNumber());var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e*i,l+=m>>>16,m&=65535,l+=d*i,k+=l>>>16,l&=65535,l+=e*h,k+=l>>>16,l&=65535,k+=c*i,j+=k>>>16,k&=65535,k+=d*h,j+=k>>>16,k&=65535,k+=e*g,j+=k>>>16,k&=65535,j+=b*i+c*h+d*g+e*f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.div=function(a){if(a.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(a.equals(goog.math.Long.ONE)||a.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;var b=this.shiftRight(1),c=b.div(a).shiftLeft(1);if(c.equals(goog.math.Long.ZERO))return a.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var d=this.subtract(a.multiply(c)),e=c.add(d.div(a));return e}if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().div(a.negate()):this.negate().div(a).negate();if(a.isNegative())return this.div(a.negate()).negate();for(var f=goog.math.Long.ZERO,d=this;d.greaterThanOrEqual(a);){for(var c=Math.max(1,Math.floor(d.toNumber()/a.toNumber())),g=Math.ceil(Math.log(c)/Math.LN2),h=48>=g?1:Math.pow(2,g-48),i=goog.math.Long.fromNumber(c),j=i.multiply(a);j.isNegative()||j.greaterThan(d);)c-=h,i=goog.math.Long.fromNumber(c),j=i.multiply(a);i.isZero()&&(i=goog.math.Long.ONE),f=f.add(i),d=d.subtract(j)}return f},goog.math.Long.prototype.modulo=function(a){return this.subtract(this.div(a).multiply(a))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(a){return goog.math.Long.fromBits(this.low_&a.low_,this.high_&a.high_)},goog.math.Long.prototype.or=function(a){return goog.math.Long.fromBits(this.low_|a.low_,this.high_|a.high_)},goog.math.Long.prototype.xor=function(a){return goog.math.Long.fromBits(this.low_^a.low_,this.high_^a.high_)},goog.math.Long.prototype.shiftLeft=function(a){if(a&=63,0==a)return this;var b=this.low_;if(32>a){var c=this.high_;return goog.math.Long.fromBits(b<<a,c<<a|b>>>32-a)}return goog.math.Long.fromBits(0,b<<a-32)},goog.math.Long.prototype.shiftRight=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>a)}return goog.math.Long.fromBits(b>>a-32,b>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>>a)}return 32==a?goog.math.Long.fromBits(b,0):goog.math.Long.fromBits(b>>>a-32,0)};var UTF8={};UTF8.encode=function(a){for(var b=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);128>d?b.push(d):2048>d?(b.push(192|d>>6),b.push(128|63&d)):65536>d?(b.push(224|d>>12),b.push(128|63&d>>6),b.push(128|63&d)):(b.push(240|d>>18),b.push(128|63&d>>12),b.push(128|63&d>>6),b.push(128|63&d))}return b},UTF8.decode=function(a){for(var b=[],c=0;c<a.length;){var d=a[c++];128>d||(224>d?(d=(31&d)<<6,d|=63&a[c++]):240>d?(d=(15&d)<<12,d|=(63&a[c++])<<6,d|=63&a[c++]):(d=(7&d)<<18,d|=(63&a[c++])<<12,d|=(63&a[c++])<<6,d|=63&a[c++])),b.push(String.fromCharCode(d))}return b.join("")};var BASE64={};if(function(b){var c=function(a){for(var c=0,d=[],e=0|a.length/3;0<e--;){var f=(a[c]<<16)+(a[c+1]<<8)+a[c+2];c+=3,d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push(b.charAt(63&f))}if(2==a.length-c){var f=(a[c]<<16)+(a[c+1]<<8);d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push("=")}else if(1==a.length-c){var f=a[c]<<16;d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push("==")}return d.join("")},d=function(){for(var a=[],c=0;c<b.length;++c)a[b.charCodeAt(c)]=c;return a["=".charCodeAt(0)]=0,a}(),e=function(a){for(var b=0,c=[],e=0|a.length/4;0<e--;){var f=(d[a.charCodeAt(b)]<<18)+(d[a.charCodeAt(b+1)]<<12)+(d[a.charCodeAt(b+2)]<<6)+d[a.charCodeAt(b+3)];c.push(255&f>>16),c.push(255&f>>8),c.push(255&f),b+=4}return c&&("="==a.charAt(b-2)?(c.pop(),c.pop()):"="==a.charAt(b-1)&&c.pop()),c},f={};f.encode=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b},f.decode=function(){for(var b=0;b<s.length;++b)a[b]=String.fromCharCode(a[b]);return a.join("")},BASE64.decodeArray=function(a){var b=e(a);return new Uint8Array(b)},BASE64.encodeASCII=function(a){var b=f.encode(a);return c(b)},BASE64.decodeASCII=function(a){var b=e(a);return f.decode(b)},BASE64.encode=function(a){var b=UTF8.encode(a);return c(b)},BASE64.decode=function(a){var b=e(a);return UTF8.decode(b)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa)var btoa=BASE64.encode;if(void 0===atob)var atob=BASE64.decode;MediaPlayer=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m="1.3.0 (refactor)",n=a,o=!1,p=!1,q=!0,r=!1,s=MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED,t=function(){return!!e&&!!f},u=function(){if(!o)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!e||!f)throw"Missing view or source.";p=!0,g=b.getObject("streamController"),g.subscribe(g.eventList.ENAME_STREAMS_COMPOSED,i),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,g),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,i),g.setVideoModel(l),g.setAutoPlay(q),g.load(f),b.mapValue("scheduleWhilePaused",r),b.mapOutlet("scheduleWhilePaused","stream"),b.mapOutlet("scheduleWhilePaused","scheduleController"),b.mapValue("bufferMax",s),b.mapOutlet("bufferMax","bufferController"),h.initialize()},v=function(){t()&&u.call(this)},w=function(){var a=k.getReadOnlyMetricsFor("video")||k.getReadOnlyMetricsFor("audio");return j.getCurrentDVRInfo(a)},x=function(){return w.call(this).manifestInfo.DVRWindowSize},y=function(a){var b=w.call(this),c=b.range.start+a;return c>b.range.end&&(c=b.range.end),c},z=function(a){l.getElement().currentTime=this.getDVRSeekOffset(a)},A=function(){var a=w.call(this);return null===a?0:this.duration()-(a.range.end-a.time)},B=function(){var a,b=w.call(this);return null===b?0:(a=b.range.end-b.range.start,a<b.manifestInfo.DVRWindowSize?a:b.manifestInfo.DVRWindowSize)},C=function(){var a,b,c=w.call(this);return null===c?0:(a=c.manifestInfo.availableFrom.getTime()/1e3,b=this.time()+(a+c.range.start))},D=function(){var a,b,c=w.call(this);return null===c?0:(a=c.manifestInfo.availableFrom.getTime()/1e3,b=a+c.range.start+this.duration())},E=function(a,b,c){var d=new Date(1e3*a),e=d.toLocaleDateString(b),f=d.toLocaleTimeString(b,{hour12:c});return f+" "+e},F=function(a){a=Math.max(a,0);var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":10>b?"0"+b.toString()+":":b.toString()+":")+(10>c?"0"+c.toString():c.toString())+":"+(10>d?"0"+d.toString():d.toString())},G=function(a,b,c){b&&void 0!==a&&null!==a&&(c?h.setRules(a,b):h.addRules(a,b))},H=function(){p&&g&&(g.unsubscribe(g.eventList.ENAME_STREAMS_COMPOSED,i),c.unsubscribe(c.eventList.ENAME_MANIFEST_LOADED,g),c.unsubscribe(c.eventList.ENAME_MANIFEST_LOADED,i),g.reset(),d.reset(),h.reset(),g=null,p=!1)};return b=new dijon.System,b.mapValue("system",b),b.mapOutlet("system"),b.injectInto(n),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,tokenAuthentication:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){j=b.getObject("metricsExt"),c=b.getObject("manifestLoader"),i=b.getObject("manifestUpdater"),d=b.getObject("abrController"),h=b.getObject("rulesController"),k=b.getObject("metricsModel")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)},getVersion:function(){return m},startup:function(){o||(b.injectInto(this),o=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return l},setAutoPlay:function(a){q=a},getAutoPlay:function(){return q},setScheduleWhilePaused:function(a){r=a},getScheduleWhilePaused:function(){return r},setTokenAuthentication:function(a,b){this.tokenAuthentication.setTokenAuthentication({name:a,type:b})},setBufferMax:function(a){s=a},getBufferMax:function(){return s},getMetricsExt:function(){return j},getMetricsFor:function(a){var b=k.getReadOnlyMetricsFor(a);return b},getQualityFor:function(a){return d.getQualityFor(a)},setQualityFor:function(a,b){d.setPlaybackQuality(a,b)},getAutoSwitchQuality:function(){return d.getAutoSwitchBitrate()},setAutoSwitchQuality:function(a){d.setAutoSwitchBitrate(a)},setSchedulingRules:function(a){G.call(this,h.SCHEDULING_RULE,a,!0)},addSchedulingRules:function(a){G.call(this,h.SCHEDULING_RULE,a,!1)},setABRRules:function(a){G.call(this,h.ABR_RULE,a,!0)},addABRRules:function(a){G.call(this,h.ABR_RULE,a,!1)},attachView:function(a){if(!o)throw"MediaPlayer not initialized!";e=a,l=null,e&&(l=b.getObject("videoModel"),l.setElement(e)),H.call(this),t.call(this)&&v.call(this)},attachSource:function(a){if(!o)throw"MediaPlayer not initialized!";this.uriQueryFragModel.reset(),f=this.uriQueryFragModel.parseURI(a),H.call(this),t.call(this)&&v.call(this)},reset:function(){this.attachSource(null),this.attachView(null)},play:u,isReady:t,seek:z,time:A,duration:B,timeAsUTC:C,durationAsUTC:D,getDVRWindowSize:x,getDVRSeekOffset:y,formatUTC:E,convertToTimeCode:F}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.di.Context=function(){"use strict";return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("debug",MediaPlayer.utils.Debug),this.system.mapSingleton("tokenAuthentication",MediaPlayer.utils.TokenAuthentication),this.system.mapSingleton("eventBus",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapClass("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapClass("playbackController",MediaPlayer.dependencies.PlaybackController),this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",MediaPlayer.rules.LimitSwitchesRule),this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection),this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController),this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule),this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule),this.system.mapClass("pendingRequestsRule",MediaPlayer.rules.PendingRequestsRule),this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule),this.system.mapClass("sameTimeRequestRule",MediaPlayer.rules.SameTimeRequestRule),this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapSingleton("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("trackController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Dash.dependencies.BaseURLExtensions=function(){"use strict";var a=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m=new DataView(a),n={},o=0;"sidx"!==j&&o<m.byteLength;){for(k=m.getUint32(o),o+=4,j="",f=0;4>f;f+=1)l=m.getInt8(o),j+=String.fromCharCode(l),o+=1;"moof"!==j&&"traf"!==j&&"sidx"!==j?o+=k-8:"sidx"===j&&(o-=8)}if(e=m.getUint32(o,!1)+o,e>a.byteLength)throw"sidx terminates after array buffer";for(n.version=m.getUint8(o+8),o+=12,n.timescale=m.getUint32(o+4,!1),o+=8,0===n.version?(n.earliest_presentation_time=m.getUint32(o,!1),n.first_offset=m.getUint32(o+4,!1),o+=8):(n.earliest_presentation_time=utils.Math.to64BitNumber(m.getUint32(o+4,!1),m.getUint32(o,!1)),n.first_offset=(m.getUint32(o+8,!1)<<32)+m.getUint32(o+12,!1),o+=16),n.first_offset+=e+(b||0),n.reference_count=m.getUint16(o+2,!1),o+=4,n.references=[],c=n.first_offset,d=n.earliest_presentation_time,f=0;f<n.reference_count;f+=1)h=m.getUint32(o,!1),g=h>>>31,h=2147483647&h,i=m.getUint32(o+4,!1),o+=12,n.references.push({size:h,type:g,offset:c,duration:i,time:d,timescale:n.timescale}),c+=h,d+=i;if(o!==e)throw"Error: final pos "+o+" differs from SIDX end "+e;return n},b=function(b,c,d){var e,f,g,h,i,j,k,l;for(e=a.call(this,b,d),f=e.references,g=[],i=0,j=f.length;j>i;i+=1)h=new Dash.vo.Segment,h.duration=f[i].duration,h.media=c,h.startTime=f[i].time,h.timescale=f[i].timescale,k=f[i].offset,l=f[i].offset+f[i].size-1,h.mediaRange=k+"-"+l,g.push(h);return this.debug.log("Parsed SIDX box: "+g.length+" segments."),g},c=function(a,b,d){var e,f,g,h,i,j,k,l,m,n=new DataView(a),o=0,p="",q=0,r=!1,s=this;for(s.debug.log("Searching for initialization.");"moov"!==p&&o<n.byteLength;){for(q=n.getUint32(o),o+=4,p="",j=0;4>j;j+=1)k=n.getInt8(o),p+=String.fromCharCode(k),o+=1;"ftyp"===p&&(e=o-8),"moov"===p&&(f=o-8),"moov"!==p&&(o+=q-8)}i=n.byteLength-o,"moov"!==p?(s.debug.log("Loading more bytes to find initialization."),b.range.start=0,b.range.end=b.bytesLoaded+b.bytesToLoad,l=new XMLHttpRequest,l.onloadend=function(){r||d.call(s,null,new Error("Error loading initialization."))},l.onload=function(){r=!0,b.bytesLoaded=b.range.end,c.call(s,l.response,function(a){d.call(s,a)})},l.onerror=function(){d.call(s,null,new Error("Error loading initialization."))},l.open("GET",s.tokenAuthentication.addTokenAsQueryArg(b.url)),l.responseType="arraybuffer",l.setRequestHeader("Range","bytes="+b.range.start+"-"+b.range.end),l=s.tokenAuthentication.setTokenInRequestHeader(l),l.send(null)):(g=void 0===e?f:e,h=f+q-1,m=g+"-"+h,s.debug.log("Found the initialization.  Range: "+m),d.call(s,m))},d=function(a){var b=new XMLHttpRequest,d=!0,e=this,f=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,g={url:f,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:b};e.debug.log("Start searching for initialization."),g.range.start=0,g.range.end=g.bytesToLoad,b.onload=function(){b.status<200||b.status>299||(d=!1,g.bytesLoaded=g.range.end,c.call(e,b.response,g,function(b){a.range=b,a.initialization=f,e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a)
}))},b.onloadend=b.onerror=function(){d&&(d=!1,e.errHandler.downloadError("initialization",g.url,b),e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a))},b.open("GET",e.tokenAuthentication.addTokenAsQueryArg(g.url)),b.responseType="arraybuffer",b.setRequestHeader("Range","bytes="+g.range.start+"-"+g.range.end),b=e.tokenAuthentication.setTokenInRequestHeader(b),b.send(null),e.debug.log("Perform init search: "+g.url)},e=function(a,c,d,g){var h,i,j,k,l,m,n,o,p,q=new DataView(a),r=new XMLHttpRequest,s=0,t="",u=0,v=!0,w=!1,x=this;for(x.debug.log("Searching for SIDX box."),x.debug.log(c.bytesLoaded+" bytes loaded.");"sidx"!==t&&s<q.byteLength;){for(u=q.getUint32(s),s+=4,t="",m=0;4>m;m+=1)n=q.getInt8(s),t+=String.fromCharCode(n),s+=1;"sidx"!==t&&(s+=u-8)}if(i=q.byteLength-s,"sidx"!==t)g.call(x);else if(u-8>i)x.debug.log("Found SIDX but we don't have all of it."),c.range.start=0,c.range.end=c.bytesLoaded+(u-i),r.onload=function(){r.status<200||r.status>299||(v=!1,c.bytesLoaded=c.range.end,e.call(x,r.response,c,d,g))},r.onloadend=r.onerror=function(){v&&(v=!1,x.errHandler.downloadError("SIDX",c.url,r),g.call(x))},r.open("GET",x.tokenAuthentication.addTokenAsQueryArg(c.url)),r.responseType="arraybuffer",r.setRequestHeader("Range","bytes="+c.range.start+"-"+c.range.end),r=x.tokenAuthentication.setTokenInRequestHeader(r),r.send(null);else if(c.range.start=s-8,c.range.end=c.range.start+u,x.debug.log("Found the SIDX box.  Start: "+c.range.start+" | End: "+c.range.end),j=new ArrayBuffer(c.range.end-c.range.start),l=new Uint8Array(j),k=new Uint8Array(a,c.range.start,c.range.end-c.range.start),l.set(k),o=this.parseSIDX.call(this,j,c.range.start),p=o.references,null!==p&&void 0!==p&&p.length>0&&(w=1===p[0].type),w){x.debug.log("Initiate multiple SIDX load.");var y,z,A,B,C,D=[],E=0,F=function(a){a?(D=D.concat(a),E+=1,E>=z&&g.call(x,D)):g.call(x)};for(y=0,z=p.length;z>y;y+=1)A=p[y].offset,B=p[y].offset+p[y].size-1,C=A+"-"+B,f.call(x,d,null,C,F)}else x.debug.log("Parsing segments from SIDX."),h=b.call(x,j,c.url,c.range.start),g.call(x,h)},f=function(a,c,d,f){var g,h,i=new XMLHttpRequest,j=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,k=!0,l=this,m={url:j,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:i};null===d?(l.debug.log("No known range for SIDX request."),m.searching=!0,m.range.start=0,m.range.end=m.bytesToLoad):(h=d.split("-"),m.range.start=parseFloat(h[0]),m.range.end=parseFloat(h[1])),i.onload=function(){i.status<200||i.status>299||(k=!1,m.searching?(m.bytesLoaded=m.range.end,e.call(l,i.response,m,a,function(b){b&&f.call(l,b,a,c)})):(g=b.call(l,i.response,m.url,m.range.start),f.call(l,g,a,c)))},i.onloadend=i.onerror=function(){k&&(k=!1,l.errHandler.downloadError("SIDX",m.url,i),f.call(l,null,a,c))},i.open("GET",l.tokenAuthentication.addTokenAsQueryArg(m.url)),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+m.range.start+"-"+m.range.end),i=l.tokenAuthentication.setTokenInRequestHeader(i),i.send(null),l.debug.log("Perform SIDX load: "+m.url)},g=function(a,b,c){var d=this;a?d.notify(d.eventList.ENAME_SEGMENTS_LOADED,a,b,c):d.notify(d.eventList.ENAME_SEGMENTS_LOADED,null,b,c,new Error("error loading segments"))};return{debug:void 0,errHandler:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},loadSegments:function(a,b,c){f.call(this,a,b,c,g.bind(this))},loadInitialization:d,parseSegments:b,parseSIDX:a,findSIDX:e}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.DashAdapter=function(){"use strict";var a=[],b={},c=function(a,b){return b.getRepresentationForQuality(a.quality)},d=function(a){return b[a.streamInfo.id][a.index]},e=function(b){var c,d=a.length,e=0;for(e;d>e;e+=1)if(c=a[e],b.id===c.id)return c;return null},f=function(a){var b=new MediaPlayer.vo.TrackInfo,c=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index],d=this.manifestExt.getRepresentationFor(a.index,c);return b.id=a.id,b.quality=a.index,b.bandwidth=this.manifestExt.getBandwidth(d),b.DVRWindow=a.segmentAvailabilityRange,b.fragmentDuration=a.segmentDuration||(a.segments&&a.segments.length>0?a.segments[0].duration:0/0),b.MSETimeOffset=a.MSETimeOffset,b.useCalculatedLiveEdgeTime=a.useCalculatedLiveEdgeTime,b.mediaInfo=g.call(this,a.adaptation),b},g=function(a){var b=new MediaPlayer.vo.MediaInfo,c=this,d=a.period.mpd.manifest.Period_asArray[a.period.index].AdaptationSet_asArray[a.index];return b.id=a.id,b.index=a.index,b.type=a.type,b.streamInfo=h.call(this,a.period),b.trackCount=this.manifestExt.getRepresentationCount(d),b.lang=this.manifestExt.getLanguageForAdaptation(d),b.codec=this.manifestExt.getCodec(d),b.mimeType=this.manifestExt.getMimeType(d),b.contentProtection=this.manifestExt.getContentProtectionData(d),b.contentProtection&&b.contentProtection.forEach(function(a){a.KID=c.manifestExt.getKID(a)}),b.isText=this.manifestExt.getIsTextTrack(b.mimeType),b},h=function(a){var b=new MediaPlayer.vo.StreamInfo;return b.id=a.id,b.index=a.index,b.start=a.start,b.duration=a.duration,b.manifestInfo=i.call(this,a.mpd),b},i=function(a){var b=new MediaPlayer.vo.ManifestInfo,c=this.manifestModel.getValue();return b.DVRWindowSize=a.timeShiftBufferDepth,b.loadedTime=a.manifest.loadedTime,b.availableFrom=a.availabilityStartTime,b.minBufferTime=a.manifest.minBufferTime,b.maxFragmentDuration=a.maxSegmentDuration,b.duration=this.manifestExt.getDuration(c),b.isDynamic=this.manifestExt.getIsDynamic(c),b},j=function(a,c,d){var f,h=e(c),i=h.id,j=this.manifestExt.getAdaptationForType(a,c.index,d);return j?(f=this.manifestExt.getIndexForAdaptation(j,a,c.index),b[i]=b[i]||this.manifestExt.getAdaptationsForPeriod(a,h),g.call(this,b[i][f])):null},k=function(c){var d,e,f,g=[];if(!c)return null;for(d=this.manifestExt.getMpd(c),a=this.manifestExt.getRegularPeriods(c,d),b={},e=a.length,f=0;e>f;f+=1)g.push(h.call(this,a[f]));return g},l=function(a){var b=this.manifestExt.getMpd(a);return i.call(this,b)},m=function(a,b){var c=a.trackController.getRepresentationForQuality(b);return a.indexHandler.getInitRequest(c)},n=function(a,b){var d=c(b,a.trackController);return a.indexHandler.getNextSegmentRequest(d)},o=function(a,b,d,e){var f=c(b,a.trackController);return a.indexHandler.getSegmentRequestForTime(f,d,e)},p=function(a,b,d){var e=c(b,a.trackController),f=a.indexHandler.generateSegmentRequestForTime(e,d);return f},q=function(a){return a.indexHandler.getCurrentTime()},r=function(a,b){return a.indexHandler.setCurrentTime(b)},s=function(a){var b,c,f=e(a.getStreamInfo()),g=a.getMediaInfo(),h=d(g),i=this.manifestModel.getValue(),j=a.getType();b=g.id,c=b?this.manifestExt.getAdaptationForId(b,i,f.index):this.manifestExt.getAdaptationForIndex(g.index,i,f.index),a.setMediaInfo(g),a.trackController.updateData(c,h,j)},t=function(a,b){var c=a.getRepresentationForQuality(b);return c?f.call(this,c):null},u=function(a){var b=a.getCurrentRepresentation();return b?f.call(this,b):null},v=function(a,b,c){var d=new Dash.vo.Event,e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=c*g+h;return b[e]?(d.eventStream=b[e],d.eventStream.value=f,d.eventStream.timescale=g,d.duration=i,d.id=j,d.presentationTime=l,d.messageData=k,d.presentationTimeDelta=h,d):null},w=function(a,b){var f=this.manifestModel.getValue(),g=[];return a instanceof MediaPlayer.vo.StreamInfo?g=this.manifestExt.getEventsForPeriod(f,e(a)):a instanceof MediaPlayer.vo.MediaInfo?g=this.manifestExt.getEventStreamForAdaptationSet(f,d(a)):a instanceof MediaPlayer.vo.TrackInfo&&(g=this.manifestExt.getEventStreamForRepresentation(f,c(a,b.trackController))),g};return{system:void 0,manifestExt:void 0,manifestModel:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:f,convertDataToMedia:g,convertDataToStream:h,getDataForTrack:c,getDataForMedia:d,getDataForStream:e,getStreamsInfo:k,getManifestInfo:l,getMediaInfoForType:j,getCurrentTrackInfo:u,getTrackInfoForQuality:t,updateData:s,getInitRequest:m,getNextFragmentRequest:n,getFragmentRequestForTime:o,generateFragmentRequestForTime:p,getIndexHandlerTime:q,setIndexHandlerTime:r,getEventsFor:w,getEvent:v,reset:function(){a=[],b={}}}},Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter},Dash.dependencies.DashHandler=function(){"use strict";var a,b,c,d=-1,e=0,f=function(a,b){for(;a.length<b;)a="0"+a;return a},g=function(a,b,c){for(var d,e,g,h,i=0,j=0,k=b.length,l="%0",m=l.length;;){if(i=a.indexOf("$"+b),0>i)return a;if(j=a.indexOf("$",i+k),0>j)return a;if(d=a.indexOf(l,i+k),d>i&&j>d)switch(e=a.charAt(j-1),g=parseInt(a.substring(d+m,j-1),10),e){case"d":case"i":case"u":h=f(c.toString(),g);break;case"x":h=f(c.toString(16),g);break;case"X":h=f(c.toString(16),g).toUpperCase();break;case"o":h=f(c.toString(8),g);break;default:return this.debug.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),a}else h=c;a=a.substring(0,i)+h+a.substring(j+1)}},h=function(a){return a.split("$$").join("$")},i=function(a,b){if(null===b||-1===a.indexOf("$RepresentationID$"))return a;var c=b.toString();return a.split("$RepresentationID$").join(c)},j=function(a,b){return a.representation.startNumber+b},k=function(a,b){var c,d=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL;return c=a===d?a:-1!==a.indexOf("http://")?a:d+a},l=function(a,c){var d,e,f=this,g=new MediaPlayer.vo.FragmentRequest;return d=a.adaptation.period,g.mediaType=c,g.type="Initialization Segment",g.url=k(a.initialization,a),g.range=a.range,e=d.start,g.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,a.adaptation.period.mpd,b),g.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+d.duration,d.mpd,b),g.quality=a.index,g},m=function(a){var b,d=this;return a?b=l.call(d,a,c):null},n=function(a){var c,e,f,g=a.adaptation.period,h=!1;return b?h=!1:0>d?h=!1:d<a.availableSegmentsNumber?(e=A(d,a),e&&(f=e.presentationStartTime-g.start,c=a.adaptation.period.duration,this.debug.log(a.segmentInfoType+": "+f+" / "+c),h=f>=c)):h=!0,h},o=function(a,c){var d,e,f,g,h=this;return e=a.segmentDuration,f=a.adaptation.period.start+c*e,g=f+e,d=new Dash.vo.Segment,d.representation=a,d.duration=e,d.presentationStartTime=f,d.mediaStartTime=h.timelineConverter.calcMediaTimeFromPresentationTime(d.presentationStartTime,a),d.availabilityStartTime=h.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(d.presentationStartTime,a.adaptation.period.mpd,b),d.availabilityEndTime=h.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,a.adaptation.period.mpd,b),d.wallStartTime=h.timelineConverter.calcWallTimeForSegment(d,b),d.replacementNumber=j(d,c),d.availabilityIdx=c,d},p=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,u=r.SegmentTimeline,v=b.availableSegmentsNumber>0,w=10,x=[],y=0,z=0,A=-1,B=function(a){return t.call(q,b,y,a.d,p,r.media,a.mediaRange,A)};for(p=b.timescale,c=u.S_asArray,k=s.call(q,b),k?(n=k.start,o=k.end):m=q.timelineConverter.calcMediaTimeFromPresentationTime(a||0,b),e=0,f=c.length;f>e;e+=1)if(d=c[e],h=0,d.hasOwnProperty("r")&&(h=d.r),d.hasOwnProperty("t")&&(y=d.t,z=y/p),0>h&&(j=c[e+1],j&&j.hasOwnProperty("t")?i=j.t/p:(i=q.timelineConverter.calcMediaTimeFromPresentationTime(b.segmentAvailabilityRange.end,b),b.segmentDuration=d.d/p),h=Math.ceil((i-z)/(d.d/p))-1),l){if(v)break;A+=h+1}else for(g=0;h>=g;g+=1){if(A+=1,k){if(A>o){if(l=!0,v)break;continue}A>=n&&x.push(B.call(q,d))}else{if(x.length>w){if(l=!0,v)break;continue}z>=m-d.d/p&&x.push(B.call(q,d))}y+=d.d,z=y/p}if(!v){var C,D,E=c[0];C=void 0===E.t?0:q.timelineConverter.calcPresentationTimeFromMediaTime(E.t/p,b),D=q.timelineConverter.calcPresentationTimeFromMediaTime((y-d.d)/p,b),b.segmentAvailabilityRange={start:C,end:D},b.availableSegmentsNumber=A+1}return x},q=function(a){var b,c,d,e,f,h=[],i=this,j=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentTemplate,k=a.segmentDuration,l=a.segmentAvailabilityRange,m=null,n=null;for(f=a.startNumber,b=r.call(i,a),d=b.start,e=b.end,c=d;e>=c;c+=1)m=o.call(i,a,c),m.replacementTime=(f+c-1)*a.segmentDuration,n=j.media,n=g(n,"Number",m.replacementNumber),n=g(n,"Time",m.replacementTime),m.media=n,h.push(m),m=null;return a.availableSegmentsNumber=Math.ceil((l.end-l.start)/k),h},r=function(c){var e,f,g,h=this,i=c.segmentDuration,j=c.adaptation.period.mpd.manifest.minBufferTime,k=c.segmentAvailabilityRange,l={start:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,k.start),end:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,k.end)},m=0/0,n=null,o=c.segments,p=2*i,q=Math.max(2*j,10*i);return l||(l=h.timelineConverter.calcSegmentAvailabilityRange(c,b)),b&&!h.timelineConverter.isTimeSyncCompleted()?(e=Math.floor(l.start/i),f=Math.floor(l.end/i),g={start:e,end:f}):(o?(n=A(d,c),m=n?h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,n.presentationStartTime):d>0?d*i:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,a||o[0].presentationStartTime)):m=d>0?d*i:b?l.end:l.start,e=Math.floor(Math.max(m-p,l.start)/i),f=Math.floor(Math.min(e+q/i,l.end/i)),g={start:e,end:f})},s=function(){var c,e,f,g=2,h=10,i=0,j=Number.POSITIVE_INFINITY;return b&&!this.timelineConverter.isTimeSyncCompleted()?f={start:i,end:j}:!b&&a||0>d?null:(c=Math.max(d-g,i),e=Math.min(d+h,j),f={start:c,end:e})},t=function(a,c,d,e,f,h,i){var k,l,m,n=this,o=c/e,p=Math.min(d/e,a.adaptation.period.mpd.maxSegmentDuration);return k=n.timelineConverter.calcPresentationTimeFromMediaTime(o,a),l=k+p,m=new Dash.vo.Segment,m.representation=a,m.duration=p,m.mediaStartTime=o,m.presentationStartTime=k,m.availabilityStartTime=a.adaptation.period.mpd.manifest.loadedTime,m.availabilityEndTime=n.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(l,a.adaptation.period.mpd,b),m.wallStartTime=n.timelineConverter.calcWallTimeForSegment(m,b),m.replacementTime=c,m.replacementNumber=j(m,i),f=g(f,"Number",m.replacementNumber),f=g(f,"Time",m.replacementTime),m.media=f,m.mediaRange=h,m.availabilityIdx=i,m},u=function(a){var b,c,d,e,f,g,h,i=this,j=[],k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentList,l=k.SegmentURL_asArray.length;for(h=a.startNumber,e=r.call(i,a),f=Math.max(e.start,0),g=Math.min(e.end,k.SegmentURL_asArray.length-1),b=f;g>=b;b+=1)d=k.SegmentURL_asArray[b],c=o.call(i,a,b),c.replacementTime=(h+b-1)*a.segmentDuration,c.media=d.media,c.mediaRange=d.mediaRange,c.index=d.index,c.indexRange=d.indexRange,j.push(c),c=null;return a.availableSegmentsNumber=l,j},v=function(a){var b,c=this,d=a.segmentInfoType;return"SegmentBase"!==d&&"BaseURL"!==d&&B.call(c,a)?("SegmentTimeline"===d?b=p.call(c,a):"SegmentTemplate"===d?b=q.call(c,a):"SegmentList"===d&&(b=u.call(c,a)),w.call(c,a,b)):b=a.segments,b},w=function(a,c){var d;if(a.segments=c,d=c.length-1,b&&isNaN(this.timelineConverter.getExpectedLiveEdge())){var e=c[d].presentationStartTime,f=this.metricsModel.getMetricsFor("stream");this.timelineConverter.setExpectedLiveEdge(e),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(f),{presentationStartTime:e})}},x=function(a){var b=this;if(!a)throw new Error("no representation");return a.segments=null,v.call(b,a),a},y=function(a,e){var f=this,g=a.initialization,h="BaseURL"!==a.segmentInfoType&&"SegmentBase"!==a.segmentInfoType;a.segmentAvailabilityRange=f.timelineConverter.calcSegmentAvailabilityRange(a,b),e||(d=-1),x.call(f,a),g||f.baseURLExt.loadInitialization(a),h||f.baseURLExt.loadSegments(a,c,a.indexRange),g&&h&&f.notify(f.eventList.ENAME_REPRESENTATION_UPDATED,a)},z=function(a,b){var c,d,e,f,g=b.segments,h=g?g.length:null,i=-1;if(g&&h>0)for(f=0;h>f;f+=1)if(c=g[f],d=c.presentationStartTime,e=c.duration,a+e/2>=d&&d+e>a-e/2){i=c.availabilityIdx;break}return i},A=function(a,b){if(!b||!b.segments)return null;var c,d,e=b.segments.length;for(d=0;e>d;d+=1)if(c=b.segments[d],c.availabilityIdx===a)return c;return null},B=function(a){var b,c,e=!1,f=a.segments;return f&&0!==f.length?(c=f[0].availabilityIdx,b=f[f.length-1].availabilityIdx,e=c>d||d>b):e=!0,e},C=function(a){if(null===a||void 0===a)return null;var b,d=new MediaPlayer.vo.FragmentRequest,e=a.representation,f=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].bandwidth;return b=k(a.media,e),b=g(b,"Number",a.replacementNumber),b=g(b,"Time",a.replacementTime),b=g(b,"Bandwidth",f),b=i(b,e.id),b=h(b),d.mediaType=c,d.type="Media Segment",d.url=b,d.range=a.mediaRange,d.startTime=a.presentationStartTime,d.duration=a.duration,d.timescale=e.timescale,d.availabilityStartTime=a.availabilityStartTime,d.availabilityEndTime=a.availabilityEndTime,d.wallStartTime=a.wallStartTime,d.quality=e.index,d.index=a.availabilityIdx,d},D=function(b,e,f){var g,h,i,j=d,k=this;return b?(a=e,k.debug.log("Getting the request for time: "+e),d=z.call(k,e,b),v.call(k,b),0>d&&(d=z.call(k,e,b)),k.debug.log("Index for time "+e+" is "+d),i=n.call(k,b),i?(g=new MediaPlayer.vo.FragmentRequest,g.action=g.ACTION_COMPLETE,g.index=d,g.mediaType=c,k.debug.log("Signal complete."),k.debug.log(g)):(h=A(d,b),g=C.call(k,h)),f&&(d=j),g):null},E=function(a,b){var c=(a.segmentAvailabilityRange.end-a.segmentAvailabilityRange.start)/2;return a.segments=null,a.segmentAvailabilityRange={start:b-c,end:b+c},D.call(this,a,b,!1)},F=function(b){var e,f,g,h,i=this;if(!b)return null;if(-1===d)throw"You must call getSegmentRequestForTime first.";return a=null,d+=1,h=d,g=n.call(i,b),g?(e=new MediaPlayer.vo.FragmentRequest,e.action=e.ACTION_COMPLETE,e.index=h,e.mediaType=c,i.debug.log("Signal complete.")):(v.call(i,b),f=A(h,b),e=C.call(i,f)),e},G=function(a,b){b.segments&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,b)},H=function(a,b,d,e,f){if(!f&&c===e){var g,h,i,j,k=this,l=[],m=0;for(g=0,h=b.length;h>g;g+=1)i=b[g],j=t.call(k,d,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,m),l.push(j),j=null,m+=1;d.segmentAvailabilityRange={start:l[0].presentationStartTime,end:l[h-1].presentationStartTime},d.availableSegmentsNumber=h,w.call(k,d,l),d.initialization&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,d)}};return{debug:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_REPRESENTATION_UPDATED:"representationUpdated"},setup:function(){this.initializationLoaded=G,this.segmentsLoaded=H},initialize:function(a){this.subscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,a.trackController),c=a.getType(),b=a.isDynamic(),this.streamProcessor=a},getType:function(){return c},setType:function(a){c=a},getIsDynamic:function(){return b},setIsDynamic:function(a){b=a},setCurrentTime:function(a){e=a},getCurrentTime:function(){return e},reset:function(){e=0,a=void 0,d=-1,this.unsubscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.trackController)},getInitRequest:m,getSegmentRequestForTime:D,getNextSegmentRequest:F,generateSegmentRequestForTime:E,updateRepresentation:y}},Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(a,b){"use strict";var c,d,e,f=a.ContentComponent_asArray,g=new RegExp("text"!==b?b:"(vtt|ttml)"),h=!1,i=!1;if(f)for(c=0,d=f.length;d>c;c+=1)f[c].contentType===b&&(h=!0,i=!0);if(a.hasOwnProperty("mimeType")&&(h=g.test(a.mimeType),i=!0),!i)for(c=0,d=a.Representation_asArray.length;!i&&d>c;)e=a.Representation_asArray[c],e.hasOwnProperty("mimeType")&&(h=g.test(e.mimeType),i=!0),c+=1;return h},getIsAudio:function(a){"use strict";return this.getIsTypeOf(a,"audio")},getIsVideo:function(a){"use strict";return this.getIsTypeOf(a,"video")},getIsText:function(a){"use strict";return this.getIsTypeOf(a,"text")},getIsTextTrack:function(a){return"text/vtt"===a||"application/ttml+xml"===a},getLanguageForAdaptation:function(a){var b="";return a.hasOwnProperty("lang")&&(b=a.lang),b},getIsMain:function(){"use strict";return!1},processAdaptation:function(a){"use strict";return void 0!==a.Representation_asArray&&null!==a.Representation_asArray&&a.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),a},getAdaptationForId:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d].hasOwnProperty("id")&&f[d].id===a)return f[d];return null},getAdaptationForIndex:function(a,b,c){"use strict";var d=b.Period_asArray[c].AdaptationSet_asArray;return d[a]},getIndexForAdaptation:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d]===a)return d;return-1},getAdaptationsForType:function(a,b,c){"use strict";var d,e,f=this,g=a.Period_asArray[b].AdaptationSet_asArray,h=[];for(d=0,e=g.length;e>d;d+=1)this.getIsTypeOf(g[d],c)&&h.push(f.processAdaptation(g[d]));return h},getAdaptationForType:function(a,b,c){"use strict";var d,e,f,g=this;if(f=this.getAdaptationsForType(a,b,c),!f||0===f.length)return null;for(d=0,e=f.length;e>d;d+=1)if(g.getIsMain(f[d]))return f[d];return f[0]},getCodec:function(a){"use strict";var b=a.Representation_asArray[0],c=b.mimeType+';codecs="'+b.codecs+'"';return c},getMimeType:function(a){"use strict";return a.Representation_asArray[0].mimeType},getKID:function(a){"use strict";return a&&a.hasOwnProperty("cenc:default_KID")?a["cenc:default_KID"]:null},getContentProtectionData:function(a){"use strict";return a&&a.hasOwnProperty("ContentProtection_asArray")&&0!==a.ContentProtection_asArray.length?a.ContentProtection_asArray:null},getIsDynamic:function(a){"use strict";var b=!1,c="dynamic";return a.hasOwnProperty("type")&&(b=a.type===c),b},getIsDVR:function(a){"use strict";var b,c,d=this.getIsDynamic(a);return b=!isNaN(a.timeShiftBufferDepth),c=d&&b},getIsOnDemand:function(a){"use strict";var b=!1;return a.profiles&&a.profiles.length>0&&(b=-1!==a.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),b},getDuration:function(a){var b;return b=a.hasOwnProperty("mediaPresentationDuration")?a.mediaPresentationDuration:Number.POSITIVE_INFINITY},getBandwidth:function(a){"use strict";return a.bandwidth},getRefreshDelay:function(a){"use strict";var b=0/0,c=2;return a.hasOwnProperty("minimumUpdatePeriod")&&(b=Math.max(parseFloat(a.minimumUpdatePeriod),c)),b},getRepresentationCount:function(a){"use strict";return a.Representation_asArray.length},getRepresentationFor:function(a,b){"use strict";return b.Representation_asArray[a]},getRepresentationsForAdaptation:function(a,b){for(var c,d,e,f,g,h=this,i=h.processAdaptation(a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index]),j=[],k=0;k<i.Representation_asArray.length;k+=1)f=i.Representation_asArray[k],c=new Dash.vo.Representation,c.index=k,c.adaptation=b,f.hasOwnProperty("id")&&(c.id=f.id),f.hasOwnProperty("SegmentBase")?(e=f.SegmentBase,c.segmentInfoType="SegmentBase"):f.hasOwnProperty("SegmentList")?(e=f.SegmentList,c.segmentInfoType="SegmentList",c.useCalculatedLiveEdgeTime=!0):f.hasOwnProperty("SegmentTemplate")?(e=f.SegmentTemplate,e.hasOwnProperty("SegmentTimeline")?(c.segmentInfoType="SegmentTimeline",g=e.SegmentTimeline.S_asArray[e.SegmentTimeline.S_asArray.length-1],(!g.hasOwnProperty("r")||g.r>=0)&&(c.useCalculatedLiveEdgeTime=!0)):c.segmentInfoType="SegmentTemplate",e.hasOwnProperty("initialization")&&(c.initialization=e.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):(e=f.BaseURL,c.segmentInfoType="BaseURL"),e.hasOwnProperty("Initialization")?(d=e.Initialization,d.hasOwnProperty("sourceURL")?c.initialization=d.sourceURL:d.hasOwnProperty("range")&&(c.initialization=f.BaseURL,c.range=d.range)):f.hasOwnProperty("mimeType")&&h.getIsTextTrack(f.mimeType)&&(c.initialization=f.BaseURL,c.range=0),e.hasOwnProperty("timescale")&&(c.timescale=e.timescale),e.hasOwnProperty("duration")&&(c.segmentDuration=e.duration/c.timescale),e.hasOwnProperty("startNumber")&&(c.startNumber=e.startNumber),e.hasOwnProperty("indexRange")&&(c.indexRange=e.indexRange),e.hasOwnProperty("presentationTimeOffset")&&(c.presentationTimeOffset=e.presentationTimeOffset/c.timescale),c.MSETimeOffset=h.timelineConverter.calcMSETimeOffset(c),j.push(c);return j},getAdaptationsForPeriod:function(a,b){for(var c,d,e=a.Period_asArray[b.index],f=[],g=0;g<e.AdaptationSet_asArray.length;g+=1)d=e.AdaptationSet_asArray[g],c=new Dash.vo.AdaptationSet,d.hasOwnProperty("id")&&(c.id=d.id),c.index=g,c.period=b,c.type=this.getIsAudio(d)?"audio":this.getIsVideo(d)?"video":"text",f.push(c);return f},getRegularPeriods:function(a,b){var c,d,e=this,f=[],g=e.getIsDynamic(a),h=null,i=null,j=null,k=null;for(c=0,d=a.Period_asArray.length;d>c;c+=1)i=a.Period_asArray[c],i.hasOwnProperty("start")?(k=new Dash.vo.Period,k.start=i.start):null!==h&&i.hasOwnProperty("duration")?(k=new Dash.vo.Period,k.start=j.start+j.duration,k.duration=i.duration):0!==c||g||(k=new Dash.vo.Period,k.start=0),null!==j&&isNaN(j.duration)&&(j.duration=k.start-j.start),null!==k&&i.hasOwnProperty("id")&&(k.id=i.id),null!==k&&i.hasOwnProperty("duration")&&(k.duration=i.duration),null!==k&&(k.index=c,k.mpd=b,f.push(k)),h=i,i=null,j=k,k=null;return 0===f.length?f:(b.checkTime=e.getCheckTime(a,f[0]),null!==j&&isNaN(j.duration)&&(j.duration=e.getEndTimeForLastPeriod(b)-j.start),f)},getMpd:function(a){var b=new Dash.vo.Mpd;return b.manifest=a,b.availabilityStartTime=new Date(a.hasOwnProperty("availabilityStartTime")?a.availabilityStartTime.getTime():a.loadedTime.getTime()),a.hasOwnProperty("availabilityEndTime")&&(b.availabilityEndTime=new Date(a.availabilityEndTime.getTime())),a.hasOwnProperty("suggestedPresentationDelay")&&(b.suggestedPresentationDelay=a.suggestedPresentationDelay),a.hasOwnProperty("timeShiftBufferDepth")&&(b.timeShiftBufferDepth=a.timeShiftBufferDepth),a.hasOwnProperty("maxSegmentDuration")&&(b.maxSegmentDuration=a.maxSegmentDuration),b},getFetchTime:function(a,b){var c=this.timelineConverter.calcPresentationTimeFromWallTime(a.loadedTime,b);return c},getCheckTime:function(a,b){var c,d=this,e=0/0;return a.hasOwnProperty("minimumUpdatePeriod")&&(c=d.getFetchTime(a,b),e=c+a.minimumUpdatePeriod),e},getEndTimeForLastPeriod:function(a){var b;if(a.manifest.mediaPresentationDuration)b=a.manifest.mediaPresentationDuration;else{if(isNaN(a.checkTime))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");b=a.checkTime}return b},getEventsForPeriod:function(a,b){var c=a.Period_asArray,d=c[b.index].EventStream_asArray,e=[];if(d)for(var f=0;f<d.length;f+=1){var g=new Dash.vo.EventStream;if(g.period=b,g.timescale=1,!d[f].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";g.schemeIdUri=d[f].schemeIdUri,d[f].hasOwnProperty("timescale")&&(g.timescale=d[f].timescale),d[f].hasOwnProperty("value")&&(g.value=d[f].value);for(var h=0;h<d[f].Event_asArray.length;h+=1){var i=new Dash.vo.Event;i.presentationTime=0,i.eventStream=g,d[f].Event_asArray[h].hasOwnProperty("presentationTime")&&(i.presentationTime=d[f].Event_asArray[h].presentationTime),d[f].Event_asArray[h].hasOwnProperty("duration")&&(i.duration=d[f].Event_asArray[h].duration),d[f].Event_asArray[h].hasOwnProperty("id")&&(i.id=d[f].Event_asArray[h].id),e.push(i)}}return e},getEventStreamForAdaptationSet:function(a,b){var c=[],d=a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index].InbandEventStream_asArray;if(d)for(var e=0;e<d.length;e+=1){var f=new Dash.vo.EventStream;if(f.timescale=1,!d[e].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";f.schemeIdUri=d[e].schemeIdUri,d[e].hasOwnProperty("timescale")&&(f.timescale=d[e].timescale),d[e].hasOwnProperty("value")&&(f.value=d[e].value),c.push(f)}return c},getEventStreamForRepresentation:function(a,b){var c=[],d=a.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].InbandEventStream_asArray;if(d)for(var e=0;e<d.length;e++){var f=new Dash.vo.EventStream;if(f.timescale=1,f.representation=b,!d[e].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";f.schemeIdUri=d[e].schemeIdUri,d[e].hasOwnProperty("timescale")&&(f.timescale=d[e].timescale),d[e].hasOwnProperty("value")&&(f.value=d[e].value),c.push(f)}return c}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return j;return-1},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){return this.manifestExt.getIsTypeOf(a,b)},d=function(a,b){var d,e,f,g,h,i;for(h=0;h<a.length;h+=1)for(d=a[h],f=d.AdaptationSet_asArray,i=0;i<f.length;i+=1)if(e=f[i],g=e.Representation_asArray,c.call(this,e,b))return g.length;return-1},e=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.bandwidth},f=function(b){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=a.call(d,f,b)},g=function(a){var b,c=this,e=c.manifestModel.getValue(),f=e.Period_asArray;return b=d.call(this,f,a)},h=function(a){if(null===a)return null;var b,c,d,e=a.RepSwitchList;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},i=function(a){if(null===a)return null;var b,c,d,e=a.BufferLevel;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},j=function(a){if(null===a)return null;var b,c,d=a.PlayList;return null===d||d.length<=0?null:(b=d[d.length-1].trace,null===b||b.length<=0?null:c=b[b.length-1].playbackspeed)},k=function(a){if(null===a)return null;var b,c,d=a.HttpList,e=null;if(null===d||d.length<=0)return null;for(b=d.length,c=b-1;c>0;){if(d[c].responsecode){e=d[c];break}c-=1}return e},l=function(a){return null===a?[]:a.HttpList?a.HttpList:[]},m=function(a){if(null===a)return null;var b,c,d,e=a.DroppedFrames;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},n=function(a){if(null===a)return null;var b,c,d,e=a.SchedulingInfo;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},o=function(a){if(null===a)return null;var b,c,d,e=a.ManifestUpdate;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},p=function(a){if(null===a)return null;var b,c=a.DVRInfo,d=null;return null===c||c.length<=0?null:(b=c.length-1,d=c[b])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:e,getIndexForRepresentation:f,getMaxIndexForBufferType:g,getCurrentRepresentationSwitch:h,getCurrentBufferLevel:i,getCurrentPlaybackRate:j,getCurrentHttpRequest:k,getHttpRequests:l,getCurrentDroppedFrames:m,getCurrentSchedulingInfo:n,getCurrentDVRInfo:p,getCurrentManifestUpdate:o}
},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=[{type:"duration",test:function(a){return h.test(a)},converter:function(f){var g=h.exec(f);return parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0)}},{type:"datetime",test:function(a){return i.test(a)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return parseFloat(a)}}],l=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},m=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},o=function(){var a=[];return a.push(l()),a.push(m()),a.push(n()),a},p=function(a,b){var c,d=new X2JS(k,"",!0),e=new ObjectIron(o()),f=new Date,g=null,h=null;try{c=d.xml_str2json(a),g=new Date,c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray[0],0!==c.BaseURL.toString().indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,e.run(c),h=new Date,this.debug.log("Parsing complete: ( xml2json: "+(g.getTime()-f.getTime())+"ms, objectiron: "+(h.getTime()-g.getTime())+"ms, total: "+(h.getTime()-f.getTime())/1e3+"s)")}catch(i){return this.errHandler.manifestError("parsing the manifest failed","parse",a),null}return c};return{debug:void 0,errHandler:void 0,parse:p}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.FragmentExtensions=function(){"use strict";var a=function(a){for(var b,c,d,e,f,g,h=new DataView(a),i=0;"tfdt"!==e&&i<h.byteLength;){for(d=h.getUint32(i),i+=4,e="",f=0;4>f;f+=1)g=h.getInt8(i),e+=String.fromCharCode(g),i+=1;"moof"!==e&&"traf"!==e&&"tfdt"!==e&&(i+=d-8)}if(i===h.byteLength)throw"Error finding live offset.";return c=h.getUint8(i),this.debug.log("position: "+i),0===c?(i+=4,b=h.getUint32(i,!1)):(i+=d-16,b=utils.Math.to64BitNumber(h.getUint32(i+4,!1),h.getUint32(i,!1))),{version:c,base_media_decode_time:b}},b=function(a){for(var b,c,d,e,f,g,h,i=new DataView(a),j=0;"sidx"!==f&&j<i.byteLength;){for(g=i.getUint32(j),j+=4,f="",e=0;4>e;e+=1)h=i.getInt8(j),f+=String.fromCharCode(h),j+=1;"moof"!==f&&"traf"!==f&&"sidx"!==f?j+=g-8:"sidx"===f&&(j-=8)}return b=i.getUint8(j+8),j+=12,c=i.getUint32(j+4,!1),j+=8,d=0===b?i.getUint32(j,!1):utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1)),{earliestPresentationTime:d,timescale:c}},c=function(b){var c,d,e,f=this,g=new XMLHttpRequest,h=!1;c=b,g.onloadend=function(){h||(d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d)))},g.onload=function(){h=!0,e=a(g.response),f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,e)},g.onerror=function(){d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d))},g.responseType="arraybuffer",g.open("GET",c),g.send(null)};return{debug:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},loadFragment:c,parseTFDT:a,parseSIDX:b}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.RepresentationController=function(){"use strict";var a,b=null,c=-1,d=!0,e=[],f=function(c,f,i){var k=this;if(d=!0,k.notify(k.eventList.ENAME_DATA_UPDATE_STARTED),e=j.call(k,f),a=h.call(k,k.abrController.getQualityFor(i)),b=c,"video"!==i&&"audio"!==i)return k.notify(k.eventList.ENAME_DATA_UPDATE_COMPLETED,b,a),void g.call(k);for(var l=0;l<e.length;l+=1)k.indexHandler.updateRepresentation(e[l],!0)},g=function(){var a=new Date,b=this.getCurrentRepresentation(),c=this.streamProcessor.playbackController.getTime();this.metricsModel.addTrackSwitch(b.adaptation.type,a,c,b.id)},h=function(a){return e[a]},i=function(){for(var a=0,b=e.length;b>a;a+=1)if(null===e[a].segmentAvailabilityRange||null===e[a].initialization)return!1;return!0},j=function(a){var d,e=this,f=e.manifestModel.getValue();return c=e.manifestExt.getIndexForAdaptation(b,f,a.period.index),d=e.manifestExt.getRepresentationsForAdaptation(f,a)},k=function(a){for(var b,c=this,d=0,f=e.length;f>d;d+=1)b=e[d],b.segmentAvailabilityRange=c.timelineConverter.calcSegmentAvailabilityRange(b,a)},l=function(c,e){for(var f,h=this,j=e,k=h.metricsModel.getMetricsFor("stream"),l=h.metricsExt.getCurrentManifestUpdate(k),m=!1,n=0;n<l.trackInfo.length;n+=1)if(f=l.trackInfo[n],f.index===j.index&&f.mediaType===h.streamProcessor.getType()){m=!0;break}m||h.metricsModel.addManifestUpdateTrackInfo(l,j.id,j.index,j.adaptation.period.index,h.streamProcessor.getType(),j.presentationTimeOffset,j.startNumber,j.segmentInfoType),i()&&(d=!1,h.metricsModel.updateManifestUpdateInfo(l,{latency:a.segmentAvailabilityRange.end-h.streamProcessor.playbackController.getTime()}),this.notify(this.eventList.ENAME_DATA_UPDATE_COMPLETED,b,a),g.call(h))},m=function(a,b){k.call(this,b)},n=function(){k.call(this,!0),this.indexHandler.updateRepresentation(a,!1)},o=function(b){var c=b.streamProcessor,d=this,e=d.timelineConverter.calcSegmentAvailabilityRange(a,c.isDynamic());d.metricsModel.addDVRInfo(c.getType(),c.playbackController.getTime(),c.getStreamInfo().manifestInfo,e)},p=function(b,c,d,e){var f=this;c===f.streamProcessor.getType()&&(a=f.getRepresentationForQuality(e),g.call(f))};return{system:void 0,debug:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},setup:function(){this.qualityChanged=p,this.representationUpdated=l,this.wallclockTimeUpdated=m,this.liveEdgeFound=n,this.bufferLevelUpdated=o},initialize:function(a){this.streamProcessor=a,this.indexHandler=a.indexHandler},getData:function(){return b},getDataIndex:function(){return c},isUpdating:function(){return d},updateData:f,getRepresentationForQuality:h,getCurrentRepresentation:function(){return a}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.TimelineConverter=function(){"use strict";var a=0,b=!1,c=0/0,d=function(b,c,d,e){var f=0/0;return f=e?d&&c.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(c.availabilityStartTime.getTime()+1e3*(b+c.timeShiftBufferDepth)):c.availabilityEndTime:d?new Date(c.availabilityStartTime.getTime()+1e3*(b-a)):c.availabilityStartTime},e=function(a,b,c){return d.call(this,a,b,c)},f=function(a,b,c){return d.call(this,a,b,c,!0)},g=function(b,c){return(b.getTime()-c.mpd.availabilityStartTime.getTime()+1e3*a)/1e3},h=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return a+(c-d)},i=function(a,b){var c=b.adaptation.period.start,d=b.presentationTimeOffset;return a-c+d},j=function(a,b){var c,d,e;return b&&(c=a.representation.adaptation.period.mpd.suggestedPresentationDelay,d=a.presentationStartTime+c,e=new Date(a.availabilityStartTime.getTime()+1e3*d)),e},k=function(a,c){var d,e,f=a.segmentDuration,h=a.adaptation.period.start,i=h+a.adaptation.period.duration,j={start:h,end:i};return c?b&&!isNaN(f)||!a.segmentAvailabilityRange?(d=a.adaptation.period.mpd.checkTime,e=g(new Date((new Date).getTime()),a.adaptation.period),h=Math.max(e-a.adaptation.period.mpd.timeShiftBufferDepth,0),i=isNaN(d)?e:Math.min(d,e),j={start:h,end:i}):a.segmentAvailabilityRange:j},l=function(a,b){var c=a.adaptation.period.start;return b-c},m=function(a,b){var c=a.adaptation.period.start;return b+c},n=function(d,e,f){b||(a=e-(c+f),b=!0)},o=function(a){var b=a.presentationTimeOffset,c=a.adaptation.period.start;return c-b},p=function(){a=0,b=!1,c=0/0};return{notifier:void 0,uriQueryFragModel:void 0,setup:function(){this.liveEdgeFound=n},calcAvailabilityStartTimeFromPresentationTime:e,calcAvailabilityEndTimeFromPresentationTime:f,calcPresentationTimeFromWallTime:g,calcPresentationTimeFromMediaTime:h,calcPeriodRelativeTimeFromMpdRelativeTime:l,calcMpdRelativeTimeFromPeriodRelativeTime:m,calcMediaTimeFromPresentationTime:i,calcSegmentAvailabilityRange:k,calcWallTimeForSegment:j,calcMSETimeOffset:o,reset:p,isTimeSyncCompleted:function(){return b},getClientTimeOffset:function(){return a},getExpectedLiveEdge:function(){return c},setExpectedLiveEdge:function(a){c=a}}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1,this.type=null},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Event=function(){"use strict";this.duration=0/0,this.presentationTime=0/0,this.id=0/0,this.messageData="",this.eventStream=null,this.presentationTimeDelta=0/0},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=0/0,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=0/0,this.start=0/0,this.mpd=null},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=0/0,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=0/0,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=0/0,this.replacementTime=null,this.replacementNumber=0/0,this.mediaStartTime=0/0,this.presentationStartTime=0/0,this.availabilityStartTime=0/0,this.availabilityEndTime=0/0,this.availabilityIdx=0/0,this.wallStartTime=0/0,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},MediaPlayer.dependencies.AbrController=function(){"use strict";var a=!0,b={},c={},d={},e=function(a){var b;return c.hasOwnProperty(a)||(c[a]=0),b=c[a]},f=function(a,b){c[a]=b},g=function(a){var b;return d.hasOwnProperty(a)||(d[a]=0),b=d[a]},h=function(a,b){d[a]=b},i=function(a,c){b[a]=c},j=function(a){var c;return b.hasOwnProperty(a)||(b[a]=0),c=b[a]},k=function(a,b,c){var d,e=this,f=this.adapter.convertDataToTrack(c).mediaInfo,g=f.type;d=f.trackCount-1,j(g)!==d&&(i(g,d),e.notify(e.eventList.ENAME_TOP_QUALITY_INDEX_CHANGED,g,d))};return{debug:void 0,adapter:void 0,abrRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_QUALITY_CHANGED:"qualityChanged",ENAME_TOP_QUALITY_INDEX_CHANGED:"topQualityIndexChanged"},setup:function(){this.dataUpdateCompleted=k},getAutoSwitchBitrate:function(){return a},setAutoSwitchBitrate:function(b){a=b},getPlaybackQuality:function(b){var c,d,i,k,l=this,m=b.getType(),n=function(a){var b=j(m);c=a.value,k=a.confidence,0>c&&(c=0),c>b&&(c=b),d=e(m),c!==d&&(f(m,c),h(m,k),l.notify(l.eventList.ENAME_QUALITY_CHANGED,m,d,c))};c=e(m),k=g(m),a&&(l.abrRulesCollection.downloadRatioRule&&l.abrRulesCollection.downloadRatioRule.setStreamProcessor(b),i=l.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),l.rulesController.applyRules(i,b,n.bind(l),c,function(a,b){return Math.min(a,b)}))},setPlaybackQuality:function(a,c){var d=e(a),g=null!==c&&!isNaN(c)&&c%1===0;if(!g)throw"argument is not an integer";c!==d&&c>=0&&b.hasOwnProperty(a)&&c<=b[a]&&(f(a,c),this.notify(this.eventList.ENAME_QUALITY_CHANGED,a,d,c))},getQualityFor:function(a){return e(a)},getConfidenceFor:function(a){return g(a)},isPlayingAtTopQuality:function(){var a,b=this,c=b.getQualityFor("audio"),d=b.getQualityFor("video");return a=c===j("audio")&&d===j("video")},reset:function(){var e,f=this.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),g=f.length,h=0;for(h;g>h;h+=1)e=f[h],"function"==typeof e.reset&&e.reset();a=!0,b={},c={},d={}}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.BufferController=function(){"use strict";var a,b,c,d,e=.5,f=22,g=[],h=0,i=-1,j=!1,k=0,l=Number.POSITIVE_INFINITY,m=-1,n=-1,o=null,p=null,q=!1,r=!1,s=[],t=!1,u=function(){var a=this.streamProcessor.getFragmentModel().getLoadingRequests();return i>h&&(v(s,i)||v(a,i))?!1:i!==h},v=function(a,b){var c=0,d=a.length;for(c;d>c;c+=1)if(a[c].quality===b)return!0;return!1},w=function(a,b){var c=function(a,c){return a[b]<c[b]?-1:a[b]>c[b]?1:0};a.sort(c)},x=function(a,c,d,e){var f=this;c===f.streamProcessor.getFragmentModel()&&(f.debug.log("Initialization finished loading: "+b),g[e]=d,e===h&&u.call(f)&&Y.call(f))},y=function(a,b,c,d,e){if(b===this.streamProcessor.getFragmentModel()){var f,g=this.streamProcessor.getFragmentModel().getExecutedRequestForQualityAndIndex(d,e),h=this.streamProcessor.getTrackForQuality(d),i=this.adapter.getEventsFor(h.mediaInfo,this.streamProcessor),j=this.adapter.getEventsFor(h,this.streamProcessor);(i.length>0||j.length>0)&&(f=C.call(this,c,g,i,j),this.streamProcessor.getEventController().addInbandEvents(f)),c=D.call(this,c),s.push({bytes:c,quality:d,index:e}),w(s,"index"),P.call(this)}},z=function(a,b,c){r=!0,d={quality:b,index:c};var e=this,f=isNaN(c);return b!==h&&f||b!==i&&!f?void R.call(e,b,c):void e.sourceBufferExt.append(o,a)},A=function(c,e,g,h){if(o===e){this.isBufferingCompleted()&&this.mediaSourceExt.signalEndOfStream(a);var i,j=this;if(h)return h.code===f&&(s.unshift({bytes:g,quality:d.quality,index:d.index}),l=.8*J.call(j),j.notify(j.eventList.ENAME_QUOTA_EXCEEDED,l),H.call(j)),void(r=!1);if(B.call(j),G.call(j)||(j.notify(j.eventList.ENAME_QUOTA_EXCEEDED,l),H.call(j)),i=j.sourceBufferExt.getAllRanges(o),i&&i.length>0){var k,m;for(k=0,m=i.length;m>k;k+=1)j.debug.log("Buffered "+b+" Range: "+i.start(k)+" - "+i.end(k))}Q.call(j,d.quality,d.index),j.notify(j.eventList.ENAME_BYTES_APPENDED,d.quality,d.index)}},B=function(){var a=this,b=a.playbackController.getTime();return k=a.sourceBufferExt.getBufferLength(o,b),a.notify(a.eventList.ENAME_BUFFER_LEVEL_UPDATED,k),E.call(a),L.call(a),e>k&&M.call(a,!1),!0},C=function(a,b,c,d){var e,f,g,h,i=[],j=0,k=Math.pow(256,2),l=Math.pow(256,3),m=Math.max(isNaN(b.startTime)?0:b.startTime,0),n=[];t=!1,h=c.concat(d);for(var o=0;o<h.length;o++)n[h[o].schemeIdUri]=h[o];for(;j<a.length&&(e=String.fromCharCode(a[j+4],a[j+5],a[j+6],a[j+7]),f=a[j]*l+a[j+1]*k+256*a[j+2]+1*a[j+3],"moov"!=e&&"moof"!=e);){if("emsg"==e){t=!0;for(var p=["","",0,0,0,0,""],q=0,r=j+12;f+j>r;)0===q||1==q||6==q?(0!==a[r]?p[q]+=String.fromCharCode(a[r]):q+=1,r+=1):(p[q]=a[r]*l+a[r+1]*k+256*a[r+2]+1*a[r+3],r+=4,q+=1);g=this.adapter.getEvent(p,n,m),g&&i.push(g)}j+=f}return i},D=function(a){if(!t)return a;for(var b,c,d=a.length,e=0,f=0,g=Math.pow(256,2),h=Math.pow(256,3),i=new Uint8Array(a.length);d>e;){if(b=String.fromCharCode(a[e+4],a[e+5],a[e+6],a[e+7]),c=a[e]*h+a[e+1]*g+256*a[e+2]+1*a[e+3],"emsg"!=b)for(var j=e;e+c>j;j++)i[f]=a[j],f+=1;e+=c}return i.subarray(0,f)},E=function(){var a=F.call(this),b=2*c,d=k-a;d>=b&&!q?(q=!0,this.notify(this.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):b/2>d&&q&&(this.notify(this.eventList.ENAME_BUFFER_LEVEL_BALANCED),q=!1,P.call(this))},F=function(){var a=this.metricsModel.getReadOnlyMetricsFor("video"),b=this.metricsExt.getCurrentBufferLevel(a),c=this.metricsModel.getReadOnlyMetricsFor("audio"),d=this.metricsExt.getCurrentBufferLevel(c),e=null;return e=null===b||null===d?null!==d?d.level:null!==b?b.level:null:Math.min(d.level,b.level)},G=function(){var a=this,b=J.call(a);return l>b},H=function(){var b,c,d,e,f=this,g=f.playbackController.getTime();o&&(e=f.fragmentController.getExecutedRequestForTime(f.streamProcessor.getFragmentModel(),g),c=e&&!isNaN(e.startTime)?e.startTime:Math.floor(g),d=f.sourceBufferExt.getBufferRange(o,g),null===d&&o.buffered.length>0&&(c=o.buffered.end(o.buffered.length-1)),b=o.buffered.start(0),f.sourceBufferExt.remove(o,b,c,a))},I=function(a,b,d,e){o===b&&(B.call(this),this.notify(this.eventList.ENAME_BUFFER_CLEARED,d,e,G.call(this)),G.call(this)||setTimeout(H.bind(this),1e3*c))},J=function(){var a,b,c=this,d=c.sourceBufferExt.getAllRanges(o),e=0;if(!d)return e;for(b=0,a=d.length;a>b;b+=1)e+=d.end(b)-d.start(b);return e},K=function(){var a=m===n-1;a&&!j&&(j=!0,this.notify(this.eventList.ENAME_BUFFERING_COMPLETED))},L=function(){var a=this.playbackController.getTimeToStreamEnd(),b=this.streamProcessor.isDynamic()?c/2:c;b>k&&(a>c||c>=a&&!j)?M.call(this,!1):M.call(this,!0)},M=function(a){p!==a&&(p=a,this.debug.log(p?"Got enough "+b+" buffer to start.":"Waiting for more "+b+" buffer before starting playback."),this.eventBus.dispatchEvent({type:p?"bufferLoaded":"bufferStalled",data:{bufferType:b}}),this.notify(this.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,a))},N=function(a){o.timestampOffset!==a&&(o.timestampOffset=a)},O=function(){var a=this;B.call(a),P.call(a)},P=function(){u.call(this)?Y.call(this):U.call(this)},Q=function(a,b){r=!1,isNaN(b)?S.call(this,a):T.call(this,b),P.call(this)},R=function(a,b){r=!1,this.notify(this.eventList.ENAME_BYTES_REJECTED,a,b),P.call(this)},S=function(a){i=a},T=function(a){m=Math.max(a,m),K.call(this)},U=function(){var a;0===s.length||q||r||u.call(this)||!G.call(this)||(a=s.shift(),z.call(this,a.bytes,a.quality,a.index))},V=function(a,b,d){var e,f=this;N.call(f,d.MSETimeOffset),e=f.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,c!==e&&(f.setMinBufferTime(e),f.notify(f.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,e))},W=function(a,b,c){var d=this;b===d.streamProcessor.getFragmentModel()&&(n=c.index,K.call(d))},X=function(a,c,d,e){if(b===c){var f=this;h!==e&&(N.call(f,f.streamProcessor.getTrackForQuality(e).MSETimeOffset),h=e,u.call(f)&&Y.call(f))}},Y=function(){var a=this;if(g[h]){if(r)return;z.call(a,g[h],h)}else a.notify(a.eventList.ENAME_INIT_REQUESTED,h)},Z=function(){P.call(this)},$=function(){L.call(this)};return{manifestModel:void 0,sourceBufferExt:void 0,eventBus:void 0,bufferMax:void 0,mediaSourceExt:void 0,metricsModel:void 0,metricsExt:void 0,adapter:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested",ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},setup:function(){this.dataUpdateCompleted=V,this.initFragmentLoaded=x,this.mediaFragmentLoaded=y,this.streamCompleted=W,this.qualityChanged=X,this.playbackProgress=O,this.playbackSeeking=O,this.playbackTimeUpdated=O,this.playbackRateChanged=$,this.wallclockTimeUpdated=Z,A=A.bind(this),I=I.bind(this),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,this,A),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,I)},initialize:function(a,c,d,e){var f=this;b=a,f.setMediaSource(d),f.setBuffer(c),f.streamProcessor=e,f.fragmentController=e.fragmentController,f.scheduleController=e.scheduleController,f.playbackController=e.playbackController},getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(a){this.streamProcessor=a},getBuffer:function(){return o},setBuffer:function(a){o=a},getBufferLevel:function(){return k},getMinBufferTime:function(){return c},setMinBufferTime:function(a){c=a},getCriticalBufferLevel:function(){return l},setMediaSource:function(b){a=b},isBufferingCompleted:function(){return j},reset:function(b){var e=this;g=[],l=Number.POSITIVE_INFINITY,p=null,c=null,i=-1,h=0,e.sourceBufferExt.unsubscribe(e.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,e,A),e.sourceBufferExt.unsubscribe(e.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,e,I),d=null,q=!1,r=!1,s=[],b||(e.sourceBufferExt.abort(a,o),e.sourceBufferExt.removeSourceBuffer(a,o)),o=null}}},MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=8,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,supportsMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return a||b},supportsMediaKeys:function(){"use strict";var a="WebKitMediaKeys"in window,b="MSMediaKeys"in window,c="MediaKeys"in window;return a||b||c},supportsCodec:function(a,b){"use strict";if(!(a instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var c=a.canPlayType(b);return"probably"===c||"maybe"===c}},MediaPlayer.utils.Debug=function(){"use strict";var a=!0;return{eventBus:void 0,setLogToBrowserConsole:function(b){a=b},getLogToBrowserConsole:function(){return a},log:function(b){a&&console.log(b),this.eventBus.dispatchEvent({type:"log",message:b})}}},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,capabilityError:function(a){this.eventBus.dispatchEvent({type:"error",error:"capability",event:a})},downloadError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"download",event:{id:a,url:b,request:c}})},manifestError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"manifestError",event:{message:a,id:b,manifest:c}})},closedCaptionsError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"cc",event:{message:a,id:b,cc:c}})},mediaSourceError:function(a){this.eventBus.dispatchEvent({type:"error",error:"mediasource",event:a})},mediaKeySessionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_session",event:a})},mediaKeyMessageError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_message",event:a})},mediaKeySystemSelectionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_system_selection",event:a})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.utils.EventBus=function(){"use strict";var a,b=function(b,c){var d=(c?"1":"0")+b;return d in a||(a[d]=[]),a[d]},c=function(){a={}};return c(),{addEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1===f&&e.push(c)},removeEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1!==f&&e.splice(f,1)},dispatchEvent:function(a){for(var c=b(a.type,!1).slice(),d=0;d<c.length;d++)c[d].call(this,a);return!a.defaultPrevented}}},MediaPlayer.dependencies.EventController=function(){"use strict";var a=[],b=[],c=[],d=null,e=100,f=e/1e3,g="urn:mpeg:dash:event:2012",h=1,i=function(){null!==d&&(clearInterval(d),d=null),a=null,b=null,c=null},j=function(){null!==d&&(clearInterval(d),d=null)},k=function(){var a=this;a.debug.log("Start Event Controller"),isNaN(e)||(d=setInterval(n.bind(this),e))},l=function(b){var c=this;a=[],b&&b.length>0&&(a=b),c.debug.log("Added "+b.length+" inline events")},m=function(a){for(var c=this,d=0;d<a.length;d++){var e=a[d];b[e.id]=e,c.debug.log("Add inband event with id "+e.id)}},n=function(){o.call(this,b),o.call(this,a),p.call(this)},o=function(a){var b,d=this,e=this.videoModel.getCurrentTime();if(a)for(var i=0;i<a.length;i++){var j=a[i];void 0!==j&&(b=j.presentationTime/j.eventStream.timescale,(0===b||e>=b&&b+f>e)&&(d.debug.log("Start Event at "+e),j.duration>0&&c.push(j),j.eventStream.schemeIdUri==g&&j.eventStream.value==h&&q.call(this),a.splice(i,1)))}},p=function(){var a=this;if(c)for(var b=this.videoModel.getCurrentTime(),d=0;d<c.length;d++){var e=c[d];null!==e&&(e.duration+e.presentationTime)/e.eventStream.timescale<b&&(a.debug.log("Remove Event at time "+b),e=null,c.splice(d,1))}},q=function(){var a=this,b=a.manifestModel.getValue(),c=b.url;b.hasOwnProperty("Location")&&(c=b.Location),a.debug.log("Refresh manifest @ "+c),a.manifestLoader.load(c)};return{manifestModel:void 0,manifestLoader:void 0,debug:void 0,system:void 0,errHandler:void 0,videoModel:void 0,addInlineEvents:l,addInbandEvents:m,reset:i,clear:j,start:k,getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},initialize:function(a){this.setVideoModel(a)}}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.dependencies.FragmentController=function(){"use strict";var a=[],b=!1,c=function(b){for(var c=a.length,d=0;c>d;d++)if(a[d].getContext()==b)return a[d];return null},d=function(b,c){var d=this,e=a[0].getContext().streamProcessor,f=e.getStreamInfo().id,g=d.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES);-1!==g.indexOf(this.scheduleRulesCollection.sameTimeRequestRule)&&this.scheduleRulesCollection.sameTimeRequestRule.setFragmentModels(a,f),d.rulesController.applyRules(g,e,c,b,function(a,b){return b})},e=function(a,b){var c=this;c.isInitializationRequest(b)?c.notify(c.eventList.ENAME_INIT_FRAGMENT_LOADING_START,a,b):c.notify(c.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,a,b)},f=function(a,b,c){var d=this,e=d.process(c);return null===e?void d.debug.log("No "+b.mediaType+" bytes to push."):(d.isInitializationRequest(b)?d.notify(d.eventList.ENAME_INIT_FRAGMENT_LOADED,a,e,b.quality):d.notify(d.eventList.ENAME_MEDIA_FRAGMENT_LOADED,a,e,b.quality,b.index),void j.call(this))},g=function(a,b){this.notify(this.eventList.ENAME_STREAM_COMPLETED,a,b)},h=function(){j.call(this)},i=function(c){var d,e,f,g,h,i=c.value;for(g=0;g<i.length;g+=1)if(e=i[g])for(h=0;h<a.length;h+=1)f=a[h],d=f.getContext().streamProcessor.getType(),e.mediaType===d&&(e instanceof MediaPlayer.vo.FragmentRequest||(e=f.getPendingRequestForTime(e.startTime)),f.executeRequest(e));b=!1},j=function(a){b||(b=!0,d.call(this,a,i.bind(this)))};return{system:void 0,debug:void 0,scheduleRulesCollection:void 0,rulesController:void 0,fragmentLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"},setup:function(){this.fragmentLoadingStarted=e,this.fragmentLoadingCompleted=f,this.streamCompleted=g,this.bufferLevelBalanced=h},process:function(a){var b=null;return null!==a&&void 0!==a&&a.byteLength>0&&(b=new Uint8Array(a)),b},getModel:function(b){if(!b)return null;var d=c(b);return d||(d=this.system.getObject("fragmentModel"),d.setContext(b),a.push(d)),d},detachModel:function(b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},isFragmentLoadedOrPending:function(a,b){var d,e=c(a);return e?d=e.isFragmentLoadedOrPending(b):!1},getPendingRequests:function(a){var b=c(a);return b?b.getPendingRequests():null},getLoadingRequests:function(a){var b=c(a);return b?b.getLoadingRequests():null},isInitializationRequest:function(a){return a&&a.type&&-1!==a.type.toLowerCase().indexOf("initialization")},getLoadingTime:function(a){var b=c(a);return b?b.getLoadingTime():null},getExecutedRequestForTime:function(a,b){return a?a.getExecutedRequestForTime(b):null},removeExecutedRequest:function(a,b){a&&a.removeExecutedRequest(b)},removeExecutedRequestsBeforeTime:function(a,b){a&&a.removeExecutedRequestsBeforeTime(b)},cancelPendingRequestsForModel:function(a){a&&a.cancelPendingRequests()},abortRequestsForModel:function(a){a&&a.abortRequests(),j.call(this)},prepareFragmentForLoading:function(a,b){var d=c(a);d&&b&&d.addRequest(b)&&j.call(this,b)},executePendingRequests:function(){j.call(this)},resetModel:function(a){this.abortRequestsForModel(a),this.cancelPendingRequestsForModel(a)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var a=3,b=500,c=[],d=function(a,e){var f=new XMLHttpRequest,g=null,h=!0,i=!0,j=null,k=this;c.push(f),a.requestStartDate=new Date,g=k.metricsModel.addHttpRequest(a.mediaType,null,a.type,a.url,null,a.range,a.requestStartDate,null,null,null,null,a.duration),k.metricsModel.appendHttpTrace(g,a.requestStartDate,a.requestStartDate.getTime()-a.requestStartDate.getTime(),[0]),j=a.requestStartDate,f.open("GET",k.tokenAuthentication.addTokenAsQueryArg(a.url),!0),f.responseType="arraybuffer",f=k.tokenAuthentication.setTokenInRequestHeader(f),a.range&&f.setRequestHeader("Range","bytes="+a.range),f.onprogress=function(b){var c=new Date;
h&&(h=!1,(!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(a.firstByteDate=c,g.tresponse=c)),k.metricsModel.appendHttpTrace(g,c,c.getTime()-j.getTime(),[f.response?f.response.byteLength:0]),j=c},f.onload=function(){if(!(f.status<200||f.status>299)){i=!1;var b,c,d=new Date,e=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=d,b=a.firstByteDate.getTime()-a.requestStartDate.getTime(),c=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("loaded "+a.mediaType+":"+a.type+":"+a.startTime+" ("+f.status+", "+b+"ms, "+c+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,d,d.getTime()-j.getTime(),[e?e.byteLength:0]),j=d,k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,e)}},f.onloadend=f.onerror=function(){if(-1!==c.indexOf(f)&&(c.splice(c.indexOf(f),1),i)){i=!1;var h,l,m=new Date,n=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=m,h=a.firstByteDate.getTime()-a.requestStartDate.getTime(),l=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("failed "+a.mediaType+":"+a.type+":"+a.startTime+" ("+f.status+", "+h+"ms, "+l+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,m,m.getTime()-j.getTime(),[n?n.byteLength:0]),j=m,e>0?(k.debug.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(k,a,e)},b)):(k.debug.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+" no retry attempts left"),k.errHandler.downloadError("content",a.url,f),k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,null,new Error("failed loading fragment")))}},f.send()},e=function(a){var b=this,c=new XMLHttpRequest,d=!1;c.open("HEAD",a.url,!0),c.onload=function(){c.status<200||c.status>299||(d=!0,b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!0,a))},c.onloadend=c.onerror=function(){d||b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},c.send()};return{metricsModel:void 0,errHandler:void 0,debug:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},load:function(b){b?d.call(this,b,a):this.notify(this.eventList.ENAME_LOADING_COMPLETED,b,null,new Error("request is null"))},checkForExistence:function(a){return a?void e.call(this,a):void this.notify(this.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},abort:function(){var a,b,d=c.length;for(a=0;d>a;a+=1)b=c[a],c[a]=null,b.abort(),b=null;c=[]}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var a,b=[],c=[],d=[],e=[],f=!1,g=function(a){var b=this;b.notify(b.eventList.ENAME_FRAGMENT_LOADING_STARTED,a),b.fragmentLoader.load(a)},h=function(a){var c=b.indexOf(a);-1!==c&&b.splice(c,1)},i=function(a,b){var c,d=a.length-1,e=0/0,f=0/0,g=null;for(c=d;c>=0;c-=1)if(g=a[c],e=g.startTime,f=e+g.duration,!isNaN(e)&&!isNaN(f)&&b>=e&&f>b||isNaN(e)&&isNaN(b))return g;return null},j=function(a,b){if(a){var c=a.mediaType,d=new Date,e=a.type,f=a.startTime,g=a.availabilityStartTime,h=a.duration,i=a.quality,j=a.range;this.metricsModel.addSchedulingInfo(c,d,e,f,g,h,i,j,b)}},k=function(a,c,e,f){d.splice(d.indexOf(c),1),e&&!f?(b.push(c),j.call(this,c,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,c,e)):(j.call(this,c,MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_FAILED,c))},l=function(a,b,c){var d=this.getExecutedRequestForQualityAndIndex(b,c);d&&(this.removeExecutedRequest(d),isNaN(c)||(e.push(d),j.call(this,d,MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE)))},m=function(){f=!0},n=function(){f=!1};return{system:void 0,debug:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",ENAME_FRAGMENT_LOADING_FAILED:"fragmentLoadingFailed"},setup:function(){this.bufferLevelOutrun=m,this.bufferLevelBalanced=n,this.bytesRejected=l,this.loadingCompleted=k},setLoader:function(a){this.fragmentLoader=a},setContext:function(b){a=b},getContext:function(){return a},getIsPostponed:function(){return f},addRequest:function(a){return!a||this.isFragmentLoadedOrPending(a)?!1:(c.push(a),j.call(this,a,MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE),!0)},isFragmentLoadedOrPending:function(a){var e=function(a,b){return"complete"===a.action&&a.action===b.action},f=function(a,b){return a.url===b.url&&a.startTime===b.startTime},g=function(a,b){return isNaN(a.index)&&isNaN(b.index)&&a.quality===b.quality},h=function(b){var c,d,h=!1,i=b.length;for(d=0;i>d;d+=1)if(c=b[d],f(a,c)||g(a,c)||e(a,c)){h=!0;break}return h};return h(c)||h(d)||h(b)},getPendingRequests:function(){return c},getLoadingRequests:function(){return d},getExecutedRequests:function(){return b},getRejectedRequests:function(){return e},getLoadingTime:function(){var a,c,d=0;for(c=b.length-1;c>=0;c-=1)if(a=b[c],a.requestEndDate instanceof Date&&a.firstByteDate instanceof Date){d=a.requestEndDate.getTime()-a.firstByteDate.getTime();break}return d},getExecutedRequestForTime:function(a){return i(b,a)},getPendingRequestForTime:function(a){return i(c,a)},getLoadingRequestForTime:function(a){return i(d,a)},getExecutedRequestForQualityAndIndex:function(a,c){var d,e=b.length-1,f=null;for(d=e;d>=0;d-=1)if(f=b[d],f.quality===a&&f.index===c)return f;return null},removeExecutedRequest:function(a){h.call(this,a)},removeExecutedRequestsBeforeTime:function(a){var c,d=b.length-1,e=0/0,f=null;for(c=d;c>=0;c-=1)f=b[c],e=f.startTime,!isNaN(e)&&a>e&&h.call(this,f)},cancelPendingRequests:function(a){var b=this,d=c,e=d;return c=[],void 0!==a&&(c=d.filter(function(b){return b.quality===a?!1:(e.splice(e.indexOf(b),1),!0)})),e.forEach(function(a){j.call(b,a,MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE)}),e},abortRequests:function(){this.fragmentLoader.abort();for(var a=0,b=d.length;b>a;a+=1)this.removeExecutedRequest(d[a]);d=[]},executeRequest:function(a){var e=this,f=c.indexOf(a);if(a&&-1!==f)switch(c.splice(f,1),a.action){case"complete":b.push(a),j.call(e,a,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),e.notify(e.eventList.ENAME_STREAM_COMPLETED,a);break;case"download":d.push(a),j.call(e,a,MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE),g.call(e,a);break;default:this.debug.log("Unknown request action.")}}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";var a,b=!1,c=function(a){var b=a.value,c=((new Date).getTime()-this.streamProcessor.getStreamInfo().manifestInfo.loadedTime.getTime())/1e3;null!==b?this.notify(this.eventList.ENAME_LIVE_EDGE_FOUND,b,c):this.notify(this.eventList.ENAME_LIVE_EDGE_SEARCH_ERROR,c)},d=function(){if(this.streamProcessor.isDynamic()&&!b){var d=this;a=d.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES),b=!0,this.rulesController.applyRules(a,d.streamProcessor,c.bind(d),null,function(a,b){return b})}};return{system:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LIVE_EDGE_FOUND:"liveEdgeFound",ENAME_LIVE_EDGE_SEARCH_ERROR:"liveEdgeSearchError"},setup:function(){this.streamUpdated=d},initialize:function(a){this.streamProcessor=a,this.fragmentLoader=a.fragmentLoader,this.scheduleRulesCollection.liveEdgeBinarySearchRule&&this.scheduleRulesCollection.liveEdgeBinarySearchRule.setFinder(this)},abortSearch:function(){if(b=!1,a)for(var c=0,d=a.length;d>c;c+=1)a[c].reset()}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var a=3,b=500,c=function(a){var b=null;return-1!==a.indexOf("/")&&(-1!==a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),b=a.substring(0,a.lastIndexOf("/")+1)),b},d=function(a,e){var f,g=c(a),h=new XMLHttpRequest,i=new Date,j=null,k=!0,l=null,m=null,n=this;l=function(){h.status<200||h.status>299||(k=!1,j=new Date,n.tokenAuthentication.checkRequestHeaderForToken(h),n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,j,h.status,null,null),f=n.parser.parse(h.responseText,g),f?(f.url=a,f.loadedTime=j,n.metricsModel.addManifestUpdate("stream",f.type,i,j,f.availabilityStartTime),n.notify(n.eventList.ENAME_MANIFEST_LOADED,f)):n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a)))},m=function(){k&&(k=!1,n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,new Date,h.status,null,null),e>0?(n.debug.log("Failed loading manifest: "+a+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(n,a,e)},b)):(n.debug.log("Failed loading manifest: "+a+" no retry attempts left"),n.errHandler.downloadError("manifest",a,h),n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a+" no retry attempts left"))))};try{h.onload=l,h.onloadend=m,h.onerror=m,h.open("GET",a,!0),h.send()}catch(o){h.onerror()}};return{debug:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_LOADED:"manifestLoaded"},load:function(b){d.call(this,b,a)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.models.ManifestModel=function(){"use strict";var a;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_UPDATED:"manifestUpdated"},getValue:function(){return a},setValue:function(b){a=b,this.eventBus.dispatchEvent({type:"manifestLoaded",data:b}),this.notify(this.eventList.ENAME_MANIFEST_UPDATED,b)}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var a=0/0,b=null,c=!1,d=!1,e=function(){null!==b&&(clearInterval(b),b=null)},f=function(){e.call(this),isNaN(a)||(this.debug.log("Refresh manifest in "+a+" seconds."),b=setTimeout(h.bind(this),Math.min(1e3*a,Math.pow(2,31)-1),this))},g=function(){var b,c,d=this,e=d.manifestModel.getValue();void 0!==e&&null!==e&&(b=d.manifestExt.getRefreshDelay(e),c=((new Date).getTime()-e.loadedTime.getTime())/1e3,a=Math.max(b-c,0),f.call(d))},h=function(){var a,b,c=this;d||(d=!0,a=c.manifestModel.getValue(),b=a.url,a.hasOwnProperty("Location")&&(b=a.Location),c.manifestLoader.load(b))},i=function(a,b,d){d||(this.manifestModel.setValue(b),this.debug.log("Manifest has been refreshed."),c||g.call(this))},j=function(){this.start()},k=function(){this.stop()},l=function(){d=!1};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){g.call(this),this.streamsComposed=l,this.manifestLoaded=i,this.playbackStarted=j,this.playbackPaused=k},start:function(){c=!1,g.call(this)},stop:function(){c=!0,e.call(this)}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return b?new MediaSource:a?new WebKitMediaSource:null},attachMediaSource:function(a,b){"use strict";b.setSource(window.URL.createObjectURL(a))},detachMediaSource:function(a){"use strict";a.setSource("")},setDuration:function(a,b){"use strict";return a.duration=b,a.duration},signalEndOfStream:function(a){"use strict";"open"===a.readyState&&a.endOfStream()}},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:"metricsChanged",data:{}})},metricChanged:function(a){this.eventBus.dispatchEvent({type:"metricChanged",data:{stream:a}}),this.metricsChanged()},metricUpdated:function(a,b,c){this.eventBus.dispatchEvent({type:"metricUpdated",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},metricAdded:function(a,b,c){this.eventBus.dispatchEvent({type:"metricAdded",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},clearCurrentMetricsForType:function(a){delete this.streamMetrics[a],this.metricChanged(a)},clearAllCurrentMetrics:function(){var a=this;this.streamMetrics={},this.metricsChanged.call(a)},getReadOnlyMetricsFor:function(a){return this.streamMetrics.hasOwnProperty(a)?this.streamMetrics[a]:null},getMetricsFor:function(a){var b;return this.streamMetrics.hasOwnProperty(a)?b=this.streamMetrics[a]:(b=this.system.getObject("metrics"),this.streamMetrics[a]=b),b},addTcpConnection:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.TCPConnection;return g.tcpid=b,g.dest=c,g.topen=d,g.tclose=e,g.tconnect=f,this.getMetricsFor(a).TcpList.push(g),this.metricAdded(a,this.adapter.metricsList.TCP_CONNECTION,g),g},addHttpRequest:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new MediaPlayer.vo.metrics.HTTPRequest;return m.stream=a,m.tcpid=b,m.type=c,m.url=d,m.actualurl=e,m.range=f,m.trequest=g,m.tresponse=h,m.tfinish=i,m.responsecode=j,m.interval=k,m.mediaduration=l,this.getMetricsFor(a).HttpList.push(m),this.metricAdded(a,this.adapter.metricsList.HTTP_REQUEST,m),m},appendHttpTrace:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return e.s=b,e.d=c,e.b=d,a.trace.push(e),this.metricUpdated(a.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,a),e},addTrackSwitch:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.TrackSwitch;return f.t=b,f.mt=c,f.to=d,f.lto=e,this.getMetricsFor(a).RepSwitchList.push(f),this.metricAdded(a,this.adapter.metricsList.TRACK_SWITCH,f),f},addBufferLevel:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferLevel;return d.t=b,d.level=c,this.getMetricsFor(a).BufferLevel.push(d),this.metricAdded(a,this.adapter.metricsList.BUFFER_LEVEL,d),d},addDVRInfo:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.DVRInfo;return e.time=b,e.range=d,e.manifestInfo=c,this.getMetricsFor(a).DVRInfo.push(e),this.metricAdded(a,this.adapter.metricsList.DVR_INFO,e),e},addDroppedFrames:function(a,b){var c=new MediaPlayer.vo.metrics.DroppedFrames,d=this.getMetricsFor(a).DroppedFrames;return c.time=b.creationTime,c.droppedFrames=b.droppedVideoFrames,d.length>0&&d[d.length-1]==c?d[d.length-1]:(d.push(c),this.metricAdded(a,this.adapter.metricsList.DROPPED_FRAMES,c),c)},addSchedulingInfo:function(a,b,c,d,e,f,g,h,i){var j=new MediaPlayer.vo.metrics.SchedulingInfo;return j.mediaType=a,j.t=b,j.type=c,j.startTime=d,j.availabilityStartTime=e,j.duration=f,j.quality=g,j.range=h,j.state=i,this.getMetricsFor(a).SchedulingInfo.push(j),this.metricAdded(a,this.adapter.metricsList.SCHEDULING_INFO,j),j},addManifestUpdate:function(a,b,c,d,e,f,g,h,i,j){var k=new MediaPlayer.vo.metrics.ManifestUpdate,l=this.getMetricsFor("stream");return k.mediaType=a,k.type=b,k.requestTime=c,k.fetchTime=d,k.availabilityStartTime=e,k.presentationStartTime=f,k.clientTimeOffset=g,k.currentTime=h,k.buffered=i,k.latency=j,l.ManifestUpdate.push(k),this.metricAdded(a,this.adapter.metricsList.MANIFEST_UPDATE,k),k},updateManifestUpdateInfo:function(a,b){for(var c in b)a[c]=b[c];this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,a)},addManifestUpdateStreamInfo:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;return f.id=b,f.index=c,f.start=d,f.duration=e,a.streamInfo.push(f),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,a),f},addManifestUpdateTrackInfo:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;return i.id=b,i.index=c,i.streamIndex=d,i.mediaType=e,i.startNumber=g,i.fragmentInfoType=h,i.presentationTimeOffset=f,a.trackInfo.push(i),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,a),i},addPlayList:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.PlayList;return e.stream=a,e.start=b,e.mstart=c,e.starttype=d,this.getMetricsFor(a).PlayList.push(e),this.metricAdded(a,this.adapter.metricsList.PLAY_LIST,e),e},appendPlayListTrace:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.PlayList.Trace;return i.representationid=b,i.subreplevel=c,i.start=d,i.mstart=e,i.duration=f,i.playbackspeed=g,i.stopreason=h,a.trace.push(i),this.metricUpdated(a.stream,this.adapter.metricsList.PLAY_LIST_TRACE,a),i}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.dependencies.Notifier=function(){"use strict";var a,b=0,c=function(){return this.id||(b+=1,this.id="_id_"+b),this.id},d=function(a){var b,c=this.eventList;for(b in c)if(c[b]===a)return!0;return!1};return{system:void 0,setup:function(){a=this.system,a.mapValue("notify",this.notify),a.mapValue("subscribe",this.subscribe),a.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var b=[].slice.call(arguments);b.splice(1,0,this),b[0]+=c.call(this),a.notify.apply(a,b)},subscribe:function(b,e,f,g){if(!f&&e[b]&&(f=e[b]=e[b].bind(e)),!d.call(this,b))throw"object does not support given event "+b;if(!e)throw"observer object cannot be null or undefined";if(!f)throw"event handler cannot be null or undefined";b+=c.call(this),a.mapHandler(b,void 0,f,g)},unsubscribe:function(b,d,e){e=e||d[b],b+=c.call(this),a.unmapHandler(b,void 0,e)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.PlaybackController=function(){"use strict";var a,b,c,d,e,f=1e3,g=0,h=0/0,i=function(a){var b,c=parseInt(this.uriQueryFragModel.getURIFragmentData.s);return e?(!isNaN(c)&&c>1262304e3&&(b=c-a.manifestInfo.availableFrom.getTime()/1e3,(b>h||b<h-a.manifestInfo.DVRWindowSize)&&(b=null)),b=b||h):b=!isNaN(c)&&c<a.duration&&c>=0?c:a.start,b},j=function(){var a,c=this,e=c.getTime(),f=c.metricsModel.getMetricsFor(d.mediaInfo.type),g=c.metricsExt.getCurrentDVRInfo(f),h=g?g.range:null;return h?e>=h.start&&e<=h.end?e:a=Math.max(h.end-2*b.manifestInfo.minBufferTime,h.start):0/0},k=function(){var b=this,c=function(){A.call(b)};null!==a&&l.call(this),a=setInterval(c,f)},l=function(){clearInterval(a),a=null},m=function(){var a=i.call(this,b);this.debug.log("Starting playback at offset: "+a),this.seek(a)},n=function(){if(!this.isPaused()&&e){var a=this.getTime(),b=j.call(this),c=!isNaN(b)&&b!==a;c&&this.seek(b)}},o=function(a,c,f){d=this.adapter.convertDataToTrack(f),b=d.mediaInfo.streamInfo,e=a.streamProcessor.isDynamic(),n.call(this)},p=function(){0!==c.getElement().readyState&&m.call(this)},q=function(){c&&(c.unlisten("play",r),c.unlisten("pause",s),c.unlisten("error",z),c.unlisten("seeking",t),c.unlisten("seeked",u),c.unlisten("timeupdate",v),c.unlisten("progress",w),c.unlisten("ratechange",x),c.unlisten("loadedmetadata",y))},r=function(){n.call(this),this.notify(this.eventList.ENAME_PLAYBACK_STARTED,this.getTime())},s=function(){this.notify(this.eventList.ENAME_PLAYBACK_PAUSED)},t=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,this.getTime(),!1)},u=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKED)},v=function(){var a=this.getTime();a!==g&&(g=a,this.notify(this.eventList.ENAME_PLAYBACK_TIME_UPDATED,this.getTimeToStreamEnd()))},w=function(){var a,d,e,f=c.getElement().buffered;f.length&&(a=f.length-1,d=f.end(a),e=i.call(this,b)+b.duration-d),this.notify(this.eventList.ENAME_PLAYBACK_PROGRESS,c.getElement().buffered,e)},x=function(){this.notify(this.eventList.ENAME_PLAYBACK_RATE_CHANGED)},y=function(){this.debug.log("Got loadmetadata event."),(!e||this.timelineConverter.isTimeSyncCompleted())&&m.call(this),this.notify(this.eventList.ENAME_PLAYBACK_METADATA_LOADED),k.call(this)},z=function(a){this.notify(this.eventList.ENAME_PLAYBACK_ERROR,a.srcElement.error)},A=function(){this.notify(this.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e,new Date)},B=function(a){c=a,c.listen("play",r),c.listen("pause",s),c.listen("error",z),c.listen("seeking",t),c.listen("seeked",u),c.listen("timeupdate",v),c.listen("progress",w),c.listen("ratechange",x),c.listen("loadedmetadata",y)};return{debug:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,eventList:{ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},setup:function(){this.dataUpdateCompleted=o,this.liveEdgeFound=p,r=r.bind(this),s=s.bind(this),z=z.bind(this),t=t.bind(this),u=u.bind(this),v=v.bind(this),w=w.bind(this),x=x.bind(this),y=y.bind(this)},initialize:function(a,d){b=a,c!==d&&(q.call(this),B.call(this,d))},getTimeToStreamEnd:function(){var a=c.getCurrentTime();return i.call(this,b)+b.duration-a},getStreamId:function(){return b.id},getStreamDuration:function(){return b.duration},getTime:function(){return c.getCurrentTime()},getPlaybackRate:function(){return c.getPlaybackRate()},setLiveStartTime:function(a){h=a},start:function(){c.play()},isPaused:function(){return c.isPaused()},pause:function(){c&&c.pause()},isSeeking:function(){return c.getElement().seeking},seek:function(a){a!==this.getTime()&&(c.setCurrentTime(a),this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,a,!0))},reset:function(){l.call(this),q.call(this),c=null,b=null,g=0,h=0/0}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var a=null,b=null,c=function(a){var b=this;b.protectionModel.removeKeySystem(a)},d=function(a){for(var c=this,d=a.codec,e=a.contentProtection,f=0;f<b.length;++f)for(var g=0;g<e.length;++g)if(b[f].isSupported(e[g])&&c.protectionExt.supportsCodec(b[f].keysTypeString,d)){var h=e[g].KID;return h||(h="unknown"),c.protectionModel.addKeySystem(h,e[g],b[f]),c.debug.log("DRM: Selected Key System: "+b[f].keysTypeString+" For KID: "+h),h}throw new Error("DRM: The protection system for this content is not supported.")},e=function(a,b,c){var d=this,e=null,f=null;d.protectionModel.needToAddKeySession(a)&&(f=d.protectionModel.getInitData(a),!f&&c?(f=c,d.debug.log("DRM: Using initdata from needskey event. length: "+f.length)):f&&d.debug.log("DRM: Using initdata from prheader in mpd. length: "+f.length),f?(e=d.protectionModel.addKeySession(a,b,f),d.debug.log("DRM: Added Key Session ["+e.sessionId+"] for KID: "+a+" type: "+b+" initData length: "+f.length)):d.debug.log("DRM: initdata is null."))},f=function(a,b,c,d){this.protectionModel.updateFromMessage(a,b,c,d)};return{system:void 0,debug:void 0,capabilities:void 0,protectionModel:void 0,protectionExt:void 0,setup:function(){b=this.protectionExt.getKeySystems()},init:function(b,c){this.videoModel=b,this.protectionModel=c,a=this.videoModel.getElement()},selectKeySystem:d,ensureKeySession:e,updateFromMessage:f,teardownKeySystem:c}},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict"},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_KEY_SYSTEM_UPDATE_COMPLETED:"keySystemUpdateCompleted"},supportsCodec:function(a,b){"use strict";var c="WebKitMediaKeys"in window,d="MSMediaKeys"in window,e="MediaKeys"in window;return e?MediaKeys.isTypeSupported(a,b):c?WebKitMediaKeys.isTypeSupported(a,b):d?MSMediaKeys.isTypeSupported(a,b):!1},createMediaKeys:function(a){"use strict";var b="WebKitMediaKeys"in window,c="MSMediaKeys"in window,d="MediaKeys"in window;return d?new MediaKeys(a):b?new WebKitMediaKeys(a):c?new MSMediaKeys(a):null},setMediaKey:function(a,b){var c="WebKitSetMediaKeys"in a,d="msSetMediaKeys"in a,e="SetMediaKeys"in a;return e?a.SetMediaKeys(b):c?a.WebKitSetMediaKeys(b):d?a.msSetMediaKeys(b):void this.debug.log("no setmediakeys function in element")},createSession:function(a,b,c){return a.createSession(b,c)},getKeySystems:function(){var a=this,b=function(b,c){var d=null,e=[],f=new DOMParser,g=f.parseFromString(b,"application/xml");if(g.getElementsByTagName("Challenge")[0]){var h=g.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;h&&(d=BASE64.decode(h))}else a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, can not find Challenge in keyMessage"));var i=g.getElementsByTagName("name"),j=g.getElementsByTagName("value");i.length!=j.length&&a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, invalid header name/value pair in keyMessage"));for(var k=0;k<i.length;k++)e[k]={name:i[k].childNodes[0].nodeValue,value:j[k].childNodes[0].nodeValue};var l=new XMLHttpRequest;l.onload=function(){200==l.status?a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,new Uint8Array(l.response)):a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR status is "'+l.statusText+'" ('+l.status+"), expected to be 200. readyState is "+l.readyState))},l.onabort=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR aborted. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.onerror=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR error. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.open("POST",c),l.responseType="arraybuffer",e&&e.forEach(function(a){l.setRequestHeader(a.name,a.value)}),l.send(d)},c=function(a,b){return null===a&&0===b.length},d=function(a){var b=0,c=0,d=0,e=new Uint8Array([112,115,115,104,0,0,0,0]),f=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),g=null,h=null,i=null,j=null;if("pro"in a)g=BASE64.decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;g=BASE64.decodeArray(a.prheader.__text)}return c=g.length,d=4+e.length+f.length+4+c,h=new ArrayBuffer(d),i=new Uint8Array(h),j=new DataView(h),j.setUint32(b,d),b+=4,i.set(e,b),b+=e.length,i.set(f,b),b+=f.length,j.setUint32(b,c),b+=4,i.set(g,b),b+=c,i};return[{schemeIdUri:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:c,getInitData:d,getUpdate:b},{schemeIdUri:"urn:mpeg:dash:mp4protection:2011",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()&&"cenc"===a.value.toLowerCase()},needToAddKeySession:c,getInitData:function(){return null},getUpdate:b},{schemeIdUri:"urn:uuid:00000000-0000-0000-0000-000000000000",keysTypeString:"webkit-org.w3.clearkey",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:function(){return!0},getInitData:function(){return null},getUpdate:function(a){return a}}]},addKey:function(a,b,c,d,e){a.webkitAddKey(b,c,d,e)},generateKeyRequest:function(a,b,c){a.webkitGenerateKeyRequest(b,c)},listenToNeedKey:function(a,b){a.listen("webkitneedkey",b),a.listen("msneedkey",b),a.listen("needKey",b)},listenToKeyError:function(a,b){a.addEventListener("webkitkeyerror",b,!1),a.addEventListener("mskeyerror",b,!1),a.addEventListener("keyerror",b,!1)},listenToKeyMessage:function(a,b){a.addEventListener("webkitkeymessage",b,!1),a.addEventListener("mskeymessage",b,!1),a.addEventListener("keymessage",b,!1)},listenToKeyAdded:function(a,b){a.addEventListener("webkitkeyadded",b,!1),a.addEventListener("mskeyadded",b,!1),a.addEventListener("keyadded",b,!1)},unlistenToKeyError:function(a,b){a.removeEventListener("webkitkeyerror",b),a.removeEventListener("mskeyerror",b),a.removeEventListener("keyerror",b)},unlistenToKeyMessage:function(a,b){a.removeEventListener("webkitkeymessage",b),a.removeEventListener("mskeymessage",b),a.removeEventListener("keymessage",b)},unlistenToKeyAdded:function(a,b){a.removeEventListener("webkitkeyadded",b),a.removeEventListener("mskeyadded",b),a.removeEventListener("keyadded",b)}},MediaPlayer.models.ProtectionModel=function(){"use strict";var a,b=null,c=null,d=null,e=null,f=[],g=function(b,c,d){d||a.update(c)};return{system:void 0,protectionExt:void 0,setup:function(){this.keySystemUpdateCompleted=g},init:function(a){this.videoModel=a,b=this.videoModel.getElement()},addKeySession:function(a,b,g){var h=null;return h=this.protectionExt.createSession(f[a].keys,b,g),this.protectionExt.listenToKeyAdded(h,c),this.protectionExt.listenToKeyError(h,d),this.protectionExt.listenToKeyMessage(h,e),f[a].initData=g,f[a].keySessions.push(h),h},addKeySystem:function(a,c,d){var e=null;e=this.protectionExt.createMediaKeys(d.keysTypeString),this.protectionExt.setMediaKey(b,e),f[a]={kID:a,contentProtection:c,keySystem:d,keys:e,initData:null,keySessions:[]}},removeKeySystem:function(a){if(null!==a&&void 0!==f[a]&&0!==f[a].keySessions.length){for(var b=f[a].keySessions,g=0;g<b.length;++g)this.protectionExt.unlistenToKeyError(b[g],d),this.protectionExt.unlistenToKeyAdded(b[g],c),this.protectionExt.unlistenToKeyMessage(b[g],e),b[g].close();f[a]=void 0}},needToAddKeySession:function(a){var b=null;return b=f[a],b.keySystem.needToAddKeySession(b.initData,b.keySessions)},getInitData:function(a){var b=null;return b=f[a],b.keySystem.getInitData(b.contentProtection)},updateFromMessage:function(b,c,d,e){a=c,f[b].keySystem.getUpdate(d,e)},listenToNeedKey:function(a){this.protectionExt.listenToNeedKey(this.videoModel,a)},listenToKeyError:function(a){d=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,e=0;e<c.length;++e)this.protectionExt.listenToKeyError(c[e],a)},listenToKeyMessage:function(a){e=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,d=0;d<c.length;++d)this.protectionExt.listenToKeyMessage(c[d],a)},listenToKeyAdded:function(a){c=a;for(var b=0;b<f.length;++b)for(var d=f[b].keySessions,e=0;e<d.length;++e)this.protectionExt.listenToKeyAdded(d[e],a)}}},MediaPlayer.models.ProtectionModel.prototype={constructor:MediaPlayer.models.ProtectionModel},MediaPlayer.dependencies.ScheduleController=function(){"use strict";var a,b,c,d,e,f=0,g=!0,h=null,i=!1,j=null,k=null,l=!0,m=function(a,b){var c=0,d=null;l===!1&&(d=k.start,c=a.getTime()-d.getTime(),k.duration=c,k.stopreason=b,l=!0)},n=function(){if(b){i=!1;var c=new Date;m(c,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),j=this.metricsModel.addPlayList(a,c,0,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON),g&&(g=!1),this.debug.log("ScheduleController "+a+" start."),w.call(this)}},o=function(){g&&r.call(this,e.quality),n.call(this)},p=function(b){i||(i=!0,this.debug.log("ScheduleController "+a+" stop."),b&&this.fragmentController.cancelPendingRequestsForModel(c),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},q=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);b.rulesController.applyRules(c,b.streamProcessor,a,null,function(a,b){return b
})},r=function(a){var b,c=this;return b=c.adapter.getInitRequest(c.streamProcessor,a),null!==b&&c.fragmentController.prepareFragmentForLoading(c,b),b},s=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);b.rulesController.applyRules(c,b.streamProcessor,a,f,function(a,b){return Math.min(a,b)})},t=function(a){var b,c,d,f=a.length;for(d=0;f>d;d+=1)b=a[d],c=b.startTime+b.duration/2,b=this.adapter.getFragmentRequestForTime(this.streamProcessor,e,c,!1),this.fragmentController.prepareFragmentForLoading(this,b)},u=function(a){var b=this;return f=a.value,0>=f?void b.fragmentController.executePendingRequests():(b.abrController.getPlaybackQuality(b.streamProcessor),void q.call(b,v.bind(b)))},v=function(a){var b=a.value;null===b||b instanceof MediaPlayer.vo.FragmentRequest||(b=this.adapter.getFragmentRequestForTime(this.streamProcessor,e,b.startTime)),b&&(f--,this.fragmentController.prepareFragmentForLoading(this,b))},w=function(){var a=(new Date).getTime(),b=h?a-h>this.fragmentController.getLoadingTime(this):!0;!b||i||this.playbackController.isPaused()&&(!this.scheduleWhilePaused||d)||(h=a,s.call(this,u.bind(this)))},x=function(){var b=this;null!==a&&""!==a&&b.metricsModel.clearCurrentMetricsForType(a)},y=function(a,c,f){e=this.adapter.convertDataToTrack(f),d||(b=!0),b&&o.call(this)},z=function(b,c){c===this.streamProcessor.getFragmentModel()&&(this.debug.log(a+" Stream is complete."),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))},A=function(a,b){var c=this;b===c.streamProcessor.getFragmentModel()&&w.call(c)},B=function(){p.call(this)},C=function(){K.call(this)},D=function(){p.call(this,!1)},E=function(a,b){r.call(this,b)},F=function(a,b,d,e){this.fragmentController.removeExecutedRequestsBeforeTime(c,d),e&&n.call(this)},G=function(b,c){var d=this;c||d.playbackController.isSeeking()||(d.debug.log("Stalling "+a+" Buffer: "+a),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},H=function(b,c){var d=this;d.metricsModel.addBufferLevel(a,new Date,c),w.call(this)},I=function(){p.call(this,!1)},J=function(b,d,f,g){if(a===d){var h,i=this;if(h=c.cancelPendingRequests(f),e=i.streamProcessor.getTrackForQuality(g),null===e||void 0===e)throw"Unexpected error!";t.call(i,h),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}},K=function(){var a=this,b=a.playbackController.getTime(),c=a.playbackController.getPlaybackRate(),d=new Date;l===!0&&e&&j&&(l=!1,k=a.metricsModel.appendPlayListTrace(j,e.id,null,d,b,null,c,null))},L=function(a,b){var d=this,e=r.call(d,b);c.executeRequest(e)},M=function(){n.call(this)},N=function(b,d){g||this.fragmentController.cancelPendingRequestsForModel(c);var f,h=this.metricsModel.getMetricsFor("stream"),i=this.metricsExt.getCurrentManifestUpdate(h);this.debug.log("ScheduleController "+a+" seek: "+d),f=new Date,m(f,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),j=this.metricsModel.addPlayList(a,f,d,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),n.call(this),this.metricsModel.updateManifestUpdateInfo(i,{latency:e.DVRWindow.end-this.playbackController.getTime()})},O=function(){K.call(this)},P=function(){w.call(this)},Q=function(a,c){var d,f,g=this,h=e.mediaInfo.streamInfo.manifestInfo,i=c-Math.min(2*h.minBufferTime,h.DVRWindowSize/2),j=g.metricsModel.getMetricsFor("stream"),k=g.metricsExt.getCurrentManifestUpdate(j);d=g.adapter.getFragmentRequestForTime(g.streamProcessor,e,i),f=d.startTime+d.duration/2,g.playbackController.setLiveStartTime(f),g.metricsModel.updateManifestUpdateInfo(k,{currentTime:f,presentationStartTime:c,latency:c-f,clientTimeOffset:g.timelineConverter.getClientTimeOffset()}),b=!0,o.call(g)};return{debug:void 0,system:void 0,metricsModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.liveEdgeFound=Q,this.qualityChanged=J,this.dataUpdateStarted=D,this.dataUpdateCompleted=y,this.mediaFragmentLoadingStart=A,this.fragmentLoadingFailed=B,this.streamCompleted=z,this.bufferCleared=F,this.bytesAppended=C,this.bufferLevelStateChanged=G,this.bufferLevelUpdated=H,this.initRequested=E,this.quotaExceeded=I,this.closedCaptioningRequested=L,this.playbackStarted=M,this.playbackSeeking=N,this.playbackRateChanged=O,this.wallclockTimeUpdated=P},initialize:function(b,e){var f=this;a=b,f.streamProcessor=e,f.playbackController=e.playbackController,f.fragmentController=e.fragmentController,f.liveEdgeFinder=e.liveEdgeFinder,f.bufferController=e.bufferController,d=e.isDynamic(),c=this.fragmentController.getModel(this),f.scheduleRulesCollection.bufferLevelRule&&f.scheduleRulesCollection.bufferLevelRule.setScheduleController(f),f.scheduleRulesCollection.pendingRequestsRule&&f.scheduleRulesCollection.pendingRequestsRule.setScheduleController(f),f.scheduleRulesCollection.playbackTimeRule&&f.scheduleRulesCollection.playbackTimeRule.setScheduleController(f)},getFragmentModel:function(){return c},reset:function(){var a=this;p.call(a,!0),a.bufferController.unsubscribe(a.bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,a.scheduleRulesCollection.bufferLevelRule),a.bufferController.unsubscribe(a.bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,a.scheduleRulesCollection.bufferLevelRule),a.fragmentController.abortRequestsForModel(c),a.fragmentController.detachModel(c),x.call(a),f=0},start:n,stop:p}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.errHandler=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"}},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(a,b){"use strict";var c=this,d=b.codec,e=null;try{e=a.addSourceBuffer(d)}catch(f){if(!b.isText)throw f;e=c.system.getObject("textSourceBuffer")}return e},removeSourceBuffer:function(a,b){"use strict";try{a.removeSourceBuffer(b)}catch(c){}},getBufferRange:function(a,b,c){"use strict";var d,e,f=null,g=0,h=0,i=null,j=null,k=0,l=c||.15;try{f=a.buffered}catch(m){return null}if(null!==f){for(e=0,d=f.length;d>e;e+=1)if(g=f.start(e),h=f.end(e),null===i)k=Math.abs(g-b),b>=g&&h>b?(i=g,j=h):l>=k&&(i=g,j=h);else{if(k=g-j,!(l>=k))break;j=h}if(null!==i)return{start:i,end:j}}return null},getAllRanges:function(a){var b=null;try{return b=a.buffered}catch(c){return null}},getBufferLength:function(a,b,c){"use strict";var d,e,f=this;return d=f.getBufferRange(a,b,c),e=null===d?0:d.end-b},waitForUpdateEnd:function(a,b){"use strict";var c,d=50,e=function(){a.updating||(clearInterval(c),b(!0))},f=function(){a.updating||(a.removeEventListener("updateend",f,!1),b(!0))};if(!a.updating)return void b(!0);if("function"==typeof a.addEventListener)try{a.addEventListener("updateend",f,!1)}catch(g){c=setInterval(e,d)}else c=setInterval(e,d)},append:function(a,b){var c=this,d="append"in a?"append":"appendBuffer"in a?"appendBuffer":null;if(d)try{c.waitForUpdateEnd(a,function(){a[d](b),c.waitForUpdateEnd(a,function(){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,a,b)})})}catch(e){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,a,b,e)}},remove:function(a,b,c,d){var e=this;try{b>=0&&c>b&&"ended"!==d.readyState&&a.remove(b,c),this.waitForUpdateEnd(a,function(){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,a,b,c)})}catch(f){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,a,b,c,f)}},abort:function(a,b){"use strict";try{"open"===a.readyState&&b.abort()}catch(c){}}},MediaPlayer.dependencies.Stream=function(){"use strict";var a,b,c,d,e,f,g={},h=[],i=!0,j=!1,k=!1,l=!1,m=null,n=[],o=!0,p=null,q=null,r=function(){j&&this.playbackController.start()},s=function(){this.playbackController.pause()},t=function(a){j&&(this.debug.log("Do seek: "+a),this.playbackController.seek(a))},u=function(a){var b,c=this,d=g.video,e=g?g.video.codec:null;if(b="msneedkey"!==a.type?a.type:e,n.push({type:b,initData:a.initData}),this.debug.log("DRM: Key required for - "+b),d&&e&&!m)try{m=c.protectionController.selectKeySystem(d)}catch(f){s.call(c),c.debug.log(f),c.errHandler.mediaKeySystemSelectionError(f)}m&&c.protectionController.ensureKeySession(m,b,a.initData)},v=function(a){var b=this,c=null,d=null,e=null,f=null;this.debug.log("DRM: Got a key message..."),c=a.target,d=new Uint16Array(a.message.buffer),e=String.fromCharCode.apply(null,d),f=a.destinationURL,b.protectionController.updateFromMessage(m,c,e,f)},w=function(){this.debug.log("DRM: Key added.")},x=function(){var a,b=event.target;switch(a="DRM: MediaKeyError - sessionId: "+b.sessionId+" errorCode: "+b.error.code+" systemErrorCode: "+b.error.systemCode+" [",b.error.code){case 1:a+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:a+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:a+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:a+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:a+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:a+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}a+="]",this.debug.log(a),this.errHandler.mediaKeySessionError(a)},y=function(a,b){var c=this,d=function(e){c.debug.log("MediaSource is open!"),c.debug.log(e),a.removeEventListener("sourceopen",d),a.removeEventListener("webkitsourceopen",d),b(a)};a.addEventListener("sourceopen",d,!1),a.addEventListener("webkitsourceopen",d,!1),c.mediaSourceExt.attachMediaSource(a,c.videoModel)},z=function(){var c,d=this,e=h.length,f=0;for(f;e>f;f+=1)c=h[f],c.reset(l),c=null;q&&q.reset(),h=[],b&&d.mediaSourceExt.detachMediaSource(d.videoModel),j=!1,m=null,n=[],g={},b=null,a=null},A=function(a,c){var d,e,f,i=this,j=function(a){return a.codec},k=i.adapter.getMediaInfoForType(c,p,a);if("text"===a&&(j=function(a){return d=a.mimeType}),null!==k){var l,m=j.call(i,k),n=null;if(m===d)try{n=i.sourceBufferExt.createSourceBuffer(b,k)}catch(o){i.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else if(e=m,i.debug.log(a+" codec: "+e),g[a]=k,l=k.contentProtection,l&&!i.capabilities.supportsMediaKeys())i.errHandler.capabilityError("mediakeys");else if(i.capabilities.supportsCodec(i.videoModel.getElement(),e))try{n=i.sourceBufferExt.createSourceBuffer(b,k)}catch(o){i.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else{var r=a+"Codec ("+e+") is not supported.";i.errHandler.manifestError(r,"codec",c),i.debug.log(r)}null===n?i.debug.log("No buffer was created, skipping "+a+" data."):(f=i.system.getObject("streamProcessor"),h.push(f),f.initialize(d||a,n,i.videoModel,i.fragmentController,i.playbackController,b,i,q),f.setMediaInfo(k),i.adapter.updateData(f))}else i.debug.log("No "+a+" data.")},B=function(){var b,c=this;q=c.system.getObject("eventController"),q.initialize(c.videoModel),b=c.adapter.getEventsFor(p),q.addInlineEvents(b),A.call(c,"video",a),A.call(c,"audio",a),A.call(c,"text",a)},C=function(){var a,c,d=this;a=p.manifestInfo.duration,c=d.mediaSourceExt.setDuration(b,a),d.debug.log("Duration successfully set to: "+c),j=!0,F.call(d)},D=function(){this.debug.log("element loaded!"),k=!0,E.call(this)},E=function(){j&&k&&0===p.index&&(q.start(),i&&r.call(this))},F=function(){var a=this,b=h.length,c=0;if(j){for(c;b>c;c+=1)if(h[c].isUpdating())return;o=!1,a.notify(a.eventList.ENAME_STREAM_UPDATED)}},G=function(a,b){var c=b.code,d="";if(-1!==c){switch(c){case 1:d="MEDIA_ERR_ABORTED";break;case 2:d="MEDIA_ERR_NETWORK";break;case 3:d="MEDIA_ERR_DECODE";break;case 4:d="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:d="MEDIA_ERR_ENCRYPTED"}l=!0,this.debug.log("Video Element Error: "+d),this.debug.log(b),this.errHandler.mediaSourceError(d),this.reset()}},H=function(c){var d,e=this,f=function(c){if(b=c,B.call(e),0===h.length){var d="No streams to play.";e.errHandler.manifestError(d,"nostreams",a),e.debug.log(d)}else e.liveEdgeFinder.initialize(h[0]),e.liveEdgeFinder.subscribe(e.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,e.playbackController),C.call(e),E.call(e)};a=c,d=e.mediaSourceExt.createMediaSource(),y.call(e,d,f)},I=function(){var a=L(),c=a.length,d=0;for(d;c>d;d+=1)if(!a[d].isBufferingCompleted())return;b&&this.mediaSourceExt.signalEndOfStream(b)},J=function(){F.call(this)},K=function(a,b,c){c&&(s.call(this),this.debug.log(c),this.errHandler.mediaKeyMessageError(c))},L=function(){var a,b,c=[],d=0,e=h.length;for(d;e>d;d+=1)b=h[d],a=b.getType(),("audio"===a||"video"===a)&&c.push(b);return c},M=function(b){var c,d,e,f=this,g=h.length,i=0;for(o=!0,a=f.manifestModel.getValue(),p=b,f.debug.log("Manifest updated... set new data on buffers."),q&&(d=f.adapter.getEventsFor(p),q.addInlineEvents(d)),i;g>i;i+=1)e=h[i],c=f.adapter.getMediaInfoForType(a,p,e.getType()),e.setMediaInfo(c),this.adapter.updateData(e)};return{system:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,adapter:void 0,fragmentController:void 0,playbackController:void 0,protectionModel:void 0,protectionController:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_UPDATED:"streamUpdated"},setup:function(){this.bufferingCompleted=I,this.dataUpdateCompleted=J,this.playbackError=G,this.playbackMetaDataLoaded=D,this.keySystemUpdateCompleted=K},load:function(a){H.call(this,a)},setVideoModel:function(a){this.videoModel=a},initProtection:function(){c=u.bind(this),d=v.bind(this),e=w.bind(this),f=x.bind(this),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(this.getVideoModel()),this.protectionController=this.system.getObject("protectionController"),this.protectionController.init(this.videoModel,this.protectionModel),this.protectionModel.listenToNeedKey(c),this.protectionModel.listenToKeyMessage(d),this.protectionModel.listenToKeyError(f),this.protectionModel.listenToKeyAdded(e),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this)},getVideoModel:function(){return this.videoModel},setAutoPlay:function(a){i=a},getAutoPlay:function(){return i},reset:function(){s.call(this),z.call(this),this.protectionController&&this.protectionController.teardownKeySystem(m),this.protectionModel&&this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this),this.protectionController=void 0,this.protectionModel=void 0,this.fragmentController=void 0,this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_ERROR,this),this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_METADATA_LOADED,this),this.playbackController.reset(),this.liveEdgeFinder.abortSearch(),this.liveEdgeFinder.unsubscribe(this.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,this.playbackController),k=!1},getDuration:function(){return p.duration},getStartTime:function(){return p.start},getStreamIndex:function(){return p.index},getId:function(){return p.id},setStreamInfo:function(a){p=a},getStreamInfo:function(){return p},startEventController:function(){q.start()},resetEventController:function(){q.reset()},setPlaybackController:function(a){this.playbackController=a,a.initialize(p,this.videoModel)},getPlaybackController:function(){return this.playbackController},isUpdating:function(){return o},updateData:M,play:r,seek:t,pause:s}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.StreamController=function(){"use strict";var a,b=[],c=6,d=.2,e=!0,f=!1,g=function(){a.play()},h=function(){a.pause()},i=function(b){a.seek(b)},j=function(a,b){var c=a.getVideoModel().getElement(),d=b.getVideoModel().getElement();d.parentNode||c.parentNode.insertBefore(d,c),c.style.width="0px",d.style.width="100%",m(c,d),l.call(this,a),k.call(this,b)},k=function(a){var b=a.getPlaybackController();b.subscribe(b.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_SEEKING,this),b.subscribe(b.eventList.ENAME_PLAYBACK_TIME_UPDATED,this),b.subscribe(b.eventList.ENAME_PLAYBACK_PROGRESS,this)},l=function(a){var b=this,c=a.getPlaybackController();setTimeout(function(){c.unsubscribe(c.eventList.ENAME_PLAYBACK_STARTED,b.manifestUpdater),c.unsubscribe(c.eventList.ENAME_PLAYBACK_PAUSED,b.manifestUpdater),c.unsubscribe(c.eventList.ENAME_PLAYBACK_SEEKING,b),c.unsubscribe(c.eventList.ENAME_PLAYBACK_TIME_UPDATED,b),c.unsubscribe(c.eventList.ENAME_PLAYBACK_PROGRESS,b)},1)},m=function(a,b){["controls","loop","muted","volume"].forEach(function(c){b[c]=a[c]})},n=function(a,b,d){!d||d>=c||q()},o=function(b,c){var e=this;e.metricsModel.addDroppedFrames("video",e.videoExt.getPlaybackQuality(a.getVideoModel().getElement())),r()&&(a.getVideoModel().getElement().seeking||d>c&&v.call(this,a,r()))},p=function(b,c){var d=s(c);d&&d!==a&&v.call(this,a,d,c)},q=function(){var a=r();a&&a.seek(a.getStartTime())},r=function(){var c=a.getStreamIndex()+1;return c<b.length?b[c]:null},s=function(a){var c=0,d=null,e=b.length;e>0&&(c+=b[0].getStartTime());for(var f=0;e>f;f++)if(d=b[f],c+=d.getDuration(),c>a)return d;return null},t=function(){var a=this.system.getObject("videoModel"),b=document.createElement("video");return a.setElement(b),a},u=function(a){a.parentNode&&a.parentNode.removeChild(a)},v=function(b,c,d){!f&&b&&c&&b!==c&&(f=!0,b.pause(),a=c,j.call(this,b,c),i(d?b.getPlaybackController().getTime():c.getStartTime()),g(),b.resetEventController(),a.startEventController(),f=!1)},w=function(){var c,d,f,g,h,i,j,l,m=this,n=m.manifestModel.getValue(),o=m.metricsModel.getMetricsFor("stream"),p=m.metricsExt.getCurrentManifestUpdate(o);if(n){j=m.adapter.getStreamsInfo(n);try{if(0===j.length)throw new Error("There are no streams");for(m.metricsModel.updateManifestUpdateInfo(p,{currentTime:m.videoModel.getCurrentTime(),buffered:m.videoModel.getElement().buffered,presentationStartTime:j[0].start,clientTimeOffset:m.timelineConverter.getClientTimeOffset()}),h=0,f=j.length;f>h;h+=1){for(d=j[h],i=0,g=b.length;g>i;i+=1)b[i].getId()===d.id&&(l=b[i],l.updateData(d));l||(l=m.system.getObject("stream"),c=m.system.getObject("playbackController"),l.setStreamInfo(d),l.setVideoModel(0===h?m.videoModel:t.call(m)),l.setPlaybackController(c),c.subscribe(c.eventList.ENAME_PLAYBACK_ERROR,l),c.subscribe(c.eventList.ENAME_PLAYBACK_METADATA_LOADED,l),l.initProtection(),l.setAutoPlay(e),l.load(n),l.subscribe(l.eventList.ENAME_STREAM_UPDATED,m),b.push(l)),m.metricsModel.addManifestUpdateStreamInfo(p,d.id,d.index,d.start,d.duration),l=null}a||(a=b[0],k.call(m,a),a.subscribe(a.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder))}catch(q){m.errHandler.manifestError(q.message,"nostreamscomposed",m.manifestModel.getValue()),m.reset()}}},x=function(){var a=this,c=b.length,d=0;for(d;c>d;d+=1)if(b[d].isUpdating())return;a.notify(a.eventList.ENAME_STREAMS_COMPOSED)},y=function(a,b,c){c?this.reset():(this.manifestModel.setValue(b),this.debug.log("Manifest has loaded."),w.call(this))};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,adapter:void 0,debug:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAMS_COMPOSED:"streamsComposed"},setup:function(){this.manifestLoaded=y,this.streamUpdated=x,this.playbackSeeking=p,this.playbackProgress=n,this.playbackTimeUpdated=o},setAutoPlay:function(a){e=a},getAutoPlay:function(){return e},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},load:function(a){this.manifestLoader.load(a)},reset:function(){a&&l.call(this,a);for(var c=0,d=b.length;d>c;c++){var e=b[c];e.unsubscribe(e.eventList.ENAME_STREAM_UPDATED,this),e.reset(),e!==a&&u(e.getVideoModel().getElement())}b=[],this.manifestUpdater.stop(),this.metricsModel.clearAllCurrentMetrics(),this.manifestModel.setValue(null),this.timelineConverter.reset(),this.adapter.reset(),f=!1,a=null},play:g,seek:i,pause:h}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var a,b,c,d,e,f=function(a){var b=this,c="video"===a||"audio"===a?"bufferController":"textController";return b.system.getObject(c)};return{system:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,eventList:void 0,abrController:void 0,baseURLExt:void 0,adapter:void 0,initialize:function(c,g,h,i,j,k,l,m){var n,o=this,p=o.system.getObject("trackController"),q=o.system.getObject("scheduleController"),r=o.liveEdgeFinder,s=o.abrController,t=o.indexHandler,u=o.baseURLExt,v=this.system.getObject("fragmentLoader"),w=f.call(o,c);b=l,d=c,e=m,a=b.getStreamInfo().manifestInfo.isDynamic,o.bufferController=w,o.playbackController=j,o.scheduleController=q,o.trackController=p,o.videoModel=h,o.fragmentController=i,o.fragmentLoader=v,p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,w),i.subscribe(i.eventList.ENAME_INIT_FRAGMENT_LOADED,w),w.subscribe(w.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,q),("video"===d||"audio"===d)&&(s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,w),s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,p),s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,q),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,p),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_STARTED,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,s),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,b),j.streamProcessor||(j.streamProcessor=o,p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,j)),i.subscribe(i.eventList.ENAME_MEDIA_FRAGMENT_LOADED,w),i.subscribe(i.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,q),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,q),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,w),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,q.scheduleRulesCollection.bufferLevelRule),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,h),w.subscribe(w.eventList.ENAME_BUFFER_CLEARED,q),w.subscribe(w.eventList.ENAME_BYTES_APPENDED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_UPDATED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_UPDATED,p),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,q),w.subscribe(w.eventList.ENAME_INIT_REQUESTED,q),w.subscribe(w.eventList.ENAME_BUFFERING_COMPLETED,b),w.subscribe(w.eventList.ENAME_QUOTA_EXCEEDED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_OUTRUN,q.scheduleRulesCollection.bufferLevelRule),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_BALANCED,q.scheduleRulesCollection.bufferLevelRule),j.subscribe(j.eventList.ENAME_PLAYBACK_PROGRESS,w),j.subscribe(j.eventList.ENAME_PLAYBACK_TIME_UPDATED,w),j.subscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,w),j.subscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,q),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,w),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,q),j.subscribe(j.eventList.ENAME_PLAYBACK_STARTED,q),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,q.scheduleRulesCollection.playbackTimeRule),a&&j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,p),j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,w),j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,q),u.subscribe(u.eventList.ENAME_INITIALIZATION_LOADED,t),u.subscribe(u.eventList.ENAME_SEGMENTS_LOADED,t)),t.initialize(this),w.initialize(d,g,k,o),q.initialize(d,this),n=this.getFragmentModel(),n.setLoader(v),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_STARTED,i),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,i),n.subscribe(n.eventList.ENAME_STREAM_COMPLETED,i),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_FAILED,q),v.subscribe(v.eventList.ENAME_LOADING_COMPLETED,n),("video"===d||"audio"===d)&&(w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_OUTRUN,n),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_BALANCED,n),w.subscribe(w.eventList.ENAME_BYTES_REJECTED,n)),p.initialize(this)},isUpdating:function(){return this.trackController.isUpdating()},getType:function(){return d},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},getStreamInfo:function(){return b.getStreamInfo()},setMediaInfo:function(a){c=a},getMediaInfo:function(){return c},getEventController:function(){return e},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getCurrentTrack:function(){return this.adapter.getCurrentTrackInfo(this.trackController)},getTrackForQuality:function(a){return this.adapter.getTrackInfoForQuality(this.trackController,a)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},isDynamic:function(){return a},reset:function(a){var c=this,d=c.bufferController,e=c.trackController,f=c.scheduleController,g=c.liveEdgeFinder,h=c.fragmentController,i=c.abrController,j=c.playbackController,k=this.indexHandler,l=this.baseURLExt,m=this.getFragmentModel(),n=this.fragmentLoader,o=c.videoModel;i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,d),i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,e),i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,f),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,f),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,e),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_STARTED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,d),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,i),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,b),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,j),h.unsubscribe(h.eventList.ENAME_INIT_FRAGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_MEDIA_FRAGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,d),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,f.scheduleRulesCollection.bufferLevelRule),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,o),d.unsubscribe(d.eventList.ENAME_BUFFER_CLEARED,f),d.unsubscribe(d.eventList.ENAME_BYTES_APPENDED,f),d.unsubscribe(d.eventList.ENAME_BYTES_REJECTED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_UPDATED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_UPDATED,e),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,f),d.unsubscribe(d.eventList.ENAME_INIT_REQUESTED,f),d.unsubscribe(d.eventList.ENAME_BUFFERING_COMPLETED,b),d.unsubscribe(d.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,f.scheduleRulesCollection.bufferLevelRule),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,f.scheduleRulesCollection.bufferLevelRule),j.unsubscribe(j.eventList.ENAME_PLAYBACK_PROGRESS,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_TIME_UPDATED,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_STARTED,f),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,d),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,f.scheduleRulesCollection.playbackTimeRule),l.unsubscribe(l.eventList.ENAME_INITIALIZATION_LOADED,k),l.unsubscribe(l.eventList.ENAME_SEGMENTS_LOADED,k),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,m),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,m),d.unsubscribe(d.eventList.ENAME_BYTES_REJECTED,m),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_STARTED,h),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,h),m.unsubscribe(m.eventList.ENAME_STREAM_COMPLETED,h),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_FAILED,f),n.unsubscribe(n.eventList.ENAME_LOADING_COMPLETED,m),h.resetModel(m),k.reset(),this.bufferController.reset(a),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.trackController=null,this.videoModel=null,this.fragmentController=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.utils.TokenAuthentication=function(){"use strict";var a={type:MediaPlayer.utils.TokenAuthentication.TYPE_QUERY};return{debug:void 0,getTokenAuthentication:function(){return a},setTokenAuthentication:function(b){a=b},checkRequestHeaderForToken:function(b){void 0!==a.name&&null!==b.getResponseHeader(a.name)&&(a.token=b.getResponseHeader(a.name),this.debug.log(a.name+" received: "+a.token))},addTokenAsQueryArg:function(b){if(void 0!==a.name&&void 0!==a.token&&a.type===MediaPlayer.utils.TokenAuthentication.TYPE_QUERY){var c=-1===b.indexOf("?")?"?":"&";b+=c+a.name+"="+a.token,this.debug.log(a.name+" is being appended on the request url with a value of : "+a.token)}return b},setTokenInRequestHeader:function(b){return a.type===MediaPlayer.utils.TokenAuthentication.TYPE_HEADER&&(b.setRequestHeader(a.name,a.token),this.debug.log(a.name+" is being set in the request header with a value of : "+a.token)),b}}},MediaPlayer.utils.TokenAuthentication.TYPE_QUERY="query",MediaPlayer.utils.TokenAuthentication.TYPE_HEADER="header",MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var a=new MediaPlayer.vo.URIFragmentData,b=[],c=function(c){function d(a,b,c,d){var e=d[0].split(/[=]/);return d.push({key:e[0],value:e[1]}),d.shift(),d}function e(a,c,d){return c>0&&(j&&0===b.length?b=d[c].split(/[&]/):k&&(g=d[c].split(/[&]/))),d}if(!c)return null;var f,g=[],h=new RegExp(/[?]/),i=new RegExp(/[#]/),j=h.test(c),k=i.test(c);return f=c.split(/[?#]/).map(e),b.length>0&&(b=b.reduce(d,null)),g.length>0&&(g=g.reduce(d,null),g.forEach(function(b){a[b.key]=b.value})),c};return{parseURI:c,getURIFragmentData:a,getURIQueryData:b,reset:function(){a=new MediaPlayer.vo.URIFragmentData,b=[]}}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.models.VideoModel=function(){"use strict";var a,b=[],c=function(){return b.length>0},d=function(c){null!==c&&(a.playbackRate=0,b[c]!==!0&&(b.push(c),b[c]=!0))},e=function(d){if(null!==d){b[d]=!1;var e=b.indexOf(d);-1!==e&&b.splice(e,1),c()===!1&&(a.playbackRate=1)}},f=function(a,b){b?d(a):e(a)},g=function(a,b){var c=a.streamProcessor.getType();f.call(this,c,!b)};return{system:void 0,setup:function(){this.bufferLevelStateChanged=g},play:function(){a.play()},pause:function(){a.pause()},isPaused:function(){return a.paused},getPlaybackRate:function(){return a.playbackRate},setPlaybackRate:function(b){a.playbackRate=b},getCurrentTime:function(){return a.currentTime
},setCurrentTime:function(b){a.currentTime!=b&&(a.currentTime=b)},listen:function(b,c){a.addEventListener(b,c,!1)},unlisten:function(b,c){a.removeEventListener(b,c,!1)},getElement:function(){return a},setElement:function(b){a=b},setSource:function(b){a.src=b}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(a){var b="webkitDroppedFrameCount"in a,c="getVideoPlaybackQuality"in a,d=null;return c?d=a.getVideoPlaybackQuality():b&&(d={droppedVideoFrames:a.webkitDroppedFrameCount,creationTime:new Date}),d}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.utils.TTMLParser=function(){"use strict";var a,b=3600,c=60,d=/^(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])((\.[0-9][0-9][0-9])|(:[0-9][0-9]))$/,e=function(e){var f,g,h,i=d.test(e);if(!i)return 0/0;if(f=e.split(":"),g=parseFloat(f[0])*b+parseFloat(f[1])*c+parseFloat(f[2]),f[3]){if(h=a.tt.frameRate,!h||isNaN(h))return 0/0;g+=parseFloat(f[3])/h}return g},f=function(){var b=!1,c=a.hasOwnProperty("tt"),d=c?a.tt.hasOwnProperty("head"):!1,e=d?a.tt.head.hasOwnProperty("layout"):!1,f=d?a.tt.head.hasOwnProperty("styling"):!1,g=c?a.tt.hasOwnProperty("body"):!1,h=d?a.tt.head.hasOwnProperty("profile"):!1;return c&&d&&e&&f&&g&&(b=!0),b&&(b=h&&"http://www.w3.org/ns/ttml/profile/sdp-us"===a.tt.head.profile.use),b},g=function(a,b){var c=Object.keys(a).filter(function(c){return"xmlns"===c.split(":")[0]&&a[c]===b}).map(function(a){return a.split(":")[1]});return 1!=c.length?null:c[0]},h=function(b){var c,d,h,i,j,k,l,m=[],n=new X2JS([],"",!1);if(a=n.xml_str2json(b),!f())throw c="TTML document has incorrect structure";if(k=g(a.tt,"http://www.w3.org/ns/ttml#parameter"),a.tt.hasOwnProperty(k+":frameRate")&&(a.tt.frameRate=parseInt(a.tt[k+":frameRate"],10)),d=a.tt.body.div_asArray[0].p_asArray,!d||0===d.length)throw c="TTML document does not contain any cues";for(l=0;l<d.length;l+=1){if(h=d[l],i=e(h.begin),j=e(h.end),isNaN(i)||isNaN(j))throw c="TTML document has incorrect timing value";m.push({start:i,end:j,data:h.__text})}return m};return{parse:h}},MediaPlayer.dependencies.TextController=function(){var a,b,c,d=!1,e=function(){d||(b.hasOwnProperty("initialize")&&b.initialize(c,this),d=!0),this.notify(this.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,0)},f=function(a,c,d){var e=this;c===e.streamProcessor.getFragmentModel()&&null!==d&&e.sourceBufferExt.append(b,d,e.videoModel)};return{sourceBufferExt:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"},setup:function(){this.dataUpdateCompleted=e,this.initFragmentLoaded=f},initialize:function(a,b,d,e){var f=this;c=a,f.setBuffer(b),f.setMediaSource(d),f.videoModel=e.videoModel,f.trackController=e.trackController,f.streamProcessor=e},getBuffer:function(){return b},setBuffer:function(a){b=a},setMediaSource:function(b){a=b},reset:function(c){c||(this.sourceBufferExt.abort(a,b),this.sourceBufferExt.removeSourceBuffer(a,b))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextSourceBuffer=function(){var a,b;return{system:void 0,eventBus:void 0,errHandler:void 0,initialize:function(c,d){b=c,this.videoModel=d.videoModel,a=d.streamProcessor.getCurrentTrack().mediaInfo},append:function(b){var c,d,e,f=this,g=String.fromCharCode.apply(null,new Uint16Array(b));try{c=f.getParser().parse(g),d=a.id,e=a.lang,f.getTextTrackExtensions().addTextTrack(f.videoModel.getElement(),c,d,e,!0),f.eventBus.dispatchEvent({type:"updateend"})}catch(h){f.errHandler.closedCaptionsError(h,"parse",g)}},abort:function(){this.getTextTrackExtensions().deleteCues(this.videoModel.getElement())},getParser:function(){var a;return"text/vtt"===b?a=this.system.getObject("vttParser"):"application/ttml+xml"===b&&(a=this.system.getObject("ttmlParser")),a},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var a;return{setup:function(){a=window.VTTCue||window.TextTrackCue},addTextTrack:function(b,c,d,e,f){var g=b.addTextTrack("captions",d,e);g.default=f,g.mode="showing";for(var h in c){var i=c[h];g.addCue(new a(i.start,i.end,i.data))}return g},deleteCues:function(a){for(var b=0,c=!1;!c;){if(null!==a.textTracks[b].cues){c=!0;break}b++}var d=a.textTracks[b],e=d.cues,f=e.length-1;for(b=f;b>=0;b--)d.removeCue(e[b]);d.mode="disabled",d.default=!1}}},MediaPlayer.utils.VTTParser=function(){"use strict";var a=function(a){var b=a.split(":"),c=b.length-1;return a=60*parseInt(b[c-1],10)+parseFloat(b[c],10),2===c&&(a+=3600*parseInt(b[0],10)),a};return{parse:function(b){var c,d=/(?:\r\n|\r|\n)/gm,e=/-->/,f=/(^[\s]+|[\s]+$)/g,g=[];b=b.split(d),c=b.length;for(var h=0;c>h;h++){var i=b[h];if(i.length>0&&"WEBVTT"!==i&&i.match(e)){var j=i.split(e),k=b[h+1];g.push({start:a(j[0].replace(f,"")),end:a(j[1].replace(f,"")),data:k})}}return g}}},MediaPlayer.rules.ABRRulesCollection=function(){"use strict";var a=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,limitSwitchesRule:void 0,getRules:function(b){switch(b){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return a;default:return null}},setup:function(){a.push(this.downloadRatioRule),a.push(this.insufficientBufferRule),a.push(this.limitSwitchesRule)}}},MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules"},MediaPlayer.rules.DownloadRatioRule=function(){"use strict";var a={},b=function(a,b,c){var d=a.getTrackForQuality(b).bandwidth;return d/c};return{debug:void 0,metricsExt:void 0,metricsModel:void 0,setStreamProcessor:function(b){var c=b.getType(),d=b.getStreamInfo().id;a[d]=a[d]||{},a[d][c]=b},execute:function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p=this,q=c.getStreamInfo().id,r=c.getMediaInfo(),s=r.type,t=c.getCurrentValue(),u=a[q][s],v=p.metricsModel.getReadOnlyMetricsFor(s),w=p.metricsExt.getCurrentHttpRequest(v),x=.75;if(!v)return void d(new MediaPlayer.rules.SwitchRequest);if(null===w)return void d(new MediaPlayer.rules.SwitchRequest);if(f=(w.tfinish.getTime()-w.trequest.getTime())/1e3,e=(w.tfinish.getTime()-w.tresponse.getTime())/1e3,0>=f)return void d(new MediaPlayer.rules.SwitchRequest);if(null===w.mediaduration||void 0===w.mediaduration||w.mediaduration<=0||isNaN(w.mediaduration))return void d(new MediaPlayer.rules.SwitchRequest);if(h=w.mediaduration/f,g=w.mediaduration/e*x,isNaN(g)||isNaN(h))return p.debug.log("The ratios are NaN, bailing."),void d(new MediaPlayer.rules.SwitchRequest);if(isNaN(g))o=new MediaPlayer.rules.SwitchRequest;else if(4>g)t>0?(p.debug.log("We are not at the lowest bitrate, so switch down."),j=u.getTrackForQuality(t-1).bandwidth,l=u.getTrackForQuality(t).bandwidth,i=j/l,i>g?(p.debug.log("Things must be going pretty bad, switch all the way down."),o=new MediaPlayer.rules.SwitchRequest(0)):(p.debug.log("Things could be better, so just switch down one index."),o=new MediaPlayer.rules.SwitchRequest(t-1))):o=new MediaPlayer.rules.SwitchRequest(t);else if(n=r.trackCount-1,n>t)if(k=u.getTrackForQuality(t+1).bandwidth,l=u.getTrackForQuality(t).bandwidth,i=k/l,g>=i)if(g>100)p.debug.log("Tons of bandwidth available, go all the way up."),o=new MediaPlayer.rules.SwitchRequest(n-1);else if(g>10)p.debug.log("Just enough bandwidth available, switch up one."),o=new MediaPlayer.rules.SwitchRequest(t+1);else{for(m=-1;(m+=1)<n&&!(g<b.call(p,u,m,l)););p.debug.log("Calculated ideal new quality index is: "+m),o=new MediaPlayer.rules.SwitchRequest(m)}else o=new MediaPlayer.rules.SwitchRequest;else o=new MediaPlayer.rules.SwitchRequest(n);d(o)},reset:function(){a={}}}},MediaPlayer.rules.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.DownloadRatioRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var a=0,b=3;return{debug:void 0,metricsModel:void 0,execute:function(c,d){var e,f,g=this,h=c.getMediaInfo().type,i=c.getCurrentValue(),j=g.metricsModel.getReadOnlyMetricsFor(h),k=!1,l=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===j.PlayList||void 0===j.PlayList||0===j.PlayList.length?void d(new MediaPlayer.rules.SwitchRequest):(e=j.PlayList[j.PlayList.length-1],null===e||void 0===e||0===e.trace.length?void d(new MediaPlayer.rules.SwitchRequest):(f=e.trace[e.trace.length-2],null===f||void 0===f||null===f.stopreason||void 0===f.stopreason?void d(new MediaPlayer.rules.SwitchRequest):(f.stopreason===MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON&&(k=!0,a+=1,g.debug.log("Number of times the buffer has run dry: "+a)),a>b&&(l=MediaPlayer.rules.SwitchRequest.prototype.STRONG,g.debug.log("Apply STRONG to buffer rule.")),void(k?(g.debug.log("The buffer ran dry recently, switch down."),d(new MediaPlayer.rules.SwitchRequest(i-1,l))):a>b?(g.debug.log("Too many dry buffer hits, quit switching bitrates."),d(new MediaPlayer.rules.SwitchRequest(i,l))):d(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l))))))}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.LimitSwitchesRule=function(){"use strict";var a=0,b=2e3;return{debug:void 0,metricsModel:void 0,execute:function(c,d){var e,f=this,g=c.getMediaInfo().type,h=c.getCurrentValue(),i=this.metricsModel.getReadOnlyMetricsFor(g),j=c.getManifestInfo(),k=i.RepSwitchList.length-1,l=i.RepSwitchList[k],m=(new Date).getTime();return b=1e3*Math.min(j.minBufferTime,j.maxFragmentDuration),e=m-a,b>e&&m-l.t.getTime()<b?(f.debug.log("Wait some time before allowing another switch."),void d(new MediaPlayer.rules.SwitchRequest(h,MediaPlayer.rules.SwitchRequest.prototype.STRONG))):(a=m,void d(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.STRONG)))}}},MediaPlayer.rules.LimitSwitchesRule.prototype={constructor:MediaPlayer.rules.LimitSwitchesRule},MediaPlayer.rules.RulesContext=function(a,b){"use strict";var c=a.getCurrentTrack();return{getStreamInfo:function(){return c.mediaInfo.streamInfo},getMediaInfo:function(){return c.mediaInfo},getTrackInfo:function(){return c},getCurrentValue:function(){return b},getManifestInfo:function(){return c.mediaInfo.streamInfo.manifestInfo}}},MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext},MediaPlayer.rules.BufferLevelRule=function(){"use strict";var a={},b={},c={},d=function(a){var b=this.metricsExt.getCurrentHttpRequest(a);return null!==b?(b.tresponse.getTime()-b.trequest.getTime())/1e3:0},e=function(a,b){var c;return c=isNaN(b)||MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME<b&&b>a?Math.max(MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME,a):a>=b?Math.min(b,MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME):Math.min(b,a)},f=function(a,b,c){var f=this,g=c.bufferController.getCriticalBufferLevel(),h=e.call(this,c.bufferController.getMinBufferTime(),b),i=h,j=c.bufferController.bufferMax,k=f.metricsModel.getReadOnlyMetricsFor("video"),l=f.metricsModel.getReadOnlyMetricsFor("audio"),m=b>=MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD,n=0;return j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN?n=h:j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY?n=b:j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED&&(!a&&f.abrController.isPlayingAtTopQuality()&&(i=m?MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY),n=i+Math.max(d.call(f,k),d.call(f,l))),n=Math.min(n,g)},g=function(a,c){return b[a]&&b[a][c]},h=function(b,c){return a[b]&&a[b][c]},i=function(a,c,d){var e=c.getContext().streamProcessor.getStreamInfo().id;b[e]=b[e]||{},b[e][d.mediaType]=!0},j=function(b){var c=b.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.streamProcessor.getType()]=!0},k=function(b){var c=b.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.streamProcessor.getType()]=!1};return{metricsExt:void 0,metricsModel:void 0,abrController:void 0,setup:function(){this.bufferLevelOutrun=j,this.bufferLevelBalanced=k,this.streamCompleted=i},setScheduleController:function(a){var b=a.streamProcessor.getStreamInfo().id;c[b]=c[b]||{},c[b][a.streamProcessor.getType()]=a},execute:function(a,b){var d=a.getStreamInfo(),e=d.id,i=a.getMediaInfo().type;if(h(e,i))return void b(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var j,k=this.metricsModel.getReadOnlyMetricsFor(i),l=this.metricsExt.getCurrentBufferLevel(k)?this.metricsExt.getCurrentBufferLevel(k).level:0,m=c[e][i],n=m.streamProcessor.getCurrentTrack(),o=m.streamProcessor.isDynamic(),p=this.metricsExt.getCurrentPlaybackRate(k),q=d.duration,r=l/Math.max(p,1),s=n.fragmentDuration,t=m.playbackController.getTime(),u=o?Number.POSITIVE_INFINITY:q-t,v=Math.min(f.call(this,o,q,m),u),w=Math.max(v-r,0);j=Math.ceil(w/s),r>=u&&!g(e,i)&&(j=j||1),b(new MediaPlayer.rules.SwitchRequest(j,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){a={},b={},c={}}}},MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule},MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){"use strict";var a,b,c=43200,d=0/0,e=null,f=0/0,g=null,h=!1,i=0/0,j=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,k=function(b,c,d,e){var f,h=this;if(null===e)f=h.adapter.generateFragmentRequestForTime(a.streamProcessor,g,b),k.call(h,b,c,d,f);else{var i=function(e,f,g){a.fragmentLoader.unsubscribe(a.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),f?c.call(h,g,b):d.call(h,g,b)};a.fragmentLoader.subscribe(a.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),a.fragmentLoader.checkForExistence(e)}},l=function(c,i){var o,p,q;return h?void n.call(this,!1,i):(q=i-d,o=q>0?d-q:d+Math.abs(q)+f,void(o<e.start&&o>e.end?b(new MediaPlayer.rules.SwitchRequest(null,j)):(p=this.adapter.getFragmentRequestForTime(a.streamProcessor,g,o),k.call(this,o,m,l,p))))},m=function(c,l){var m,o,p=c.startTime,q=this;if(!h){if(!g.fragmentDuration)return void b(new MediaPlayer.rules.SwitchRequest(p,j));if(h=!0,e.end=p+2*f,l===d)return o=l+i,m=q.adapter.getFragmentRequestForTime(a.streamProcessor,g,o),void k.call(q,o,function(){n.call(q,!0,o)},function(){b(new MediaPlayer.rules.SwitchRequest(o,j))},m)}n.call(this,!0,l)},n=function(c,d){var f,h,n;c?e.start=d:e.end=d,f=Math.floor(e.end-e.start)<=i,f?b(new MediaPlayer.rules.SwitchRequest(c?d:d-i,j)):(n=(e.start+e.end)/2,h=this.adapter.getFragmentRequestForTime(a.streamProcessor,g,n),k.call(this,n,m,l,h))};return{metricsExt:void 0,adapter:void 0,setFinder:function(b){a=b},execute:function(h,n){var o,p,q=this;return b=n,g=a.streamProcessor.getCurrentTrack(),i=g.fragmentDuration,p=g.DVRWindow,d=p.end,g.useCalculatedLiveEdgeTime?void b(new MediaPlayer.rules.SwitchRequest(d,j)):(e={start:Math.max(0,d-c),end:d+c},f=Math.floor((p.end-p.start)/2),o=q.adapter.getFragmentRequestForTime(a.streamProcessor,g,d),void k.call(q,d,m,l,o))},reset:function(){d=0/0,e=null,f=0/0,g=null,h=!1,i=0/0,a=null}}},MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule},MediaPlayer.rules.PendingRequestsRule=function(){"use strict";var a=3,b={};return{metricsExt:void 0,setScheduleController:function(a){var c=a.streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.streamProcessor.getType()]=a},execute:function(c,d){var e=c.getMediaInfo().type,f=c.getStreamInfo().id,g=c.getCurrentValue(),h=b[f][e],i=h.getFragmentModel(),j=i.getPendingRequests(),k=i.getLoadingRequests(),l=i.getRejectedRequests(),m=l.length,n=j.length+k.length,o=Math.max(g-n,0);return m>0?void d(new MediaPlayer.rules.SwitchRequest(m,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):n>a?void d(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):0===g?void d(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE)):void d(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){b={}}}},MediaPlayer.rules.PendingRequestsRule.prototype={constructor:MediaPlayer.rules.PendingRequestsRule},MediaPlayer.rules.PlaybackTimeRule=function(){"use strict";var a={},b={},c=function(b,c){var d=b.getStreamId();a[d]=a[d]||{},a[d].audio=c,a[d].video=c};return{adapter:void 0,sourceBufferExt:void 0,setup:function(){this.playbackSeeking=c},setScheduleController:function(a){var c=a.streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.streamProcessor.getType()]=a},execute:function(c,d){var e,f,g,h=c.getMediaInfo().type,i=c.getStreamInfo().id,j=b[i][h],k=b[i][h].streamProcessor,l=k.getCurrentTrack(),m=a[i]?a[i][h]:null,n=m?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,o=j.getFragmentModel().getRejectedRequests().shift(),p=!!o&&!m,q=this.adapter.getIndexHandlerTime(k),r=k.playbackController.getTime(),s=o?o.startTime+o.duration:null,t=o&&(s>r&&o.startTime<=q||isNaN(q));if(f=m||(t?o.startTime:q),isNaN(f))return void d(new MediaPlayer.rules.SwitchRequest(null,n));for(a[i]&&(a[i][h]=null),e=this.sourceBufferExt.getBufferRange(k.bufferController.getBuffer(),f),null!==e&&(f=e.end),g=this.adapter.getFragmentRequestForTime(k,l,f,p),t&&g&&g.index!==o.index&&(g=this.adapter.getFragmentRequestForTime(k,l,o.startTime+o.duration/2,p));g&&k.fragmentController.isFragmentLoadedOrPending(j,g);){if("complete"===g.action){g=null,this.adapter.setIndexHandlerTime(k,0/0);break}g=this.adapter.getNextFragmentRequest(k,l)}g&&!t&&this.adapter.setIndexHandlerTime(k,g.startTime+g.duration),d(new MediaPlayer.rules.SwitchRequest(g,n))},reset:function(){a={},b={}}}},MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule},MediaPlayer.rules.RulesController=function(){"use strict";var a={},b=["execute"],c=function(a){return a===this.SCHEDULING_RULE||a===this.ABR_RULE},d=function(a){var c=b.length,d=0;for(d;c>d;d+=1)if(!a.hasOwnProperty(b[d]))return!1;return!0},e=function(a,b){return new MediaPlayer.rules.RulesContext(a,b)},f=function(a){var b=a.execute.bind(a);return a.execute=function(c,d){var e=function(b){d.call(a,new MediaPlayer.rules.SwitchRequest(b.value,b.priority))};b(c,e)},"function"!=typeof a.reset&&(a.reset=function(){}),a},g=function(a,b,c){var e,g,h,i,j,k;for(g in b)if(i=b[g],j=i.length)for(k=0;j>k;k+=1)e=i[k],d.call(this,e)&&(e=f.call(this,e),h=a.getRules(g),c&&(h.length=0),h.push(e))};return{system:void 0,debug:void 0,SCHEDULING_RULE:0,ABR_RULE:1,initialize:function(){a[this.ABR_RULE]=this.system.getObject("abrRulesCollection"),a[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection")},setRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!0)},addRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!1)},applyRules:function(a,b,c,f,g){var h,i,j=a.length,k=j,l={},m=e.call(this,b,f),n=function(a){var b,d;a.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(l[a.priority]=g(l[a.priority],a.value)),--j||(l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.WEAK,b=l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,b=l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.STRONG,b=l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),d!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&d!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),c({value:b||f,confidence:d}))};for(l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,i=0;k>i;i+=1)h=a[i],d.call(this,h)?h.execute(m,n):j--},reset:function(){a={}}}},MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController},MediaPlayer.rules.SameTimeRequestRule=function(){"use strict";var a=4,b=function(a,b){var c,e,f,g,h,i=0,j=a.length;for(i;j>i;i+=1)for(f=a[i].getPendingRequests(),d.call(this,f,"index"),g=0,h=f.length;h>g;g++){if(c=f[g],isNaN(c.startTime)&&"complete"!==c.action){e=c;break}c.startTime>b&&(!e||c.startTime<e.startTime)&&(e=c)}return e||c},c=function(a,b){var c,d,e=a.length,f=null;for(d=0;e>d;d+=1)c=a[d].getPendingRequestForTime(b),c&&(!f||c.startTime>f.startTime)&&(f=c);return f},d=function(a,b){var c=function(a,c){return a[b]<c[b]||isNaN(a[b])&&"complete"!==a.action?-1:a[b]>c[b]?1:0};a.sort(c)};return{setFragmentModels:function(a,b){this.fragmentModels=this.fragmentModels||{},this.fragmentModels[b]=a},execute:function(d,e){var f,g,h,i,j,k,l,m,n,o=d.getStreamInfo().id,p=d.getCurrentValue(),q=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,r=this.fragmentModels[o],s=new Date,t=null,u=r?r.length:null,v=!1,w=[];if(!r||!u)return void e(new MediaPlayer.rules.SwitchRequest([],q));if(k=Math.round(100*r[0].getContext().playbackController.getTime())/100,l=c(r,k),j=l||b(r,k)||p,!j)return void e(new MediaPlayer.rules.SwitchRequest([],q));for(i=0;u>i;i+=1)if(g=r[i],f=g.getContext().streamProcessor.getType(),("video"===f||"audio"===f)&&(m=g.getPendingRequests(),n=g.getLoadingRequests().length,!g.getIsPostponed()||isNaN(j.startTime))){if(n>a)return void e(new MediaPlayer.rules.SwitchRequest([],q));if(t=t||(j===l?k:j.startTime),-1===m.indexOf(j)){if(h=g.getPendingRequestForTime(t))w.push(h);else if(h=g.getLoadingRequestForTime(t)||g.getExecutedRequestForTime(t),!h){v=!0;break}}else w.push(j)}return w=w.filter(function(a){return"complete"===a.action||s.getTime()>=a.availabilityStartTime.getTime()}),v?void e(new MediaPlayer.rules.SwitchRequest([],q)):void e(new MediaPlayer.rules.SwitchRequest(w,q))}}},MediaPlayer.rules.SameTimeRequestRule.prototype={constructor:MediaPlayer.rules.SameTimeRequestRule},MediaPlayer.rules.ScheduleRulesCollection=function(){"use strict";var a=[],b=[],c=[],d=[];return{bufferLevelRule:void 0,pendingRequestsRule:void 0,playbackTimeRule:void 0,sameTimeRequestRule:void 0,liveEdgeBinarySearchRule:void 0,getRules:function(e){switch(e){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return a;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return d;case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES:return b;case MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES:return c;default:return null}},setup:function(){a.push(this.bufferLevelRule),a.push(this.pendingRequestsRule),d.push(this.playbackTimeRule),b.push(this.sameTimeRequestRule),c.push(this.liveEdgeBinarySearchRule)}}},MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules",FRAGMENTS_TO_EXECUTE_RULES:"fragmentsToExecuteRules",LIVE_EDGE_RULES:"liveEdgeRules"},MediaPlayer.rules.SwitchRequest=function(a,b){"use strict";this.value=a,this.priority=b,void 0===this.value&&(this.value=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.vo.FragmentRequest=function(){"use strict";this.action="download",this.startTime=0/0,this.mediaType=null,this.type=null,this.duration=0/0,this.timescale=0/0,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=0/0,this.index=0/0,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.ManifestInfo=function(){"use strict";this.DVRWindowSize=0/0,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=0/0,this.duration=0/0,this.isDynamic=!1,this.maxFragmentDuration=null},MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo},MediaPlayer.vo.MediaInfo=function(){"use strict";this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.trackCount=0,this.lang=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null},MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=0/0,this.duration=0/0,this.manifestInfo=null},MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo},MediaPlayer.vo.TrackInfo=function(){"use strict";this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null,this.manifestInfo=null},MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){"use strict";this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.TrackSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.TrackSwitch.prototype={constructor:MediaPlayer.vo.metrics.TrackSwitch},MediaPlayer.vo.metrics.SchedulingInfo=function(){"use strict";this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo},MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE="pending",MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE="loading",MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE="executed",MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE="rejected",MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE="canceled",MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE="failed",MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection};function X2JS(a,b,c){function d(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function e(a){return a.prefix}function f(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function g(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){if(f.nodeType==u.DOCUMENT_NODE){var i,j,k,l=f.firstChild;for(j=0,k=f.childNodes.length;k>j;j+=1)if(f.childNodes[j].nodeType!==u.COMMENT_NODE){l=f.childNodes[j];break}if(c)i=h(l);else{i={};var m=d(l);i[m]=h(l)}return i}if(f.nodeType==u.ELEMENT_NODE){var i=new Object;i.__cnt=0;for(var n=f.childNodes,o=0;o<n.length;o++){var l=n.item(o),m=d(l);if(i.__cnt++,null==i[m])i[m]=h(l),i[m+"_asArray"]=new Array(1),i[m+"_asArray"][0]=i[m];else{if(null!=i[m]&&!(i[m]instanceof Array)){var p=i[m];i[m]=new Array,i[m][0]=p,i[m+"_asArray"]=i[m]}for(var q=0;null!=i[m][q];)q++;i[m][q]=h(l)}}for(var r=0;r<f.attributes.length;r++){var s=f.attributes.item(r);i.__cnt++;for(var v=s.value,w=0,x=a.length;x>w;w++){var y=a[w];y.test.call(this,s.value)&&(v=y.converter.call(this,s.value))}i[b+s.name]=v}var z=e(f);return null!=z&&""!=z&&(i.__cnt++,i.__prefix=z),1==i.__cnt&&null!=i["#text"]&&(i=i["#text"]),null!=i["#text"]&&(i.__text=i["#text"],t&&(i.__text=g(i.__text)),delete i["#text"],delete i["#text_asArray"]),null!=i["#cdata-section"]&&(i.__cdata=i["#cdata-section"],delete i["#cdata-section"],delete i["#cdata-section_asArray"]),(null!=i.__text||null!=i.__cdata)&&(i.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),i}return f.nodeType==u.TEXT_NODE||f.nodeType==u.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==u.COMMENT_NODE?null:void 0}function i(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function j(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function k(a,b){return-1!==a.indexOf(b,a.length-b.length)}function l(a,b){return k(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function m(a){var b=0;if(a instanceof Object)for(var c in a)l(a,c)||b++;return b}function n(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function o(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=t?f(a.__text):a.__text),b}function p(a){var b="";return a instanceof Object?b+=o(a):null!=a&&(b+=t?f(a):a),b}function q(a,b,c){var d="";if(0==a.length)d+=i(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=i(a[e],b,n(a[e]),!1),d+=r(a[e]),d+=j(a[e],b);return d}function r(a){var b="",c=m(a);if(c>0)for(var d in a)if(!l(a,d)){var e=a[d],f=n(e);if(null==e||void 0==e)b+=i(e,d,f,!0);else if(e instanceof Object)if(e instanceof Array)b+=q(e,d,f);else{var g=m(e);g>0||null!=e.__text||null!=e.__cdata?(b+=i(e,d,f,!1),b+=r(e),b+=j(e,d)):b+=i(e,d,f,!0)}else b+=i(e,d,f,!1),b+=p(e),b+=j(e,d)}return b+=p(a)}(null===b||void 0===b)&&(b="_"),(null===c||void 0===c)&&(c=!1);var s="1.0.11",t=!1,u={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return h(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return r(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return s},this.escapeMode=function(a){t=a}}function ObjectIron(a){var b;for(b=[],i=0,len=a.length;len>i;i+=1)b.push(a[i].isRoot?"root":a[i].name);var c=function(a,b){var c;if(null!==a&&null!==b)for(c in a)a.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=a[c]))},d=function(a,b,d){var e,f,g,h,i;if(null!==a&&0!==a.length)for(e=0,f=a.length;f>e;e+=1)g=a[e],b.hasOwnProperty(g.name)&&(d.hasOwnProperty(g.name)?g.merge&&(h=b[g.name],i=d[g.name],"object"==typeof h&&"object"==typeof i?c(h,i):d[g.name]=null!=g.mergeFunction?g.mergeFunction(h,i):h+i):d[g.name]=b[g.name])},e=function(a,b){var c,f,g,h,i,j,k,l=a;if(null!==l.children&&0!==l.children.length)for(c=0,f=l.children.length;f>c;c+=1)if(j=l.children[c],b.hasOwnProperty(j.name))if(j.isArray)for(i=b[j.name+"_asArray"],g=0,h=i.length;h>g;g+=1)k=i[g],d(l.properties,b,k),e(j,k);else k=b[j.name],d(l.properties,b,k),e(j,k)},f=function(c){var d,g,h,i,j,k,l;if(null===c)return c;if("object"!=typeof c)return c;for(d=0,g=b.length;g>d;d+=1)"root"===b[d]&&(j=a[d],k=c,e(j,k));for(i in c)if(c.hasOwnProperty(i)){if(h=b.indexOf(i),-1!==h)if(j=a[h],j.isArray)for(l=c[i+"_asArray"],d=0,g=l.length;g>d;d+=1)k=l[d],e(j,k);else k=c[i],e(j,k);f(c[i])}return c};return{run:f}}if(function(a){"use strict";var b={VERSION:"0.5.3"};b.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},b.System.prototype={_createAndSetupInstance:function(a,b){var c=new b;return this.injectInto(c,a),c},_retrieveFromCacheOrCreate:function(a,b){"undefined"==typeof b&&(b=!1);var c;if(!this._mappings.hasOwnProperty(a))throw new Error(1e3);var d=this._mappings[a];return!b&&d.isSingleton?(null==d.object&&(d.object=this._createAndSetupInstance(a,d.clazz)),c=d.object):c=d.clazz?this._createAndSetupInstance(a,d.clazz):d.object,c},mapOutlet:function(a,b,c){if("undefined"==typeof a)throw new Error(1010);return b=b||"global",c=c||a,this._outlets.hasOwnProperty(b)||(this._outlets[b]={}),this._outlets[b][c]=a,this},getObject:function(a){if("undefined"==typeof a)throw new Error(1020);return this._retrieveFromCacheOrCreate(a)},mapValue:function(a,b){if("undefined"==typeof a)throw new Error(1030);return this._mappings[a]={clazz:null,object:b,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this.hasMapping(a)&&this.injectInto(b,a),this},hasMapping:function(a){if("undefined"==typeof a)throw new Error(1040);return this._mappings.hasOwnProperty(a)},mapClass:function(a,b){if("undefined"==typeof a)throw new Error(1050);if("undefined"==typeof b)throw new Error(1051);return this._mappings[a]={clazz:b,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(a),this},mapSingleton:function(a,b){if("undefined"==typeof a)throw new Error(1060);if("undefined"==typeof b)throw new Error(1061);return this._mappings[a]={clazz:b,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(a),this},instantiate:function(a){if("undefined"==typeof a)throw new Error(1070);return this._retrieveFromCacheOrCreate(a,!0)},injectInto:function(a,b){if("undefined"==typeof a)throw new Error(1080);if("object"==typeof a){var c=[];this._outlets.hasOwnProperty("global")&&c.push(this._outlets.global),"undefined"!=typeof b&&this._outlets.hasOwnProperty(b)&&c.push(this._outlets[b]);for(var d in c){var e=c[d];for(var f in e){var g=e[f];(!this.strictInjections||f in a)&&(a[f]=this.getObject(g))}}"setup"in a&&a.setup.call(a)}return this},unmap:function(a){if("undefined"==typeof a)throw new Error(1090);return delete this._mappings[a],this},unmapOutlet:function(a,b){if("undefined"==typeof a)throw new Error(1100);if("undefined"==typeof b)throw new Error(1101);return delete this._outlets[a][b],this},mapHandler:function(a,b,c,d,e){if("undefined"==typeof a)throw new Error(1110);return b=b||"global",c=c||a,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=!1),this._handlers.hasOwnProperty(a)||(this._handlers[a]={}),this._handlers[a].hasOwnProperty(b)||(this._handlers[a][b]=[]),this._handlers[a][b].push({handler:c,oneShot:d,passEvent:e}),this},unmapHandler:function(a,b,c){if("undefined"==typeof a)throw new Error(1120);if(b=b||"global",c=c||a,this._handlers.hasOwnProperty(a)&&this._handlers[a].hasOwnProperty(b)){var d=this._handlers[a][b];for(var e in d){var f=d[e];if(f.handler===c){d.splice(e,1);break}}}return this},notify:function(a){if("undefined"==typeof a)throw new Error(1130);var b=Array.prototype.slice.call(arguments),c=b.slice(1);if(this._handlers.hasOwnProperty(a)){var d=this._handlers[a];for(var e in d){var f,g=d[e];"global"!==e&&(f=this.getObject(e));var h,i,j=[];for(h=0,i=g.length;i>h;h++){var k,l=g[h];k=f&&"string"==typeof l.handler?f[l.handler]:l.handler,l.oneShot&&j.unshift(h),l.passEvent?k.apply(f,b):k.apply(f,c)}for(h=0,i=j.length;i>h;h++)g.splice(j[h],1)}}return this}},a.dijon=b}(this),"undefined"==typeof utils)var utils={};"undefined"==typeof utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(a,b){var c,d,e;return c=new goog.math.Long(0,b),d=new goog.math.Long(a,0),e=c.add(d),e.toNumber()},goog={},goog.math={},goog.math.Long=function(a,b){this.low_=0|a,this.high_=0|b},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(a){if(a>=-128&&128>a){var b=goog.math.Long.IntCache_[a];if(b)return b}var c=new goog.math.Long(0|a,0>a?-1:0);return a>=-128&&128>a&&(goog.math.Long.IntCache_[a]=c),c},goog.math.Long.fromNumber=function(a){return isNaN(a)||!isFinite(a)?goog.math.Long.ZERO:a<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:a+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>a?goog.math.Long.fromNumber(-a).negate():new goog.math.Long(a%goog.math.Long.TWO_PWR_32_DBL_|0,a/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(a,b){return new goog.math.Long(a,b)},goog.math.Long.fromString=function(a,b){if(0==a.length)throw Error("number format error: empty string");var c=b||10;if(2>c||c>36)throw Error("radix out of range: "+c);if("-"==a.charAt(0))return goog.math.Long.fromString(a.substring(1),c).negate();if(a.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+a);for(var d=goog.math.Long.fromNumber(Math.pow(c,8)),e=goog.math.Long.ZERO,f=0;f<a.length;f+=8){var g=Math.min(8,a.length-f),h=parseInt(a.substring(f,f+g),c);if(8>g){var i=goog.math.Long.fromNumber(Math.pow(c,g));e=e.multiply(i).add(goog.math.Long.fromNumber(h))}else e=e.multiply(d),e=e.add(goog.math.Long.fromNumber(h))}return e},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(a){var b=a||10;if(2>b||b>36)throw Error("radix out of range: "+b);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var c=goog.math.Long.fromNumber(b),d=this.div(c),e=d.multiply(c).subtract(this);return d.toString(b)+e.toInt().toString(b)}return"-"+this.negate().toString(b)}for(var f=goog.math.Long.fromNumber(Math.pow(b,6)),e=this,g="";;){var h=e.div(f),i=e.subtract(h.multiply(f)).toInt(),j=i.toString(b);if(e=h,e.isZero())return j+g;for(;j.length<6;)j="0"+j;g=""+j+g}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var a=0!=this.high_?this.high_:this.low_,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high_?b+33:b+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(a){return this.high_==a.high_&&this.low_==a.low_},goog.math.Long.prototype.notEquals=function(a){return this.high_!=a.high_||this.low_!=a.low_},goog.math.Long.prototype.lessThan=function(a){return this.compare(a)<0},goog.math.Long.prototype.lessThanOrEqual=function(a){return this.compare(a)<=0},goog.math.Long.prototype.greaterThan=function(a){return this.compare(a)>0},goog.math.Long.prototype.greaterThanOrEqual=function(a){return this.compare(a)>=0},goog.math.Long.prototype.compare=function(a){if(this.equals(a))return 0;var b=this.isNegative(),c=a.isNegative();return b&&!c?-1:!b&&c?1:this.subtract(a).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(a){var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e+i,l+=m>>>16,m&=65535,l+=d+h,k+=l>>>16,l&=65535,k+=c+g,j+=k>>>16,k&=65535,j+=b+f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.subtract=function(a){return this.add(a.negate())},goog.math.Long.prototype.multiply=function(a){if(this.isZero())return goog.math.Long.ZERO;if(a.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return a.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(a.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().multiply(a.negate()):this.negate().multiply(a).negate();if(a.isNegative())return this.multiply(a.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&a.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*a.toNumber());var b=this.high_>>>16,c=65535&this.high_,d=this.low_>>>16,e=65535&this.low_,f=a.high_>>>16,g=65535&a.high_,h=a.low_>>>16,i=65535&a.low_,j=0,k=0,l=0,m=0;return m+=e*i,l+=m>>>16,m&=65535,l+=d*i,k+=l>>>16,l&=65535,l+=e*h,k+=l>>>16,l&=65535,k+=c*i,j+=k>>>16,k&=65535,k+=d*h,j+=k>>>16,k&=65535,k+=e*g,j+=k>>>16,k&=65535,j+=b*i+c*h+d*g+e*f,j&=65535,goog.math.Long.fromBits(l<<16|m,j<<16|k)},goog.math.Long.prototype.div=function(a){if(a.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(a.equals(goog.math.Long.ONE)||a.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;var b=this.shiftRight(1),c=b.div(a).shiftLeft(1);if(c.equals(goog.math.Long.ZERO))return a.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var d=this.subtract(a.multiply(c)),e=c.add(d.div(a));return e}if(a.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return a.isNegative()?this.negate().div(a.negate()):this.negate().div(a).negate();if(a.isNegative())return this.div(a.negate()).negate();for(var f=goog.math.Long.ZERO,d=this;d.greaterThanOrEqual(a);){for(var c=Math.max(1,Math.floor(d.toNumber()/a.toNumber())),g=Math.ceil(Math.log(c)/Math.LN2),h=48>=g?1:Math.pow(2,g-48),i=goog.math.Long.fromNumber(c),j=i.multiply(a);j.isNegative()||j.greaterThan(d);)c-=h,i=goog.math.Long.fromNumber(c),j=i.multiply(a);i.isZero()&&(i=goog.math.Long.ONE),f=f.add(i),d=d.subtract(j)}return f},goog.math.Long.prototype.modulo=function(a){return this.subtract(this.div(a).multiply(a))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(a){return goog.math.Long.fromBits(this.low_&a.low_,this.high_&a.high_)},goog.math.Long.prototype.or=function(a){return goog.math.Long.fromBits(this.low_|a.low_,this.high_|a.high_)},goog.math.Long.prototype.xor=function(a){return goog.math.Long.fromBits(this.low_^a.low_,this.high_^a.high_)},goog.math.Long.prototype.shiftLeft=function(a){if(a&=63,0==a)return this;var b=this.low_;if(32>a){var c=this.high_;return goog.math.Long.fromBits(b<<a,c<<a|b>>>32-a)}return goog.math.Long.fromBits(0,b<<a-32)},goog.math.Long.prototype.shiftRight=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>a)}return goog.math.Long.fromBits(b>>a-32,b>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(a){if(a&=63,0==a)return this;var b=this.high_;if(32>a){var c=this.low_;return goog.math.Long.fromBits(c>>>a|b<<32-a,b>>>a)}return 32==a?goog.math.Long.fromBits(b,0):goog.math.Long.fromBits(b>>>a-32,0)};var UTF8={};UTF8.encode=function(a){for(var b=[],c=0;c<a.length;++c){var d=a.charCodeAt(c);128>d?b.push(d):2048>d?(b.push(192|d>>6),b.push(128|63&d)):65536>d?(b.push(224|d>>12),b.push(128|63&d>>6),b.push(128|63&d)):(b.push(240|d>>18),b.push(128|63&d>>12),b.push(128|63&d>>6),b.push(128|63&d))}return b},UTF8.decode=function(a){for(var b=[],c=0;c<a.length;){var d=a[c++];128>d||(224>d?(d=(31&d)<<6,d|=63&a[c++]):240>d?(d=(15&d)<<12,d|=(63&a[c++])<<6,d|=63&a[c++]):(d=(7&d)<<18,d|=(63&a[c++])<<12,d|=(63&a[c++])<<6,d|=63&a[c++])),b.push(String.fromCharCode(d))}return b.join("")};var BASE64={};if(function(b){var c=function(a){for(var c=0,d=[],e=0|a.length/3;0<e--;){var f=(a[c]<<16)+(a[c+1]<<8)+a[c+2];c+=3,d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push(b.charAt(63&f))}if(2==a.length-c){var f=(a[c]<<16)+(a[c+1]<<8);d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push(b.charAt(63&f>>6)),d.push("=")}else if(1==a.length-c){var f=a[c]<<16;d.push(b.charAt(63&f>>18)),d.push(b.charAt(63&f>>12)),d.push("==")}return d.join("")},d=function(){for(var a=[],c=0;c<b.length;++c)a[b.charCodeAt(c)]=c;return a["=".charCodeAt(0)]=0,a}(),e=function(a){for(var b=0,c=[],e=0|a.length/4;0<e--;){var f=(d[a.charCodeAt(b)]<<18)+(d[a.charCodeAt(b+1)]<<12)+(d[a.charCodeAt(b+2)]<<6)+d[a.charCodeAt(b+3)];c.push(255&f>>16),c.push(255&f>>8),c.push(255&f),b+=4}return c&&("="==a.charAt(b-2)?(c.pop(),c.pop()):"="==a.charAt(b-1)&&c.pop()),c},f={};f.encode=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a.charCodeAt(c));return b},f.decode=function(){for(var b=0;b<s.length;++b)a[b]=String.fromCharCode(a[b]);return a.join("")},BASE64.decodeArray=function(a){var b=e(a);return new Uint8Array(b)},BASE64.encodeASCII=function(a){var b=f.encode(a);return c(b)},BASE64.decodeASCII=function(a){var b=e(a);return f.decode(b)},BASE64.encode=function(a){var b=UTF8.encode(a);return c(b)},BASE64.decode=function(a){var b=e(a);return UTF8.decode(b)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa)var btoa=BASE64.encode;if(void 0===atob)var atob=BASE64.decode;MediaPlayer=function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m="1.3.0 (refactor)",n=a,o=!1,p=!1,q=!0,r=!1,s=MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED,t=function(){return!!e&&!!f},u=function(){if(!o)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!e||!f)throw"Missing view or source.";p=!0,g=b.getObject("streamController"),g.subscribe(g.eventList.ENAME_STREAMS_COMPOSED,i),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,g),c.subscribe(c.eventList.ENAME_MANIFEST_LOADED,i),g.setVideoModel(l),g.setAutoPlay(q),g.load(f),b.mapValue("scheduleWhilePaused",r),b.mapOutlet("scheduleWhilePaused","stream"),b.mapOutlet("scheduleWhilePaused","scheduleController"),b.mapValue("bufferMax",s),b.mapOutlet("bufferMax","bufferController"),h.initialize()},v=function(){t()&&u.call(this)},w=function(){var a=k.getReadOnlyMetricsFor("video")||k.getReadOnlyMetricsFor("audio");return j.getCurrentDVRInfo(a)},x=function(){return w.call(this).manifestInfo.DVRWindowSize},y=function(a){var b=w.call(this),c=b.range.start+parseInt(a);return c>b.range.end&&(c=b.range.end),c},z=function(a){l.getElement().currentTime=this.getDVRSeekOffset(a)},A=function(){var a=w.call(this);return null===a?0:Math.round(this.duration()-(a.range.end-a.time))},B=function(){var a,b=w.call(this);return null===b?0:(a=b.range.end-b.range.start,Math.round(a<b.manifestInfo.DVRWindowSize?a:b.manifestInfo.DVRWindowSize))},C=function(){var a,b,c=w.call(this);return null===c?0:(a=c.manifestInfo.availableFrom.getTime()/1e3,b=this.time()+(a+c.range.start),Math.round(b))},D=function(){var a,b,c=w.call(this);return null===c?0:(a=c.manifestInfo.availableFrom.getTime()/1e3,b=a+c.range.start+this.duration(),Math.round(b))},E=function(a,b,c){var d=new Date(1e3*a),e=d.toLocaleDateString(b),f=d.toLocaleTimeString(b,{hour12:c});return f+" "+e},F=function(a){a=Math.max(a,0);var b=Math.floor(a/3600),c=Math.floor(a%3600/60),d=Math.floor(a%3600%60);return(0===b?"":10>b?"0"+b.toString()+":":b.toString()+":")+(10>c?"0"+c.toString():c.toString())+":"+(10>d?"0"+d.toString():d.toString())},G=function(a,b,c){b&&void 0!==a&&null!==a&&(c?h.setRules(a,b):h.addRules(a,b))},H=function(){p&&g&&(g.unsubscribe(g.eventList.ENAME_STREAMS_COMPOSED,i),c.unsubscribe(c.eventList.ENAME_MANIFEST_LOADED,g),c.unsubscribe(c.eventList.ENAME_MANIFEST_LOADED,i),g.reset(),d.reset(),h.reset(),g=null,p=!1)};return b=new dijon.System,b.mapValue("system",b),b.mapOutlet("system"),b.injectInto(n),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,tokenAuthentication:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){j=b.getObject("metricsExt"),c=b.getObject("manifestLoader"),i=b.getObject("manifestUpdater"),d=b.getObject("abrController"),h=b.getObject("rulesController"),k=b.getObject("metricsModel")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)},getVersion:function(){return m},startup:function(){o||(b.injectInto(this),o=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return l},setAutoPlay:function(a){q=a},getAutoPlay:function(){return q},setScheduleWhilePaused:function(a){r=a},getScheduleWhilePaused:function(){return r},setTokenAuthentication:function(a,b){this.tokenAuthentication.setTokenAuthentication({name:a,type:b})},setBufferMax:function(a){s=a},getBufferMax:function(){return s},getMetricsExt:function(){return j},getMetricsFor:function(a){var b=k.getReadOnlyMetricsFor(a);return b},getQualityFor:function(a){return d.getQualityFor(a)},setQualityFor:function(a,b){d.setPlaybackQuality(a,b)},getAutoSwitchQuality:function(){return d.getAutoSwitchBitrate()},setAutoSwitchQuality:function(a){d.setAutoSwitchBitrate(a)},setSchedulingRules:function(a){G.call(this,h.SCHEDULING_RULE,a,!0)},addSchedulingRules:function(a){G.call(this,h.SCHEDULING_RULE,a,!1)},setABRRules:function(a){G.call(this,h.ABR_RULE,a,!0)},addABRRules:function(a){G.call(this,h.ABR_RULE,a,!1)},attachView:function(a){if(!o)throw"MediaPlayer not initialized!";e=a,l=null,e&&(l=b.getObject("videoModel"),l.setElement(e)),H.call(this),t.call(this)&&v.call(this)},attachSource:function(a){if(!o)throw"MediaPlayer not initialized!";this.uriQueryFragModel.reset(),f=this.uriQueryFragModel.parseURI(a),H.call(this),t.call(this)&&v.call(this)},reset:function(){this.attachSource(null),this.attachView(null)},play:u,isReady:t,seek:z,time:A,duration:B,timeAsUTC:C,durationAsUTC:D,getDVRWindowSize:x,getDVRSeekOffset:y,formatUTC:E,convertToTimeCode:F}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.di.Context=function(){"use strict";return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("debug",MediaPlayer.utils.Debug),this.system.mapSingleton("tokenAuthentication",MediaPlayer.utils.TokenAuthentication),this.system.mapSingleton("eventBus",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapClass("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapClass("playbackController",MediaPlayer.dependencies.PlaybackController),this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",MediaPlayer.rules.LimitSwitchesRule),this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection),this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController),this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule),this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule),this.system.mapClass("pendingRequestsRule",MediaPlayer.rules.PendingRequestsRule),this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule),this.system.mapClass("sameTimeRequestRule",MediaPlayer.rules.SameTimeRequestRule),this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapSingleton("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("trackController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Dash.dependencies.BaseURLExtensions=function(){"use strict";var a=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m=new DataView(a),n={},o=0;"sidx"!==j&&o<m.byteLength;){for(k=m.getUint32(o),o+=4,j="",f=0;4>f;f+=1)l=m.getInt8(o),j+=String.fromCharCode(l),o+=1;"moof"!==j&&"traf"!==j&&"sidx"!==j?o+=k-8:"sidx"===j&&(o-=8)}if(e=m.getUint32(o,!1)+o,e>a.byteLength)throw"sidx terminates after array buffer";for(n.version=m.getUint8(o+8),o+=12,n.timescale=m.getUint32(o+4,!1),o+=8,0===n.version?(n.earliest_presentation_time=m.getUint32(o,!1),n.first_offset=m.getUint32(o+4,!1),o+=8):(n.earliest_presentation_time=utils.Math.to64BitNumber(m.getUint32(o+4,!1),m.getUint32(o,!1)),n.first_offset=(m.getUint32(o+8,!1)<<32)+m.getUint32(o+12,!1),o+=16),n.first_offset+=e+(b||0),n.reference_count=m.getUint16(o+2,!1),o+=4,n.references=[],c=n.first_offset,d=n.earliest_presentation_time,f=0;f<n.reference_count;f+=1)h=m.getUint32(o,!1),g=h>>>31,h=2147483647&h,i=m.getUint32(o+4,!1),o+=12,n.references.push({size:h,type:g,offset:c,duration:i,time:d,timescale:n.timescale}),c+=h,d+=i;if(o!==e)throw"Error: final pos "+o+" differs from SIDX end "+e;return n},b=function(b,c,d){var e,f,g,h,i,j,k,l;for(e=a.call(this,b,d),f=e.references,g=[],i=0,j=f.length;j>i;i+=1)h=new Dash.vo.Segment,h.duration=f[i].duration,h.media=c,h.startTime=f[i].time,h.timescale=f[i].timescale,k=f[i].offset,l=f[i].offset+f[i].size-1,h.mediaRange=k+"-"+l,g.push(h);return this.debug.log("Parsed SIDX box: "+g.length+" segments."),g},c=function(a,b,d){var e,f,g,h,i,j,k,l,m,n=new DataView(a),o=0,p="",q=0,r=!1,s=this;for(s.debug.log("Searching for initialization.");"moov"!==p&&o<n.byteLength;){for(q=n.getUint32(o),o+=4,p="",j=0;4>j;j+=1)k=n.getInt8(o),p+=String.fromCharCode(k),o+=1;"ftyp"===p&&(e=o-8),"moov"===p&&(f=o-8),"moov"!==p&&(o+=q-8)}i=n.byteLength-o,"moov"!==p?(s.debug.log("Loading more bytes to find initialization."),b.range.start=0,b.range.end=b.bytesLoaded+b.bytesToLoad,l=new XMLHttpRequest,l.onloadend=function(){r||d.call(s,null,new Error("Error loading initialization."))},l.onload=function(){r=!0,b.bytesLoaded=b.range.end,c.call(s,l.response,function(a){d.call(s,a)})},l.onerror=function(){d.call(s,null,new Error("Error loading initialization."))},l.open("GET",s.tokenAuthentication.addTokenAsQueryArg(b.url)),l.responseType="arraybuffer",l.setRequestHeader("Range","bytes="+b.range.start+"-"+b.range.end),l=s.tokenAuthentication.setTokenInRequestHeader(l),l.send(null)):(g=void 0===e?f:e,h=f+q-1,m=g+"-"+h,s.debug.log("Found the initialization.  Range: "+m),d.call(s,m))},d=function(a){var b=new XMLHttpRequest,d=!0,e=this,f=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,g={url:f,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:b};e.debug.log("Start searching for initialization."),g.range.start=0,g.range.end=g.bytesToLoad,b.onload=function(){b.status<200||b.status>299||(d=!1,g.bytesLoaded=g.range.end,c.call(e,b.response,g,function(b){a.range=b,a.initialization=f,e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a)
}))},b.onloadend=b.onerror=function(){d&&(d=!1,e.errHandler.downloadError("initialization",g.url,b),e.notify(e.eventList.ENAME_INITIALIZATION_LOADED,a))},b.open("GET",e.tokenAuthentication.addTokenAsQueryArg(g.url)),b.responseType="arraybuffer",b.setRequestHeader("Range","bytes="+g.range.start+"-"+g.range.end),b=e.tokenAuthentication.setTokenInRequestHeader(b),b.send(null),e.debug.log("Perform init search: "+g.url)},e=function(a,c,d,g){var h,i,j,k,l,m,n,o,p,q=new DataView(a),r=new XMLHttpRequest,s=0,t="",u=0,v=!0,w=!1,x=this;for(x.debug.log("Searching for SIDX box."),x.debug.log(c.bytesLoaded+" bytes loaded.");"sidx"!==t&&s<q.byteLength;){for(u=q.getUint32(s),s+=4,t="",m=0;4>m;m+=1)n=q.getInt8(s),t+=String.fromCharCode(n),s+=1;"sidx"!==t&&(s+=u-8)}if(i=q.byteLength-s,"sidx"!==t)g.call(x);else if(u-8>i)x.debug.log("Found SIDX but we don't have all of it."),c.range.start=0,c.range.end=c.bytesLoaded+(u-i),r.onload=function(){r.status<200||r.status>299||(v=!1,c.bytesLoaded=c.range.end,e.call(x,r.response,c,d,g))},r.onloadend=r.onerror=function(){v&&(v=!1,x.errHandler.downloadError("SIDX",c.url,r),g.call(x))},r.open("GET",x.tokenAuthentication.addTokenAsQueryArg(c.url)),r.responseType="arraybuffer",r.setRequestHeader("Range","bytes="+c.range.start+"-"+c.range.end),r=x.tokenAuthentication.setTokenInRequestHeader(r),r.send(null);else if(c.range.start=s-8,c.range.end=c.range.start+u,x.debug.log("Found the SIDX box.  Start: "+c.range.start+" | End: "+c.range.end),j=new ArrayBuffer(c.range.end-c.range.start),l=new Uint8Array(j),k=new Uint8Array(a,c.range.start,c.range.end-c.range.start),l.set(k),o=this.parseSIDX.call(this,j,c.range.start),p=o.references,null!==p&&void 0!==p&&p.length>0&&(w=1===p[0].type),w){x.debug.log("Initiate multiple SIDX load.");var y,z,A,B,C,D=[],E=0,F=function(a){a?(D=D.concat(a),E+=1,E>=z&&g.call(x,D)):g.call(x)};for(y=0,z=p.length;z>y;y+=1)A=p[y].offset,B=p[y].offset+p[y].size-1,C=A+"-"+B,f.call(x,d,null,C,F)}else x.debug.log("Parsing segments from SIDX."),h=b.call(x,j,c.url,c.range.start),g.call(x,h)},f=function(a,c,d,f){var g,h,i=new XMLHttpRequest,j=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].BaseURL,k=!0,l=this,m={url:j,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:i};null===d?(l.debug.log("No known range for SIDX request."),m.searching=!0,m.range.start=0,m.range.end=m.bytesToLoad):(h=d.split("-"),m.range.start=parseFloat(h[0]),m.range.end=parseFloat(h[1])),i.onload=function(){i.status<200||i.status>299||(k=!1,m.searching?(m.bytesLoaded=m.range.end,e.call(l,i.response,m,a,function(b){b&&f.call(l,b,a,c)})):(g=b.call(l,i.response,m.url,m.range.start),f.call(l,g,a,c)))},i.onloadend=i.onerror=function(){k&&(k=!1,l.errHandler.downloadError("SIDX",m.url,i),f.call(l,null,a,c))},i.open("GET",l.tokenAuthentication.addTokenAsQueryArg(m.url)),i.responseType="arraybuffer",i.setRequestHeader("Range","bytes="+m.range.start+"-"+m.range.end),i=l.tokenAuthentication.setTokenInRequestHeader(i),i.send(null),l.debug.log("Perform SIDX load: "+m.url)},g=function(a,b,c){var d=this;a?d.notify(d.eventList.ENAME_SEGMENTS_LOADED,a,b,c):d.notify(d.eventList.ENAME_SEGMENTS_LOADED,null,b,c,new Error("error loading segments"))};return{debug:void 0,errHandler:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},loadSegments:function(a,b,c){f.call(this,a,b,c,g.bind(this))},loadInitialization:d,parseSegments:b,parseSIDX:a,findSIDX:e}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.DashAdapter=function(){"use strict";var a=[],b={},c=function(a,b){return b.getRepresentationForQuality(a.quality)},d=function(a){return b[a.streamInfo.id][a.index]},e=function(b){var c,d=a.length,e=0;for(e;d>e;e+=1)if(c=a[e],b.id===c.id)return c;return null},f=function(a){var b=new MediaPlayer.vo.TrackInfo,c=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index],d=this.manifestExt.getRepresentationFor(a.index,c);return b.id=a.id,b.quality=a.index,b.bandwidth=this.manifestExt.getBandwidth(d),b.DVRWindow=a.segmentAvailabilityRange,b.fragmentDuration=a.segmentDuration||(a.segments&&a.segments.length>0?a.segments[0].duration:0/0),b.MSETimeOffset=a.MSETimeOffset,b.useCalculatedLiveEdgeTime=a.useCalculatedLiveEdgeTime,b.mediaInfo=g.call(this,a.adaptation),b},g=function(a){var b=new MediaPlayer.vo.MediaInfo,c=this,d=a.period.mpd.manifest.Period_asArray[a.period.index].AdaptationSet_asArray[a.index];return b.id=a.id,b.index=a.index,b.type=a.type,b.streamInfo=h.call(this,a.period),b.trackCount=this.manifestExt.getRepresentationCount(d),b.lang=this.manifestExt.getLanguageForAdaptation(d),b.codec=this.manifestExt.getCodec(d),b.mimeType=this.manifestExt.getMimeType(d),b.contentProtection=this.manifestExt.getContentProtectionData(d),b.contentProtection&&b.contentProtection.forEach(function(a){a.KID=c.manifestExt.getKID(a)}),b.isText=this.manifestExt.getIsTextTrack(b.mimeType),b},h=function(a){var b=new MediaPlayer.vo.StreamInfo;return b.id=a.id,b.index=a.index,b.start=a.start,b.duration=a.duration,b.manifestInfo=i.call(this,a.mpd),b},i=function(a){var b=new MediaPlayer.vo.ManifestInfo,c=this.manifestModel.getValue();return b.DVRWindowSize=a.timeShiftBufferDepth,b.loadedTime=a.manifest.loadedTime,b.availableFrom=a.availabilityStartTime,b.minBufferTime=a.manifest.minBufferTime,b.maxFragmentDuration=a.maxSegmentDuration,b.duration=this.manifestExt.getDuration(c),b.isDynamic=this.manifestExt.getIsDynamic(c),b},j=function(a,c,d){var f,h=e(c),i=h.id,j=this.manifestExt.getAdaptationForType(a,c.index,d);return j?(f=this.manifestExt.getIndexForAdaptation(j,a,c.index),b[i]=b[i]||this.manifestExt.getAdaptationsForPeriod(a,h),g.call(this,b[i][f])):null},k=function(c){var d,e,f,g=[];if(!c)return null;for(d=this.manifestExt.getMpd(c),a=this.manifestExt.getRegularPeriods(c,d),b={},e=a.length,f=0;e>f;f+=1)g.push(h.call(this,a[f]));return g},l=function(a){var b=this.manifestExt.getMpd(a);return i.call(this,b)},m=function(a,b){var c=a.trackController.getRepresentationForQuality(b);return a.indexHandler.getInitRequest(c)},n=function(a,b){var d=c(b,a.trackController);return a.indexHandler.getNextSegmentRequest(d)},o=function(a,b,d,e){var f=c(b,a.trackController);return a.indexHandler.getSegmentRequestForTime(f,d,e)},p=function(a,b,d){var e=c(b,a.trackController),f=a.indexHandler.generateSegmentRequestForTime(e,d);return f},q=function(a){return a.indexHandler.getCurrentTime()},r=function(a,b){return a.indexHandler.setCurrentTime(b)},s=function(a){var b,c,f=e(a.getStreamInfo()),g=a.getMediaInfo(),h=d(g),i=this.manifestModel.getValue(),j=a.getType();b=g.id,c=b?this.manifestExt.getAdaptationForId(b,i,f.index):this.manifestExt.getAdaptationForIndex(g.index,i,f.index),a.setMediaInfo(g),a.trackController.updateData(c,h,j)},t=function(a,b){var c=a.getRepresentationForQuality(b);return c?f.call(this,c):null},u=function(a){var b=a.getCurrentRepresentation();return b?f.call(this,b):null},v=function(a,b,c){var d=new Dash.vo.Event,e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=c*g+h;return b[e]?(d.eventStream=b[e],d.eventStream.value=f,d.eventStream.timescale=g,d.duration=i,d.id=j,d.presentationTime=l,d.messageData=k,d.presentationTimeDelta=h,d):null},w=function(a,b){var f=this.manifestModel.getValue(),g=[];return a instanceof MediaPlayer.vo.StreamInfo?g=this.manifestExt.getEventsForPeriod(f,e(a)):a instanceof MediaPlayer.vo.MediaInfo?g=this.manifestExt.getEventStreamForAdaptationSet(f,d(a)):a instanceof MediaPlayer.vo.TrackInfo&&(g=this.manifestExt.getEventStreamForRepresentation(f,c(a,b.trackController))),g};return{system:void 0,manifestExt:void 0,manifestModel:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:f,convertDataToMedia:g,convertDataToStream:h,getDataForTrack:c,getDataForMedia:d,getDataForStream:e,getStreamsInfo:k,getManifestInfo:l,getMediaInfoForType:j,getCurrentTrackInfo:u,getTrackInfoForQuality:t,updateData:s,getInitRequest:m,getNextFragmentRequest:n,getFragmentRequestForTime:o,generateFragmentRequestForTime:p,getIndexHandlerTime:q,setIndexHandlerTime:r,getEventsFor:w,getEvent:v,reset:function(){a=[],b={}}}},Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter},Dash.dependencies.DashHandler=function(){"use strict";var a,b,c,d=-1,e=0,f=function(a,b){for(;a.length<b;)a="0"+a;return a},g=function(a,b,c){for(var d,e,g,h,i=0,j=0,k=b.length,l="%0",m=l.length;;){if(i=a.indexOf("$"+b),0>i)return a;if(j=a.indexOf("$",i+k),0>j)return a;if(d=a.indexOf(l,i+k),d>i&&j>d)switch(e=a.charAt(j-1),g=parseInt(a.substring(d+m,j-1),10),e){case"d":case"i":case"u":h=f(c.toString(),g);break;case"x":h=f(c.toString(16),g);break;case"X":h=f(c.toString(16),g).toUpperCase();break;case"o":h=f(c.toString(8),g);break;default:return this.debug.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),a}else h=c;a=a.substring(0,i)+h+a.substring(j+1)}},h=function(a){return a.split("$$").join("$")},i=function(a,b){if(null===b||-1===a.indexOf("$RepresentationID$"))return a;var c=b.toString();return a.split("$RepresentationID$").join(c)},j=function(a,b){return a.representation.startNumber+b},k=function(a,b){var c,d=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].BaseURL;return c=a===d?a:-1!==a.indexOf("http://")?a:d+a},l=function(a,c){var d,e,f=this,g=new MediaPlayer.vo.FragmentRequest;return d=a.adaptation.period,g.mediaType=c,g.type="Initialization Segment",g.url=k(a.initialization,a),g.range=a.range,e=d.start,g.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(e,a.adaptation.period.mpd,b),g.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(e+d.duration,d.mpd,b),g.quality=a.index,g},m=function(a){var b,d=this;return a?b=l.call(d,a,c):null},n=function(a){var c,e,f,g=a.adaptation.period,h=!1;return b?h=!1:0>d?h=!1:d<a.availableSegmentsNumber?(e=A(d,a),e&&(f=e.presentationStartTime-g.start,c=a.adaptation.period.duration,this.debug.log(a.segmentInfoType+": "+f+" / "+c),h=f>=c)):h=!0,h},o=function(a,c){var d,e,f,g,h=this;return e=a.segmentDuration,f=a.adaptation.period.start+c*e,g=f+e,d=new Dash.vo.Segment,d.representation=a,d.duration=e,d.presentationStartTime=f,d.mediaStartTime=h.timelineConverter.calcMediaTimeFromPresentationTime(d.presentationStartTime,a),d.availabilityStartTime=h.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(d.presentationStartTime,a.adaptation.period.mpd,b),d.availabilityEndTime=h.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(g,a.adaptation.period.mpd,b),d.wallStartTime=h.timelineConverter.calcWallTimeForSegment(d,b),d.replacementNumber=j(d,c),d.availabilityIdx=c,d},p=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this,r=b.adaptation.period.mpd.manifest.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].SegmentTemplate,u=r.SegmentTimeline,v=b.availableSegmentsNumber>0,w=10,x=[],y=0,z=0,A=-1,B=function(a){return t.call(q,b,y,a.d,p,r.media,a.mediaRange,A)};for(p=b.timescale,c=u.S_asArray,k=s.call(q,b),k?(n=k.start,o=k.end):m=q.timelineConverter.calcMediaTimeFromPresentationTime(a||0,b),e=0,f=c.length;f>e;e+=1)if(d=c[e],h=0,d.hasOwnProperty("r")&&(h=d.r),d.hasOwnProperty("t")&&(y=d.t,z=y/p),0>h&&(j=c[e+1],j&&j.hasOwnProperty("t")?i=j.t/p:(i=q.timelineConverter.calcMediaTimeFromPresentationTime(b.segmentAvailabilityRange.end,b),b.segmentDuration=d.d/p),h=Math.ceil((i-z)/(d.d/p))-1),l){if(v)break;A+=h+1}else for(g=0;h>=g;g+=1){if(A+=1,k){if(A>o){if(l=!0,v)break;continue}A>=n&&x.push(B.call(q,d))}else{if(x.length>w){if(l=!0,v)break;continue}z>=m-d.d/p&&x.push(B.call(q,d))}y+=d.d,z=y/p}if(!v){var C,D,E=c[0];C=void 0===E.t?0:q.timelineConverter.calcPresentationTimeFromMediaTime(E.t/p,b),D=q.timelineConverter.calcPresentationTimeFromMediaTime((y-d.d)/p,b),b.segmentAvailabilityRange={start:C,end:D},b.availableSegmentsNumber=A+1}return x},q=function(a){var b,c,d,e,f,h=[],i=this,j=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentTemplate,k=a.segmentDuration,l=a.segmentAvailabilityRange,m=null,n=null;for(f=a.startNumber,b=r.call(i,a),d=b.start,e=b.end,c=d;e>=c;c+=1)m=o.call(i,a,c),m.replacementTime=(f+c-1)*a.segmentDuration,n=j.media,n=g(n,"Number",m.replacementNumber),n=g(n,"Time",m.replacementTime),m.media=n,h.push(m),m=null;return a.availableSegmentsNumber=Math.ceil((l.end-l.start)/k),h},r=function(c){var e,f,g,h=this,i=c.segmentDuration,j=c.adaptation.period.mpd.manifest.minBufferTime,k=c.segmentAvailabilityRange,l={start:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,k.start),end:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,k.end)},m=0/0,n=null,o=c.segments,p=2*i,q=Math.max(2*j,10*i);return l||(l=h.timelineConverter.calcSegmentAvailabilityRange(c,b)),b&&!h.timelineConverter.isTimeSyncCompleted()?(e=Math.floor(l.start/i),f=Math.floor(l.end/i),g={start:e,end:f}):(o?(n=A(d,c),m=n?h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,n.presentationStartTime):d>0?d*i:h.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(c,a||o[0].presentationStartTime)):m=d>0?d*i:b?l.end:l.start,e=Math.floor(Math.max(m-p,l.start)/i),f=Math.floor(Math.min(e+q/i,l.end/i)),g={start:e,end:f})},s=function(){var c,e,f,g=2,h=10,i=0,j=Number.POSITIVE_INFINITY;return b&&!this.timelineConverter.isTimeSyncCompleted()?f={start:i,end:j}:!b&&a||0>d?null:(c=Math.max(d-g,i),e=Math.min(d+h,j),f={start:c,end:e})},t=function(a,c,d,e,f,h,i){var k,l,m,n=this,o=c/e,p=Math.min(d/e,a.adaptation.period.mpd.maxSegmentDuration);return k=n.timelineConverter.calcPresentationTimeFromMediaTime(o,a),l=k+p,m=new Dash.vo.Segment,m.representation=a,m.duration=p,m.mediaStartTime=o,m.presentationStartTime=k,m.availabilityStartTime=a.adaptation.period.mpd.manifest.loadedTime,m.availabilityEndTime=n.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(l,a.adaptation.period.mpd,b),m.wallStartTime=n.timelineConverter.calcWallTimeForSegment(m,b),m.replacementTime=c,m.replacementNumber=j(m,i),f=g(f,"Number",m.replacementNumber),f=g(f,"Time",m.replacementTime),m.media=f,m.mediaRange=h,m.availabilityIdx=i,m},u=function(a){var b,c,d,e,f,g,h,i=this,j=[],k=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].SegmentList,l=k.SegmentURL_asArray.length;for(h=a.startNumber,e=r.call(i,a),f=Math.max(e.start,0),g=Math.min(e.end,k.SegmentURL_asArray.length-1),b=f;g>=b;b+=1)d=k.SegmentURL_asArray[b],c=o.call(i,a,b),c.replacementTime=(h+b-1)*a.segmentDuration,c.media=d.media,c.mediaRange=d.mediaRange,c.index=d.index,c.indexRange=d.indexRange,j.push(c),c=null;return a.availableSegmentsNumber=l,j},v=function(a){var b,c=this,d=a.segmentInfoType;return"SegmentBase"!==d&&"BaseURL"!==d&&B.call(c,a)?("SegmentTimeline"===d?b=p.call(c,a):"SegmentTemplate"===d?b=q.call(c,a):"SegmentList"===d&&(b=u.call(c,a)),w.call(c,a,b)):b=a.segments,b},w=function(a,c){var d;if(a.segments=c,d=c.length-1,b&&isNaN(this.timelineConverter.getExpectedLiveEdge())){var e=c[d].presentationStartTime,f=this.metricsModel.getMetricsFor("stream");this.timelineConverter.setExpectedLiveEdge(e),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(f),{presentationStartTime:e})}},x=function(a){var b=this;if(!a)throw new Error("no representation");return a.segments=null,v.call(b,a),a},y=function(a,e){var f=this,g=a.initialization,h="BaseURL"!==a.segmentInfoType&&"SegmentBase"!==a.segmentInfoType;a.segmentAvailabilityRange=f.timelineConverter.calcSegmentAvailabilityRange(a,b),e||(d=-1),x.call(f,a),g||f.baseURLExt.loadInitialization(a),h||f.baseURLExt.loadSegments(a,c,a.indexRange),g&&h&&f.notify(f.eventList.ENAME_REPRESENTATION_UPDATED,a)},z=function(a,b){var c,d,e,f,g=b.segments,h=g?g.length-1:null,i=-1;if(g&&g.length>0)for(f=h;f>=0;f--)if(c=g[f],d=c.presentationStartTime,e=c.duration,a+Dash.dependencies.DashHandler.EPSILON>=d&&a-Dash.dependencies.DashHandler.EPSILON<=d+e){i=c.availabilityIdx;break}return i},A=function(a,b){if(!b||!b.segments)return null;var c,d,e=b.segments.length;for(d=0;e>d;d+=1)if(c=b.segments[d],c.availabilityIdx===a)return c;return null},B=function(a){var b,c,e=!1,f=a.segments;return f?(c=f[0].availabilityIdx,b=f[f.length-1].availabilityIdx,e=c>d||d>b):e=!0,e},C=function(a){if(null===a||void 0===a)return null;var b,d=new MediaPlayer.vo.FragmentRequest,e=a.representation,f=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].bandwidth;return b=k(a.media,e),b=g(b,"Number",a.replacementNumber),b=g(b,"Time",a.replacementTime),b=g(b,"Bandwidth",f),b=i(b,e.id),b=h(b),d.mediaType=c,d.type="Media Segment",d.url=b,d.range=a.mediaRange,d.startTime=a.presentationStartTime,d.duration=a.duration,d.timescale=e.timescale,d.availabilityStartTime=a.availabilityStartTime,d.availabilityEndTime=a.availabilityEndTime,d.wallStartTime=a.wallStartTime,d.quality=e.index,d.index=a.availabilityIdx,d},D=function(b,e,f){var g,h,i,j=d,k=this;return b?(a=e,k.debug.log("Getting the request for time: "+e),d=z.call(k,e,b),v.call(k,b),0>d&&(d=z.call(k,e,b)),k.debug.log("Index for time "+e+" is "+d),i=n.call(k,b),i?(g=new MediaPlayer.vo.FragmentRequest,g.action=g.ACTION_COMPLETE,g.index=d,g.mediaType=c,k.debug.log("Signal complete."),k.debug.log(g)):(h=A(d,b),g=C.call(k,h)),f&&(d=j),g):null},E=function(a,b){var c=(a.segmentAvailabilityRange.end-a.segmentAvailabilityRange.start)/2;return a.segments=null,a.segmentAvailabilityRange={start:b-c,end:b+c},D.call(this,a,b,!1)},F=function(b){var e,f,g,h,i=this;if(!b)return null;if(-1===d)throw"You must call getSegmentRequestForTime first.";return a=null,d+=1,h=d,g=n.call(i,b),g?(e=new MediaPlayer.vo.FragmentRequest,e.action=e.ACTION_COMPLETE,e.index=h,e.mediaType=c,i.debug.log("Signal complete.")):(v.call(i,b),f=A(h,b),e=C.call(i,f)),e},G=function(a,b){b.segments&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,b)},H=function(a,b,d,e,f){if(!f&&c===e){var g,h,i,j,k=this,l=[],m=0;for(g=0,h=b.length;h>g;g+=1)i=b[g],j=t.call(k,d,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,m),l.push(j),j=null,m+=1;d.segmentAvailabilityRange={start:l[0].presentationStartTime,end:l[h-1].presentationStartTime},d.availableSegmentsNumber=h,w.call(k,d,l),d.initialization&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,d)}};return{debug:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_REPRESENTATION_UPDATED:"representationUpdated"},setup:function(){this.initializationLoaded=G,this.segmentsLoaded=H},initialize:function(a){this.subscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,a.trackController),c=a.getType(),b=a.isDynamic(),this.streamProcessor=a},getType:function(){return c},setType:function(a){c=a},getIsDynamic:function(){return b},setIsDynamic:function(a){b=a},setCurrentTime:function(a){e=a},getCurrentTime:function(){return e},reset:function(){e=0,a=void 0,d=-1,this.unsubscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.trackController)},getInitRequest:m,getSegmentRequestForTime:D,getNextSegmentRequest:F,generateSegmentRequestForTime:E,updateRepresentation:y}},Dash.dependencies.DashHandler.EPSILON=.003,Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(a,b){"use strict";var c,d,e,f=a.ContentComponent_asArray,g=new RegExp("text"!==b?b:"(vtt|ttml)"),h=!1,i=!1;if(f)for(c=0,d=f.length;d>c;c+=1)f[c].contentType===b&&(h=!0,i=!0);if(a.hasOwnProperty("mimeType")&&(h=g.test(a.mimeType),i=!0),!i)for(c=0,d=a.Representation_asArray.length;!i&&d>c;)e=a.Representation_asArray[c],e.hasOwnProperty("mimeType")&&(h=g.test(e.mimeType),i=!0),c+=1;return h},getIsAudio:function(a){"use strict";return this.getIsTypeOf(a,"audio")},getIsVideo:function(a){"use strict";return this.getIsTypeOf(a,"video")},getIsText:function(a){"use strict";return this.getIsTypeOf(a,"text")},getIsTextTrack:function(a){return"text/vtt"===a||"application/ttml+xml"===a},getLanguageForAdaptation:function(a){var b="";return a.hasOwnProperty("lang")&&(b=a.lang),b},getIsMain:function(){"use strict";return!1},processAdaptation:function(a){"use strict";return void 0!==a.Representation_asArray&&null!==a.Representation_asArray&&a.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),a},getAdaptationForId:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d].hasOwnProperty("id")&&f[d].id===a)return f[d];return null},getAdaptationForIndex:function(a,b,c){"use strict";var d=b.Period_asArray[c].AdaptationSet_asArray;return d[a]},getIndexForAdaptation:function(a,b,c){"use strict";var d,e,f=b.Period_asArray[c].AdaptationSet_asArray;for(d=0,e=f.length;e>d;d+=1)if(f[d]===a)return d;return-1},getAdaptationsForType:function(a,b,c){"use strict";var d,e,f=this,g=a.Period_asArray[b].AdaptationSet_asArray,h=[];for(d=0,e=g.length;e>d;d+=1)this.getIsTypeOf(g[d],c)&&h.push(f.processAdaptation(g[d]));return h},getAdaptationForType:function(a,b,c){"use strict";var d,e,f,g=this;if(f=this.getAdaptationsForType(a,b,c),!f||0===f.length)return null;for(d=0,e=f.length;e>d;d+=1)if(g.getIsMain(f[d]))return f[d];return f[0]},getCodec:function(a){"use strict";var b=a.Representation_asArray[0],c=b.mimeType+';codecs="'+b.codecs+'"';return c},getMimeType:function(a){"use strict";return a.Representation_asArray[0].mimeType},getKID:function(a){"use strict";return a&&a.hasOwnProperty("cenc:default_KID")?a["cenc:default_KID"]:null},getContentProtectionData:function(a){"use strict";return a&&a.hasOwnProperty("ContentProtection_asArray")&&0!==a.ContentProtection_asArray.length?a.ContentProtection_asArray:null},getIsDynamic:function(a){"use strict";var b=!1,c="dynamic";return a.hasOwnProperty("type")&&(b=a.type===c),b},getIsDVR:function(a){"use strict";var b,c,d=this.getIsDynamic(a);return b=!isNaN(a.timeShiftBufferDepth),c=d&&b},getIsOnDemand:function(a){"use strict";var b=!1;return a.profiles&&a.profiles.length>0&&(b=-1!==a.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),b},getDuration:function(a){var b;return b=a.hasOwnProperty("mediaPresentationDuration")?a.mediaPresentationDuration:Number.POSITIVE_INFINITY},getBandwidth:function(a){"use strict";return a.bandwidth},getRefreshDelay:function(a){"use strict";var b=0/0,c=2;return a.hasOwnProperty("minimumUpdatePeriod")&&(b=Math.max(parseFloat(a.minimumUpdatePeriod),c)),b},getRepresentationCount:function(a){"use strict";return a.Representation_asArray.length},getRepresentationFor:function(a,b){"use strict";return b.Representation_asArray[a]},getRepresentationsForAdaptation:function(a,b){for(var c,d,e,f,g,h=this,i=h.processAdaptation(a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index]),j=[],k=0;k<i.Representation_asArray.length;k+=1)f=i.Representation_asArray[k],c=new Dash.vo.Representation,c.index=k,c.adaptation=b,f.hasOwnProperty("id")&&(c.id=f.id),f.hasOwnProperty("SegmentBase")?(e=f.SegmentBase,c.segmentInfoType="SegmentBase"):f.hasOwnProperty("SegmentList")?(e=f.SegmentList,c.segmentInfoType="SegmentList",c.useCalculatedLiveEdgeTime=!0):f.hasOwnProperty("SegmentTemplate")?(e=f.SegmentTemplate,e.hasOwnProperty("SegmentTimeline")?(c.segmentInfoType="SegmentTimeline",g=e.SegmentTimeline.S_asArray[e.SegmentTimeline.S_asArray.length-1],(!g.hasOwnProperty("r")||g.r>=0)&&(c.useCalculatedLiveEdgeTime=!0)):c.segmentInfoType="SegmentTemplate",e.hasOwnProperty("initialization")&&(c.initialization=e.initialization.split("$Bandwidth$").join(f.bandwidth).split("$RepresentationID$").join(f.id))):(e=f.BaseURL,c.segmentInfoType="BaseURL"),e.hasOwnProperty("Initialization")?(d=e.Initialization,d.hasOwnProperty("sourceURL")?c.initialization=d.sourceURL:d.hasOwnProperty("range")&&(c.initialization=f.BaseURL,c.range=d.range)):f.hasOwnProperty("mimeType")&&h.getIsTextTrack(f.mimeType)&&(c.initialization=f.BaseURL,c.range=0),e.hasOwnProperty("timescale")&&(c.timescale=e.timescale),e.hasOwnProperty("duration")&&(c.segmentDuration=e.duration/c.timescale),e.hasOwnProperty("startNumber")&&(c.startNumber=e.startNumber),e.hasOwnProperty("indexRange")&&(c.indexRange=e.indexRange),e.hasOwnProperty("presentationTimeOffset")&&(c.presentationTimeOffset=e.presentationTimeOffset/c.timescale),c.MSETimeOffset=h.timelineConverter.calcMSETimeOffset(c),j.push(c);return j},getAdaptationsForPeriod:function(a,b){for(var c,d,e=a.Period_asArray[b.index],f=[],g=0;g<e.AdaptationSet_asArray.length;g+=1)d=e.AdaptationSet_asArray[g],c=new Dash.vo.AdaptationSet,d.hasOwnProperty("id")&&(c.id=d.id),c.index=g,c.period=b,c.type=this.getIsAudio(d)?"audio":this.getIsVideo(d)?"video":"text",f.push(c);return f},getRegularPeriods:function(a,b){var c,d,e=this,f=[],g=e.getIsDynamic(a),h=null,i=null,j=null,k=null;for(c=0,d=a.Period_asArray.length;d>c;c+=1)i=a.Period_asArray[c],i.hasOwnProperty("start")?(k=new Dash.vo.Period,k.start=i.start):null!==h&&i.hasOwnProperty("duration")?(k=new Dash.vo.Period,k.start=j.start+j.duration,k.duration=i.duration):0!==c||g||(k=new Dash.vo.Period,k.start=0),null!==j&&isNaN(j.duration)&&(j.duration=k.start-j.start),null!==k&&i.hasOwnProperty("id")&&(k.id=i.id),null!==k&&i.hasOwnProperty("duration")&&(k.duration=i.duration),null!==k&&(k.index=c,k.mpd=b,f.push(k)),h=i,i=null,j=k,k=null;return 0===f.length?f:(b.checkTime=e.getCheckTime(a,f[0]),null!==j&&isNaN(j.duration)&&(j.duration=e.getEndTimeForLastPeriod(b)-j.start),f)},getMpd:function(a){var b=new Dash.vo.Mpd;return b.manifest=a,b.availabilityStartTime=new Date(a.hasOwnProperty("availabilityStartTime")?a.availabilityStartTime.getTime():a.loadedTime.getTime()),a.hasOwnProperty("availabilityEndTime")&&(b.availabilityEndTime=new Date(a.availabilityEndTime.getTime())),a.hasOwnProperty("suggestedPresentationDelay")&&(b.suggestedPresentationDelay=a.suggestedPresentationDelay),a.hasOwnProperty("timeShiftBufferDepth")&&(b.timeShiftBufferDepth=a.timeShiftBufferDepth),a.hasOwnProperty("maxSegmentDuration")&&(b.maxSegmentDuration=a.maxSegmentDuration),b},getFetchTime:function(a,b){var c=this.timelineConverter.calcPresentationTimeFromWallTime(a.loadedTime,b);return c},getCheckTime:function(a,b){var c,d=this,e=0/0;return a.hasOwnProperty("minimumUpdatePeriod")&&(c=d.getFetchTime(a,b),e=c+a.minimumUpdatePeriod),e},getEndTimeForLastPeriod:function(a){var b;if(a.manifest.mediaPresentationDuration)b=a.manifest.mediaPresentationDuration;else{if(isNaN(a.checkTime))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");b=a.checkTime}return b},getEventsForPeriod:function(a,b){var c=a.Period_asArray,d=c[b.index].EventStream_asArray,e=[];if(d)for(var f=0;f<d.length;f+=1){var g=new Dash.vo.EventStream;if(g.period=b,g.timescale=1,!d[f].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";g.schemeIdUri=d[f].schemeIdUri,d[f].hasOwnProperty("timescale")&&(g.timescale=d[f].timescale),d[f].hasOwnProperty("value")&&(g.value=d[f].value);for(var h=0;h<d[f].Event_asArray.length;h+=1){var i=new Dash.vo.Event;i.presentationTime=0,i.eventStream=g,d[f].Event_asArray[h].hasOwnProperty("presentationTime")&&(i.presentationTime=d[f].Event_asArray[h].presentationTime),d[f].Event_asArray[h].hasOwnProperty("duration")&&(i.duration=d[f].Event_asArray[h].duration),d[f].Event_asArray[h].hasOwnProperty("id")&&(i.id=d[f].Event_asArray[h].id),e.push(i)}}return e},getEventStreamForAdaptationSet:function(a,b){var c=[],d=a.Period_asArray[b.period.index].AdaptationSet_asArray[b.index].InbandEventStream_asArray;if(d)for(var e=0;e<d.length;e+=1){var f=new Dash.vo.EventStream;if(f.timescale=1,!d[e].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";f.schemeIdUri=d[e].schemeIdUri,d[e].hasOwnProperty("timescale")&&(f.timescale=d[e].timescale),d[e].hasOwnProperty("value")&&(f.value=d[e].value),c.push(f)}return c},getEventStreamForRepresentation:function(a,b){var c=[],d=a.Period_asArray[b.adaptation.period.index].AdaptationSet_asArray[b.adaptation.index].Representation_asArray[b.index].InbandEventStream_asArray;if(d)for(var e=0;e<d.length;e++){var f=new Dash.vo.EventStream;if(f.timescale=1,f.representation=b,!d[e].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";f.schemeIdUri=d[e].schemeIdUri,d[e].hasOwnProperty("timescale")&&(f.timescale=d[e].timescale),d[e].hasOwnProperty("value")&&(f.value=d[e].value),c.push(f)}return c}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var a=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return j;return-1},b=function(a,b){var c,d,e,f,g,h,i,j;for(h=0;h<a.length;h+=1)for(c=a[h],e=c.AdaptationSet_asArray,i=0;i<e.length;i+=1)for(d=e[i],g=d.Representation_asArray,j=0;j<g.length;j+=1)if(f=g[j],b===f.id)return f;return null},c=function(a,b){return this.manifestExt.getIsTypeOf(a,b)},d=function(a,b){var d,e,f,g,h,i;for(h=0;h<a.length;h+=1)for(d=a[h],f=d.AdaptationSet_asArray,i=0;i<f.length;i+=1)if(e=f[i],g=e.Representation_asArray,c.call(this,e,b))return g.length;return-1},e=function(a){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=b.call(d,f,a),null===c?null:c.bandwidth},f=function(b){var c,d=this,e=d.manifestModel.getValue(),f=e.Period_asArray;return c=a.call(d,f,b)},g=function(a){var b,c=this,e=c.manifestModel.getValue(),f=e.Period_asArray;return b=d.call(this,f,a)},h=function(a){if(null===a)return null;var b,c,d,e=a.RepSwitchList;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},i=function(a){if(null===a)return null;var b,c,d,e=a.BufferLevel;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},j=function(a){if(null===a)return null;var b,c,d=a.PlayList;return null===d||d.length<=0?null:(b=d[d.length-1].trace,null===b||b.length<=0?null:c=b[b.length-1].playbackspeed)},k=function(a){if(null===a)return null;var b,c,d=a.HttpList,e=null;if(null===d||d.length<=0)return null;for(b=d.length,c=b-1;c>0;){if(d[c].responsecode){e=d[c];break}c-=1}return e},l=function(a){return null===a?[]:a.HttpList?a.HttpList:[]},m=function(a){if(null===a)return null;var b,c,d,e=a.DroppedFrames;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},n=function(a){if(null===a)return null;var b,c,d,e=a.SchedulingInfo;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},o=function(a){if(null===a)return null;var b,c,d,e=a.ManifestUpdate;return null===e||e.length<=0?null:(b=e.length,c=b-1,d=e[c])},p=function(a){if(null===a)return null;var b,c=a.DVRInfo,d=null;return null===c||c.length<=0?null:(b=c.length-1,d=c[b])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:e,getIndexForRepresentation:f,getMaxIndexForBufferType:g,getCurrentRepresentationSwitch:h,getCurrentBufferLevel:i,getCurrentPlaybackRate:j,getCurrentHttpRequest:k,getHttpRequests:l,getCurrentDroppedFrames:m,getCurrentSchedulingInfo:n,getCurrentDVRInfo:p,getCurrentManifestUpdate:o}
},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.DashParser=function(){"use strict";var a=31536e3,b=2592e3,c=86400,d=3600,e=60,f=60,g=1e3,h=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,i=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,j=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,k=[{type:"duration",test:function(a){return h.test(a)},converter:function(f){var g=h.exec(f);return parseFloat(g[2]||0)*a+parseFloat(g[4]||0)*b+parseFloat(g[6]||0)*c+parseFloat(g[8]||0)*d+parseFloat(g[10]||0)*e+parseFloat(g[12]||0)}},{type:"datetime",test:function(a){return i.test(a)},converter:function(a){var b,c=i.exec(a);if(b=Date.UTC(parseInt(c[1],10),parseInt(c[2],10)-1,parseInt(c[3],10),parseInt(c[4],10),parseInt(c[5],10),c[6]&&parseInt(c[6],10)||0,c[7]&&parseFloat(c[7])*g||0),c[9]&&c[10]){var d=parseInt(c[9],10)*f+parseInt(c[10],10);b+=("+"===c[8]?-1:1)*d*e*g}return new Date(b)}},{type:"numeric",test:function(a){return j.test(a)},converter:function(a){return parseFloat(a)}}],l=function(){var a,b,c,d;return d=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],a={},a.name="AdaptationSet",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="Representation",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="SubRepresentation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},m=function(){var a,b,c,d;return d=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],a={},a.name="Period",a.isRoot=!1,a.isArray=!0,a.parent=null,a.children=[],a.properties=d,b={},b.name="AdaptationSet",b.isRoot=!1,b.isArray=!0,b.parent=a,b.children=[],b.properties=d,a.children.push(b),c={},c.name="Representation",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=d,b.children.push(c),a},n=function(){var a,b,c,d,e;return e=[{name:"BaseURL",merge:!0,mergeFunction:function(a,b){var c;return c=0===b.indexOf("http://")?b:a+b}}],a={},a.name="mpd",a.isRoot=!0,a.isArray=!0,a.parent=null,a.children=[],a.properties=e,b={},b.name="Period",b.isRoot=!1,b.isArray=!0,b.parent=null,b.children=[],b.properties=e,a.children.push(b),c={},c.name="AdaptationSet",c.isRoot=!1,c.isArray=!0,c.parent=b,c.children=[],c.properties=e,b.children.push(c),d={},d.name="Representation",d.isRoot=!1,d.isArray=!0,d.parent=c,d.children=[],d.properties=e,c.children.push(d),a},o=function(){var a=[];return a.push(l()),a.push(m()),a.push(n()),a},p=function(a,b){var c,d=new X2JS(k,"",!0),e=new ObjectIron(o()),f=new Date,g=null,h=null;try{c=d.xml_str2json(a),g=new Date,c.hasOwnProperty("BaseURL")?(c.BaseURL=c.BaseURL_asArray[0],0!==c.BaseURL.toString().indexOf("http")&&(c.BaseURL=b+c.BaseURL)):c.BaseURL=b,e.run(c),h=new Date,this.debug.log("Parsing complete: ( xml2json: "+(g.getTime()-f.getTime())+"ms, objectiron: "+(h.getTime()-g.getTime())+"ms, total: "+(h.getTime()-f.getTime())/1e3+"s)")}catch(i){return this.errHandler.manifestError("parsing the manifest failed","parse",a),null}return c};return{debug:void 0,errHandler:void 0,parse:p}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.FragmentExtensions=function(){"use strict";var a=function(a){for(var b,c,d,e,f,g,h=new DataView(a),i=0;"tfdt"!==e&&i<h.byteLength;){for(d=h.getUint32(i),i+=4,e="",f=0;4>f;f+=1)g=h.getInt8(i),e+=String.fromCharCode(g),i+=1;"moof"!==e&&"traf"!==e&&"tfdt"!==e&&(i+=d-8)}if(i===h.byteLength)throw"Error finding live offset.";return c=h.getUint8(i),this.debug.log("position: "+i),0===c?(i+=4,b=h.getUint32(i,!1)):(i+=d-16,b=utils.Math.to64BitNumber(h.getUint32(i+4,!1),h.getUint32(i,!1))),{version:c,base_media_decode_time:b}},b=function(a){for(var b,c,d,e,f,g,h,i=new DataView(a),j=0;"sidx"!==f&&j<i.byteLength;){for(g=i.getUint32(j),j+=4,f="",e=0;4>e;e+=1)h=i.getInt8(j),f+=String.fromCharCode(h),j+=1;"moof"!==f&&"traf"!==f&&"sidx"!==f?j+=g-8:"sidx"===f&&(j-=8)}return b=i.getUint8(j+8),j+=12,c=i.getUint32(j+4,!1),j+=8,d=0===b?i.getUint32(j,!1):utils.Math.to64BitNumber(i.getUint32(j+4,!1),i.getUint32(j,!1)),{earliestPresentationTime:d,timescale:c}},c=function(b){var c,d,e,f=this,g=new XMLHttpRequest,h=!1;c=b,g.onloadend=function(){h||(d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d)))},g.onload=function(){h=!0,e=a(g.response),f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,e)},g.onerror=function(){d="Error loading fragment: "+c,f.notify(f.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(d))},g.responseType="arraybuffer",g.open("GET",c),g.send(null)};return{debug:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},loadFragment:c,parseTFDT:a,parseSIDX:b}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.RepresentationController=function(){"use strict";var a,b=null,c=-1,d=!0,e=[],f=function(c,f,i){var k=this;if(d=!0,k.notify(k.eventList.ENAME_DATA_UPDATE_STARTED),e=j.call(k,f),a=h.call(k,k.abrController.getQualityFor(i)),b=c,"video"!==i&&"audio"!==i)return k.notify(k.eventList.ENAME_DATA_UPDATE_COMPLETED,b,a),void g.call(k);for(var l=0;l<e.length;l+=1)k.indexHandler.updateRepresentation(e[l],!0)},g=function(){var a=new Date,b=this.getCurrentRepresentation(),c=this.streamProcessor.playbackController.getTime();this.metricsModel.addTrackSwitch(b.adaptation.type,a,c,b.id)},h=function(a){return e[a]},i=function(){for(var a=0,b=e.length;b>a;a+=1)if(null===e[a].segmentAvailabilityRange||null===e[a].initialization)return!1;return!0},j=function(a){var d,e=this,f=e.manifestModel.getValue();return c=e.manifestExt.getIndexForAdaptation(b,f,a.period.index),d=e.manifestExt.getRepresentationsForAdaptation(f,a)},k=function(a){for(var b,c=this,d=0,f=e.length;f>d;d+=1)b=e[d],b.segmentAvailabilityRange=c.timelineConverter.calcSegmentAvailabilityRange(b,a)},l=function(c,e){for(var f,h=this,j=e,k=h.metricsModel.getMetricsFor("stream"),l=h.metricsExt.getCurrentManifestUpdate(k),m=!1,n=0;n<l.trackInfo.length;n+=1)if(f=l.trackInfo[n],f.index===j.index&&f.mediaType===h.streamProcessor.getType()){m=!0;break}m||h.metricsModel.addManifestUpdateTrackInfo(l,j.id,j.index,j.adaptation.period.index,h.streamProcessor.getType(),j.presentationTimeOffset,j.startNumber,j.segmentInfoType),i()&&(d=!1,h.metricsModel.updateManifestUpdateInfo(l,{latency:a.segmentAvailabilityRange.end-h.streamProcessor.playbackController.getTime()}),this.notify(this.eventList.ENAME_DATA_UPDATE_COMPLETED,b,a),g.call(h))},m=function(a,b){k.call(this,b)},n=function(){k.call(this,!0),this.indexHandler.updateRepresentation(a,!1)},o=function(b){var c=b.streamProcessor,d=this,e=d.timelineConverter.calcSegmentAvailabilityRange(a,c.isDynamic());d.metricsModel.addDVRInfo(c.getType(),c.playbackController.getTime(),c.getStreamInfo().manifestInfo,e)},p=function(b,c,d,e){var f=this;c===f.streamProcessor.getType()&&(a=f.getRepresentationForQuality(e),g.call(f))};return{system:void 0,debug:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},setup:function(){this.qualityChanged=p,this.representationUpdated=l,this.wallclockTimeUpdated=m,this.liveEdgeFound=n,this.bufferLevelUpdated=o},initialize:function(a){this.streamProcessor=a,this.indexHandler=a.indexHandler},getData:function(){return b},getDataIndex:function(){return c},isUpdating:function(){return d},updateData:f,getRepresentationForQuality:h,getCurrentRepresentation:function(){return a}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.TimelineConverter=function(){"use strict";var a=0,b=!1,c=0/0,d=function(b,c,d,e){var f=0/0;return f=e?d&&c.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(c.availabilityStartTime.getTime()+1e3*(b+c.timeShiftBufferDepth)):c.availabilityEndTime:d?new Date(c.availabilityStartTime.getTime()+1e3*(b-a)):c.availabilityStartTime},e=function(a,b,c){return d.call(this,a,b,c)},f=function(a,b,c){return d.call(this,a,b,c,!0)},g=function(b,c){return(b.getTime()-c.mpd.availabilityStartTime.getTime()+1e3*a)/1e3},h=function(a,b){var c=b.presentationTimeOffset;return a-c},i=function(a,b){var c=b.presentationTimeOffset;return c+a},j=function(a,b){var c,d,e;return b&&(c=a.representation.adaptation.period.mpd.suggestedPresentationDelay,d=a.presentationStartTime+c,e=new Date(a.availabilityStartTime.getTime()+1e3*d)),e},k=function(a,c){var d,e,f=a.segmentDuration,h=a.adaptation.period.start,i=h+a.adaptation.period.duration,j={start:h,end:i};return c?b&&!isNaN(f)||!a.segmentAvailabilityRange?(d=a.adaptation.period.mpd.checkTime,e=g(new Date((new Date).getTime()),a.adaptation.period),h=Math.max(e-a.adaptation.period.mpd.timeShiftBufferDepth,0),i=isNaN(d)?e:Math.min(d,e),j={start:h,end:i}):a.segmentAvailabilityRange:j},l=function(a,b){var c=a.adaptation.period.start;return b-c},m=function(a,b){var c=a.adaptation.period.start;return b+c},n=function(d,e,f){b||(a=e-(c+f),b=!0)},o=function(a){var b=a.presentationTimeOffset;return-b},p=function(){a=0,b=!1,c=0/0};return{notifier:void 0,uriQueryFragModel:void 0,setup:function(){this.liveEdgeFound=n},calcAvailabilityStartTimeFromPresentationTime:e,calcAvailabilityEndTimeFromPresentationTime:f,calcPresentationTimeFromWallTime:g,calcPresentationTimeFromMediaTime:h,calcPeriodRelativeTimeFromMpdRelativeTime:l,calcMpdRelativeTimeFromPeriodRelativeTime:m,calcMediaTimeFromPresentationTime:i,calcSegmentAvailabilityRange:k,calcWallTimeForSegment:j,calcMSETimeOffset:o,reset:p,isTimeSyncCompleted:function(){return b},getClientTimeOffset:function(){return a},getExpectedLiveEdge:function(){return c},setExpectedLiveEdge:function(a){c=a}}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1,this.type=null},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Event=function(){"use strict";this.duration=0/0,this.presentationTime=0/0,this.id=0/0,this.messageData="",this.eventStream=null,this.presentationTimeDelta=0/0},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=0/0,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=0/0,this.start=0/0,this.mpd=null},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=0/0,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=0/0,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=0/0,this.replacementTime=null,this.replacementNumber=0/0,this.mediaStartTime=0/0,this.presentationStartTime=0/0,this.availabilityStartTime=0/0,this.availabilityEndTime=0/0,this.availabilityIdx=0/0,this.wallStartTime=0/0,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},MediaPlayer.dependencies.AbrController=function(){"use strict";var a=!0,b={},c={},d={},e=function(a){var b;return c.hasOwnProperty(a)||(c[a]=0),b=c[a]},f=function(a,b){c[a]=b},g=function(a){var b;return d.hasOwnProperty(a)||(d[a]=0),b=d[a]},h=function(a,b){d[a]=b},i=function(a,c){b[a]=c},j=function(a){var c;return b.hasOwnProperty(a)||(b[a]=0),c=b[a]},k=function(a,b,c){var d,e=this,f=this.adapter.convertDataToTrack(c).mediaInfo,g=f.type;d=f.trackCount-1,j(g)!==d&&(i(g,d),e.notify(e.eventList.ENAME_TOP_QUALITY_INDEX_CHANGED,g,d))};return{debug:void 0,adapter:void 0,abrRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_QUALITY_CHANGED:"qualityChanged",ENAME_TOP_QUALITY_INDEX_CHANGED:"topQualityIndexChanged"},setup:function(){this.dataUpdateCompleted=k},getAutoSwitchBitrate:function(){return a},setAutoSwitchBitrate:function(b){a=b},getPlaybackQuality:function(b){var c,d,i,k,l=this,m=b.getType(),n=function(a){var b=j(m);c=a.value,k=a.confidence,0>c&&(c=0),c>b&&(c=b),d=e(m),c!==d&&(f(m,c),h(m,k),l.notify(l.eventList.ENAME_QUALITY_CHANGED,m,d,c))};c=e(m),k=g(m),a&&(l.abrRulesCollection.downloadRatioRule&&l.abrRulesCollection.downloadRatioRule.setStreamProcessor(b),i=l.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),l.rulesController.applyRules(i,b,n.bind(l),c,function(a,b){return Math.min(a,b)}))},setPlaybackQuality:function(a,c){var d=e(a),g=null!==c&&!isNaN(c)&&c%1===0;if(!g)throw"argument is not an integer";c!==d&&c>=0&&b.hasOwnProperty(a)&&c<=b[a]&&(f(a,c),this.notify(this.eventList.ENAME_QUALITY_CHANGED,a,d,c))},getQualityFor:function(a){return e(a)},getConfidenceFor:function(a){return g(a)},isPlayingAtTopQuality:function(){var a,b=this,c=b.getQualityFor("audio"),d=b.getQualityFor("video");return a=c===j("audio")&&d===j("video")},reset:function(){var e,f=this.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),g=f.length,h=0;for(h;g>h;h+=1)e=f[h],"function"==typeof e.reset&&e.reset();a=!0,b={},c={},d={}}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.BufferController=function(){"use strict";var a,b,c,d,e=.5,f=22,g=[],h=0,i=-1,j=!1,k=0,l=Number.POSITIVE_INFINITY,m=-1,n=-1,o=null,p=null,q=!1,r=!1,s=[],t=!1,u=function(){var a=this.streamProcessor.getFragmentModel().getLoadingRequests();return i>h&&(v(s,i)||v(a,i))?!1:i!==h},v=function(a,b){var c=0,d=a.length;for(c;d>c;c+=1)if(a[c].quality===b)return!0;return!1},w=function(a,b){var c=function(a,c){return a[b]<c[b]?-1:a[b]>c[b]?1:0};a.sort(c)},x=function(a,c,d,e){var f=this;c===f.streamProcessor.getFragmentModel()&&(f.debug.log("Initialization finished loading: "+b),g[e]=d,e===h&&u.call(f)&&Y.call(f))},y=function(a,b,c,d,e){if(b===this.streamProcessor.getFragmentModel()){var f,g=this.streamProcessor.getFragmentModel().getExecutedRequestForQualityAndIndex(d,e),h=this.streamProcessor.getTrackForQuality(d),i=this.adapter.getEventsFor(h.mediaInfo,this.streamProcessor),j=this.adapter.getEventsFor(h,this.streamProcessor);(i.length>0||j.length>0)&&(f=C.call(this,c,g,i,j),this.streamProcessor.getEventController().addInbandEvents(f)),c=D.call(this,c),s.push({bytes:c,quality:d,index:e}),w(s,"index"),P.call(this)}},z=function(a,b,c){r=!0,d={quality:b,index:c};var e=this,f=isNaN(c);return b!==h&&f||b!==i&&!f?void R.call(e,b,c):void e.sourceBufferExt.append(o,a)},A=function(a,c,e,g){if(o===c){var h,i=this;if(g)return g.code===f&&(s.unshift({bytes:e,quality:d.quality,index:d.index}),l=.8*J.call(i),i.notify(i.eventList.ENAME_QUOTA_EXCEEDED,l),H.call(i)),void(r=!1);if(B.call(i),G.call(i)||(i.notify(i.eventList.ENAME_QUOTA_EXCEEDED,l),H.call(i)),h=i.sourceBufferExt.getAllRanges(o),h&&h.length>0){var j,k;for(j=0,k=h.length;k>j;j+=1)i.debug.log("Buffered "+b+" Range: "+h.start(j)+" - "+h.end(j))}Q.call(i,d.quality,d.index),i.notify(i.eventList.ENAME_BYTES_APPENDED,d.quality,d.index)}},B=function(){var a=this,b=a.playbackController.getTime();return k=a.sourceBufferExt.getBufferLength(o,b),a.notify(a.eventList.ENAME_BUFFER_LEVEL_UPDATED,k),E.call(a),L.call(a),e>k&&M.call(a,!1),!0},C=function(a,b,c,d){var e,f,g,h,i=[],j=0,k=Math.pow(256,2),l=Math.pow(256,3),m=Math.max(isNaN(b.startTime)?0:b.startTime,0),n=[];t=!1,h=c.concat(d);for(var o=0;o<h.length;o++)n[h[o].schemeIdUri]=h[o];for(;j<a.length&&(e=String.fromCharCode(a[j+4],a[j+5],a[j+6],a[j+7]),f=a[j]*l+a[j+1]*k+256*a[j+2]+1*a[j+3],"moov"!=e&&"moof"!=e);){if("emsg"==e){t=!0;for(var p=["","",0,0,0,0,""],q=0,r=j+12;f+j>r;)0===q||1==q||6==q?(0!==a[r]?p[q]+=String.fromCharCode(a[r]):q+=1,r+=1):(p[q]=a[r]*l+a[r+1]*k+256*a[r+2]+1*a[r+3],r+=4,q+=1);g=this.adapter.getEvent(p,n,m),g&&i.push(g)}j+=f}return i},D=function(a){if(!t)return a;for(var b,c,d=a.length,e=0,f=0,g=Math.pow(256,2),h=Math.pow(256,3),i=new Uint8Array(a.length);d>e;){if(b=String.fromCharCode(a[e+4],a[e+5],a[e+6],a[e+7]),c=a[e]*h+a[e+1]*g+256*a[e+2]+1*a[e+3],"emsg"!=b)for(var j=e;e+c>j;j++)i[f]=a[j],f+=1;e+=c}return i.subarray(0,f)},E=function(){var a=F.call(this),b=2*c,d=k-a;d>=b&&!q?(q=!0,this.notify(this.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):b/2>d&&q&&(this.notify(this.eventList.ENAME_BUFFER_LEVEL_BALANCED),q=!1,P.call(this))},F=function(){var a=this.metricsModel.getReadOnlyMetricsFor("video"),b=this.metricsExt.getCurrentBufferLevel(a),c=this.metricsModel.getReadOnlyMetricsFor("audio"),d=this.metricsExt.getCurrentBufferLevel(c),e=null;return e=null===b||null===d?null!==d?d.level:null!==b?b.level:null:Math.min(d.level,b.level)},G=function(){var a=this,b=J.call(a);return l>b},H=function(){var b,c,d,e,f=this,g=f.playbackController.getTime();o&&(e=f.fragmentController.getExecutedRequestForTime(f.streamProcessor.getFragmentModel(),g),c=e&&!isNaN(e.startTime)?e.startTime:Math.floor(g),d=f.sourceBufferExt.getBufferRange(o,g),null===d&&o.buffered.length>0&&(c=o.buffered.end(o.buffered.length-1)),b=o.buffered.start(0),f.sourceBufferExt.remove(o,b,c,a))},I=function(a,b,d,e){o===b&&(B.call(this),this.notify(this.eventList.ENAME_BUFFER_CLEARED,d,e,G.call(this)),G.call(this)||setTimeout(H.bind(this),1e3*c))},J=function(){var a,b,c=this,d=c.sourceBufferExt.getAllRanges(o),e=0;if(!d)return e;for(b=0,a=d.length;a>b;b+=1)e+=d.end(b)-d.start(b);return e},K=function(){var a=m===n-1;a&&!j&&(j=!0,this.notify(this.eventList.ENAME_BUFFERING_COMPLETED))},L=function(){var a=this.playbackController.getTimeToStreamEnd(),b=this.streamProcessor.isDynamic()?c/2:c;b>k&&(a>c||c>=a&&!j)?M.call(this,!1):M.call(this,!0)},M=function(a){p!==a&&(p=a,this.debug.log(p?"Got enough "+b+" buffer to start.":"Waiting for more "+b+" buffer before starting playback."),this.notify(this.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,a))},N=function(a){o.timestampOffset!==a&&(o.timestampOffset=a)},O=function(){var a=this;B.call(a),P.call(a)},P=function(){u.call(this)?Y.call(this):U.call(this)},Q=function(a,b){r=!1,isNaN(b)?S.call(this,a):T.call(this,b),P.call(this)},R=function(a,b){r=!1,this.notify(this.eventList.ENAME_BYTES_REJECTED,a,b),P.call(this)},S=function(a){i=a},T=function(a){m=Math.max(a,m),K.call(this)},U=function(){var a;0===s.length||q||r||u.call(this)||!G.call(this)||(a=s.shift(),z.call(this,a.bytes,a.quality,a.index))},V=function(a,b,d){var e,f=this;N.call(f,d.MSETimeOffset),e=f.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,c!==e&&(f.setMinBufferTime(e),f.notify(f.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,e))},W=function(a,b,c){var d=this;b===d.streamProcessor.getFragmentModel()&&(n=c.index,K.call(d))},X=function(a,c,d,e){if(b===c){var f=this;h!==e&&(N.call(f,f.streamProcessor.getTrackForQuality(e).MSETimeOffset),h=e,u.call(f)&&Y.call(f))}},Y=function(){var a=this;if(g[h]){if(r)return;z.call(a,g[h],h)}else a.notify(a.eventList.ENAME_INIT_REQUESTED,h)},Z=function(){P.call(this)},$=function(){L.call(this)};return{manifestModel:void 0,sourceBufferExt:void 0,bufferMax:void 0,metricsModel:void 0,metricsExt:void 0,adapter:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested",ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},setup:function(){this.dataUpdateCompleted=V,this.initFragmentLoaded=x,this.mediaFragmentLoaded=y,this.streamCompleted=W,this.qualityChanged=X,this.playbackProgress=O,this.playbackSeeking=O,this.playbackTimeUpdated=O,this.playbackRateChanged=$,this.wallclockTimeUpdated=Z,A=A.bind(this),I=I.bind(this),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,this,A),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,I)},initialize:function(a,c,d,e){var f=this;b=a,f.setMediaSource(d),f.setBuffer(c),f.streamProcessor=e,f.fragmentController=e.fragmentController,f.scheduleController=e.scheduleController,f.playbackController=e.playbackController},getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(a){this.streamProcessor=a},getBuffer:function(){return o},setBuffer:function(a){o=a},getBufferLevel:function(){return k},getMinBufferTime:function(){return c},setMinBufferTime:function(a){c=a},getCriticalBufferLevel:function(){return l},setMediaSource:function(b){a=b},isBufferingCompleted:function(){return j},reset:function(b){var e=this;g=[],l=Number.POSITIVE_INFINITY,p=null,c=null,i=-1,h=0,e.sourceBufferExt.unsubscribe(e.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,e,A),e.sourceBufferExt.unsubscribe(e.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,e,I),d=null,q=!1,r=!1,s=[],b||(e.sourceBufferExt.abort(a,o),e.sourceBufferExt.removeSourceBuffer(a,o)),o=null}}},MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=8,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,supportsMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return a||b},supportsMediaKeys:function(){"use strict";var a="WebKitMediaKeys"in window,b="MSMediaKeys"in window,c="MediaKeys"in window;return a||b||c},supportsCodec:function(a,b){"use strict";if(!(a instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var c=a.canPlayType(b);return"probably"===c}},MediaPlayer.utils.Debug=function(){"use strict";var a=!0;return{eventBus:void 0,setLogToBrowserConsole:function(b){a=b},getLogToBrowserConsole:function(){return a},log:function(b){a&&console.log(b),this.eventBus.dispatchEvent({type:"log",message:b})}}},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,capabilityError:function(a){this.eventBus.dispatchEvent({type:"error",error:"capability",event:a})},downloadError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"download",event:{id:a,url:b,request:c}})},manifestError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"manifestError",event:{message:a,id:b,manifest:c}})},closedCaptionsError:function(a,b,c){this.eventBus.dispatchEvent({type:"error",error:"cc",event:{message:a,id:b,cc:c}})},mediaSourceError:function(a){this.eventBus.dispatchEvent({type:"error",error:"mediasource",event:a})},mediaKeySessionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_session",event:a})},mediaKeyMessageError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_message",event:a})},mediaKeySystemSelectionError:function(a){this.eventBus.dispatchEvent({type:"error",error:"key_system_selection",event:a})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.utils.EventBus=function(){"use strict";var a,b=function(b,c){var d=(c?"1":"0")+b;return d in a||(a[d]=[]),a[d]},c=function(){a={}};return c(),{addEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1===f&&e.push(c)},removeEventListener:function(a,c,d){var e=b(a,d),f=e.indexOf(c);-1!==f&&e.splice(f,1)},dispatchEvent:function(a){for(var c=b(a.type,!1).slice(),d=0;d<c.length;d++)c[d].call(this,a);return!a.defaultPrevented}}},MediaPlayer.dependencies.EventController=function(){"use strict";var a=[],b=[],c=[],d=null,e=100,f=e/1e3,g="urn:mpeg:dash:event:2012",h=1,i=function(){null!==d&&(clearInterval(d),d=null),a=null,b=null,c=null},j=function(){null!==d&&(clearInterval(d),d=null)},k=function(){var a=this;a.debug.log("Start Event Controller"),isNaN(e)||(d=setInterval(n.bind(this),e))},l=function(b){var c=this;a=[],b&&b.length>0&&(a=b),c.debug.log("Added "+b.length+" inline events")},m=function(a){for(var c=this,d=0;d<a.length;d++){var e=a[d];b[e.id]=e,c.debug.log("Add inband event with id "+e.id)}},n=function(){o.call(this,b),o.call(this,a),p.call(this)},o=function(a){var b,d=this,e=this.videoModel.getCurrentTime();if(a)for(var i=0;i<a.length;i++){var j=a[i];void 0!==j&&(b=j.presentationTime/j.eventStream.timescale,(0===b||e>=b&&b+f>e)&&(d.debug.log("Start Event at "+e),j.duration>0&&c.push(j),j.eventStream.schemeIdUri==g&&j.eventStream.value==h&&q.call(this),a.splice(i,1)))}},p=function(){var a=this;if(c)for(var b=this.videoModel.getCurrentTime(),d=0;d<c.length;d++){var e=c[d];null!==e&&(e.duration+e.presentationTime)/e.eventStream.timescale<b&&(a.debug.log("Remove Event at time "+b),e=null,c.splice(d,1))}},q=function(){var a=this,b=a.manifestModel.getValue(),c=b.url;b.hasOwnProperty("Location")&&(c=b.Location),a.debug.log("Refresh manifest @ "+c),a.manifestLoader.load(c)};return{manifestModel:void 0,manifestLoader:void 0,debug:void 0,system:void 0,errHandler:void 0,videoModel:void 0,addInlineEvents:l,addInbandEvents:m,reset:i,clear:j,start:k,getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},initialize:function(a){this.setVideoModel(a)}}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.dependencies.FragmentController=function(){"use strict";var a=[],b=!1,c=function(b){for(var c=a.length,d=0;c>d;d++)if(a[d].getContext()==b)return a[d];return null},d=function(b,c){var d=this,e=a[0].getContext().streamProcessor,f=e.getStreamInfo().id,g=d.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES);-1!==g.indexOf(this.scheduleRulesCollection.sameTimeRequestRule)&&this.scheduleRulesCollection.sameTimeRequestRule.setFragmentModels(a,f),d.rulesController.applyRules(g,e,c,b,function(a,b){return b})},e=function(a,b){var c=this;c.isInitializationRequest(b)?c.notify(c.eventList.ENAME_INIT_FRAGMENT_LOADING_START,a,b):c.notify(c.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,a,b)},f=function(a,b,c){var d=this,e=d.process(c);return null===e?void d.debug.log("No "+b.mediaType+" bytes to push."):(d.isInitializationRequest(b)?d.notify(d.eventList.ENAME_INIT_FRAGMENT_LOADED,a,e,b.quality):d.notify(d.eventList.ENAME_MEDIA_FRAGMENT_LOADED,a,e,b.quality,b.index),void j.call(this))},g=function(a,b){this.notify(this.eventList.ENAME_STREAM_COMPLETED,a,b)},h=function(){j.call(this)},i=function(c){var d,e,f,g,h,i=c.value;for(g=0;g<i.length;g+=1)if(e=i[g])for(h=0;h<a.length;h+=1)f=a[h],d=f.getContext().streamProcessor.getType(),e.mediaType===d&&(e instanceof MediaPlayer.vo.FragmentRequest||(e=f.getPendingRequestForTime(e.startTime)),f.executeRequest(e));b=!1},j=function(a){b||(b=!0,d.call(this,a,i.bind(this)))};return{system:void 0,debug:void 0,scheduleRulesCollection:void 0,rulesController:void 0,fragmentLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"},setup:function(){this.fragmentLoadingStarted=e,this.fragmentLoadingCompleted=f,this.streamCompleted=g,this.bufferLevelBalanced=h},process:function(a){var b=null;return null!==a&&void 0!==a&&a.byteLength>0&&(b=new Uint8Array(a)),b},getModel:function(b){if(!b)return null;var d=c(b);return d||(d=this.system.getObject("fragmentModel"),d.setContext(b),a.push(d)),d},detachModel:function(b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},isFragmentLoadedOrPending:function(a,b){var d,e=c(a);return e?d=e.isFragmentLoadedOrPending(b):!1},getPendingRequests:function(a){var b=c(a);return b?b.getPendingRequests():null},getLoadingRequests:function(a){var b=c(a);return b?b.getLoadingRequests():null},isInitializationRequest:function(a){return a&&a.type&&-1!==a.type.toLowerCase().indexOf("initialization")},getLoadingTime:function(a){var b=c(a);return b?b.getLoadingTime():null},getExecutedRequestForTime:function(a,b){return a?a.getExecutedRequestForTime(b):null},removeExecutedRequest:function(a,b){a&&a.removeExecutedRequest(b)},removeExecutedRequestsBeforeTime:function(a,b){a&&a.removeExecutedRequestsBeforeTime(b)},cancelPendingRequestsForModel:function(a){a&&a.cancelPendingRequests()},abortRequestsForModel:function(a){a&&a.abortRequests(),j.call(this)},prepareFragmentForLoading:function(a,b){var d=c(a);d&&b&&d.addRequest(b)&&j.call(this,b)},executePendingRequests:function(){j.call(this)},resetModel:function(a){this.abortRequestsForModel(a),this.cancelPendingRequestsForModel(a)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var a=3,b=500,c=[],d=function(a,e){var f=new XMLHttpRequest,g=null,h=!0,i=!0,j=null,k=this;c.push(f),a.requestStartDate=new Date,g=k.metricsModel.addHttpRequest(a.mediaType,null,a.type,a.url,null,a.range,a.requestStartDate,null,null,null,null,a.duration),k.metricsModel.appendHttpTrace(g,a.requestStartDate,a.requestStartDate.getTime()-a.requestStartDate.getTime(),[0]),j=a.requestStartDate,f.open("GET",k.tokenAuthentication.addTokenAsQueryArg(a.url),!0),f.responseType="arraybuffer",f=k.tokenAuthentication.setTokenInRequestHeader(f),a.range&&f.setRequestHeader("Range","bytes="+a.range),f.onprogress=function(b){var c=new Date;h&&(h=!1,(!b.lengthComputable||b.lengthComputable&&b.total!=b.loaded)&&(a.firstByteDate=c,g.tresponse=c)),k.metricsModel.appendHttpTrace(g,c,c.getTime()-j.getTime(),[f.response?f.response.byteLength:0]),j=c
},f.onload=function(){if(!(f.status<200||f.status>299)){i=!1;var b,c,d=new Date,e=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=d,b=a.firstByteDate.getTime()-a.requestStartDate.getTime(),c=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("loaded "+a.mediaType+":"+a.type+":"+a.startTime+" ("+f.status+", "+b+"ms, "+c+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,d,d.getTime()-j.getTime(),[e?e.byteLength:0]),j=d,k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,e)}},f.onloadend=f.onerror=function(){if(-1!==c.indexOf(f)&&(c.splice(c.indexOf(f),1),i)){i=!1;var h,l,m=new Date,n=f.response;a.firstByteDate||(a.firstByteDate=a.requestStartDate),a.requestEndDate=m,h=a.firstByteDate.getTime()-a.requestStartDate.getTime(),l=a.requestEndDate.getTime()-a.firstByteDate.getTime(),k.debug.log("failed "+a.mediaType+":"+a.type+":"+a.startTime+" ("+f.status+", "+h+"ms, "+l+"ms)"),g.tresponse=a.firstByteDate,g.tfinish=a.requestEndDate,g.responsecode=f.status,k.metricsModel.appendHttpTrace(g,m,m.getTime()-j.getTime(),[n?n.byteLength:0]),j=m,e>0?(k.debug.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(k,a,e)},b)):(k.debug.log("Failed loading fragment: "+a.mediaType+":"+a.type+":"+a.startTime+" no retry attempts left"),k.errHandler.downloadError("content",a.url,f),k.notify(k.eventList.ENAME_LOADING_COMPLETED,a,null,new Error("failed loading fragment")))}},f.send()},e=function(a){var b=this,c=new XMLHttpRequest,d=!1;c.open("HEAD",a.url,!0),c.onload=function(){c.status<200||c.status>299||(d=!0,b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!0,a))},c.onloadend=c.onerror=function(){d||b.notify(b.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},c.send()};return{metricsModel:void 0,errHandler:void 0,debug:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},load:function(b){b?d.call(this,b,a):this.notify(this.eventList.ENAME_LOADING_COMPLETED,b,null,new Error("request is null"))},checkForExistence:function(a){return a?void e.call(this,a):void this.notify(this.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,a)},abort:function(){var a,b,d=c.length;for(a=0;d>a;a+=1)b=c[a],c[a]=null,b.abort(),b=null;c=[]}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var a,b=[],c=[],d=[],e=[],f=!1,g=function(a){var b=this;b.notify(b.eventList.ENAME_FRAGMENT_LOADING_STARTED,a),b.fragmentLoader.load(a)},h=function(a){var c=b.indexOf(a);-1!==c&&b.splice(c,1)},i=function(a,b){var c,d=a.length-1,e=0/0,f=0/0,g=null;for(c=d;c>=0;c-=1)if(g=a[c],e=g.startTime,f=e+g.duration,!isNaN(e)&&!isNaN(f)&&b>=e&&f>b||isNaN(e)&&isNaN(b))return g;return null},j=function(a,b){if(a){var c=a.mediaType,d=new Date,e=a.type,f=a.startTime,g=a.availabilityStartTime,h=a.duration,i=a.quality,j=a.range;this.metricsModel.addSchedulingInfo(c,d,e,f,g,h,i,j,b)}},k=function(a,c,e,f){d.splice(d.indexOf(c),1),e&&!f?(b.push(c),j.call(this,c,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,c,e)):(j.call(this,c,MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_FAILED,c))},l=function(a,b,c){var d=this.getExecutedRequestForQualityAndIndex(b,c);d&&(this.removeExecutedRequest(d),isNaN(c)||(e.push(d),j.call(this,d,MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE)))},m=function(){f=!0},n=function(){f=!1};return{system:void 0,debug:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",ENAME_FRAGMENT_LOADING_FAILED:"fragmentLoadingFailed"},setup:function(){this.bufferLevelOutrun=m,this.bufferLevelBalanced=n,this.bytesRejected=l,this.loadingCompleted=k},setLoader:function(a){this.fragmentLoader=a},setContext:function(b){a=b},getContext:function(){return a},getIsPostponed:function(){return f},addRequest:function(a){return!a||this.isFragmentLoadedOrPending(a)?!1:(c.push(a),j.call(this,a,MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE),!0)},isFragmentLoadedOrPending:function(a){var e=function(a,b){return"complete"===a.action&&a.action===b.action},f=function(a,b){return a.url===b.url&&a.startTime===b.startTime},g=function(a,b){return isNaN(a.index)&&isNaN(b.index)&&a.quality===b.quality},h=function(b){var c,d,h=!1,i=b.length;for(d=0;i>d;d+=1)if(c=b[d],f(a,c)||g(a,c)||e(a,c)){h=!0;break}return h};return h(c)||h(d)||h(b)},getPendingRequests:function(){return c},getLoadingRequests:function(){return d},getExecutedRequests:function(){return b},getRejectedRequests:function(){return e},getLoadingTime:function(){var a,c,d=0;for(c=b.length-1;c>=0;c-=1)if(a=b[c],a.requestEndDate instanceof Date&&a.firstByteDate instanceof Date){d=a.requestEndDate.getTime()-a.firstByteDate.getTime();break}return d},getExecutedRequestForTime:function(a){return i(b,a)},getPendingRequestForTime:function(a){return i(c,a)},getLoadingRequestForTime:function(a){return i(d,a)},getExecutedRequestForQualityAndIndex:function(a,c){var d,e=b.length-1,f=null;for(d=e;d>=0;d-=1)if(f=b[d],f.quality===a&&f.index===c)return f;return null},removeExecutedRequest:function(a){h.call(this,a)},removeExecutedRequestsBeforeTime:function(a){var c,d=b.length-1,e=0/0,f=null;for(c=d;c>=0;c-=1)f=b[c],e=f.startTime,!isNaN(e)&&a>e&&h.call(this,f)},cancelPendingRequests:function(){var a=this,b=c;c=[],b.forEach(function(b){j.call(a,b,MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE)})},abortRequests:function(){this.fragmentLoader.abort();for(var a=0,b=d.length;b>a;a+=1)this.removeExecutedRequest(d[a]);d=[]},executeRequest:function(a){var e=this,f=c.indexOf(a);if(a&&-1!==f)switch(c.splice(f,1),a.action){case"complete":b.push(a),j.call(e,a,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),e.notify(e.eventList.ENAME_STREAM_COMPLETED,a);break;case"download":d.push(a),j.call(e,a,MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE),g.call(e,a);break;default:this.debug.log("Unknown request action.")}}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";var a,b=!1,c=function(a){var b=a.value,c=((new Date).getTime()-this.streamProcessor.getStreamInfo().manifestInfo.loadedTime.getTime())/1e3;null!==b?this.notify(this.eventList.ENAME_LIVE_EDGE_FOUND,b,c):this.notify(this.eventList.ENAME_LIVE_EDGE_SEARCH_ERROR,c)},d=function(){if(this.streamProcessor.isDynamic()&&!b){var d=this;a=d.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES),b=!0,this.rulesController.applyRules(a,d.streamProcessor,c.bind(d),null,function(a,b){return b})}};return{system:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LIVE_EDGE_FOUND:"liveEdgeFound",ENAME_LIVE_EDGE_SEARCH_ERROR:"liveEdgeSearchError"},setup:function(){this.streamUpdated=d},initialize:function(a){this.streamProcessor=a,this.fragmentLoader=a.fragmentLoader,this.scheduleRulesCollection.liveEdgeBinarySearchRule&&this.scheduleRulesCollection.liveEdgeBinarySearchRule.setFinder(this)},abortSearch:function(){if(b=!1,a)for(var c=0,d=a.length;d>c;c+=1)a[c].reset()}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var a=3,b=500,c=function(a){var b=null;return-1!==a.indexOf("/")&&(-1!==a.indexOf("?")&&(a=a.substring(0,a.indexOf("?"))),b=a.substring(0,a.lastIndexOf("/")+1)),b},d=function(a,e){var f,g=c(a),h=new XMLHttpRequest,i=new Date,j=null,k=!0,l=null,m=null,n=this;l=function(){h.status<200||h.status>299||(k=!1,j=new Date,n.tokenAuthentication.checkRequestHeaderForToken(h),n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,j,h.status,null,null),f=n.parser.parse(h.responseText,g),f?(f.url=a,f.loadedTime=j,n.metricsModel.addManifestUpdate("stream",f.type,i,j,f.availabilityStartTime),n.notify(n.eventList.ENAME_MANIFEST_LOADED,f)):n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a)))},m=function(){k&&(k=!1,n.metricsModel.addHttpRequest("stream",null,"MPD",a,null,null,i,new Date,h.status,null,null),e>0?(n.debug.log("Failed loading manifest: "+a+", retry in "+b+"ms attempts: "+e),e--,setTimeout(function(){d.call(n,a,e)},b)):(n.debug.log("Failed loading manifest: "+a+" no retry attempts left"),n.errHandler.downloadError("manifest",a,h),n.notify(n.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+a+" no retry attempts left"))))};try{h.onload=l,h.onloadend=m,h.onerror=m,h.open("GET",a,!0),h.send()}catch(o){h.onerror()}};return{debug:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_LOADED:"manifestLoaded"},load:function(b){d.call(this,b,a)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.models.ManifestModel=function(){"use strict";var a;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_UPDATED:"manifestUpdated"},getValue:function(){return a},setValue:function(b){a=b,this.eventBus.dispatchEvent({type:"manifestLoaded",data:b}),this.notify(this.eventList.ENAME_MANIFEST_UPDATED,b)}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var a=0/0,b=null,c=!1,d=!1,e=function(){null!==b&&(clearInterval(b),b=null)},f=function(){e.call(this),isNaN(a)||(this.debug.log("Refresh manifest in "+a+" seconds."),b=setTimeout(h.bind(this),Math.min(1e3*a,Math.pow(2,31)-1),this))},g=function(){var b,c,d=this,e=d.manifestModel.getValue();void 0!==e&&null!==e&&(b=d.manifestExt.getRefreshDelay(e),c=((new Date).getTime()-e.loadedTime.getTime())/1e3,a=Math.max(b-c,0),f.call(d))},h=function(){var a,b,c=this;d||(d=!0,a=c.manifestModel.getValue(),b=a.url,a.hasOwnProperty("Location")&&(b=a.Location),c.manifestLoader.load(b))},i=function(a,b,d){d||(this.manifestModel.setValue(b),this.debug.log("Manifest has been refreshed."),c||g.call(this))},j=function(){this.start()},k=function(){this.stop()},l=function(){d=!1};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){g.call(this),this.streamsComposed=l,this.manifestLoaded=i,this.playbackStarted=j,this.playbackPaused=k},start:function(){c=!1,g.call(this)},stop:function(){c=!0,e.call(this)}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var a="WebKitMediaSource"in window,b="MediaSource"in window;return b?new MediaSource:a?new WebKitMediaSource:null},attachMediaSource:function(a,b){"use strict";b.setSource(window.URL.createObjectURL(a))},detachMediaSource:function(a){"use strict";a.setSource("")},setDuration:function(a,b){"use strict";return a.duration=b,a.duration},signalEndOfStream:function(a){"use strict";"open"===a.readyState&&a.endOfStream()}},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:"metricsChanged",data:{}})},metricChanged:function(a){this.eventBus.dispatchEvent({type:"metricChanged",data:{stream:a}}),this.metricsChanged()},metricUpdated:function(a,b,c){this.eventBus.dispatchEvent({type:"metricUpdated",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},metricAdded:function(a,b,c){this.eventBus.dispatchEvent({type:"metricAdded",data:{stream:a,metric:b,value:c}}),this.metricChanged(a)},clearCurrentMetricsForType:function(a){delete this.streamMetrics[a],this.metricChanged(a)},clearAllCurrentMetrics:function(){var a=this;this.streamMetrics={},this.metricsChanged.call(a)},getReadOnlyMetricsFor:function(a){return this.streamMetrics.hasOwnProperty(a)?this.streamMetrics[a]:null},getMetricsFor:function(a){var b;return this.streamMetrics.hasOwnProperty(a)?b=this.streamMetrics[a]:(b=this.system.getObject("metrics"),this.streamMetrics[a]=b),b},addTcpConnection:function(a,b,c,d,e,f){var g=new MediaPlayer.vo.metrics.TCPConnection;return g.tcpid=b,g.dest=c,g.topen=d,g.tclose=e,g.tconnect=f,this.getMetricsFor(a).TcpList.push(g),this.metricAdded(a,this.adapter.metricsList.TCP_CONNECTION,g),g},addHttpRequest:function(a,b,c,d,e,f,g,h,i,j,k,l){var m=new MediaPlayer.vo.metrics.HTTPRequest;return m.stream=a,m.tcpid=b,m.type=c,m.url=d,m.actualurl=e,m.range=f,m.trequest=g,m.tresponse=h,m.tfinish=i,m.responsecode=j,m.interval=k,m.mediaduration=l,this.getMetricsFor(a).HttpList.push(m),this.metricAdded(a,this.adapter.metricsList.HTTP_REQUEST,m),m},appendHttpTrace:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return e.s=b,e.d=c,e.b=d,a.trace.push(e),this.metricUpdated(a.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,a),e},addTrackSwitch:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.TrackSwitch;return f.t=b,f.mt=c,f.to=d,f.lto=e,this.getMetricsFor(a).RepSwitchList.push(f),this.metricAdded(a,this.adapter.metricsList.TRACK_SWITCH,f),f},addBufferLevel:function(a,b,c){var d=new MediaPlayer.vo.metrics.BufferLevel;return d.t=b,d.level=c,this.getMetricsFor(a).BufferLevel.push(d),this.metricAdded(a,this.adapter.metricsList.BUFFER_LEVEL,d),d},addDVRInfo:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.DVRInfo;return e.time=b,e.range=d,e.manifestInfo=c,this.getMetricsFor(a).DVRInfo.push(e),this.metricAdded(a,this.adapter.metricsList.DVR_INFO,e),e},addDroppedFrames:function(a,b){var c=new MediaPlayer.vo.metrics.DroppedFrames,d=this.getMetricsFor(a).DroppedFrames;return c.time=b.creationTime,c.droppedFrames=b.droppedVideoFrames,d.length>0&&d[d.length-1]==c?d[d.length-1]:(d.push(c),this.metricAdded(a,this.adapter.metricsList.DROPPED_FRAMES,c),c)},addSchedulingInfo:function(a,b,c,d,e,f,g,h,i){var j=new MediaPlayer.vo.metrics.SchedulingInfo;return j.mediaType=a,j.t=b,j.type=c,j.startTime=d,j.availabilityStartTime=e,j.duration=f,j.quality=g,j.range=h,j.state=i,this.getMetricsFor(a).SchedulingInfo.push(j),this.metricAdded(a,this.adapter.metricsList.SCHEDULING_INFO,j),j},addManifestUpdate:function(a,b,c,d,e,f,g,h,i,j){var k=new MediaPlayer.vo.metrics.ManifestUpdate,l=this.getMetricsFor("stream");return k.mediaType=a,k.type=b,k.requestTime=c,k.fetchTime=d,k.availabilityStartTime=e,k.presentationStartTime=f,k.clientTimeOffset=g,k.currentTime=h,k.buffered=i,k.latency=j,l.ManifestUpdate.push(k),this.metricAdded(a,this.adapter.metricsList.MANIFEST_UPDATE,k),k},updateManifestUpdateInfo:function(a,b){for(var c in b)a[c]=b[c];this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,a)},addManifestUpdateStreamInfo:function(a,b,c,d,e){var f=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;return f.id=b,f.index=c,f.start=d,f.duration=e,a.streamInfo.push(f),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,a),f},addManifestUpdateTrackInfo:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;return i.id=b,i.index=c,i.streamIndex=d,i.mediaType=e,i.startNumber=g,i.fragmentInfoType=h,i.presentationTimeOffset=f,a.trackInfo.push(i),this.metricUpdated(a.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,a),i},addPlayList:function(a,b,c,d){var e=new MediaPlayer.vo.metrics.PlayList;return e.stream=a,e.start=b,e.mstart=c,e.starttype=d,this.getMetricsFor(a).PlayList.push(e),this.metricAdded(a,this.adapter.metricsList.PLAY_LIST,e),e},appendPlayListTrace:function(a,b,c,d,e,f,g,h){var i=new MediaPlayer.vo.metrics.PlayList.Trace;return i.representationid=b,i.subreplevel=c,i.start=d,i.mstart=e,i.duration=f,i.playbackspeed=g,i.stopreason=h,a.trace.push(i),this.metricUpdated(a.stream,this.adapter.metricsList.PLAY_LIST_TRACE,a),i}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.dependencies.Notifier=function(){"use strict";var a,b=0,c=function(){return this.id||(b+=1,this.id="_id_"+b),this.id},d=function(a){var b,c=this.eventList;for(b in c)if(c[b]===a)return!0;return!1};return{system:void 0,setup:function(){a=this.system,a.mapValue("notify",this.notify),a.mapValue("subscribe",this.subscribe),a.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var b=[].slice.call(arguments);b.splice(1,0,this),b[0]+=c.call(this),a.notify.apply(a,b)},subscribe:function(b,e,f,g){if(!f&&e[b]&&(f=e[b]=e[b].bind(e)),!d.call(this,b))throw"object does not support given event "+b;if(!e)throw"observer object cannot be null or undefined";if(!f)throw"event handler cannot be null or undefined";b+=c.call(this),a.mapHandler(b,void 0,f,g)},unsubscribe:function(b,d,e){e=e||d[b],b+=c.call(this),a.unmapHandler(b,void 0,e)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.PlaybackController=function(){"use strict";var a,b,c,d,e,f=1e3,g=0,h=0/0,i=function(a){var b,c=parseInt(this.uriQueryFragModel.getURIFragmentData.s);return e?(!isNaN(c)&&c>1262304e3&&(b=c-a.manifestInfo.availableFrom.getTime()/1e3,(b>h||b<h-a.manifestInfo.DVRWindowSize)&&(b=null)),b=b||h):b=!isNaN(c)&&c<a.duration&&c>=0?c:a.start,b},j=function(){var a,c=this,e=c.getTime(),f=c.metricsModel.getMetricsFor(d.mediaInfo.type),g=c.metricsExt.getCurrentDVRInfo(f),h=g?g.range:null;return h?e>=h.start&&e<=h.end?e:a=Math.max(h.end-2*b.manifestInfo.minBufferTime,h.start):0/0},k=function(){var b=this,c=function(){A.call(b)};null!==a&&l.call(this),a=setInterval(c,f)},l=function(){clearInterval(a),a=null},m=function(){var a=i.call(this,b);this.debug.log("Starting playback at offset: "+a),this.seek(a)},n=function(){if(!this.isPaused()&&e){var a=this.getTime(),b=j.call(this),c=!isNaN(b)&&b!==a;c&&this.seek(b)}},o=function(a,c,f){d=this.adapter.convertDataToTrack(f),b=d.mediaInfo.streamInfo,e=a.streamProcessor.isDynamic(),n.call(this)},p=function(){0!==c.getElement().readyState&&m.call(this)},q=function(){c&&(c.unlisten("play",r),c.unlisten("pause",s),c.unlisten("error",z),c.unlisten("seeking",t),c.unlisten("seeked",u),c.unlisten("timeupdate",v),c.unlisten("progress",w),c.unlisten("ratechange",x),c.unlisten("loadedmetadata",y))},r=function(){n.call(this),this.notify(this.eventList.ENAME_PLAYBACK_STARTED,this.getTime())},s=function(){this.notify(this.eventList.ENAME_PLAYBACK_PAUSED)},t=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,this.getTime(),!1)},u=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKED)},v=function(){var a=this.getTime();a!==g&&(g=a,this.notify(this.eventList.ENAME_PLAYBACK_TIME_UPDATED,this.getTimeToStreamEnd()))},w=function(){var a,d,e,f=c.getElement().buffered;f.length&&(a=f.length-1,d=f.end(a),e=i.call(this,b)+b.duration-d),this.notify(this.eventList.ENAME_PLAYBACK_PROGRESS,c.getElement().buffered,e)},x=function(){this.notify(this.eventList.ENAME_PLAYBACK_RATE_CHANGED)},y=function(){this.debug.log("Got loadmetadata event."),(!e||this.timelineConverter.isTimeSyncCompleted())&&m.call(this),this.notify(this.eventList.ENAME_PLAYBACK_METADATA_LOADED),k.call(this)},z=function(a){this.notify(this.eventList.ENAME_PLAYBACK_ERROR,a.srcElement.error)},A=function(){this.notify(this.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e,new Date)},B=function(a){c=a,c.listen("play",r),c.listen("pause",s),c.listen("error",z),c.listen("seeking",t),c.listen("seeked",u),c.listen("timeupdate",v),c.listen("progress",w),c.listen("ratechange",x),c.listen("loadedmetadata",y)};return{debug:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,eventList:{ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},setup:function(){this.dataUpdateCompleted=o,this.liveEdgeFound=p,r=r.bind(this),s=s.bind(this),z=z.bind(this),t=t.bind(this),u=u.bind(this),v=v.bind(this),w=w.bind(this),x=x.bind(this),y=y.bind(this)},initialize:function(a,d){b=a,c!==d&&(q.call(this),B.call(this,d))},getTimeToStreamEnd:function(){var a=c.getCurrentTime();return i.call(this,b)+b.duration-a},getStreamId:function(){return b.id},getStreamDuration:function(){return b.duration},getTime:function(){return c.getCurrentTime()},getPlaybackRate:function(){return c.getPlaybackRate()},setLiveStartTime:function(a){h=a},start:function(){c.play()},isPaused:function(){return c.isPaused()},pause:function(){c&&c.pause()},isSeeking:function(){return c.getElement().seeking},seek:function(a){a!==this.getTime()&&(c.setCurrentTime(a),this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,a,!0))},reset:function(){l.call(this),q.call(this),c=null,b=null,g=0,h=0/0}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var a=null,b=null,c=function(a){var b=this;b.protectionModel.removeKeySystem(a)},d=function(a){for(var c=this,d=a.codec,e=a.contentProtection,f=0;f<b.length;++f)for(var g=0;g<e.length;++g)if(b[f].isSupported(e[g])&&c.protectionExt.supportsCodec(b[f].keysTypeString,d)){var h=e[g].KID;return h||(h="unknown"),c.protectionModel.addKeySystem(h,e[g],b[f]),c.debug.log("DRM: Selected Key System: "+b[f].keysTypeString+" For KID: "+h),h}throw new Error("DRM: The protection system for this content is not supported.")},e=function(a,b,c){var d=this,e=null,f=null;d.protectionModel.needToAddKeySession(a)&&(f=d.protectionModel.getInitData(a),!f&&c?(f=c,d.debug.log("DRM: Using initdata from needskey event. length: "+f.length)):f&&d.debug.log("DRM: Using initdata from prheader in mpd. length: "+f.length),f?(e=d.protectionModel.addKeySession(a,b,f),d.debug.log("DRM: Added Key Session ["+e.sessionId+"] for KID: "+a+" type: "+b+" initData length: "+f.length)):d.debug.log("DRM: initdata is null."))},f=function(a,b,c,d){this.protectionModel.updateFromMessage(a,b,c,d)};return{system:void 0,debug:void 0,capabilities:void 0,protectionModel:void 0,protectionExt:void 0,setup:function(){b=this.protectionExt.getKeySystems()},init:function(b,c){this.videoModel=b,this.protectionModel=c,a=this.videoModel.getElement()},selectKeySystem:d,ensureKeySession:e,updateFromMessage:f,teardownKeySystem:c}},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict"},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_KEY_SYSTEM_UPDATE_COMPLETED:"keySystemUpdateCompleted"},supportsCodec:function(a,b){"use strict";var c="WebKitMediaKeys"in window,d="MSMediaKeys"in window,e="MediaKeys"in window;return e?MediaKeys.isTypeSupported(a,b):c?WebKitMediaKeys.isTypeSupported(a,b):d?MSMediaKeys.isTypeSupported(a,b):!1},createMediaKeys:function(a){"use strict";var b="WebKitMediaKeys"in window,c="MSMediaKeys"in window,d="MediaKeys"in window;return d?new MediaKeys(a):b?new WebKitMediaKeys(a):c?new MSMediaKeys(a):null},setMediaKey:function(a,b){var c="WebKitSetMediaKeys"in a,d="msSetMediaKeys"in a,e="SetMediaKeys"in a;return e?a.SetMediaKeys(b):c?a.WebKitSetMediaKeys(b):d?a.msSetMediaKeys(b):void this.debug.log("no setmediakeys function in element")},createSession:function(a,b,c){return a.createSession(b,c)},getKeySystems:function(){var a=this,b=function(b,c){var d=null,e=[],f=new DOMParser,g=f.parseFromString(b,"application/xml");if(g.getElementsByTagName("Challenge")[0]){var h=g.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;h&&(d=BASE64.decode(h))}else a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, can not find Challenge in keyMessage"));var i=g.getElementsByTagName("name"),j=g.getElementsByTagName("value");i.length!=j.length&&a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, invalid header name/value pair in keyMessage"));for(var k=0;k<i.length;k++)e[k]={name:i[k].childNodes[0].nodeValue,value:j[k].childNodes[0].nodeValue};var l=new XMLHttpRequest;l.onload=function(){200==l.status?a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,new Uint8Array(l.response)):a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR status is "'+l.statusText+'" ('+l.status+"), expected to be 200. readyState is "+l.readyState))},l.onabort=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR aborted. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.onerror=function(){a.notify(a.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR error. status is "'+l.statusText+'" ('+l.status+"), readyState is "+l.readyState))},l.open("POST",c),l.responseType="arraybuffer",e&&e.forEach(function(a){l.setRequestHeader(a.name,a.value)}),l.send(d)},c=function(a,b){return null===a&&0===b.length},d=function(a){var b=0,c=0,d=0,e=new Uint8Array([112,115,115,104,0,0,0,0]),f=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),g=null,h=null,i=null,j=null;if("pro"in a)g=BASE64.decodeArray(a.pro.__text);else{if(!("prheader"in a))return null;g=BASE64.decodeArray(a.prheader.__text)}return c=g.length,d=4+e.length+f.length+4+c,h=new ArrayBuffer(d),i=new Uint8Array(h),j=new DataView(h),j.setUint32(b,d),b+=4,i.set(e,b),b+=e.length,i.set(f,b),b+=f.length,j.setUint32(b,c),b+=4,i.set(g,b),b+=c,i};return[{schemeIdUri:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:c,getInitData:d,getUpdate:b},{schemeIdUri:"urn:mpeg:dash:mp4protection:2011",keysTypeString:"com.microsoft.playready",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()&&"cenc"===a.value.toLowerCase()},needToAddKeySession:c,getInitData:function(){return null},getUpdate:b},{schemeIdUri:"urn:uuid:00000000-0000-0000-0000-000000000000",keysTypeString:"webkit-org.w3.clearkey",isSupported:function(a){return this.schemeIdUri===a.schemeIdUri.toLowerCase()},needToAddKeySession:function(){return!0},getInitData:function(){return null},getUpdate:function(a){return a}}]},addKey:function(a,b,c,d,e){a.webkitAddKey(b,c,d,e)},generateKeyRequest:function(a,b,c){a.webkitGenerateKeyRequest(b,c)},listenToNeedKey:function(a,b){a.listen("webkitneedkey",b),a.listen("msneedkey",b),a.listen("needKey",b)},listenToKeyError:function(a,b){a.addEventListener("webkitkeyerror",b,!1),a.addEventListener("mskeyerror",b,!1),a.addEventListener("keyerror",b,!1)},listenToKeyMessage:function(a,b){a.addEventListener("webkitkeymessage",b,!1),a.addEventListener("mskeymessage",b,!1),a.addEventListener("keymessage",b,!1)},listenToKeyAdded:function(a,b){a.addEventListener("webkitkeyadded",b,!1),a.addEventListener("mskeyadded",b,!1),a.addEventListener("keyadded",b,!1)},unlistenToKeyError:function(a,b){a.removeEventListener("webkitkeyerror",b),a.removeEventListener("mskeyerror",b),a.removeEventListener("keyerror",b)},unlistenToKeyMessage:function(a,b){a.removeEventListener("webkitkeymessage",b),a.removeEventListener("mskeymessage",b),a.removeEventListener("keymessage",b)},unlistenToKeyAdded:function(a,b){a.removeEventListener("webkitkeyadded",b),a.removeEventListener("mskeyadded",b),a.removeEventListener("keyadded",b)}},MediaPlayer.models.ProtectionModel=function(){"use strict";var a,b=null,c=null,d=null,e=null,f=[],g=function(b,c,d){d||a.update(c)};return{system:void 0,protectionExt:void 0,setup:function(){this.keySystemUpdateCompleted=g},init:function(a){this.videoModel=a,b=this.videoModel.getElement()},addKeySession:function(a,b,g){var h=null;return h=this.protectionExt.createSession(f[a].keys,b,g),this.protectionExt.listenToKeyAdded(h,c),this.protectionExt.listenToKeyError(h,d),this.protectionExt.listenToKeyMessage(h,e),f[a].initData=g,f[a].keySessions.push(h),h},addKeySystem:function(a,c,d){var e=null;e=this.protectionExt.createMediaKeys(d.keysTypeString),this.protectionExt.setMediaKey(b,e),f[a]={kID:a,contentProtection:c,keySystem:d,keys:e,initData:null,keySessions:[]}},removeKeySystem:function(a){if(null!==a&&void 0!==f[a]&&0!==f[a].keySessions.length){for(var b=f[a].keySessions,g=0;g<b.length;++g)this.protectionExt.unlistenToKeyError(b[g],d),this.protectionExt.unlistenToKeyAdded(b[g],c),this.protectionExt.unlistenToKeyMessage(b[g],e),b[g].close();f[a]=void 0}},needToAddKeySession:function(a){var b=null;return b=f[a],b.keySystem.needToAddKeySession(b.initData,b.keySessions)},getInitData:function(a){var b=null;return b=f[a],b.keySystem.getInitData(b.contentProtection)},updateFromMessage:function(b,c,d,e){a=c,f[b].keySystem.getUpdate(d,e)},listenToNeedKey:function(a){this.protectionExt.listenToNeedKey(this.videoModel,a)},listenToKeyError:function(a){d=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,e=0;e<c.length;++e)this.protectionExt.listenToKeyError(c[e],a)},listenToKeyMessage:function(a){e=a;for(var b=0;b<f.length;++b)for(var c=f[b].keySessions,d=0;d<c.length;++d)this.protectionExt.listenToKeyMessage(c[d],a)},listenToKeyAdded:function(a){c=a;for(var b=0;b<f.length;++b)for(var d=f[b].keySessions,e=0;e<d.length;++e)this.protectionExt.listenToKeyAdded(d[e],a)}}},MediaPlayer.models.ProtectionModel.prototype={constructor:MediaPlayer.models.ProtectionModel},MediaPlayer.dependencies.ScheduleController=function(){"use strict";var a,b,c,d,e,f=0,g=!0,h=null,i=!1,j=null,k=null,l=!0,m=function(a,b){var c=0,d=null;l===!1&&(d=k.start,c=a.getTime()-d.getTime(),k.duration=c,k.stopreason=b,l=!0)},n=function(){if(b){i=!1;var c=new Date;m(c,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),j=this.metricsModel.addPlayList(a,c,0,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON),g&&(g=!1),this.debug.log("ScheduleController "+a+" start."),v.call(this)}},o=function(){g&&r.call(this,e.quality),n.call(this)},p=function(b){i||(i=!0,this.debug.log("ScheduleController "+a+" stop."),b&&this.fragmentController.cancelPendingRequestsForModel(c),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},q=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);b.rulesController.applyRules(c,b.streamProcessor,a,null,function(a,b){return b})},r=function(a){var b,c=this;return b=c.adapter.getInitRequest(c.streamProcessor,a),null!==b&&c.fragmentController.prepareFragmentForLoading(c,b),b},s=function(a){var b=this,c=b.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);
b.rulesController.applyRules(c,b.streamProcessor,a,f,function(a,b){return Math.min(a,b)})},t=function(a){var b=this;return f=a.value,0>=f?void b.fragmentController.executePendingRequests():(b.abrController.getPlaybackQuality(b.streamProcessor),void q.call(b,u.bind(b)))},u=function(a){var b=a.value;null===b||b instanceof MediaPlayer.vo.FragmentRequest||(b=this.adapter.getFragmentRequestForTime(this.streamProcessor,e,b.startTime)),b&&(f--,this.fragmentController.prepareFragmentForLoading(this,b))},v=function(){var a=(new Date).getTime(),b=h?a-h>this.fragmentController.getLoadingTime(this):!0;!b||i||this.playbackController.isPaused()&&(!this.scheduleWhilePaused||d)||(h=a,s.call(this,t.bind(this)))},w=function(){var b=this;null!==a&&""!==a&&b.metricsModel.clearCurrentMetricsForType(a)},x=function(a,c,f){e=this.adapter.convertDataToTrack(f),d||(b=!0),b&&o.call(this)},y=function(b,c){c===this.streamProcessor.getFragmentModel()&&(this.debug.log(a+" Stream is complete."),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))},z=function(a,b){var c=this;b===c.streamProcessor.getFragmentModel()&&v.call(c)},A=function(){p.call(this)},B=function(){J.call(this)},C=function(){p.call(this,!1)},D=function(a,b){r.call(this,b)},E=function(a,b,d,e){this.fragmentController.removeExecutedRequestsBeforeTime(c,d),e&&n.call(this)},F=function(b,c){var d=this;c||d.playbackController.isSeeking()||(d.debug.log("Stalling "+a+" Buffer: "+a),m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},G=function(b,c){var d=this;d.metricsModel.addBufferLevel(a,new Date,c),v.call(this)},H=function(){p.call(this,!1)},I=function(b,c,d,f){if(a===c){var g=this;if(e=g.streamProcessor.getTrackForQuality(f),null===e||void 0===e)throw"Unexpected error!";m(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}},J=function(){var a=this,b=a.playbackController.getTime(),c=a.playbackController.getPlaybackRate(),d=new Date;l===!0&&e&&j&&(l=!1,k=a.metricsModel.appendPlayListTrace(j,e.id,null,d,b,null,c,null))},K=function(a,b){var d=this,e=r.call(d,b);c.executeRequest(e)},L=function(){n.call(this)},M=function(b,d){g||this.fragmentController.cancelPendingRequestsForModel(c);var f,h=this.metricsModel.getMetricsFor("stream"),i=this.metricsExt.getCurrentManifestUpdate(h);this.debug.log("ScheduleController "+a+" seek: "+d),f=new Date,m(f,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),j=this.metricsModel.addPlayList(a,f,d,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),n.call(this),this.metricsModel.updateManifestUpdateInfo(i,{latency:e.DVRWindow.end-this.playbackController.getTime()})},N=function(){J.call(this)},O=function(){v.call(this)},P=function(a,c){var d,f,g=this,h=e.mediaInfo.streamInfo.manifestInfo,i=c-Math.min(2*h.minBufferTime,h.DVRWindowSize/2),j=g.metricsModel.getMetricsFor("stream"),k=g.metricsExt.getCurrentManifestUpdate(j);d=g.adapter.getFragmentRequestForTime(g.streamProcessor,e,i),f=d.startTime+d.duration/2,g.playbackController.setLiveStartTime(f),g.metricsModel.updateManifestUpdateInfo(k,{currentTime:f,presentationStartTime:c,latency:c-f,clientTimeOffset:g.timelineConverter.getClientTimeOffset()}),b=!0,o.call(g)};return{debug:void 0,system:void 0,metricsModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.liveEdgeFound=P,this.qualityChanged=I,this.dataUpdateStarted=C,this.dataUpdateCompleted=x,this.mediaFragmentLoadingStart=z,this.fragmentLoadingFailed=A,this.streamCompleted=y,this.bufferCleared=E,this.bytesAppended=B,this.bufferLevelStateChanged=F,this.bufferLevelUpdated=G,this.initRequested=D,this.quotaExceeded=H,this.closedCaptioningRequested=K,this.playbackStarted=L,this.playbackSeeking=M,this.playbackRateChanged=N,this.wallclockTimeUpdated=O},initialize:function(b,e){var f=this;a=b,f.streamProcessor=e,f.playbackController=e.playbackController,f.fragmentController=e.fragmentController,f.liveEdgeFinder=e.liveEdgeFinder,f.bufferController=e.bufferController,d=e.isDynamic(),c=this.fragmentController.getModel(this),f.scheduleRulesCollection.bufferLevelRule&&f.scheduleRulesCollection.bufferLevelRule.setScheduleController(f),f.scheduleRulesCollection.pendingRequestsRule&&f.scheduleRulesCollection.pendingRequestsRule.setScheduleController(f),f.scheduleRulesCollection.playbackTimeRule&&f.scheduleRulesCollection.playbackTimeRule.setScheduleController(f)},getFragmentModel:function(){return c},reset:function(){var a=this;p.call(a,!0),a.bufferController.unsubscribe(a.bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,a.scheduleRulesCollection.bufferLevelRule),a.bufferController.unsubscribe(a.bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,a.scheduleRulesCollection.bufferLevelRule),a.fragmentController.abortRequestsForModel(c),a.fragmentController.detachModel(c),w.call(a),f=0},start:n,stop:p}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.errHandler=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"}},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(a,b){"use strict";var c=this,d=b.codec,e=null;try{e=a.addSourceBuffer(d)}catch(f){if(!b.isText)throw f;e=c.system.getObject("textSourceBuffer")}return e},removeSourceBuffer:function(a,b){"use strict";try{a.removeSourceBuffer(b)}catch(c){}},getBufferRange:function(a,b,c){"use strict";var d,e,f=null,g=0,h=0,i=null,j=null,k=0,l=c||.15;try{f=a.buffered}catch(m){return null}if(null!==f){for(e=0,d=f.length;d>e;e+=1)if(g=f.start(e),h=f.end(e),null===i)k=Math.abs(g-b),b>=g&&h>b?(i=g,j=h):l>=k&&(i=g,j=h);else{if(k=g-j,!(l>=k))break;j=h}if(null!==i)return{start:i,end:j}}return null},getAllRanges:function(a){var b=null;try{return b=a.buffered}catch(c){return null}},getBufferLength:function(a,b,c){"use strict";var d,e,f=this;return d=f.getBufferRange(a,b,c),e=null===d?0:d.end-b},waitForUpdateEnd:function(a,b){"use strict";var c,d=50,e=function(){a.updating||(clearInterval(c),b(!0))},f=function(){a.updating||(a.removeEventListener("updateend",f,!1),b(!0))};if(!a.updating)return void b(!0);if("function"==typeof a.addEventListener)try{a.addEventListener("updateend",f,!1)}catch(g){c=setInterval(e,d)}else c=setInterval(e,d)},append:function(a,b){var c=this,d="append"in a?"append":"appendBuffer"in a?"appendBuffer":null;if(d)try{c.waitForUpdateEnd(a,function(){a[d](b),c.waitForUpdateEnd(a,function(){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,a,b)})})}catch(e){c.notify(c.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,a,b,e)}},remove:function(a,b,c,d){var e=this;try{b>=0&&c>b&&"ended"!==d.readyState&&a.remove(b,c),this.waitForUpdateEnd(a,function(){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,a,b,c)})}catch(f){e.notify(e.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,a,b,c,f)}},abort:function(a,b){"use strict";try{"open"===a.readyState&&b.abort()}catch(c){}}},MediaPlayer.dependencies.Stream=function(){"use strict";var a,b,c,d,e,f,g={},h=[],i=!0,j=!1,k=!1,l=!1,m=null,n=[],o=!0,p=null,q=null,r=function(){j&&this.playbackController.start()},s=function(){this.playbackController.pause()},t=function(a){j&&(this.debug.log("Do seek: "+a),this.playbackController.seek(a))},u=function(a){var b,c=this,d=g.video,e=g?g.video.codec:null;if(b="msneedkey"!==a.type?a.type:e,n.push({type:b,initData:a.initData}),this.debug.log("DRM: Key required for - "+b),d&&e&&!m)try{m=c.protectionController.selectKeySystem(d)}catch(f){s.call(c),c.debug.log(f),c.errHandler.mediaKeySystemSelectionError(f)}m&&c.protectionController.ensureKeySession(m,b,a.initData)},v=function(a){var b=this,c=null,d=null,e=null,f=null;this.debug.log("DRM: Got a key message..."),c=a.target,d=new Uint16Array(a.message.buffer),e=String.fromCharCode.apply(null,d),f=a.destinationURL,b.protectionController.updateFromMessage(m,c,e,f)},w=function(){this.debug.log("DRM: Key added.")},x=function(){var a,b=event.target;switch(a="DRM: MediaKeyError - sessionId: "+b.sessionId+" errorCode: "+b.error.code+" systemErrorCode: "+b.error.systemCode+" [",b.error.code){case 1:a+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:a+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:a+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:a+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:a+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:a+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}a+="]",this.debug.log(a),this.errHandler.mediaKeySessionError(a)},y=function(a,b){var c=this,d=function(e){c.debug.log("MediaSource is open!"),c.debug.log(e),a.removeEventListener("sourceopen",d),a.removeEventListener("webkitsourceopen",d),b(a)};a.addEventListener("sourceopen",d,!1),a.addEventListener("webkitsourceopen",d,!1),c.mediaSourceExt.attachMediaSource(a,c.videoModel)},z=function(){var c,d=this,e=h.length,f=0;for(f;e>f;f+=1)c=h[f],c.reset(l),c=null;q&&q.reset(),h=[],b&&d.mediaSourceExt.detachMediaSource(d.videoModel),j=!1,m=null,n=[],g={},b=null,a=null},A=function(a,c){var d,e,f,i=this,j=function(a){return a.codec},k=i.adapter.getMediaInfoForType(c,p,a);if("text"===a&&(j=function(a){return d=a.mimeType}),null!==k){var l,m=j.call(i,k),n=null;if(m===d)try{n=i.sourceBufferExt.createSourceBuffer(b,k)}catch(o){i.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else if(e=m,i.debug.log(a+" codec: "+e),g[a]=k,l=k.contentProtection,l&&!i.capabilities.supportsMediaKeys())i.errHandler.capabilityError("mediakeys");else if(i.capabilities.supportsCodec(i.videoModel.getElement(),e))try{n=i.sourceBufferExt.createSourceBuffer(b,k)}catch(o){i.errHandler.mediaSourceError("Error creating "+a+" source buffer.")}else{var r=a+"Codec ("+e+") is not supported.";i.errHandler.manifestError(r,"codec",c),i.debug.log(r)}null===n?i.debug.log("No buffer was created, skipping "+a+" data."):(f=i.system.getObject("streamProcessor"),h.push(f),f.initialize(d||a,n,i.videoModel,i.fragmentController,i.playbackController,b,i,q),f.setMediaInfo(k),i.adapter.updateData(f))}else i.debug.log("No "+a+" data.")},B=function(){var b,c=this;q=c.system.getObject("eventController"),q.initialize(c.videoModel),b=c.adapter.getEventsFor(p),q.addInlineEvents(b),A.call(c,"video",a),A.call(c,"audio",a),A.call(c,"text",a)},C=function(){var a,c,d=this;a=p.manifestInfo.duration,c=d.mediaSourceExt.setDuration(b,a),d.debug.log("Duration successfully set to: "+c),j=!0,F.call(d)},D=function(){this.debug.log("element loaded!"),k=!0,E.call(this)},E=function(){j&&k&&0===p.index&&(q.start(),i&&r.call(this))},F=function(){var a=this,b=h.length,c=0;if(j){for(c;b>c;c+=1)if(h[c].isUpdating())return;o=!1,a.notify(a.eventList.ENAME_STREAM_UPDATED)}},G=function(a,b){var c=b.code,d="";if(-1!==c){switch(c){case 1:d="MEDIA_ERR_ABORTED";break;case 2:d="MEDIA_ERR_NETWORK";break;case 3:d="MEDIA_ERR_DECODE";break;case 4:d="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:d="MEDIA_ERR_ENCRYPTED"}l=!0,this.debug.log("Video Element Error: "+d),this.debug.log(b),this.errHandler.mediaSourceError(d),this.reset()}},H=function(c){var d,e=this,f=function(c){if(b=c,B.call(e),0===h.length){var d="No streams to play.";e.errHandler.manifestError(d,"nostreams",a),e.debug.log(d)}else e.liveEdgeFinder.initialize(h[0]),e.liveEdgeFinder.subscribe(e.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,e.playbackController),C.call(e),E.call(e)};a=c,d=e.mediaSourceExt.createMediaSource(),y.call(e,d,f)},I=function(){var a=L(),c=a.length,d=0;for(d;c>d;d+=1)if(!a[d].isBufferingCompleted())return;b&&this.mediaSourceExt.signalEndOfStream(b)},J=function(){F.call(this)},K=function(a,b,c){c&&(s.call(this),this.debug.log(c),this.errHandler.mediaKeyMessageError(c))},L=function(){var a,b,c=[],d=0,e=h.length;for(d;e>d;d+=1)b=h[d],a=b.getType(),("audio"===a||"video"===a)&&c.push(b);return c},M=function(b){var c,d,e,f=this,g=h.length,i=0;for(o=!0,a=f.manifestModel.getValue(),p=b,f.debug.log("Manifest updated... set new data on buffers."),q&&(d=f.adapter.getEventsFor(p),q.addInlineEvents(d)),i;g>i;i+=1)e=h[i],c=f.adapter.getMediaInfoForType(a,p,e.getType()),e.setMediaInfo(c),this.adapter.updateData(e)};return{system:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,adapter:void 0,fragmentController:void 0,playbackController:void 0,protectionModel:void 0,protectionController:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_UPDATED:"streamUpdated"},setup:function(){this.bufferingCompleted=I,this.dataUpdateCompleted=J,this.playbackError=G,this.playbackMetaDataLoaded=D,this.keySystemUpdateCompleted=K},load:function(a){H.call(this,a)},setVideoModel:function(a){this.videoModel=a},initProtection:function(){c=u.bind(this),d=v.bind(this),e=w.bind(this),f=x.bind(this),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(this.getVideoModel()),this.protectionController=this.system.getObject("protectionController"),this.protectionController.init(this.videoModel,this.protectionModel),this.protectionModel.listenToNeedKey(c),this.protectionModel.listenToKeyMessage(d),this.protectionModel.listenToKeyError(f),this.protectionModel.listenToKeyAdded(e),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this)},getVideoModel:function(){return this.videoModel},setAutoPlay:function(a){i=a},getAutoPlay:function(){return i},reset:function(){s.call(this),z.call(this),this.protectionController&&this.protectionController.teardownKeySystem(m),this.protectionModel&&this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this),this.protectionController=void 0,this.protectionModel=void 0,this.fragmentController=void 0,this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_ERROR,this),this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_METADATA_LOADED,this),this.playbackController.reset(),this.liveEdgeFinder.abortSearch(),this.liveEdgeFinder.unsubscribe(this.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,this.playbackController),k=!1},getDuration:function(){return p.duration},getStartTime:function(){return p.start},getStreamIndex:function(){return p.index},getId:function(){return p.id},setStreamInfo:function(a){p=a},getStreamInfo:function(){return p},startEventController:function(){q.start()},resetEventController:function(){q.reset()},setPlaybackController:function(a){this.playbackController=a,a.initialize(p,this.videoModel)},getPlaybackController:function(){return this.playbackController},isUpdating:function(){return o},updateData:M,play:r,seek:t,pause:s}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.StreamController=function(){"use strict";var a,b=[],c=6,d=.2,e=!0,f=!1,g=function(){a.play()},h=function(){a.pause()},i=function(b){a.seek(b)},j=function(a,b){var c=a.getVideoModel().getElement(),d=b.getVideoModel().getElement();d.parentNode||c.parentNode.insertBefore(d,c),c.style.width="0px",d.style.width="100%",m(c,d),l.call(this,a),k.call(this,b)},k=function(a){var b=a.getPlaybackController();b.subscribe(b.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),b.subscribe(b.eventList.ENAME_PLAYBACK_SEEKING,this),b.subscribe(b.eventList.ENAME_PLAYBACK_TIME_UPDATED,this),b.subscribe(b.eventList.ENAME_PLAYBACK_PROGRESS,this)},l=function(a){var b=this,c=a.getPlaybackController();setTimeout(function(){c.unsubscribe(c.eventList.ENAME_PLAYBACK_STARTED,b.manifestUpdater),c.unsubscribe(c.eventList.ENAME_PLAYBACK_PAUSED,b.manifestUpdater),c.unsubscribe(c.eventList.ENAME_PLAYBACK_SEEKING,b),c.unsubscribe(c.eventList.ENAME_PLAYBACK_TIME_UPDATED,b),c.unsubscribe(c.eventList.ENAME_PLAYBACK_PROGRESS,b)},1)},m=function(a,b){["controls","loop","muted","volume"].forEach(function(c){b[c]=a[c]})},n=function(a,b,d){!d||d>=c||q()},o=function(b,c){var e=this;e.metricsModel.addDroppedFrames("video",e.videoExt.getPlaybackQuality(a.getVideoModel().getElement())),r()&&(a.getVideoModel().getElement().seeking||d>c&&v.call(this,a,r()))},p=function(b,c){var d=s(c);d&&d!==a&&v.call(this,a,d,c)},q=function(){var a=r();a&&a.seek(a.getStartTime())},r=function(){var c=a.getStreamIndex()+1;return c<b.length?b[c]:null},s=function(a){var c=0,d=null,e=b.length;e>0&&(c+=b[0].getStartTime());for(var f=0;e>f;f++)if(d=b[f],c+=d.getDuration(),c>a)return d;return null},t=function(){var a=this.system.getObject("videoModel"),b=document.createElement("video");return a.setElement(b),a},u=function(a){a.parentNode&&a.parentNode.removeChild(a)},v=function(b,c,d){!f&&b&&c&&b!==c&&(f=!0,b.pause(),a=c,j.call(this,b,c),i(d?b.getPlaybackController().getTime():c.getStartTime()),g(),b.resetEventController(),a.startEventController(),f=!1)},w=function(){var c,d,f,g,h,i,j,l,m=this,n=m.manifestModel.getValue(),o=m.metricsModel.getMetricsFor("stream"),p=m.metricsExt.getCurrentManifestUpdate(o);if(n){j=m.adapter.getStreamsInfo(n);try{if(0===j.length)throw new Error("There are no streams");for(m.metricsModel.updateManifestUpdateInfo(p,{currentTime:m.videoModel.getCurrentTime(),buffered:m.videoModel.getElement().buffered,presentationStartTime:j[0].start,clientTimeOffset:m.timelineConverter.getClientTimeOffset()}),h=0,f=j.length;f>h;h+=1){for(d=j[h],i=0,g=b.length;g>i;i+=1)b[i].getId()===d.id&&(l=b[i],l.updateData(d));l||(l=m.system.getObject("stream"),c=m.system.getObject("playbackController"),l.setStreamInfo(d),l.setVideoModel(0===h?m.videoModel:t.call(m)),l.setPlaybackController(c),c.subscribe(c.eventList.ENAME_PLAYBACK_ERROR,l),c.subscribe(c.eventList.ENAME_PLAYBACK_METADATA_LOADED,l),l.initProtection(),l.setAutoPlay(e),l.load(n),l.subscribe(l.eventList.ENAME_STREAM_UPDATED,m),b.push(l)),m.metricsModel.addManifestUpdateStreamInfo(p,d.id,d.index,d.start,d.duration),l=null}a||(a=b[0],k.call(m,a),a.subscribe(a.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder))}catch(q){m.errHandler.manifestError(q.message,"nostreamscomposed",m.manifestModel.getValue()),m.reset()}}},x=function(){var a=this,c=b.length,d=0;for(d;c>d;d+=1)if(b[d].isUpdating())return;a.notify(a.eventList.ENAME_STREAMS_COMPOSED)},y=function(a,b,c){c?this.reset():(this.manifestModel.setValue(b),this.debug.log("Manifest has loaded."),w.call(this))};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,adapter:void 0,debug:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAMS_COMPOSED:"streamsComposed"},setup:function(){this.manifestLoaded=y,this.streamUpdated=x,this.playbackSeeking=p,this.playbackProgress=n,this.playbackTimeUpdated=o},setAutoPlay:function(a){e=a},getAutoPlay:function(){return e},getVideoModel:function(){return this.videoModel},setVideoModel:function(a){this.videoModel=a},load:function(a){this.manifestLoader.load(a)},reset:function(){a&&l.call(this,a);for(var c=0,d=b.length;d>c;c++){var e=b[c];e.unsubscribe(e.eventList.ENAME_STREAM_UPDATED,this),e.reset(),e!==a&&u(e.getVideoModel().getElement())}b=[],this.manifestUpdater.stop(),this.metricsModel.clearAllCurrentMetrics(),this.manifestModel.setValue(null),this.timelineConverter.reset(),this.adapter.reset(),f=!1,a=null},play:g,seek:i,pause:h}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var a,b,c,d,e,f=function(a){var b=this,c="video"===a||"audio"===a?"bufferController":"textController";return b.system.getObject(c)};return{system:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,eventList:void 0,abrController:void 0,baseURLExt:void 0,adapter:void 0,initialize:function(c,g,h,i,j,k,l,m){var n,o=this,p=o.system.getObject("trackController"),q=o.system.getObject("scheduleController"),r=o.liveEdgeFinder,s=o.abrController,t=o.indexHandler,u=o.baseURLExt,v=this.system.getObject("fragmentLoader"),w=f.call(o,c);b=l,d=c,e=m,a=b.getStreamInfo().manifestInfo.isDynamic,o.bufferController=w,o.playbackController=j,o.scheduleController=q,o.trackController=p,o.videoModel=h,o.fragmentController=i,o.fragmentLoader=v,p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,w),i.subscribe(i.eventList.ENAME_INIT_FRAGMENT_LOADED,w),w.subscribe(w.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,q),("video"===d||"audio"===d)&&(s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,w),s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,p),s.subscribe(s.eventList.ENAME_QUALITY_CHANGED,q),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,p),r.subscribe(r.eventList.ENAME_LIVE_EDGE_FOUND,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_STARTED,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,q),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,s),p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,b),j.streamProcessor||(j.streamProcessor=o,p.subscribe(p.eventList.ENAME_DATA_UPDATE_COMPLETED,j)),i.subscribe(i.eventList.ENAME_MEDIA_FRAGMENT_LOADED,w),i.subscribe(i.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,q),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,q),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,w),i.subscribe(i.eventList.ENAME_STREAM_COMPLETED,q.scheduleRulesCollection.bufferLevelRule),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,h),w.subscribe(w.eventList.ENAME_BUFFER_CLEARED,q),w.subscribe(w.eventList.ENAME_BYTES_APPENDED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_UPDATED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_UPDATED,p),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,q),w.subscribe(w.eventList.ENAME_INIT_REQUESTED,q),w.subscribe(w.eventList.ENAME_BUFFERING_COMPLETED,b),w.subscribe(w.eventList.ENAME_QUOTA_EXCEEDED,q),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_OUTRUN,q.scheduleRulesCollection.bufferLevelRule),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_BALANCED,q.scheduleRulesCollection.bufferLevelRule),j.subscribe(j.eventList.ENAME_PLAYBACK_PROGRESS,w),j.subscribe(j.eventList.ENAME_PLAYBACK_TIME_UPDATED,w),j.subscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,w),j.subscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,q),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,w),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,q),j.subscribe(j.eventList.ENAME_PLAYBACK_STARTED,q),j.subscribe(j.eventList.ENAME_PLAYBACK_SEEKING,q.scheduleRulesCollection.playbackTimeRule),a&&j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,p),j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,w),j.subscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,q),u.subscribe(u.eventList.ENAME_INITIALIZATION_LOADED,t),u.subscribe(u.eventList.ENAME_SEGMENTS_LOADED,t)),t.initialize(this),w.initialize(d,g,k,o),q.initialize(d,this),n=this.getFragmentModel(),n.setLoader(v),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_STARTED,i),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,i),n.subscribe(n.eventList.ENAME_STREAM_COMPLETED,i),n.subscribe(n.eventList.ENAME_FRAGMENT_LOADING_FAILED,q),v.subscribe(v.eventList.ENAME_LOADING_COMPLETED,n),("video"===d||"audio"===d)&&(w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_OUTRUN,n),w.subscribe(w.eventList.ENAME_BUFFER_LEVEL_BALANCED,n),w.subscribe(w.eventList.ENAME_BYTES_REJECTED,n)),p.initialize(this)},isUpdating:function(){return this.trackController.isUpdating()},getType:function(){return d},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},getStreamInfo:function(){return b.getStreamInfo()},setMediaInfo:function(a){c=a},getMediaInfo:function(){return c},getEventController:function(){return e},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getCurrentTrack:function(){return this.adapter.getCurrentTrackInfo(this.trackController)},getTrackForQuality:function(a){return this.adapter.getTrackInfoForQuality(this.trackController,a)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},isDynamic:function(){return a},reset:function(a){var c=this,d=c.bufferController,e=c.trackController,f=c.scheduleController,g=c.liveEdgeFinder,h=c.fragmentController,i=c.abrController,j=c.playbackController,k=this.indexHandler,l=this.baseURLExt,m=this.getFragmentModel(),n=this.fragmentLoader,o=c.videoModel;i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,d),i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,e),i.unsubscribe(i.eventList.ENAME_QUALITY_CHANGED,f),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,f),g.unsubscribe(g.eventList.ENAME_LIVE_EDGE_FOUND,e),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_STARTED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,d),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,f),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,i),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,b),e.unsubscribe(e.eventList.ENAME_DATA_UPDATE_COMPLETED,j),h.unsubscribe(h.eventList.ENAME_INIT_FRAGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_MEDIA_FRAGMENT_LOADED,d),h.unsubscribe(h.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,f),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,d),h.unsubscribe(h.eventList.ENAME_STREAM_COMPLETED,f.scheduleRulesCollection.bufferLevelRule),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,o),d.unsubscribe(d.eventList.ENAME_BUFFER_CLEARED,f),d.unsubscribe(d.eventList.ENAME_BYTES_APPENDED,f),d.unsubscribe(d.eventList.ENAME_BYTES_REJECTED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_UPDATED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_UPDATED,e),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,f),d.unsubscribe(d.eventList.ENAME_INIT_REQUESTED,f),d.unsubscribe(d.eventList.ENAME_BUFFERING_COMPLETED,b),d.unsubscribe(d.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,f),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,f.scheduleRulesCollection.bufferLevelRule),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,f.scheduleRulesCollection.bufferLevelRule),j.unsubscribe(j.eventList.ENAME_PLAYBACK_PROGRESS,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_TIME_UPDATED,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_RATE_CHANGED,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,d),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_STARTED,f),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,d),j.unsubscribe(j.eventList.ENAME_WALLCLOCK_TIME_UPDATED,f),j.unsubscribe(j.eventList.ENAME_PLAYBACK_SEEKING,f.scheduleRulesCollection.playbackTimeRule),l.unsubscribe(l.eventList.ENAME_INITIALIZATION_LOADED,k),l.unsubscribe(l.eventList.ENAME_SEGMENTS_LOADED,k),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_OUTRUN,m),d.unsubscribe(d.eventList.ENAME_BUFFER_LEVEL_BALANCED,m),d.unsubscribe(d.eventList.ENAME_BYTES_REJECTED,m),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_STARTED,h),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,h),m.unsubscribe(m.eventList.ENAME_STREAM_COMPLETED,h),m.unsubscribe(m.eventList.ENAME_FRAGMENT_LOADING_FAILED,f),n.unsubscribe(n.eventList.ENAME_LOADING_COMPLETED,m),h.resetModel(m),k.reset(),this.bufferController.reset(a),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.trackController=null,this.videoModel=null,this.fragmentController=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.utils.TokenAuthentication=function(){"use strict";var a={type:MediaPlayer.utils.TokenAuthentication.TYPE_QUERY};return{debug:void 0,getTokenAuthentication:function(){return a},setTokenAuthentication:function(b){a=b},checkRequestHeaderForToken:function(b){void 0!==a.name&&null!==b.getResponseHeader(a.name)&&(a.token=b.getResponseHeader(a.name),this.debug.log(a.name+" received: "+a.token))},addTokenAsQueryArg:function(b){if(void 0!==a.name&&void 0!==a.token&&a.type===MediaPlayer.utils.TokenAuthentication.TYPE_QUERY){var c=-1===b.indexOf("?")?"?":"&";b+=c+a.name+"="+a.token,this.debug.log(a.name+" is being appended on the request url with a value of : "+a.token)}return b},setTokenInRequestHeader:function(b){return a.type===MediaPlayer.utils.TokenAuthentication.TYPE_HEADER&&(b.setRequestHeader(a.name,a.token),this.debug.log(a.name+" is being set in the request header with a value of : "+a.token)),b}}},MediaPlayer.utils.TokenAuthentication.TYPE_QUERY="query",MediaPlayer.utils.TokenAuthentication.TYPE_HEADER="header",MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var a=new MediaPlayer.vo.URIFragmentData,b=[],c=function(c){function d(a,b,c,d){var e=d[0].split(/[=]/);return d.push({key:e[0],value:e[1]}),d.shift(),d}function e(a,c,d){return c>0&&(j&&0===b.length?b=d[c].split(/[&]/):k&&(g=d[c].split(/[&]/))),d}if(!c)return null;var f,g=[],h=new RegExp(/[?]/),i=new RegExp(/[#]/),j=h.test(c),k=i.test(c);return f=c.split(/[?#]/).map(e),b.length>0&&(b=b.reduce(d,null)),g.length>0&&(g=g.reduce(d,null),g.forEach(function(b){a[b.key]=b.value})),c};return{parseURI:c,getURIFragmentData:a,getURIQueryData:b,reset:function(){a=new MediaPlayer.vo.URIFragmentData,b=[]}}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.models.VideoModel=function(){"use strict";var a,b=[],c=function(){return b.length>0},d=function(c){null!==c&&(a.playbackRate=0,b[c]!==!0&&(b.push(c),b[c]=!0))},e=function(d){if(null!==d){b[d]=!1;var e=b.indexOf(d);-1!==e&&b.splice(e,1),c()===!1&&(a.playbackRate=1)}},f=function(a,b){b?d(a):e(a)},g=function(a,b){var c=a.streamProcessor.getType();f.call(this,c,!b)};return{system:void 0,setup:function(){this.bufferLevelStateChanged=g},play:function(){a.play()},pause:function(){a.pause()},isPaused:function(){return a.paused},getPlaybackRate:function(){return a.playbackRate},setPlaybackRate:function(b){a.playbackRate=b},getCurrentTime:function(){return a.currentTime},setCurrentTime:function(b){a.currentTime!=b&&(a.currentTime=b)},listen:function(b,c){a.addEventListener(b,c,!1)},unlisten:function(b,c){a.removeEventListener(b,c,!1)},getElement:function(){return a},setElement:function(b){a=b},setSource:function(b){a.src=b}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(a){var b="webkitDroppedFrameCount"in a,c="getVideoPlaybackQuality"in a,d=null;
return c?d=a.getVideoPlaybackQuality():b&&(d={droppedVideoFrames:a.webkitDroppedFrameCount,creationTime:new Date}),d}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.utils.TTMLParser=function(){"use strict";var a,b=3600,c=60,d=/^(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])((\.[0-9][0-9][0-9])|(:[0-9][0-9]))$/,e=function(e){var f,g,h,i=d.test(e);if(!i)return 0/0;if(f=e.split(":"),g=parseFloat(f[0])*b+parseFloat(f[1])*c+parseFloat(f[2]),f[3]){if(h=a.tt.frameRate,!h||isNaN(h))return 0/0;g+=parseFloat(f[3])/h}return g},f=function(){var b=!1,c=a.hasOwnProperty("tt"),d=c?a.tt.hasOwnProperty("head"):!1,e=d?a.tt.head.hasOwnProperty("layout"):!1,f=d?a.tt.head.hasOwnProperty("styling"):!1,g=c?a.tt.hasOwnProperty("body"):!1,h=d?a.tt.head.hasOwnProperty("profile"):!1;return c&&d&&e&&f&&g&&(b=!0),b&&(b=h&&"http://www.w3.org/ns/ttml/profile/sdp-us"===a.tt.head.profile.use),b},g=function(a,b){var c=Object.keys(a).filter(function(c){return"xmlns"===c.split(":")[0]&&a[c]===b}).map(function(a){return a.split(":")[1]});return 1!=c.length?null:c[0]},h=function(b){var c,d,h,i,j,k,l,m=[],n=new X2JS([],"",!1);if(a=n.xml_str2json(b),!f())throw c="TTML document has incorrect structure";if(k=g(a.tt,"http://www.w3.org/ns/ttml#parameter"),a.tt.hasOwnProperty(k+":frameRate")&&(a.tt.frameRate=parseInt(a.tt[k+":frameRate"],10)),d=a.tt.body.div_asArray[0].p_asArray,!d||0===d.length)throw c="TTML document does not contain any cues";for(l=0;l<d.length;l+=1){if(h=d[l],i=e(h.begin),j=e(h.end),isNaN(i)||isNaN(j))throw c="TTML document has incorrect timing value";m.push({start:i,end:j,data:h.__text})}return m};return{parse:h}},MediaPlayer.dependencies.TextController=function(){var a,b,c,d=!1,e=function(){d||(b.hasOwnProperty("initialize")&&b.initialize(c,this),d=!0),this.notify(this.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,0)},f=function(a,c,d){var e=this;c===e.streamProcessor.getFragmentModel()&&null!==d&&e.sourceBufferExt.append(b,d,e.videoModel)};return{sourceBufferExt:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"},setup:function(){this.dataUpdateCompleted=e,this.initFragmentLoaded=f},initialize:function(a,b,d,e){var f=this;c=a,f.setBuffer(b),f.setMediaSource(d),f.videoModel=e.videoModel,f.trackController=e.trackController,f.streamProcessor=e},getBuffer:function(){return b},setBuffer:function(a){b=a},setMediaSource:function(b){a=b},reset:function(c){c||(this.sourceBufferExt.abort(a,b),this.sourceBufferExt.removeSourceBuffer(a,b))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextSourceBuffer=function(){var a,b;return{system:void 0,eventBus:void 0,errHandler:void 0,initialize:function(c,d){b=c,this.videoModel=d.videoModel,a=d.streamProcessor.getCurrentTrack().mediaInfo},append:function(b){var c,d,e,f=this,g=String.fromCharCode.apply(null,new Uint16Array(b));try{c=f.getParser().parse(g),d=a.id,e=a.lang,f.getTextTrackExtensions().addTextTrack(f.videoModel.getElement(),c,d,e,!0),f.eventBus.dispatchEvent({type:"updateend"})}catch(h){f.errHandler.closedCaptionsError(h,"parse",g)}},abort:function(){this.getTextTrackExtensions().deleteCues(this.videoModel.getElement())},getParser:function(){var a;return"text/vtt"===b?a=this.system.getObject("vttParser"):"application/ttml+xml"===b&&(a=this.system.getObject("ttmlParser")),a},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(a,b,c){this.eventBus.addEventListener(a,b,c)},removeEventListener:function(a,b,c){this.eventBus.removeEventListener(a,b,c)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var a;return{setup:function(){a=window.VTTCue||window.TextTrackCue},addTextTrack:function(b,c,d,e,f){var g=b.addTextTrack("captions",d,e);g.default=f,g.mode="showing";for(var h in c){var i=c[h];g.addCue(new a(i.start,i.end,i.data))}return g},deleteCues:function(a){for(var b=a.textTracks[0],c=b.cues,d=c.length-1,e=d;e>=0;e-=1)b.removeCue(c[e]);b.mode="disabled"}}},MediaPlayer.utils.VTTParser=function(){"use strict";var a=function(a){var b=a.split(":"),c=b.length-1;return a=60*parseInt(b[c-1],10)+parseFloat(b[c],10),2===c&&(a+=3600*parseInt(b[0],10)),a};return{parse:function(b){var c,d=/(?:\r\n|\r|\n)/gm,e=/-->/,f=/(^[\s]+|[\s]+$)/g,g=[];b=b.split(d),c=b.length;for(var h=0;c>h;h++){var i=b[h];if(i.length>0&&"WEBVTT"!==i&&i.match(e)){var j=i.split(e),k=b[h+1];g.push({start:a(j[0].replace(f,"")),end:a(j[1].replace(f,"")),data:k})}}return g}}},MediaPlayer.rules.ABRRulesCollection=function(){"use strict";var a=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,limitSwitchesRule:void 0,getRules:function(b){switch(b){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return a;default:return null}},setup:function(){a.push(this.downloadRatioRule),a.push(this.insufficientBufferRule),a.push(this.limitSwitchesRule)}}},MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules"},MediaPlayer.rules.DownloadRatioRule=function(){"use strict";var a={},b=function(a,b,c){var d=a.getTrackForQuality(b).bandwidth;return d/c};return{debug:void 0,metricsExt:void 0,metricsModel:void 0,setStreamProcessor:function(b){var c=b.getType(),d=b.getStreamInfo().id;a[d]=a[d]||{},a[d][c]=b},execute:function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p=this,q=c.getStreamInfo().id,r=c.getMediaInfo(),s=r.type,t=c.getCurrentValue(),u=a[q][s],v=p.metricsModel.getReadOnlyMetricsFor(s),w=p.metricsExt.getCurrentHttpRequest(v),x=.75;if(!v)return void d(new MediaPlayer.rules.SwitchRequest);if(null===w)return void d(new MediaPlayer.rules.SwitchRequest);if(f=(w.tfinish.getTime()-w.trequest.getTime())/1e3,e=(w.tfinish.getTime()-w.tresponse.getTime())/1e3,0>=f)return void d(new MediaPlayer.rules.SwitchRequest);if(null===w.mediaduration||void 0===w.mediaduration||w.mediaduration<=0||isNaN(w.mediaduration))return void d(new MediaPlayer.rules.SwitchRequest);if(h=w.mediaduration/f,g=w.mediaduration/e*x,isNaN(g)||isNaN(h))return p.debug.log("The ratios are NaN, bailing."),void d(new MediaPlayer.rules.SwitchRequest);if(isNaN(g))o=new MediaPlayer.rules.SwitchRequest;else if(4>g)t>0?(p.debug.log("We are not at the lowest bitrate, so switch down."),j=u.getTrackForQuality(t-1).bandwidth,l=u.getTrackForQuality(t).bandwidth,i=j/l,i>g?(p.debug.log("Things must be going pretty bad, switch all the way down."),o=new MediaPlayer.rules.SwitchRequest(0)):(p.debug.log("Things could be better, so just switch down one index."),o=new MediaPlayer.rules.SwitchRequest(t-1))):o=new MediaPlayer.rules.SwitchRequest(t);else if(n=r.trackCount-1,n>t)if(k=u.getTrackForQuality(t+1).bandwidth,l=u.getTrackForQuality(t).bandwidth,i=k/l,g>=i)if(g>100)p.debug.log("Tons of bandwidth available, go all the way up."),o=new MediaPlayer.rules.SwitchRequest(n-1);else if(g>10)p.debug.log("Just enough bandwidth available, switch up one."),o=new MediaPlayer.rules.SwitchRequest(t+1);else{for(m=-1;(m+=1)<n&&!(g<b.call(p,u,m,l)););p.debug.log("Calculated ideal new quality index is: "+m),o=new MediaPlayer.rules.SwitchRequest(m)}else o=new MediaPlayer.rules.SwitchRequest;else o=new MediaPlayer.rules.SwitchRequest(n);d(o)},reset:function(){a={}}}},MediaPlayer.rules.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.DownloadRatioRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var a=0,b=3;return{debug:void 0,metricsModel:void 0,execute:function(c,d){var e,f,g=this,h=c.getMediaInfo().type,i=c.getCurrentValue(),j=g.metricsModel.getReadOnlyMetricsFor(h),k=!1,l=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===j.PlayList||void 0===j.PlayList||0===j.PlayList.length?void d(new MediaPlayer.rules.SwitchRequest):(e=j.PlayList[j.PlayList.length-1],null===e||void 0===e||0===e.trace.length?void d(new MediaPlayer.rules.SwitchRequest):(f=e.trace[e.trace.length-2],null===f||void 0===f||null===f.stopreason||void 0===f.stopreason?void d(new MediaPlayer.rules.SwitchRequest):(f.stopreason===MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON&&(k=!0,a+=1,g.debug.log("Number of times the buffer has run dry: "+a)),a>b&&(l=MediaPlayer.rules.SwitchRequest.prototype.STRONG,g.debug.log("Apply STRONG to buffer rule.")),void(k?(g.debug.log("The buffer ran dry recently, switch down."),d(new MediaPlayer.rules.SwitchRequest(i-1,l))):a>b?(g.debug.log("Too many dry buffer hits, quit switching bitrates."),d(new MediaPlayer.rules.SwitchRequest(i,l))):d(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l))))))}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.LimitSwitchesRule=function(){"use strict";var a=0,b=2e3;return{debug:void 0,metricsModel:void 0,execute:function(c,d){var e,f=this,g=c.getMediaInfo().type,h=c.getCurrentValue(),i=this.metricsModel.getReadOnlyMetricsFor(g),j=c.getManifestInfo(),k=i.RepSwitchList.length-1,l=i.RepSwitchList[k],m=(new Date).getTime();return b=1e3*Math.min(j.minBufferTime,j.maxFragmentDuration),e=m-a,b>e&&m-l.t.getTime()<b?(f.debug.log("Wait some time before allowing another switch."),void d(new MediaPlayer.rules.SwitchRequest(h,MediaPlayer.rules.SwitchRequest.prototype.STRONG))):(a=m,void d(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.STRONG)))}}},MediaPlayer.rules.LimitSwitchesRule.prototype={constructor:MediaPlayer.rules.LimitSwitchesRule},MediaPlayer.rules.RulesContext=function(a,b){"use strict";var c=a.getCurrentTrack();return{getStreamInfo:function(){return c.mediaInfo.streamInfo},getMediaInfo:function(){return c.mediaInfo},getTrackInfo:function(){return c},getCurrentValue:function(){return b},getManifestInfo:function(){return c.mediaInfo.streamInfo.manifestInfo}}},MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext},MediaPlayer.rules.BufferLevelRule=function(){"use strict";var a={},b={},c={},d=function(a){var b=this.metricsExt.getCurrentHttpRequest(a);return null!==b?(b.tresponse.getTime()-b.trequest.getTime())/1e3:0},e=function(a,b){var c;return c=isNaN(b)||MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME<b&&b>a?Math.max(MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME,a):a>=b?Math.min(b,MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME):Math.min(b,a)},f=function(a,b,c){var f=this,g=c.bufferController.getCriticalBufferLevel(),h=e.call(this,c.bufferController.getMinBufferTime(),b),i=h,j=c.bufferController.bufferMax,k=f.metricsModel.getReadOnlyMetricsFor("video"),l=f.metricsModel.getReadOnlyMetricsFor("audio"),m=b>=MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD,n=0;return j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN?n=h:j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY?n=b:j===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED&&(!a&&f.abrController.isPlayingAtTopQuality()&&(i=m?MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY),n=i+Math.max(d.call(f,k),d.call(f,l))),n=Math.min(n,g)},g=function(a,c){return b[a]&&b[a][c]},h=function(b,c){return a[b]&&a[b][c]},i=function(a,c,d){var e=c.getContext().streamProcessor.getStreamInfo().id;b[e]=b[e]||{},b[e][d.mediaType]=!0},j=function(b){var c=b.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.streamProcessor.getType()]=!0},k=function(b){var c=b.streamProcessor.getStreamInfo().id;a[c]=a[c]||{},a[c][b.streamProcessor.getType()]=!1};return{metricsExt:void 0,metricsModel:void 0,abrController:void 0,setup:function(){this.bufferLevelOutrun=j,this.bufferLevelBalanced=k,this.streamCompleted=i},setScheduleController:function(a){var b=a.streamProcessor.getStreamInfo().id;c[b]=c[b]||{},c[b][a.streamProcessor.getType()]=a},execute:function(a,b){var d=a.getStreamInfo(),e=d.id,i=a.getMediaInfo().type;if(h(e,i))return void b(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var j,k=this.metricsModel.getReadOnlyMetricsFor(i),l=this.metricsExt.getCurrentBufferLevel(k)?this.metricsExt.getCurrentBufferLevel(k).level:0,m=c[e][i],n=m.streamProcessor.getCurrentTrack(),o=m.streamProcessor.isDynamic(),p=this.metricsExt.getCurrentPlaybackRate(k),q=d.duration,r=l/Math.max(p,1),s=n.fragmentDuration,t=m.playbackController.getTime(),u=o?Number.POSITIVE_INFINITY:q-t,v=Math.min(f.call(this,o,q,m),u),w=Math.max(v-r,0);j=Math.ceil(w/s),r>=u&&!g(e,i)&&(j=j||1),b(new MediaPlayer.rules.SwitchRequest(j,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){a={},b={},c={}}}},MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule},MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){"use strict";var a,b,c=43200,d=0/0,e=null,f=0/0,g=null,h=!1,i=0/0,j=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,k=function(b,c,d,e){var f,h=this;if(null===e)f=h.adapter.generateFragmentRequestForTime(a.streamProcessor,g,b),k.call(h,b,c,d,f);else{var i=function(e,f,g){a.fragmentLoader.unsubscribe(a.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),f?c.call(h,g,b):d.call(h,g,b)};a.fragmentLoader.subscribe(a.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,h,i),a.fragmentLoader.checkForExistence(e)}},l=function(c,i){var o,p,q;return h?void n.call(this,!1,i):(q=i-d,o=q>0?d-q:d+Math.abs(q)+f,void(o<e.start&&o>e.end?b(new MediaPlayer.rules.SwitchRequest(null,j)):(p=this.adapter.getFragmentRequestForTime(a.streamProcessor,g,o),k.call(this,o,m,l,p))))},m=function(c,l){var m,o,p=c.startTime,q=this;if(!h){if(!g.fragmentDuration)return void b(new MediaPlayer.rules.SwitchRequest(p,j));if(h=!0,e.end=p+2*f,l===d)return o=l+i,m=q.adapter.getFragmentRequestForTime(a.streamProcessor,g,o),void k.call(q,o,function(){n.call(q,!0,o)},function(){b(new MediaPlayer.rules.SwitchRequest(o,j))},m)}n.call(this,!0,l)},n=function(c,d){var f,h,n;c?e.start=d:e.end=d,f=Math.floor(e.end-e.start)<=i,f?b(new MediaPlayer.rules.SwitchRequest(c?d:d-i,j)):(n=(e.start+e.end)/2,h=this.adapter.getFragmentRequestForTime(a.streamProcessor,g,n),k.call(this,n,m,l,h))};return{metricsExt:void 0,adapter:void 0,setFinder:function(b){a=b},execute:function(h,n){var o,p,q=this;return b=n,g=a.streamProcessor.getCurrentTrack(),i=g.fragmentDuration,p=g.DVRWindow,d=p.end,g.useCalculatedLiveEdgeTime?void b(new MediaPlayer.rules.SwitchRequest(d,j)):(e={start:Math.max(0,d-c),end:d+c},f=Math.floor((p.end-p.start)/2),o=q.adapter.getFragmentRequestForTime(a.streamProcessor,g,d),void k.call(q,d,m,l,o))},reset:function(){d=0/0,e=null,f=0/0,g=null,h=!1,i=0/0,a=null}}},MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule},MediaPlayer.rules.PendingRequestsRule=function(){"use strict";var a=3,b={};return{metricsExt:void 0,setScheduleController:function(a){var c=a.streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.streamProcessor.getType()]=a},execute:function(c,d){var e=c.getMediaInfo().type,f=c.getStreamInfo().id,g=c.getCurrentValue(),h=b[f][e],i=h.getFragmentModel(),j=i.getPendingRequests(),k=i.getLoadingRequests(),l=i.getRejectedRequests(),m=l.length,n=j.length+k.length,o=Math.max(g-n,0);return m>0?void d(new MediaPlayer.rules.SwitchRequest(m,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):n>a?void d(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):0===g?void d(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE)):void d(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){b={}}}},MediaPlayer.rules.PendingRequestsRule.prototype={constructor:MediaPlayer.rules.PendingRequestsRule},MediaPlayer.rules.PlaybackTimeRule=function(){"use strict";var a={},b={},c=function(b,c){var d=b.getStreamId();a[d]=a[d]||{},a[d].audio=c,a[d].video=c};return{adapter:void 0,sourceBufferExt:void 0,setup:function(){this.playbackSeeking=c},setScheduleController:function(a){var c=a.streamProcessor.getStreamInfo().id;b[c]=b[c]||{},b[c][a.streamProcessor.getType()]=a},execute:function(c,d){var e,f,g,h=c.getMediaInfo().type,i=c.getStreamInfo().id,j=b[i][h],k=b[i][h].streamProcessor,l=k.getCurrentTrack(),m=a[i]?a[i][h]:null,n=m?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,o=j.getFragmentModel().getRejectedRequests().shift(),p=!!o&&!m,q=this.adapter.getIndexHandlerTime(k),r=k.playbackController.getTime(),s=o?o.startTime+o.duration:null,t=o&&(s>r&&o.startTime<=q||isNaN(q));if(f=m||(t?o.startTime:q),isNaN(f))return void d(new MediaPlayer.rules.SwitchRequest(null,n));for(a[i]&&(a[i][h]=null),e=this.sourceBufferExt.getBufferRange(k.bufferController.getBuffer(),f),null!==e&&(f=e.end),g=this.adapter.getFragmentRequestForTime(k,l,f,p);g&&k.fragmentController.isFragmentLoadedOrPending(j,g);){if("complete"===g.action){g=null,this.adapter.setIndexHandlerTime(k,0/0);break}g=this.adapter.getNextFragmentRequest(k,l)}g&&!t&&this.adapter.setIndexHandlerTime(k,g.startTime+g.duration),d(new MediaPlayer.rules.SwitchRequest(g,n))},reset:function(){a={},b={}}}},MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule},MediaPlayer.rules.RulesController=function(){"use strict";var a={},b=["execute"],c=function(a){return a===this.SCHEDULING_RULE||a===this.ABR_RULE},d=function(a){var c=b.length,d=0;for(d;c>d;d+=1)if(!a.hasOwnProperty(b[d]))return!1;return!0},e=function(a,b){return new MediaPlayer.rules.RulesContext(a,b)},f=function(a){var b=a.execute.bind(a);return a.execute=function(c,d){var e=function(b){d.call(a,new MediaPlayer.rules.SwitchRequest(b.value,b.priority))};b(c,e)},"function"!=typeof a.reset&&(a.reset=function(){}),a},g=function(a,b,c){var e,g,h,i,j,k;for(g in b)if(i=b[g],j=i.length)for(k=0;j>k;k+=1)e=i[k],d.call(this,e)&&(e=f.call(this,e),h=a.getRules(g),c&&(h.length=0),h.push(e))};return{system:void 0,debug:void 0,SCHEDULING_RULE:0,ABR_RULE:1,initialize:function(){a[this.ABR_RULE]=this.system.getObject("abrRulesCollection"),a[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection")},setRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!0)},addRules:function(b,d){c.call(this,b)&&d&&g.call(this,a[b],d,!1)},applyRules:function(a,b,c,f,g){var h,i,j=a.length,k=j,l={},m=e.call(this,b,f),n=function(a){var b,d;a.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(l[a.priority]=g(l[a.priority],a.value)),--j||(l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.WEAK,b=l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,b=l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(d=MediaPlayer.rules.SwitchRequest.prototype.STRONG,b=l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),d!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&d!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(d=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),c({value:b||f,confidence:d}))};for(l[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,l[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,i=0;k>i;i+=1)h=a[i],d.call(this,h)?h.execute(m,n):j--},reset:function(){a={}}}},MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController},MediaPlayer.rules.SameTimeRequestRule=function(){"use strict";var a=4,b=function(a,b){var c,e,f,g,h,i=0,j=a.length;for(i;j>i;i+=1)for(f=a[i].getPendingRequests(),d.call(this,f,"index"),g=0,h=f.length;h>g;g++){if(c=f[g],isNaN(c.startTime)&&"complete"!==c.action){e=c;break}c.startTime>b&&(!e||c.startTime<e.startTime)&&(e=c)}return e||c},c=function(a,b){var c,d,e=a.length,f=null;for(d=0;e>d;d+=1)c=a[d].getPendingRequestForTime(b),c&&(!f||c.startTime>f.startTime)&&(f=c);return f},d=function(a,b){var c=function(a,c){return a[b]<c[b]||isNaN(a[b])&&"complete"!==a.action?-1:a[b]>c[b]?1:0};a.sort(c)};return{setFragmentModels:function(a,b){this.fragmentModels=this.fragmentModels||{},this.fragmentModels[b]=a},execute:function(d,e){var f,g,h,i,j,k,l,m,n,o=d.getStreamInfo().id,p=d.getCurrentValue(),q=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,r=this.fragmentModels[o],s=new Date,t=null,u=r?r.length:null,v=!1,w=[];if(!r||!u)return void e(new MediaPlayer.rules.SwitchRequest([],q));if(k=Math.round(100*r[0].getContext().playbackController.getTime())/100,l=c(r,k),j=l||b(r,k)||p,!j)return void e(new MediaPlayer.rules.SwitchRequest([],q));for(i=0;u>i;i+=1)if(g=r[i],f=g.getContext().streamProcessor.getType(),("video"===f||"audio"===f)&&(m=g.getPendingRequests(),n=g.getLoadingRequests().length,!g.getIsPostponed()||isNaN(j.startTime))){if(n>a)return void e(new MediaPlayer.rules.SwitchRequest([],q));if(t=t||(j===l?k:j.startTime),-1===m.indexOf(j)){if(h=g.getPendingRequestForTime(t))w.push(h);else if(h=g.getLoadingRequestForTime(t)||g.getExecutedRequestForTime(t),!h){v=!0;break}}else w.push(j)}return w=w.filter(function(a){return"complete"===a.action||s.getTime()>=a.availabilityStartTime.getTime()}),v?void e(new MediaPlayer.rules.SwitchRequest([],q)):void e(new MediaPlayer.rules.SwitchRequest(w,q))}}},MediaPlayer.rules.SameTimeRequestRule.prototype={constructor:MediaPlayer.rules.SameTimeRequestRule},MediaPlayer.rules.ScheduleRulesCollection=function(){"use strict";var a=[],b=[],c=[],d=[];return{bufferLevelRule:void 0,pendingRequestsRule:void 0,playbackTimeRule:void 0,sameTimeRequestRule:void 0,liveEdgeBinarySearchRule:void 0,getRules:function(e){switch(e){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return a;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return d;case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES:return b;case MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES:return c;default:return null}},setup:function(){a.push(this.bufferLevelRule),a.push(this.pendingRequestsRule),d.push(this.playbackTimeRule),b.push(this.sameTimeRequestRule),c.push(this.liveEdgeBinarySearchRule)}}},MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules",FRAGMENTS_TO_EXECUTE_RULES:"fragmentsToExecuteRules",LIVE_EDGE_RULES:"liveEdgeRules"},MediaPlayer.rules.SwitchRequest=function(a,b){"use strict";this.value=a,this.priority=b,void 0===this.value&&(this.value=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.vo.FragmentRequest=function(){"use strict";this.action="download",this.startTime=0/0,this.mediaType=null,this.type=null,this.duration=0/0,this.timescale=0/0,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=0/0,this.index=0/0,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.ManifestInfo=function(){"use strict";this.DVRWindowSize=0/0,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=0/0,this.duration=0/0,this.isDynamic=!1,this.maxFragmentDuration=null},MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo},MediaPlayer.vo.MediaInfo=function(){"use strict";this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.trackCount=0,this.lang=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null},MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=0/0,this.duration=0/0,this.manifestInfo=null},MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo},MediaPlayer.vo.TrackInfo=function(){"use strict";this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null,this.manifestInfo=null},MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){"use strict";this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.TrackSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.TrackSwitch.prototype={constructor:MediaPlayer.vo.metrics.TrackSwitch},MediaPlayer.vo.metrics.SchedulingInfo=function(){"use strict";this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo},MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE="pending",MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE="loading",MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE="executed",MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE="rejected",MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE="canceled",MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE="failed",MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection};






















































function X2JS(matchers,attrPrefix,ignoreRoot){function getNodeLocalName(node){var nodeLocalName=node.localName;return null==nodeLocalName&&(nodeLocalName=node.baseName),(null==nodeLocalName||""==nodeLocalName)&&(nodeLocalName=node.nodeName),nodeLocalName}function getNodePrefix(node){return node.prefix}function escapeXmlChars(str){return"string"==typeof str?str.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):str}function unescapeXmlChars(str){return str.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function parseDOMChildren(node){if(node.nodeType==DOMNodeTypes.DOCUMENT_NODE){var result,i,len,child=node.firstChild;for(i=0,len=node.childNodes.length;len>i;i+=1)if(node.childNodes[i].nodeType!==DOMNodeTypes.COMMENT_NODE){child=node.childNodes[i];break}if(ignoreRoot)result=parseDOMChildren(child);else{result={};var childName=getNodeLocalName(child);result[childName]=parseDOMChildren(child)}return result}if(node.nodeType==DOMNodeTypes.ELEMENT_NODE){var result=new Object;result.__cnt=0;for(var nodeChildren=node.childNodes,cidx=0;cidx<nodeChildren.length;cidx++){var child=nodeChildren.item(cidx),childName=getNodeLocalName(child);if(result.__cnt++,null==result[childName])result[childName]=parseDOMChildren(child),result[childName+"_asArray"]=new Array(1),result[childName+"_asArray"][0]=result[childName];else{if(null!=result[childName]&&!(result[childName]instanceof Array)){var tmpObj=result[childName];result[childName]=new Array,result[childName][0]=tmpObj,result[childName+"_asArray"]=result[childName]}for(var aridx=0;null!=result[childName][aridx];)aridx++;result[childName][aridx]=parseDOMChildren(child)}}for(var aidx=0;aidx<node.attributes.length;aidx++){var attr=node.attributes.item(aidx);result.__cnt++;for(var value2=attr.value,m=0,ml=matchers.length;ml>m;m++){var matchobj=matchers[m];matchobj.test.call(this,attr.value)&&(value2=matchobj.converter.call(this,attr.value))}result[attrPrefix+attr.name]=value2}var nodePrefix=getNodePrefix(node);return null!=nodePrefix&&""!=nodePrefix&&(result.__cnt++,result.__prefix=nodePrefix),1==result.__cnt&&null!=result["#text"]&&(result=result["#text"]),null!=result["#text"]&&(result.__text=result["#text"],escapeMode&&(result.__text=unescapeXmlChars(result.__text)),delete result["#text"],delete result["#text_asArray"]),null!=result["#cdata-section"]&&(result.__cdata=result["#cdata-section"],delete result["#cdata-section"],delete result["#cdata-section_asArray"]),(null!=result.__text||null!=result.__cdata)&&(result.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),result}return node.nodeType==DOMNodeTypes.TEXT_NODE||node.nodeType==DOMNodeTypes.CDATA_SECTION_NODE?node.nodeValue:node.nodeType==DOMNodeTypes.COMMENT_NODE?null:void 0}function startTag(jsonObj,element,attrList,closed){var resultStr="<"+(null!=jsonObj&&null!=jsonObj.__prefix?jsonObj.__prefix+":":"")+element;if(null!=attrList)for(var aidx=0;aidx<attrList.length;aidx++){var attrName=attrList[aidx],attrVal=jsonObj[attrName];resultStr+=" "+attrName.substr(1)+"='"+attrVal+"'"}return resultStr+=closed?"/>":">"}function endTag(jsonObj,elementName){return"</"+(null!=jsonObj.__prefix?jsonObj.__prefix+":":"")+elementName+">"}function endsWith(str,suffix){return-1!==str.indexOf(suffix,str.length-suffix.length)}function jsonXmlSpecialElem(jsonObj,jsonObjField){return endsWith(jsonObjField.toString(),"_asArray")||0==jsonObjField.toString().indexOf("_")||jsonObj[jsonObjField]instanceof Function?!0:!1}function jsonXmlElemCount(jsonObj){var elementsCnt=0;if(jsonObj instanceof Object)for(var it in jsonObj)jsonXmlSpecialElem(jsonObj,it)||elementsCnt++;return elementsCnt}function parseJSONAttributes(jsonObj){var attrList=[];if(jsonObj instanceof Object)for(var ait in jsonObj)-1==ait.toString().indexOf("__")&&0==ait.toString().indexOf("_")&&attrList.push(ait);return attrList}function parseJSONTextAttrs(jsonTxtObj){var result="";return null!=jsonTxtObj.__cdata&&(result+="<![CDATA["+jsonTxtObj.__cdata+"]]>"),null!=jsonTxtObj.__text&&(result+=escapeMode?escapeXmlChars(jsonTxtObj.__text):jsonTxtObj.__text),result}function parseJSONTextObject(jsonTxtObj){var result="";return jsonTxtObj instanceof Object?result+=parseJSONTextAttrs(jsonTxtObj):null!=jsonTxtObj&&(result+=escapeMode?escapeXmlChars(jsonTxtObj):jsonTxtObj),result}function parseJSONArray(jsonArrRoot,jsonArrObj,attrList){var result="";if(0==jsonArrRoot.length)result+=startTag(jsonArrRoot,jsonArrObj,attrList,!0);else for(var arIdx=0;arIdx<jsonArrRoot.length;arIdx++)result+=startTag(jsonArrRoot[arIdx],jsonArrObj,parseJSONAttributes(jsonArrRoot[arIdx]),!1),result+=parseJSONObject(jsonArrRoot[arIdx]),result+=endTag(jsonArrRoot[arIdx],jsonArrObj);return result}function parseJSONObject(jsonObj){var result="",elementsCnt=jsonXmlElemCount(jsonObj);if(elementsCnt>0)for(var it in jsonObj)if(!jsonXmlSpecialElem(jsonObj,it)){var subObj=jsonObj[it],attrList=parseJSONAttributes(subObj);if(null==subObj||void 0==subObj)result+=startTag(subObj,it,attrList,!0);else if(subObj instanceof Object)if(subObj instanceof Array)result+=parseJSONArray(subObj,it,attrList);else{var subObjElementsCnt=jsonXmlElemCount(subObj);subObjElementsCnt>0||null!=subObj.__text||null!=subObj.__cdata?(result+=startTag(subObj,it,attrList,!1),result+=parseJSONObject(subObj),result+=endTag(subObj,it)):result+=startTag(subObj,it,attrList,!0)}else result+=startTag(subObj,it,attrList,!1),result+=parseJSONTextObject(subObj),result+=endTag(subObj,it)}return result+=parseJSONTextObject(jsonObj)}(null===attrPrefix||void 0===attrPrefix)&&(attrPrefix="_"),(null===ignoreRoot||void 0===ignoreRoot)&&(ignoreRoot=!1);var VERSION="1.0.11",escapeMode=!1,DOMNodeTypes={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(xmlDocStr){var xmlDoc;if(window.DOMParser){var parser=new window.DOMParser;xmlDoc=parser.parseFromString(xmlDocStr,"text/xml")}else 0==xmlDocStr.indexOf("<?")&&(xmlDocStr=xmlDocStr.substr(xmlDocStr.indexOf("?>")+2)),xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(xmlDocStr);return xmlDoc},this.xml2json=function(xmlDoc){return parseDOMChildren(xmlDoc)},this.xml_str2json=function(xmlDocStr){var xmlDoc=this.parseXmlString(xmlDocStr);return this.xml2json(xmlDoc)},this.json2xml_str=function(jsonObj){return parseJSONObject(jsonObj)},this.json2xml=function(jsonObj){var xmlDocStr=this.json2xml_str(jsonObj);return this.parseXmlString(xmlDocStr)},this.getVersion=function(){return VERSION},this.escapeMode=function(enabled){escapeMode=enabled}}function ObjectIron(map){var lookup;for(lookup=[],i=0,len=map.length;len>i;i+=1)lookup.push(map[i].isRoot?"root":map[i].name);var mergeValues=function(parentItem,childItem){var name;if(null!==parentItem&&null!==childItem)for(name in parentItem)parentItem.hasOwnProperty(name)&&(childItem.hasOwnProperty(name)||(childItem[name]=parentItem[name]))},mapProperties=function(properties,parent,child){var i,len,property,parentValue,childValue;if(null!==properties&&0!==properties.length)for(i=0,len=properties.length;len>i;i+=1)property=properties[i],parent.hasOwnProperty(property.name)&&(child.hasOwnProperty(property.name)?property.merge&&(parentValue=parent[property.name],childValue=child[property.name],"object"==typeof parentValue&&"object"==typeof childValue?mergeValues(parentValue,childValue):child[property.name]=null!=property.mergeFunction?property.mergeFunction(parentValue,childValue):parentValue+childValue):child[property.name]=parent[property.name])},mapItem=function(obj,node){var i,len,v,len2,array,childItem,childNode,item=obj;if(null!==item.children&&0!==item.children.length)for(i=0,len=item.children.length;len>i;i+=1)if(childItem=item.children[i],node.hasOwnProperty(childItem.name))if(childItem.isArray)for(array=node[childItem.name+"_asArray"],v=0,len2=array.length;len2>v;v+=1)childNode=array[v],mapProperties(item.properties,node,childNode),mapItem(childItem,childNode);else childNode=node[childItem.name],mapProperties(item.properties,node,childNode),mapItem(childItem,childNode)},performMapping=function(source){var i,len,pi,pp,item,node,array;if(null===source)return source;if("object"!=typeof source)return source;for(i=0,len=lookup.length;len>i;i+=1)"root"===lookup[i]&&(item=map[i],node=source,mapItem(item,node));for(pp in source)if(source.hasOwnProperty(pp)){if(pi=lookup.indexOf(pp),-1!==pi)if(item=map[pi],item.isArray)for(array=source[pp+"_asArray"],i=0,len=array.length;len>i;i+=1)node=array[i],mapItem(item,node);else node=source[pp],mapItem(item,node);performMapping(source[pp])}return source};return{run:performMapping}}if(function(scope){"use strict";var dijon={VERSION:"0.5.3"};dijon.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},dijon.System.prototype={_createAndSetupInstance:function(key,Clazz){var instance=new Clazz;return this.injectInto(instance,key),instance},_retrieveFromCacheOrCreate:function(key,overrideRules){"undefined"==typeof overrideRules&&(overrideRules=!1);var output;if(!this._mappings.hasOwnProperty(key))throw new Error(1e3);var config=this._mappings[key];return!overrideRules&&config.isSingleton?(null==config.object&&(config.object=this._createAndSetupInstance(key,config.clazz)),output=config.object):output=config.clazz?this._createAndSetupInstance(key,config.clazz):config.object,output},mapOutlet:function(sourceKey,targetKey,outletName){if("undefined"==typeof sourceKey)throw new Error(1010);return targetKey=targetKey||"global",outletName=outletName||sourceKey,this._outlets.hasOwnProperty(targetKey)||(this._outlets[targetKey]={}),this._outlets[targetKey][outletName]=sourceKey,this},getObject:function(key){if("undefined"==typeof key)throw new Error(1020);return this._retrieveFromCacheOrCreate(key)},mapValue:function(key,useValue){if("undefined"==typeof key)throw new Error(1030);return this._mappings[key]={clazz:null,object:useValue,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(key),this.hasMapping(key)&&this.injectInto(useValue,key),this},hasMapping:function(key){if("undefined"==typeof key)throw new Error(1040);return this._mappings.hasOwnProperty(key)},mapClass:function(key,clazz){if("undefined"==typeof key)throw new Error(1050);if("undefined"==typeof clazz)throw new Error(1051);return this._mappings[key]={clazz:clazz,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(key),this},mapSingleton:function(key,clazz){if("undefined"==typeof key)throw new Error(1060);if("undefined"==typeof clazz)throw new Error(1061);return this._mappings[key]={clazz:clazz,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(key),this},instantiate:function(key){if("undefined"==typeof key)throw new Error(1070);return this._retrieveFromCacheOrCreate(key,!0)},injectInto:function(instance,key){if("undefined"==typeof instance)throw new Error(1080);if("object"==typeof instance){var o=[];this._outlets.hasOwnProperty("global")&&o.push(this._outlets.global),"undefined"!=typeof key&&this._outlets.hasOwnProperty(key)&&o.push(this._outlets[key]);for(var i in o){var l=o[i];for(var outlet in l){var source=l[outlet];(!this.strictInjections||outlet in instance)&&(instance[outlet]=this.getObject(source))}}"setup"in instance&&instance.setup.call(instance)}return this},unmap:function(key){if("undefined"==typeof key)throw new Error(1090);return delete this._mappings[key],this},unmapOutlet:function(target,outlet){if("undefined"==typeof target)throw new Error(1100);if("undefined"==typeof outlet)throw new Error(1101);return delete this._outlets[target][outlet],this},mapHandler:function(eventName,key,handler,oneShot,passEvent){if("undefined"==typeof eventName)throw new Error(1110);return key=key||"global",handler=handler||eventName,"undefined"==typeof oneShot&&(oneShot=!1),"undefined"==typeof passEvent&&(passEvent=!1),this._handlers.hasOwnProperty(eventName)||(this._handlers[eventName]={}),this._handlers[eventName].hasOwnProperty(key)||(this._handlers[eventName][key]=[]),this._handlers[eventName][key].push({handler:handler,oneShot:oneShot,passEvent:passEvent}),this},unmapHandler:function(eventName,key,handler){if("undefined"==typeof eventName)throw new Error(1120);if(key=key||"global",handler=handler||eventName,this._handlers.hasOwnProperty(eventName)&&this._handlers[eventName].hasOwnProperty(key)){var handlers=this._handlers[eventName][key];for(var i in handlers){var config=handlers[i];if(config.handler===handler){handlers.splice(i,1);break}}}return this},notify:function(eventName){if("undefined"==typeof eventName)throw new Error(1130);var argsWithEvent=Array.prototype.slice.call(arguments),argsClean=argsWithEvent.slice(1);if(this._handlers.hasOwnProperty(eventName)){var handlers=this._handlers[eventName];for(var key in handlers){var instance,configs=handlers[key];"global"!==key&&(instance=this.getObject(key));var i,n,toBeDeleted=[];for(i=0,n=configs.length;n>i;i++){var handler,config=configs[i];handler=instance&&"string"==typeof config.handler?instance[config.handler]:config.handler,config.oneShot&&toBeDeleted.unshift(i),config.passEvent?handler.apply(instance,argsWithEvent):handler.apply(instance,argsClean)}for(i=0,n=toBeDeleted.length;n>i;i++)configs.splice(toBeDeleted[i],1)}}return this}},scope.dijon=dijon}(this),"undefined"==typeof utils)var utils={};"undefined"==typeof utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(low,high){var highNum,lowNum,expected;return highNum=new goog.math.Long(0,high),lowNum=new goog.math.Long(low,0),expected=highNum.add(lowNum),expected.toNumber()},goog={},goog.math={},goog.math.Long=function(low,high){this.low_=0|low,this.high_=0|high},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(value){if(value>=-128&&128>value){var cachedObj=goog.math.Long.IntCache_[value];if(cachedObj)return cachedObj}var obj=new goog.math.Long(0|value,0>value?-1:0);return value>=-128&&128>value&&(goog.math.Long.IntCache_[value]=obj),obj},goog.math.Long.fromNumber=function(value){return isNaN(value)||!isFinite(value)?goog.math.Long.ZERO:value<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:value+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>value?goog.math.Long.fromNumber(-value).negate():new goog.math.Long(value%goog.math.Long.TWO_PWR_32_DBL_|0,value/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(lowBits,highBits){return new goog.math.Long(lowBits,highBits)},goog.math.Long.fromString=function(str,opt_radix){if(0==str.length)throw Error("number format error: empty string");var radix=opt_radix||10;if(2>radix||radix>36)throw Error("radix out of range: "+radix);if("-"==str.charAt(0))return goog.math.Long.fromString(str.substring(1),radix).negate();if(str.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+str);for(var radixToPower=goog.math.Long.fromNumber(Math.pow(radix,8)),result=goog.math.Long.ZERO,i=0;i<str.length;i+=8){var size=Math.min(8,str.length-i),value=parseInt(str.substring(i,i+size),radix);if(8>size){var power=goog.math.Long.fromNumber(Math.pow(radix,size));result=result.multiply(power).add(goog.math.Long.fromNumber(value))}else result=result.multiply(radixToPower),result=result.add(goog.math.Long.fromNumber(value))}return result},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=1<<24,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(1<<24),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(opt_radix){var radix=opt_radix||10;if(2>radix||radix>36)throw Error("radix out of range: "+radix);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var radixLong=goog.math.Long.fromNumber(radix),div=this.div(radixLong),rem=div.multiply(radixLong).subtract(this);return div.toString(radix)+rem.toInt().toString(radix)}return"-"+this.negate().toString(radix)}for(var radixToPower=goog.math.Long.fromNumber(Math.pow(radix,6)),rem=this,result="";;){var remDiv=rem.div(radixToPower),intval=rem.subtract(remDiv.multiply(radixToPower)).toInt(),digits=intval.toString(radix);if(rem=remDiv,rem.isZero())return digits+result;for(;digits.length<6;)digits="0"+digits;result=""+digits+result}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var val=0!=this.high_?this.high_:this.low_,bit=31;bit>0&&0==(val&1<<bit);bit--);return 0!=this.high_?bit+33:bit+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(other){return this.high_==other.high_&&this.low_==other.low_},goog.math.Long.prototype.notEquals=function(other){return this.high_!=other.high_||this.low_!=other.low_},goog.math.Long.prototype.lessThan=function(other){return this.compare(other)<0},goog.math.Long.prototype.lessThanOrEqual=function(other){return this.compare(other)<=0},goog.math.Long.prototype.greaterThan=function(other){return this.compare(other)>0},goog.math.Long.prototype.greaterThanOrEqual=function(other){return this.compare(other)>=0},goog.math.Long.prototype.compare=function(other){if(this.equals(other))return 0;var thisNeg=this.isNegative(),otherNeg=other.isNegative();return thisNeg&&!otherNeg?-1:!thisNeg&&otherNeg?1:this.subtract(other).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(other){var a48=this.high_>>>16,a32=65535&this.high_,a16=this.low_>>>16,a00=65535&this.low_,b48=other.high_>>>16,b32=65535&other.high_,b16=other.low_>>>16,b00=65535&other.low_,c48=0,c32=0,c16=0,c00=0;return c00+=a00+b00,c16+=c00>>>16,c00&=65535,c16+=a16+b16,c32+=c16>>>16,c16&=65535,c32+=a32+b32,c48+=c32>>>16,c32&=65535,c48+=a48+b48,c48&=65535,goog.math.Long.fromBits(c16<<16|c00,c48<<16|c32)},goog.math.Long.prototype.subtract=function(other){return this.add(other.negate())},goog.math.Long.prototype.multiply=function(other){if(this.isZero())return goog.math.Long.ZERO;if(other.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return other.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(other.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return other.isNegative()?this.negate().multiply(other.negate()):this.negate().multiply(other).negate();if(other.isNegative())return this.multiply(other.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&other.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*other.toNumber());var a48=this.high_>>>16,a32=65535&this.high_,a16=this.low_>>>16,a00=65535&this.low_,b48=other.high_>>>16,b32=65535&other.high_,b16=other.low_>>>16,b00=65535&other.low_,c48=0,c32=0,c16=0,c00=0;return c00+=a00*b00,c16+=c00>>>16,c00&=65535,c16+=a16*b00,c32+=c16>>>16,c16&=65535,c16+=a00*b16,c32+=c16>>>16,c16&=65535,c32+=a32*b00,c48+=c32>>>16,c32&=65535,c32+=a16*b16,c48+=c32>>>16,c32&=65535,c32+=a00*b32,c48+=c32>>>16,c32&=65535,c48+=a48*b00+a32*b16+a16*b32+a00*b48,c48&=65535,goog.math.Long.fromBits(c16<<16|c00,c48<<16|c32)},goog.math.Long.prototype.div=function(other){if(other.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE)){if(other.equals(goog.math.Long.ONE)||other.equals(goog.math.Long.NEG_ONE))return goog.math.Long.MIN_VALUE;if(other.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ONE;var halfThis=this.shiftRight(1),approx=halfThis.div(other).shiftLeft(1);if(approx.equals(goog.math.Long.ZERO))return other.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE;var rem=this.subtract(other.multiply(approx)),result=approx.add(rem.div(other));return result}if(other.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return other.isNegative()?this.negate().div(other.negate()):this.negate().div(other).negate();if(other.isNegative())return this.div(other.negate()).negate();for(var res=goog.math.Long.ZERO,rem=this;rem.greaterThanOrEqual(other);){for(var approx=Math.max(1,Math.floor(rem.toNumber()/other.toNumber())),log2=Math.ceil(Math.log(approx)/Math.LN2),delta=48>=log2?1:Math.pow(2,log2-48),approxRes=goog.math.Long.fromNumber(approx),approxRem=approxRes.multiply(other);approxRem.isNegative()||approxRem.greaterThan(rem);)approx-=delta,approxRes=goog.math.Long.fromNumber(approx),approxRem=approxRes.multiply(other);approxRes.isZero()&&(approxRes=goog.math.Long.ONE),res=res.add(approxRes),rem=rem.subtract(approxRem)}return res},goog.math.Long.prototype.modulo=function(other){return this.subtract(this.div(other).multiply(other))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(other){return goog.math.Long.fromBits(this.low_&other.low_,this.high_&other.high_)},goog.math.Long.prototype.or=function(other){return goog.math.Long.fromBits(this.low_|other.low_,this.high_|other.high_)},goog.math.Long.prototype.xor=function(other){return goog.math.Long.fromBits(this.low_^other.low_,this.high_^other.high_)},goog.math.Long.prototype.shiftLeft=function(numBits){if(numBits&=63,0==numBits)return this;var low=this.low_;if(32>numBits){var high=this.high_;return goog.math.Long.fromBits(low<<numBits,high<<numBits|low>>>32-numBits)}return goog.math.Long.fromBits(0,low<<numBits-32)},goog.math.Long.prototype.shiftRight=function(numBits){if(numBits&=63,0==numBits)return this;var high=this.high_;if(32>numBits){var low=this.low_;return goog.math.Long.fromBits(low>>>numBits|high<<32-numBits,high>>numBits)}return goog.math.Long.fromBits(high>>numBits-32,high>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(numBits){if(numBits&=63,0==numBits)return this;var high=this.high_;if(32>numBits){var low=this.low_;return goog.math.Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits)}return 32==numBits?goog.math.Long.fromBits(high,0):goog.math.Long.fromBits(high>>>numBits-32,0)};var UTF8={};UTF8.encode=function(s){for(var u=[],i=0;i<s.length;++i){var c=s.charCodeAt(i);128>c?u.push(c):2048>c?(u.push(192|c>>6),u.push(128|63&c)):65536>c?(u.push(224|c>>12),u.push(128|63&c>>6),u.push(128|63&c)):(u.push(240|c>>18),u.push(128|63&c>>12),u.push(128|63&c>>6),u.push(128|63&c))}return u},UTF8.decode=function(u){for(var a=[],i=0;i<u.length;){var v=u[i++];128>v||(224>v?(v=(31&v)<<6,v|=63&u[i++]):240>v?(v=(15&v)<<12,v|=(63&u[i++])<<6,v|=63&u[i++]):(v=(7&v)<<18,v|=(63&u[i++])<<12,v|=(63&u[i++])<<6,v|=63&u[i++])),a.push(String.fromCharCode(v))}return a.join("")};var BASE64={};if(function(T){var encodeArray=function(u){for(var i=0,a=[],n=0|u.length/3;0<n--;){var v=(u[i]<<16)+(u[i+1]<<8)+u[i+2];i+=3,a.push(T.charAt(63&v>>18)),a.push(T.charAt(63&v>>12)),a.push(T.charAt(63&v>>6)),a.push(T.charAt(63&v))}if(2==u.length-i){var v=(u[i]<<16)+(u[i+1]<<8);a.push(T.charAt(63&v>>18)),a.push(T.charAt(63&v>>12)),a.push(T.charAt(63&v>>6)),a.push("=")}else if(1==u.length-i){var v=u[i]<<16;a.push(T.charAt(63&v>>18)),a.push(T.charAt(63&v>>12)),a.push("==")}return a.join("")},R=function(){for(var a=[],i=0;i<T.length;++i)a[T.charCodeAt(i)]=i;return a["=".charCodeAt(0)]=0,a}(),decodeArray=function(s){for(var i=0,u=[],n=0|s.length/4;0<n--;){var v=(R[s.charCodeAt(i)]<<18)+(R[s.charCodeAt(i+1)]<<12)+(R[s.charCodeAt(i+2)]<<6)+R[s.charCodeAt(i+3)];u.push(255&v>>16),u.push(255&v>>8),u.push(255&v),i+=4}return u&&("="==s.charAt(i-2)?(u.pop(),u.pop()):"="==s.charAt(i-1)&&u.pop()),u},ASCII={};ASCII.encode=function(s){for(var u=[],i=0;i<s.length;++i)u.push(s.charCodeAt(i));return u},ASCII.decode=function(){for(var i=0;i<s.length;++i)a[i]=String.fromCharCode(a[i]);return a.join("")},BASE64.decodeArray=function(s){var u=decodeArray(s);return new Uint8Array(u)},BASE64.encodeASCII=function(s){var u=ASCII.encode(s);return encodeArray(u)},BASE64.decodeASCII=function(s){var a=decodeArray(s);return ASCII.decode(a)},BASE64.encode=function(s){var u=UTF8.encode(s);return encodeArray(u)},BASE64.decode=function(s){var u=decodeArray(s);return UTF8.decode(u)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa)var btoa=BASE64.encode;if(void 0===atob)var atob=BASE64.decode;MediaPlayer=function(aContext){"use strict";var system,manifestLoader,abrController,element,source,streamController,rulesController,manifestUpdater,metricsExt,metricsModel,videoModel,VERSION="1.3.0 (refactor)",context=aContext,initialized=!1,playing=!1,autoPlay=!0,scheduleWhilePaused=!1,bufferMax=MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED,isReady=function(){return!!element&&!!source},play=function(){if(!initialized)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!element||!source)throw"Missing view or source.";playing=!0,streamController=system.getObject("streamController"),streamController.subscribe(streamController.eventList.ENAME_STREAMS_COMPOSED,manifestUpdater),manifestLoader.subscribe(manifestLoader.eventList.ENAME_MANIFEST_LOADED,streamController),manifestLoader.subscribe(manifestLoader.eventList.ENAME_MANIFEST_LOADED,manifestUpdater),streamController.setVideoModel(videoModel),streamController.setAutoPlay(autoPlay),streamController.load(source),system.mapValue("scheduleWhilePaused",scheduleWhilePaused),system.mapOutlet("scheduleWhilePaused","stream"),system.mapOutlet("scheduleWhilePaused","scheduleController"),system.mapValue("bufferMax",bufferMax),system.mapOutlet("bufferMax","bufferController"),rulesController.initialize()},doAutoPlay=function(){isReady()&&play.call(this)},getDVRInfoMetric=function(){var metric=metricsModel.getReadOnlyMetricsFor("video")||metricsModel.getReadOnlyMetricsFor("audio");return metricsExt.getCurrentDVRInfo(metric)},getDVRWindowSize=function(){return getDVRInfoMetric.call(this).manifestInfo.DVRWindowSize},getDVRSeekOffset=function(value){var metric=getDVRInfoMetric.call(this),val=metric.range.start+parseInt(value);return val>metric.range.end&&(val=metric.range.end),val},seek=function(value){videoModel.getElement().currentTime=this.getDVRSeekOffset(value)},time=function(){var metric=getDVRInfoMetric.call(this);return null===metric?0:Math.round(this.duration()-(metric.range.end-metric.time))},duration=function(){var range,metric=getDVRInfoMetric.call(this);return null===metric?0:(range=metric.range.end-metric.range.start,Math.round(range<metric.manifestInfo.DVRWindowSize?range:metric.manifestInfo.DVRWindowSize))},timeAsUTC=function(){var availableFrom,currentUTCTime,metric=getDVRInfoMetric.call(this);return null===metric?0:(availableFrom=metric.manifestInfo.availableFrom.getTime()/1e3,currentUTCTime=this.time()+(availableFrom+metric.range.start),Math.round(currentUTCTime))},durationAsUTC=function(){var availableFrom,currentUTCDuration,metric=getDVRInfoMetric.call(this);return null===metric?0:(availableFrom=metric.manifestInfo.availableFrom.getTime()/1e3,currentUTCDuration=availableFrom+metric.range.start+this.duration(),Math.round(currentUTCDuration))},formatUTC=function(time,locales,hour12){var dt=new Date(1e3*time),d=dt.toLocaleDateString(locales),t=dt.toLocaleTimeString(locales,{hour12:hour12});return t+" "+d},convertToTimeCode=function(value){value=Math.max(value,0);var h=Math.floor(value/3600),m=Math.floor(value%3600/60),s=Math.floor(value%3600%60);return(0===h?"":10>h?"0"+h.toString()+":":h.toString()+":")+(10>m?"0"+m.toString():m.toString())+":"+(10>s?"0"+s.toString():s.toString())},updateRules=function(type,rules,override){rules&&void 0!==type&&null!==type&&(override?rulesController.setRules(type,rules):rulesController.addRules(type,rules))},doReset=function(){playing&&streamController&&(streamController.unsubscribe(streamController.eventList.ENAME_STREAMS_COMPOSED,manifestUpdater),manifestLoader.unsubscribe(manifestLoader.eventList.ENAME_MANIFEST_LOADED,streamController),manifestLoader.unsubscribe(manifestLoader.eventList.ENAME_MANIFEST_LOADED,manifestUpdater),streamController.reset(),abrController.reset(),rulesController.reset(),streamController=null,playing=!1)};return system=new dijon.System,system.mapValue("system",system),system.mapOutlet("system"),system.injectInto(context),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,tokenAuthentication:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){metricsExt=system.getObject("metricsExt"),manifestLoader=system.getObject("manifestLoader"),manifestUpdater=system.getObject("manifestUpdater"),abrController=system.getObject("abrController"),rulesController=system.getObject("rulesController"),metricsModel=system.getObject("metricsModel")},addEventListener:function(type,listener,useCapture){this.eventBus.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){this.eventBus.removeEventListener(type,listener,useCapture)},getVersion:function(){return VERSION},startup:function(){initialized||(system.injectInto(this),initialized=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return videoModel},setAutoPlay:function(value){autoPlay=value},getAutoPlay:function(){return autoPlay},setScheduleWhilePaused:function(value){scheduleWhilePaused=value},getScheduleWhilePaused:function(){return scheduleWhilePaused},setTokenAuthentication:function(name,type){this.tokenAuthentication.setTokenAuthentication({name:name,type:type})},setBufferMax:function(value){bufferMax=value},getBufferMax:function(){return bufferMax},getMetricsExt:function(){return metricsExt},getMetricsFor:function(type){var metrics=metricsModel.getReadOnlyMetricsFor(type);return metrics},getQualityFor:function(type){return abrController.getQualityFor(type)},setQualityFor:function(type,value){abrController.setPlaybackQuality(type,value)},getAutoSwitchQuality:function(){return abrController.getAutoSwitchBitrate()},setAutoSwitchQuality:function(value){abrController.setAutoSwitchBitrate(value)},setSchedulingRules:function(newRulesCollection){updateRules.call(this,rulesController.SCHEDULING_RULE,newRulesCollection,!0)},addSchedulingRules:function(newRulesCollection){updateRules.call(this,rulesController.SCHEDULING_RULE,newRulesCollection,!1)},setABRRules:function(newRulesCollection){updateRules.call(this,rulesController.ABR_RULE,newRulesCollection,!0)},addABRRules:function(newRulesCollection){updateRules.call(this,rulesController.ABR_RULE,newRulesCollection,!1)},attachView:function(view){if(!initialized)throw"MediaPlayer not initialized!";
element=view,videoModel=null,element&&(videoModel=system.getObject("videoModel"),videoModel.setElement(element)),doReset.call(this),isReady.call(this)&&doAutoPlay.call(this)},attachSource:function(url){if(!initialized)throw"MediaPlayer not initialized!";this.uriQueryFragModel.reset(),source=this.uriQueryFragModel.parseURI(url),doReset.call(this),isReady.call(this)&&doAutoPlay.call(this)},reset:function(){this.attachSource(null),this.attachView(null)},play:play,isReady:isReady,seek:seek,time:time,duration:duration,timeAsUTC:timeAsUTC,durationAsUTC:durationAsUTC,getDVRWindowSize:getDVRWindowSize,getDVRSeekOffset:getDVRSeekOffset,formatUTC:formatUTC,convertToTimeCode:convertToTimeCode}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.di.Context=function(){"use strict";return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapSingleton("debug",MediaPlayer.utils.Debug),this.system.mapSingleton("tokenAuthentication",MediaPlayer.utils.TokenAuthentication),this.system.mapSingleton("eventBus",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapClass("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapClass("playbackController",MediaPlayer.dependencies.PlaybackController),this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("downloadRatioRule",MediaPlayer.rules.DownloadRatioRule),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("limitSwitchesRule",MediaPlayer.rules.LimitSwitchesRule),this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection),this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController),this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule),this.system.mapClass("liveEdgeBBCSearchRule",MediaPlayer.rules.LiveEdgeBBCSearchRule),this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule),this.system.mapClass("pendingRequestsRule",MediaPlayer.rules.PendingRequestsRule),this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule),this.system.mapClass("sameTimeRequestRule",MediaPlayer.rules.SameTimeRequestRule),this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapSingleton("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("trackController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Dash.dependencies.BaseURLExtensions=function(){"use strict";var parseSIDX=function(ab,ab_first_byte_offset){for(var offset,time,sidxEnd,i,ref_type,ref_size,ref_dur,type,size,charCode,d=new DataView(ab),sidx={},pos=0;"sidx"!==type&&pos<d.byteLength;){for(size=d.getUint32(pos),pos+=4,type="",i=0;4>i;i+=1)charCode=d.getInt8(pos),type+=String.fromCharCode(charCode),pos+=1;"moof"!==type&&"traf"!==type&&"sidx"!==type?pos+=size-8:"sidx"===type&&(pos-=8)}if(sidxEnd=d.getUint32(pos,!1)+pos,sidxEnd>ab.byteLength)throw"sidx terminates after array buffer";for(sidx.version=d.getUint8(pos+8),pos+=12,sidx.timescale=d.getUint32(pos+4,!1),pos+=8,0===sidx.version?(sidx.earliest_presentation_time=d.getUint32(pos,!1),sidx.first_offset=d.getUint32(pos+4,!1),pos+=8):(sidx.earliest_presentation_time=utils.Math.to64BitNumber(d.getUint32(pos+4,!1),d.getUint32(pos,!1)),sidx.first_offset=(d.getUint32(pos+8,!1)<<32)+d.getUint32(pos+12,!1),pos+=16),sidx.first_offset+=sidxEnd+(ab_first_byte_offset||0),sidx.reference_count=d.getUint16(pos+2,!1),pos+=4,sidx.references=[],offset=sidx.first_offset,time=sidx.earliest_presentation_time,i=0;i<sidx.reference_count;i+=1)ref_size=d.getUint32(pos,!1),ref_type=ref_size>>>31,ref_size=2147483647&ref_size,ref_dur=d.getUint32(pos+4,!1),pos+=12,sidx.references.push({size:ref_size,type:ref_type,offset:offset,duration:ref_dur,time:time,timescale:sidx.timescale}),offset+=ref_size,time+=ref_dur;if(pos!==sidxEnd)throw"Error: final pos "+pos+" differs from SIDX end "+sidxEnd;return sidx},parseSegments=function(data,media,offset){var parsed,ref,segments,segment,i,len,start,end;for(parsed=parseSIDX.call(this,data,offset),ref=parsed.references,segments=[],i=0,len=ref.length;len>i;i+=1)segment=new Dash.vo.Segment,segment.duration=ref[i].duration,segment.media=media,segment.startTime=ref[i].time,segment.timescale=ref[i].timescale,start=ref[i].offset,end=ref[i].offset+ref[i].size-1,segment.mediaRange=start+"-"+end,segments.push(segment);return this.debug.log("Parsed SIDX box: "+segments.length+" segments."),segments},findInit=function(data,info,callback){var ftyp,moov,start,end,bytesAvailable,i,c,request,irange,d=new DataView(data),pos=0,type="",size=0,loaded=!1,self=this;for(self.debug.log("Searching for initialization.");"moov"!==type&&pos<d.byteLength;){for(size=d.getUint32(pos),pos+=4,type="",i=0;4>i;i+=1)c=d.getInt8(pos),type+=String.fromCharCode(c),pos+=1;"ftyp"===type&&(ftyp=pos-8),"moov"===type&&(moov=pos-8),"moov"!==type&&(pos+=size-8)}bytesAvailable=d.byteLength-pos,"moov"!==type?(self.debug.log("Loading more bytes to find initialization."),info.range.start=0,info.range.end=info.bytesLoaded+info.bytesToLoad,request=new XMLHttpRequest,request.onloadend=function(){loaded||callback.call(self,null,new Error("Error loading initialization."))},request.onload=function(){loaded=!0,info.bytesLoaded=info.range.end,findInit.call(self,request.response,function(segments){callback.call(self,segments)})},request.onerror=function(){callback.call(self,null,new Error("Error loading initialization."))},request.open("GET",self.tokenAuthentication.addTokenAsQueryArg(info.url)),request.responseType="arraybuffer",request.setRequestHeader("Range","bytes="+info.range.start+"-"+info.range.end),request=self.tokenAuthentication.setTokenInRequestHeader(request),request.send(null)):(start=void 0===ftyp?moov:ftyp,end=moov+size-1,irange=start+"-"+end,self.debug.log("Found the initialization.  Range: "+irange),callback.call(self,irange))},loadInit=function(representation){var request=new XMLHttpRequest,needFailureReport=!0,self=this,media=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].BaseURL,info={url:media,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:request};self.debug.log("Start searching for initialization."),info.range.start=0,info.range.end=info.bytesToLoad,request.onload=function(){request.status<200||request.status>299||(needFailureReport=!1,info.bytesLoaded=info.range.end,findInit.call(self,request.response,info,function(range){representation.range=range,representation.initialization=media,self.notify(self.eventList.ENAME_INITIALIZATION_LOADED,representation)}))},request.onloadend=request.onerror=function(){needFailureReport&&(needFailureReport=!1,self.errHandler.downloadError("initialization",info.url,request),self.notify(self.eventList.ENAME_INITIALIZATION_LOADED,representation))},request.open("GET",self.tokenAuthentication.addTokenAsQueryArg(info.url)),request.responseType="arraybuffer",request.setRequestHeader("Range","bytes="+info.range.start+"-"+info.range.end),request=self.tokenAuthentication.setTokenInRequestHeader(request),request.send(null),self.debug.log("Perform init search: "+info.url)},findSIDX=function(data,info,representation,callback){var segments,bytesAvailable,sidxBytes,sidxSlice,sidxOut,i,c,parsed,ref,d=new DataView(data),request=new XMLHttpRequest,pos=0,type="",size=0,needFailureReport=!0,loadMultiSidx=!1,self=this;for(self.debug.log("Searching for SIDX box."),self.debug.log(info.bytesLoaded+" bytes loaded.");"sidx"!==type&&pos<d.byteLength;){for(size=d.getUint32(pos),pos+=4,type="",i=0;4>i;i+=1)c=d.getInt8(pos),type+=String.fromCharCode(c),pos+=1;"sidx"!==type&&(pos+=size-8)}if(bytesAvailable=d.byteLength-pos,"sidx"!==type)callback.call(self);else if(size-8>bytesAvailable)self.debug.log("Found SIDX but we don't have all of it."),info.range.start=0,info.range.end=info.bytesLoaded+(size-bytesAvailable),request.onload=function(){request.status<200||request.status>299||(needFailureReport=!1,info.bytesLoaded=info.range.end,findSIDX.call(self,request.response,info,representation,callback))},request.onloadend=request.onerror=function(){needFailureReport&&(needFailureReport=!1,self.errHandler.downloadError("SIDX",info.url,request),callback.call(self))},request.open("GET",self.tokenAuthentication.addTokenAsQueryArg(info.url)),request.responseType="arraybuffer",request.setRequestHeader("Range","bytes="+info.range.start+"-"+info.range.end),request=self.tokenAuthentication.setTokenInRequestHeader(request),request.send(null);else if(info.range.start=pos-8,info.range.end=info.range.start+size,self.debug.log("Found the SIDX box.  Start: "+info.range.start+" | End: "+info.range.end),sidxBytes=new ArrayBuffer(info.range.end-info.range.start),sidxOut=new Uint8Array(sidxBytes),sidxSlice=new Uint8Array(data,info.range.start,info.range.end-info.range.start),sidxOut.set(sidxSlice),parsed=this.parseSIDX.call(this,sidxBytes,info.range.start),ref=parsed.references,null!==ref&&void 0!==ref&&ref.length>0&&(loadMultiSidx=1===ref[0].type),loadMultiSidx){self.debug.log("Initiate multiple SIDX load.");var j,len,ss,se,r,segs=[],count=0,tmpCallback=function(segments){segments?(segs=segs.concat(segments),count+=1,count>=len&&callback.call(self,segs)):callback.call(self)};for(j=0,len=ref.length;len>j;j+=1)ss=ref[j].offset,se=ref[j].offset+ref[j].size-1,r=ss+"-"+se,loadSegments.call(self,representation,null,r,tmpCallback)}else self.debug.log("Parsing segments from SIDX."),segments=parseSegments.call(self,sidxBytes,info.url,info.range.start),callback.call(self,segments)},loadSegments=function(representation,type,theRange,callback){var segments,parts,request=new XMLHttpRequest,media=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].BaseURL,needFailureReport=!0,self=this,info={url:media,range:{},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:request};null===theRange?(self.debug.log("No known range for SIDX request."),info.searching=!0,info.range.start=0,info.range.end=info.bytesToLoad):(parts=theRange.split("-"),info.range.start=parseFloat(parts[0]),info.range.end=parseFloat(parts[1])),request.onload=function(){request.status<200||request.status>299||(needFailureReport=!1,info.searching?(info.bytesLoaded=info.range.end,findSIDX.call(self,request.response,info,representation,function(segments){segments&&callback.call(self,segments,representation,type)})):(segments=parseSegments.call(self,request.response,info.url,info.range.start),callback.call(self,segments,representation,type)))},request.onloadend=request.onerror=function(){needFailureReport&&(needFailureReport=!1,self.errHandler.downloadError("SIDX",info.url,request),callback.call(self,null,representation,type))},request.open("GET",self.tokenAuthentication.addTokenAsQueryArg(info.url)),request.responseType="arraybuffer",request.setRequestHeader("Range","bytes="+info.range.start+"-"+info.range.end),request=self.tokenAuthentication.setTokenInRequestHeader(request),request.send(null),self.debug.log("Perform SIDX load: "+info.url)},onLoaded=function(segments,representation,type){var self=this;segments?self.notify(self.eventList.ENAME_SEGMENTS_LOADED,segments,representation,type):self.notify(self.eventList.ENAME_SEGMENTS_LOADED,null,representation,type,new Error("error loading segments"))};return{debug:void 0,errHandler:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},loadSegments:function(representation,type,range){loadSegments.call(this,representation,type,range,onLoaded.bind(this))},loadInitialization:loadInit,parseSegments:parseSegments,parseSIDX:parseSIDX,findSIDX:findSIDX}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.DashAdapter=function(){"use strict";var periods=[],adaptations={},getRepresentationForTrackInfo=function(trackInfo,representationController){return representationController.getRepresentationForQuality(trackInfo.quality)},getAdaptationForMediaInfo=function(mediaInfo){return adaptations[mediaInfo.streamInfo.id][mediaInfo.index]},getPeriodForStreamInfo=function(streamInfo){var period,ln=periods.length,i=0;for(i;ln>i;i+=1)if(period=periods[i],streamInfo.id===period.id)return period;return null},convertRepresentationToTrackInfo=function(representation){var trackInfo=new MediaPlayer.vo.TrackInfo,a=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index],r=this.manifestExt.getRepresentationFor(representation.index,a);return trackInfo.id=representation.id,trackInfo.quality=representation.index,trackInfo.bandwidth=this.manifestExt.getBandwidth(r),trackInfo.DVRWindow=representation.segmentAvailabilityRange,trackInfo.fragmentDuration=representation.segmentDuration||(representation.segments&&representation.segments.length>0?representation.segments[0].duration:0/0),trackInfo.MSETimeOffset=representation.MSETimeOffset,trackInfo.useCalculatedLiveEdgeTime=representation.useCalculatedLiveEdgeTime,trackInfo.mediaInfo=convertAdaptationToMediaInfo.call(this,representation.adaptation),trackInfo},convertAdaptationToMediaInfo=function(adaptation){var mediaInfo=new MediaPlayer.vo.MediaInfo,self=this,a=adaptation.period.mpd.manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index];return mediaInfo.id=adaptation.id,mediaInfo.index=adaptation.index,mediaInfo.type=adaptation.type,mediaInfo.streamInfo=convertPeriodToStreamInfo.call(this,adaptation.period),mediaInfo.trackCount=this.manifestExt.getRepresentationCount(a),mediaInfo.lang=this.manifestExt.getLanguageForAdaptation(a),mediaInfo.codec=this.manifestExt.getCodec(a),mediaInfo.mimeType=this.manifestExt.getMimeType(a),mediaInfo.contentProtection=this.manifestExt.getContentProtectionData(a),mediaInfo.contentProtection&&mediaInfo.contentProtection.forEach(function(item){item.KID=self.manifestExt.getKID(item)}),mediaInfo.isText=this.manifestExt.getIsTextTrack(mediaInfo.mimeType),mediaInfo},convertPeriodToStreamInfo=function(period){var streamInfo=new MediaPlayer.vo.StreamInfo;return streamInfo.id=period.id,streamInfo.index=period.index,streamInfo.start=period.start,streamInfo.duration=period.duration,streamInfo.manifestInfo=convertMpdToManifestInfo.call(this,period.mpd),streamInfo},convertMpdToManifestInfo=function(mpd){var manifestInfo=new MediaPlayer.vo.ManifestInfo,manifest=this.manifestModel.getValue();return manifestInfo.DVRWindowSize=mpd.timeShiftBufferDepth,manifestInfo.loadedTime=mpd.manifest.loadedTime,manifestInfo.availableFrom=mpd.availabilityStartTime,manifestInfo.minBufferTime=mpd.manifest.minBufferTime,manifestInfo.maxFragmentDuration=mpd.maxSegmentDuration,manifestInfo.duration=this.manifestExt.getDuration(manifest),manifestInfo.isDynamic=this.manifestExt.getIsDynamic(manifest),manifestInfo},getMediaInfoForType=function(manifest,streamInfo,type){var idx,periodInfo=getPeriodForStreamInfo(streamInfo),periodId=periodInfo.id,data=this.manifestExt.getAdaptationForType(manifest,streamInfo.index,type);return data?(idx=this.manifestExt.getIndexForAdaptation(data,manifest,streamInfo.index),adaptations[periodId]=adaptations[periodId]||this.manifestExt.getAdaptationsForPeriod(manifest,periodInfo),convertAdaptationToMediaInfo.call(this,adaptations[periodId][idx])):null},getStreamsInfoFromManifest=function(manifest){var mpd,ln,i,streams=[];if(!manifest)return null;for(mpd=this.manifestExt.getMpd(manifest),periods=this.manifestExt.getRegularPeriods(manifest,mpd),adaptations={},ln=periods.length,i=0;ln>i;i+=1)streams.push(convertPeriodToStreamInfo.call(this,periods[i]));return streams},getMpdInfo=function(manifest){var mpd=this.manifestExt.getMpd(manifest);return convertMpdToManifestInfo.call(this,mpd)},getInitRequest=function(streamProcessor,quality){var representation=streamProcessor.trackController.getRepresentationForQuality(quality);return streamProcessor.indexHandler.getInitRequest(representation)},getNextFragmentRequest=function(streamProcessor,trackInfo){var representation=getRepresentationForTrackInfo(trackInfo,streamProcessor.trackController);return streamProcessor.indexHandler.getNextSegmentRequest(representation)},getFragmentRequestForTime=function(streamProcessor,trackInfo,time,keepIdx){var representation=getRepresentationForTrackInfo(trackInfo,streamProcessor.trackController);return streamProcessor.indexHandler.getSegmentRequestForTime(representation,time,keepIdx)},generateFragmentRequestForTime=function(streamProcessor,trackInfo,time){var representation=getRepresentationForTrackInfo(trackInfo,streamProcessor.trackController),request=streamProcessor.indexHandler.generateSegmentRequestForTime(representation,time);return request},getIndexHandlerTime=function(streamProcessor){return streamProcessor.indexHandler.getCurrentTime()},setIndexHandlerTime=function(streamProcessor,value){return streamProcessor.indexHandler.setCurrentTime(value)},updateData=function(streamProcessor){var id,data,periodInfo=getPeriodForStreamInfo(streamProcessor.getStreamInfo()),mediaInfo=streamProcessor.getMediaInfo(),adaptation=getAdaptationForMediaInfo(mediaInfo),manifest=this.manifestModel.getValue(),type=streamProcessor.getType();id=mediaInfo.id,data=id?this.manifestExt.getAdaptationForId(id,manifest,periodInfo.index):this.manifestExt.getAdaptationForIndex(mediaInfo.index,manifest,periodInfo.index),streamProcessor.setMediaInfo(mediaInfo),streamProcessor.trackController.updateData(data,adaptation,type)},getTrackInfoForQuality=function(representationController,quality){var representation=representationController.getRepresentationForQuality(quality);return representation?convertRepresentationToTrackInfo.call(this,representation):null},getCurrentTrackInfo=function(representationController){var representation=representationController.getCurrentRepresentation();return representation?convertRepresentationToTrackInfo.call(this,representation):null},getEvent=function(eventBox,eventStreams,startTime){var event=new Dash.vo.Event,schemeIdUri=eventBox[0],value=eventBox[1],timescale=eventBox[2],presentationTimeDelta=eventBox[3],duration=eventBox[4],id=eventBox[5],messageData=eventBox[6],presentationTime=startTime*timescale+presentationTimeDelta;return eventStreams[schemeIdUri]?(event.eventStream=eventStreams[schemeIdUri],event.eventStream.value=value,event.eventStream.timescale=timescale,event.duration=duration,event.id=id,event.presentationTime=presentationTime,event.messageData=messageData,event.presentationTimeDelta=presentationTimeDelta,event):null},getEventsFor=function(info,streamProcessor){var manifest=this.manifestModel.getValue(),events=[];return info instanceof MediaPlayer.vo.StreamInfo?events=this.manifestExt.getEventsForPeriod(manifest,getPeriodForStreamInfo(info)):info instanceof MediaPlayer.vo.MediaInfo?events=this.manifestExt.getEventStreamForAdaptationSet(manifest,getAdaptationForMediaInfo(info)):info instanceof MediaPlayer.vo.TrackInfo&&(events=this.manifestExt.getEventStreamForRepresentation(manifest,getRepresentationForTrackInfo(info,streamProcessor.trackController))),events};return{system:void 0,manifestExt:void 0,manifestModel:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:convertRepresentationToTrackInfo,convertDataToMedia:convertAdaptationToMediaInfo,convertDataToStream:convertPeriodToStreamInfo,getDataForTrack:getRepresentationForTrackInfo,getDataForMedia:getAdaptationForMediaInfo,getDataForStream:getPeriodForStreamInfo,getStreamsInfo:getStreamsInfoFromManifest,getManifestInfo:getMpdInfo,getMediaInfoForType:getMediaInfoForType,getCurrentTrackInfo:getCurrentTrackInfo,getTrackInfoForQuality:getTrackInfoForQuality,updateData:updateData,getInitRequest:getInitRequest,getNextFragmentRequest:getNextFragmentRequest,getFragmentRequestForTime:getFragmentRequestForTime,generateFragmentRequestForTime:generateFragmentRequestForTime,getIndexHandlerTime:getIndexHandlerTime,setIndexHandlerTime:setIndexHandlerTime,getEventsFor:getEventsFor,getEvent:getEvent,reset:function(){periods=[],adaptations={}}}},Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter},Dash.dependencies.DashHandler=function(){"use strict";var requestedTime,isDynamic,type,index=-1,currentTime=0,zeroPadToLength=function(numStr,minStrLength){for(;numStr.length<minStrLength;)numStr="0"+numStr;return numStr},replaceTokenForTemplate=function(url,token,value){for(var formatTagPos,specifier,width,paddedValue,startPos=0,endPos=0,tokenLen=token.length,formatTag="%0",formatTagLen=formatTag.length;;){if(startPos=url.indexOf("$"+token),0>startPos)return url;if(endPos=url.indexOf("$",startPos+tokenLen),0>endPos)return url;if(formatTagPos=url.indexOf(formatTag,startPos+tokenLen),formatTagPos>startPos&&endPos>formatTagPos)switch(specifier=url.charAt(endPos-1),width=parseInt(url.substring(formatTagPos+formatTagLen,endPos-1),10),specifier){case"d":case"i":case"u":paddedValue=zeroPadToLength(value.toString(),width);break;case"x":paddedValue=zeroPadToLength(value.toString(16),width);break;case"X":paddedValue=zeroPadToLength(value.toString(16),width).toUpperCase();break;case"o":paddedValue=zeroPadToLength(value.toString(8),width);break;default:return this.debug.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),url}else paddedValue=value;url=url.substring(0,startPos)+paddedValue+url.substring(endPos+1)}},unescapeDollarsInTemplate=function(url){return url.split("$$").join("$")},replaceIDForTemplate=function(url,value){if(null===value||-1===url.indexOf("$RepresentationID$"))return url;var v=value.toString();return url.split("$RepresentationID$").join(v)},getNumberForSegment=function(segment,segmentIndex){return segment.representation.startNumber+segmentIndex},getRequestUrl=function(destination,representation){var url,baseURL=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].BaseURL;return url=destination===baseURL?destination:-1!==destination.indexOf("http://")||-1!==destination.indexOf("https://")?destination:baseURL+destination},generateInitRequest=function(representation,mediaType){var period,presentationStartTime,self=this,request=new MediaPlayer.vo.FragmentRequest;return period=representation.adaptation.period,request.mediaType=mediaType,request.type="Initialization Segment",request.url=getRequestUrl(representation.initialization,representation),request.range=representation.range,presentationStartTime=period.start,request.availabilityStartTime=self.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(presentationStartTime,representation.adaptation.period.mpd,isDynamic),request.availabilityEndTime=self.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(presentationStartTime+period.duration,period.mpd,isDynamic),request.quality=representation.index,request},getInit=function(representation){var request,self=this;return console.log(representation),representation?request=generateInitRequest.call(self,representation,type):null},isMediaFinished=function(representation){var sDuration,seg,fTime,period=representation.adaptation.period,isFinished=!1;return isDynamic?isFinished=!1:0>index?isFinished=!1:index<representation.availableSegmentsNumber?(seg=getSegmentByIndex(index,representation),seg&&(fTime=seg.presentationStartTime-period.start,sDuration=representation.adaptation.period.duration,this.debug.log(representation.segmentInfoType+": "+fTime+" / "+sDuration),isFinished=fTime>=sDuration)):isFinished=!0,isFinished},getIndexBasedSegment=function(representation,index){var seg,duration,presentationStartTime,presentationEndTime,self=this;return duration=representation.segmentDuration,presentationStartTime=representation.adaptation.period.start+index*duration,presentationEndTime=presentationStartTime+duration,seg=new Dash.vo.Segment,seg.representation=representation,seg.duration=duration,seg.presentationStartTime=presentationStartTime,seg.mediaStartTime=self.timelineConverter.calcMediaTimeFromPresentationTime(seg.presentationStartTime,representation),seg.availabilityStartTime=self.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(seg.presentationStartTime,representation.adaptation.period.mpd,isDynamic),seg.availabilityEndTime=self.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(presentationEndTime,representation.adaptation.period.mpd,isDynamic),seg.wallStartTime=self.timelineConverter.calcWallTimeForSegment(seg,isDynamic),seg.replacementNumber=getNumberForSegment(seg,index),seg.availabilityIdx=index,seg},getSegmentsFromTimeline=function(representation){var fragments,frag,i,len,j,repeat,repeatEndTime,nextFrag,calculatedRange,hasEnoughSegments,requiredMediaTime,startIdx,endIdx,fTimescale,self=this,template=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].SegmentTemplate,timeline=template.SegmentTimeline,isAvailableSegmentNumberCalculated=representation.availableSegmentsNumber>0,maxSegmentsAhead=10,segments=[],time=0,scaledTime=0,availabilityIdx=-1,createSegment=function(s){return getTimeBasedSegment.call(self,representation,time,s.d,fTimescale,template.media,s.mediaRange,availabilityIdx)};for(fTimescale=representation.timescale,fragments=timeline.S_asArray,calculatedRange=decideSegmentListRangeForTimeline.call(self,representation),calculatedRange?(startIdx=calculatedRange.start,endIdx=calculatedRange.end):requiredMediaTime=self.timelineConverter.calcMediaTimeFromPresentationTime(requestedTime||0,representation),i=0,len=fragments.length;len>i;i+=1)if(frag=fragments[i],repeat=0,frag.hasOwnProperty("r")&&(repeat=frag.r),frag.hasOwnProperty("t")&&(time=frag.t,scaledTime=time/fTimescale),0>repeat&&(nextFrag=fragments[i+1],nextFrag&&nextFrag.hasOwnProperty("t")?repeatEndTime=nextFrag.t/fTimescale:(repeatEndTime=self.timelineConverter.calcMediaTimeFromPresentationTime(representation.segmentAvailabilityRange.end,representation),representation.segmentDuration=frag.d/fTimescale),repeat=Math.ceil((repeatEndTime-scaledTime)/(frag.d/fTimescale))-1),hasEnoughSegments){if(isAvailableSegmentNumberCalculated)break;availabilityIdx+=repeat+1}else for(j=0;repeat>=j;j+=1){if(availabilityIdx+=1,calculatedRange){if(availabilityIdx>endIdx){if(hasEnoughSegments=!0,isAvailableSegmentNumberCalculated)break;continue}availabilityIdx>=startIdx&&segments.push(createSegment.call(self,frag))}else{if(segments.length>maxSegmentsAhead){if(hasEnoughSegments=!0,isAvailableSegmentNumberCalculated)break;continue}scaledTime>=requiredMediaTime-frag.d/fTimescale&&segments.push(createSegment.call(self,frag))}time+=frag.d,scaledTime=time/fTimescale}if(!isAvailableSegmentNumberCalculated){var availabilityStartTime,availabilityEndTime,f=fragments[0];availabilityStartTime=void 0===f.t?0:self.timelineConverter.calcPresentationTimeFromMediaTime(f.t/fTimescale,representation),availabilityEndTime=self.timelineConverter.calcPresentationTimeFromMediaTime((time-frag.d)/fTimescale,representation),representation.segmentAvailabilityRange={start:availabilityStartTime,end:availabilityEndTime},representation.availableSegmentsNumber=availabilityIdx+1}return segments},getSegmentsFromTemplate=function(representation){var segmentRange,periodSegIdx,startIdx,endIdx,start,segments=[],self=this,template=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].SegmentTemplate,duration=representation.segmentDuration,availabilityWindow=representation.segmentAvailabilityRange,seg=null,url=null;for(start=representation.startNumber,segmentRange=decideSegmentListRangeForTemplate.call(self,representation),startIdx=segmentRange.start,endIdx=segmentRange.end,periodSegIdx=startIdx;endIdx>=periodSegIdx;periodSegIdx+=1)seg=getIndexBasedSegment.call(self,representation,periodSegIdx),seg.replacementTime=(start+periodSegIdx-1)*representation.segmentDuration,url=template.media,url=replaceTokenForTemplate(url,"Number",seg.replacementNumber),url=replaceTokenForTemplate(url,"Time",seg.replacementTime),seg.media=url,segments.push(seg),seg=null;
return representation.availableSegmentsNumber=Math.ceil((availabilityWindow.end-availabilityWindow.start)/duration),segments},decideSegmentListRangeForTemplate=function(representation){{var start,end,range,self=this,duration=representation.segmentDuration,minBufferTime=representation.adaptation.period.mpd.manifest.minBufferTime,availabilityWindow=representation.segmentAvailabilityRange,periodRelativeRange={start:self.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,availabilityWindow.start),end:self.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,availabilityWindow.end)},originAvailabilityTime=0/0,originSegment=null,currentSegmentList=representation.segments;Math.max(2*minBufferTime,10*duration)}return periodRelativeRange||(periodRelativeRange=self.timelineConverter.calcSegmentAvailabilityRange(representation,isDynamic)),isDynamic&&!self.timelineConverter.isTimeSyncCompleted()?(start=Math.floor(periodRelativeRange.start/duration),end=Math.floor(periodRelativeRange.end/duration),range={start:start,end:end}):(currentSegmentList?(originSegment=getSegmentByIndex(index,representation),originAvailabilityTime=originSegment?self.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,originSegment.presentationStartTime):index>0?index*duration:self.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(representation,requestedTime||currentSegmentList[0].presentationStartTime)):originAvailabilityTime=index>0?index*duration:isDynamic?periodRelativeRange.end:periodRelativeRange.start,start=Math.floor(periodRelativeRange.start/duration),end=Math.floor(periodRelativeRange.end/duration),range={start:start,end:end})},decideSegmentListRangeForTimeline=function(){var start,end,range,availabilityLowerLimit=2,availabilityUpperLimit=10,firstIdx=0,lastIdx=Number.POSITIVE_INFINITY;return isDynamic&&!this.timelineConverter.isTimeSyncCompleted()?range={start:firstIdx,end:lastIdx}:!isDynamic&&requestedTime||0>index?null:(start=Math.max(index-availabilityLowerLimit,firstIdx),end=Math.min(index+availabilityUpperLimit,lastIdx),range={start:start,end:end})},getTimeBasedSegment=function(representation,time,duration,fTimescale,url,range,index){var presentationStartTime,presentationEndTime,seg,self=this,scaledTime=time/fTimescale,scaledDuration=Math.min(duration/fTimescale,representation.adaptation.period.mpd.maxSegmentDuration);return presentationStartTime=self.timelineConverter.calcPresentationTimeFromMediaTime(scaledTime,representation),presentationEndTime=presentationStartTime+scaledDuration,seg=new Dash.vo.Segment,seg.representation=representation,seg.duration=scaledDuration,seg.mediaStartTime=scaledTime,seg.presentationStartTime=presentationStartTime,seg.availabilityStartTime=representation.adaptation.period.mpd.manifest.loadedTime,seg.availabilityEndTime=self.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(presentationEndTime,representation.adaptation.period.mpd,isDynamic),seg.wallStartTime=self.timelineConverter.calcWallTimeForSegment(seg,isDynamic),seg.replacementTime=time,seg.replacementNumber=getNumberForSegment(seg,index),url=replaceTokenForTemplate(url,"Number",seg.replacementNumber),url=replaceTokenForTemplate(url,"Time",seg.replacementTime),seg.media=url,seg.mediaRange=range,seg.availabilityIdx=index,seg},getSegmentsFromList=function(representation){var periodSegIdx,seg,s,range,startIdx,endIdx,start,self=this,segments=[],list=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].SegmentList,len=list.SegmentURL_asArray.length;for(start=representation.startNumber,range=decideSegmentListRangeForTemplate.call(self,representation),startIdx=Math.max(range.start,0),endIdx=Math.min(range.end,list.SegmentURL_asArray.length-1),periodSegIdx=startIdx;endIdx>=periodSegIdx;periodSegIdx+=1)s=list.SegmentURL_asArray[periodSegIdx],seg=getIndexBasedSegment.call(self,representation,periodSegIdx),seg.replacementTime=(start+periodSegIdx-1)*representation.segmentDuration,seg.media=s.media,seg.mediaRange=s.mediaRange,seg.index=s.index,seg.indexRange=s.indexRange,segments.push(seg),seg=null;return representation.availableSegmentsNumber=len,segments},getSegments=function(representation){var segments,self=this,type=representation.segmentInfoType;return"SegmentBase"!==type&&"BaseURL"!==type&&isSegmentListUpdateRequired.call(self,representation)?("SegmentTimeline"===type?segments=getSegmentsFromTimeline.call(self,representation):"SegmentTemplate"===type?segments=getSegmentsFromTemplate.call(self,representation):"SegmentList"===type&&(segments=getSegmentsFromList.call(self,representation)),onSegmentListUpdated.call(self,representation,segments)):segments=representation.segments,segments},onSegmentListUpdated=function(representation,segments){var lastIdx;if(representation.segments=segments,lastIdx=segments.length-1,isDynamic&&isNaN(this.timelineConverter.getExpectedLiveEdge())){var liveEdge=segments[lastIdx].presentationStartTime,metrics=this.metricsModel.getMetricsFor("stream");this.timelineConverter.setExpectedLiveEdge(liveEdge),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(metrics),{presentationStartTime:liveEdge})}},updateSegmentList=function(representation){var self=this;if(!representation)throw new Error("no representation");return representation.segments=null,getSegments.call(self,representation),representation},updateRepresentation=function(representation,keepIdx){var self=this,hasInitialization=representation.initialization,hasSegments="BaseURL"!==representation.segmentInfoType&&"SegmentBase"!==representation.segmentInfoType;representation.segmentAvailabilityRange=self.timelineConverter.calcSegmentAvailabilityRange(representation,isDynamic),keepIdx||(index=-1),updateSegmentList.call(self,representation),hasInitialization||self.baseURLExt.loadInitialization(representation),hasSegments||self.baseURLExt.loadSegments(representation,type,representation.indexRange),hasInitialization&&hasSegments&&self.notify(self.eventList.ENAME_REPRESENTATION_UPDATED,representation)},getIndexForSegments=function(time,representation){time=Math.floor(time);var frag,ft,fd,i,segments=representation.segments,segmentLastIdx=segments?segments.length-1:null,idx=-1;if(segments&&segments.length>0)for(i=segmentLastIdx;i>=0;i--)if(frag=segments[i],ft=frag.presentationStartTime,fd=frag.duration,time+Dash.dependencies.DashHandler.EPSILON>=ft&&time-Dash.dependencies.DashHandler.EPSILON<=ft+fd){idx=frag.availabilityIdx;break}return idx},getSegmentByIndex=function(index,representation){if(!representation||!representation.segments)return null;var seg,i,ln=representation.segments.length;for(i=0;ln>i;i+=1)if(seg=representation.segments[i],seg.availabilityIdx===index)return seg;return null},isSegmentListUpdateRequired=function(representation){var upperIdx,lowerIdx,updateRequired=!1,segments=representation.segments;return segments?(lowerIdx=segments[0].availabilityIdx,upperIdx=segments[segments.length-1].availabilityIdx,updateRequired=lowerIdx>index||index>upperIdx):updateRequired=!0,updateRequired},getRequestForSegment=function(segment){if(null===segment||void 0===segment)return null;var url,request=new MediaPlayer.vo.FragmentRequest,representation=segment.representation,bandwidth=representation.adaptation.period.mpd.manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].bandwidth;return url=getRequestUrl(segment.media,representation),url=replaceTokenForTemplate(url,"Number",segment.replacementNumber),url=replaceTokenForTemplate(url,"Time",segment.replacementTime),url=replaceTokenForTemplate(url,"Bandwidth",bandwidth),url=replaceIDForTemplate(url,representation.id),url=unescapeDollarsInTemplate(url),request.mediaType=type,request.type="Media Segment",request.url=url,request.range=segment.mediaRange,request.startTime=segment.presentationStartTime,request.duration=segment.duration,request.timescale=representation.timescale,request.availabilityStartTime=segment.availabilityStartTime,request.availabilityEndTime=segment.availabilityEndTime,request.wallStartTime=segment.wallStartTime,request.quality=representation.index,request.index=segment.availabilityIdx,request},getForTime=function(representation,time,keepIdx){var request,segment,finished,idx=index,self=this;return representation?(requestedTime=time,self.debug.log("Getting the request for time: "+time),index=getIndexForSegments.call(self,time,representation),getSegments.call(self,representation),0>index&&(index=getIndexForSegments.call(self,time,representation)),self.debug.log("Index for time "+time+" is "+index),finished=isMediaFinished.call(self,representation),finished?(request=new MediaPlayer.vo.FragmentRequest,request.action=request.ACTION_COMPLETE,request.index=index,request.mediaType=type,self.debug.log("Signal complete."),self.debug.log(request)):(segment=getSegmentByIndex(index,representation),request=getRequestForSegment.call(self,segment)),keepIdx&&(index=idx),request):null},generateForTime=function(representation,time){var step=(representation.segmentAvailabilityRange.end-representation.segmentAvailabilityRange.start)/2;return representation.segments=null,representation.segmentAvailabilityRange={start:time-step,end:time+step},getForTime.call(this,representation,time,!1)},getNext=function(representation){var request,segment,finished,idx,self=this;if(!representation)return null;if(-1===index)throw"You must call getSegmentRequestForTime first.";return requestedTime=null,index+=1,idx=index,finished=isMediaFinished.call(self,representation),finished?(request=new MediaPlayer.vo.FragmentRequest,request.action=request.ACTION_COMPLETE,request.index=idx,request.mediaType=type,self.debug.log("Signal complete.")):(getSegments.call(self,representation),segment=getSegmentByIndex(idx,representation),request=getRequestForSegment.call(self,segment)),request},onInitializationLoaded=function(sender,representation){console.log("INIT LOADED"),console.log(representation),representation.segments&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,representation)},onSegmentsLoaded=function(sender,fragments,representation,typeValue,error){if(!error&&type===typeValue){var i,len,s,seg,self=this,segments=[],count=0;for(i=0,len=fragments.length;len>i;i+=1)s=fragments[i],seg=getTimeBasedSegment.call(self,representation,s.startTime,s.duration,s.timescale,s.media,s.mediaRange,count),segments.push(seg),seg=null,count+=1;representation.segmentAvailabilityRange={start:segments[0].presentationStartTime,end:segments[len-1].presentationStartTime},representation.availableSegmentsNumber=len,onSegmentListUpdated.call(self,representation,segments),representation.initialization&&this.notify(this.eventList.ENAME_REPRESENTATION_UPDATED,representation)}};return{debug:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_REPRESENTATION_UPDATED:"representationUpdated"},setup:function(){this.initializationLoaded=onInitializationLoaded,this.segmentsLoaded=onSegmentsLoaded},initialize:function(streamProcessor){this.subscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,streamProcessor.trackController),type=streamProcessor.getType(),isDynamic=streamProcessor.isDynamic(),this.streamProcessor=streamProcessor},getType:function(){return type},setType:function(value){type=value},getIsDynamic:function(){return isDynamic},setIsDynamic:function(value){isDynamic=value},setCurrentTime:function(value){currentTime=value},getCurrentTime:function(){return currentTime},reset:function(){currentTime=0,requestedTime=void 0,index=-1,this.unsubscribe(this.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.trackController)},getInitRequest:getInit,getSegmentRequestForTime:getForTime,getNextSegmentRequest:getNext,generateSegmentRequestForTime:generateForTime,updateRepresentation:updateRepresentation}},Dash.dependencies.DashHandler.EPSILON=.003,Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(adaptation,type){"use strict";var i,len,representation,col=adaptation.ContentComponent_asArray,mimeTypeRegEx=new RegExp("text"!==type?type:"(vtt|ttml)"),result=!1,found=!1;if(col)for(i=0,len=col.length;len>i;i+=1)col[i].contentType===type&&(result=!0,found=!0);if(adaptation.hasOwnProperty("mimeType")&&(result=mimeTypeRegEx.test(adaptation.mimeType),found=!0),!found)for(i=0,len=adaptation.Representation_asArray.length;!found&&len>i;)representation=adaptation.Representation_asArray[i],representation.hasOwnProperty("mimeType")&&(result=mimeTypeRegEx.test(representation.mimeType),found=!0),i+=1;return result},getIsAudio:function(adaptation){"use strict";return this.getIsTypeOf(adaptation,"audio")},getIsVideo:function(adaptation){"use strict";return this.getIsTypeOf(adaptation,"video")},getIsText:function(adaptation){"use strict";return this.getIsTypeOf(adaptation,"text")},getIsTextTrack:function(type){return"text/vtt"===type||"application/ttml+xml"===type},getLanguageForAdaptation:function(adaptation){var lang="";return adaptation.hasOwnProperty("lang")&&(lang=adaptation.lang),lang},getIsMain:function(){"use strict";return!1},processAdaptation:function(adaptation){"use strict";return void 0!==adaptation.Representation_asArray&&null!==adaptation.Representation_asArray&&adaptation.Representation_asArray.sort(function(a,b){return a.bandwidth-b.bandwidth}),adaptation},getAdaptationForId:function(id,manifest,periodIndex){"use strict";var i,len,adaptations=manifest.Period_asArray[periodIndex].AdaptationSet_asArray;for(i=0,len=adaptations.length;len>i;i+=1)if(adaptations[i].hasOwnProperty("id")&&adaptations[i].id===id)return adaptations[i];return null},getAdaptationForIndex:function(index,manifest,periodIndex){"use strict";var adaptations=manifest.Period_asArray[periodIndex].AdaptationSet_asArray;return adaptations[index]},getIndexForAdaptation:function(adaptation,manifest,periodIndex){"use strict";var i,len,adaptations=manifest.Period_asArray[periodIndex].AdaptationSet_asArray;for(i=0,len=adaptations.length;len>i;i+=1)if(adaptations[i]===adaptation)return i;return-1},getAdaptationsForType:function(manifest,periodIndex,type){"use strict";var i,len,self=this,adaptationSet=manifest.Period_asArray[periodIndex].AdaptationSet_asArray,adaptations=[];for(i=0,len=adaptationSet.length;len>i;i+=1)this.getIsTypeOf(adaptationSet[i],type)&&adaptations.push(self.processAdaptation(adaptationSet[i]));return adaptations},getAdaptationForType:function(manifest,periodIndex,type){"use strict";var i,len,adaptations,self=this;if(adaptations=this.getAdaptationsForType(manifest,periodIndex,type),!adaptations||0===adaptations.length)return null;for(i=0,len=adaptations.length;len>i;i+=1)if(self.getIsMain(adaptations[i]))return adaptations[i];return adaptations[0]},getCodec:function(adaptation){"use strict";var representation=adaptation.Representation_asArray[0],codec=representation.mimeType+';codecs="'+representation.codecs+'"';return codec},getMimeType:function(adaptation){"use strict";return adaptation.Representation_asArray[0].mimeType},getKID:function(adaptation){"use strict";return adaptation&&adaptation.hasOwnProperty("cenc:default_KID")?adaptation["cenc:default_KID"]:null},getContentProtectionData:function(adaptation){"use strict";return adaptation&&adaptation.hasOwnProperty("ContentProtection_asArray")&&0!==adaptation.ContentProtection_asArray.length?adaptation.ContentProtection_asArray:null},getIsDynamic:function(manifest){"use strict";var isDynamic=!1,LIVE_TYPE="dynamic";return manifest.hasOwnProperty("type")&&(isDynamic=manifest.type===LIVE_TYPE),isDynamic},getIsDVR:function(manifest){"use strict";var containsDVR,isDVR,isDynamic=this.getIsDynamic(manifest);return containsDVR=!isNaN(manifest.timeShiftBufferDepth),isDVR=isDynamic&&containsDVR},getIsOnDemand:function(manifest){"use strict";var isOnDemand=!1;return manifest.profiles&&manifest.profiles.length>0&&(isOnDemand=-1!==manifest.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),isOnDemand},getDuration:function(manifest){var mpdDuration;return mpdDuration=manifest.hasOwnProperty("mediaPresentationDuration")?manifest.mediaPresentationDuration:Number.POSITIVE_INFINITY},getBandwidth:function(representation){"use strict";return representation.bandwidth},getRefreshDelay:function(manifest){"use strict";var delay=0/0,minDelay=2;return manifest.hasOwnProperty("minimumUpdatePeriod")&&(delay=Math.max(parseFloat(manifest.minimumUpdatePeriod),minDelay)),delay},getRepresentationCount:function(adaptation){"use strict";return adaptation.Representation_asArray.length},getRepresentationFor:function(index,adaptation){"use strict";return adaptation.Representation_asArray[index]},getRepresentationsForAdaptation:function(manifest,adaptation){for(var representation,initialization,segmentInfo,r,s,self=this,a=self.processAdaptation(manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index]),representations=[],i=0;i<a.Representation_asArray.length;i+=1)r=a.Representation_asArray[i],representation=new Dash.vo.Representation,representation.index=i,representation.adaptation=adaptation,r.hasOwnProperty("id")&&(representation.id=r.id),r.hasOwnProperty("SegmentBase")?(segmentInfo=r.SegmentBase,representation.segmentInfoType="SegmentBase"):r.hasOwnProperty("SegmentList")?(segmentInfo=r.SegmentList,representation.segmentInfoType="SegmentList",representation.useCalculatedLiveEdgeTime=!0):r.hasOwnProperty("SegmentTemplate")?(segmentInfo=r.SegmentTemplate,segmentInfo.hasOwnProperty("SegmentTimeline")?(representation.segmentInfoType="SegmentTimeline",s=segmentInfo.SegmentTimeline.S_asArray[segmentInfo.SegmentTimeline.S_asArray.length-1],(!s.hasOwnProperty("r")||s.r>=0)&&(representation.useCalculatedLiveEdgeTime=!0)):representation.segmentInfoType="SegmentTemplate",segmentInfo.hasOwnProperty("initialization")&&(representation.initialization=segmentInfo.initialization.split("$Bandwidth$").join(r.bandwidth).split("$RepresentationID$").join(r.id))):(segmentInfo=r.BaseURL,representation.segmentInfoType="BaseURL"),segmentInfo.hasOwnProperty("Initialization")&&(initialization=segmentInfo.Initialization,initialization.hasOwnProperty("sourceURL")?representation.initialization=initialization.sourceURL:initialization.hasOwnProperty("range")&&(representation.initialization=r.BaseURL,representation.range=initialization.range)),segmentInfo.hasOwnProperty("timescale")&&(representation.timescale=segmentInfo.timescale),segmentInfo.hasOwnProperty("duration")&&(representation.segmentDuration=segmentInfo.duration/representation.timescale),segmentInfo.hasOwnProperty("startNumber")&&(representation.startNumber=segmentInfo.startNumber),segmentInfo.hasOwnProperty("indexRange")&&(representation.indexRange=segmentInfo.indexRange),segmentInfo.hasOwnProperty("presentationTimeOffset")&&(representation.presentationTimeOffset=segmentInfo.presentationTimeOffset/representation.timescale),representation.MSETimeOffset=self.timelineConverter.calcMSETimeOffset(representation),representations.push(representation);return representations},getAdaptationsForPeriod:function(manifest,period){for(var adaptationSet,a,p=manifest.Period_asArray[period.index],adaptations=[],i=0;i<p.AdaptationSet_asArray.length;i+=1)a=p.AdaptationSet_asArray[i],adaptationSet=new Dash.vo.AdaptationSet,a.hasOwnProperty("id")&&(adaptationSet.id=a.id),adaptationSet.index=i,adaptationSet.period=period,adaptationSet.type=this.getIsAudio(a)?"audio":this.getIsVideo(a)?"video":"text",adaptations.push(adaptationSet);return adaptations},getRegularPeriods:function(manifest,mpd){var i,len,self=this,periods=[],isDynamic=self.getIsDynamic(manifest),p1=null,p=null,vo1=null,vo=null;for(i=0,len=manifest.Period_asArray.length;len>i;i+=1)p=manifest.Period_asArray[i],p.hasOwnProperty("start")?(vo=new Dash.vo.Period,vo.start=p.start):null!==p1&&p.hasOwnProperty("duration")?(vo=new Dash.vo.Period,vo.start=vo1.start+vo1.duration,vo.duration=p.duration):0!==i||isDynamic||(vo=new Dash.vo.Period,vo.start=0),null!==vo1&&isNaN(vo1.duration)&&(vo1.duration=vo.start-vo1.start),null!==vo&&p.hasOwnProperty("id")&&(vo.id=p.id),null!==vo&&p.hasOwnProperty("duration")&&(vo.duration=p.duration),null!==vo&&(vo.index=i,vo.mpd=mpd,periods.push(vo)),p1=p,p=null,vo1=vo,vo=null;return 0===periods.length?periods:(mpd.checkTime=self.getCheckTime(manifest,periods[0]),null!==vo1&&isNaN(vo1.duration)&&(vo1.duration=self.getEndTimeForLastPeriod(mpd)-vo1.start),periods)},getMpd:function(manifest){var mpd=new Dash.vo.Mpd;return mpd.manifest=manifest,mpd.availabilityStartTime=new Date(manifest.hasOwnProperty("availabilityStartTime")?manifest.availabilityStartTime.getTime():manifest.loadedTime.getTime()),manifest.hasOwnProperty("availabilityEndTime")&&(mpd.availabilityEndTime=new Date(manifest.availabilityEndTime.getTime())),manifest.hasOwnProperty("suggestedPresentationDelay")&&(mpd.suggestedPresentationDelay=manifest.suggestedPresentationDelay),manifest.hasOwnProperty("timeShiftBufferDepth")&&(mpd.timeShiftBufferDepth=manifest.timeShiftBufferDepth),manifest.hasOwnProperty("maxSegmentDuration")&&(mpd.maxSegmentDuration=manifest.maxSegmentDuration),mpd},getFetchTime:function(manifest,period){var fetchTime=this.timelineConverter.calcPresentationTimeFromWallTime(manifest.loadedTime,period);return fetchTime},getCheckTime:function(manifest,period){var fetchTime,self=this,checkTime=0/0;return manifest.hasOwnProperty("minimumUpdatePeriod")&&(fetchTime=self.getFetchTime(manifest,period),checkTime=fetchTime+manifest.minimumUpdatePeriod),checkTime},getEndTimeForLastPeriod:function(mpd){var periodEnd;if(mpd.manifest.mediaPresentationDuration)periodEnd=mpd.manifest.mediaPresentationDuration;else{if(isNaN(mpd.checkTime))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");periodEnd=mpd.checkTime}return periodEnd},getEventsForPeriod:function(manifest,period){var periodArray=manifest.Period_asArray,eventStreams=periodArray[period.index].EventStream_asArray,events=[];if(eventStreams)for(var i=0;i<eventStreams.length;i+=1){var eventStream=new Dash.vo.EventStream;if(eventStream.period=period,eventStream.timescale=1,!eventStreams[i].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";eventStream.schemeIdUri=eventStreams[i].schemeIdUri,eventStreams[i].hasOwnProperty("timescale")&&(eventStream.timescale=eventStreams[i].timescale),eventStreams[i].hasOwnProperty("value")&&(eventStream.value=eventStreams[i].value);for(var j=0;j<eventStreams[i].Event_asArray.length;j+=1){var event=new Dash.vo.Event;event.presentationTime=0,event.eventStream=eventStream,eventStreams[i].Event_asArray[j].hasOwnProperty("presentationTime")&&(event.presentationTime=eventStreams[i].Event_asArray[j].presentationTime),eventStreams[i].Event_asArray[j].hasOwnProperty("duration")&&(event.duration=eventStreams[i].Event_asArray[j].duration),eventStreams[i].Event_asArray[j].hasOwnProperty("id")&&(event.id=eventStreams[i].Event_asArray[j].id),events.push(event)}}return events},getEventStreamForAdaptationSet:function(manifest,adaptation){var eventStreams=[],inbandStreams=manifest.Period_asArray[adaptation.period.index].AdaptationSet_asArray[adaptation.index].InbandEventStream_asArray;if(inbandStreams)for(var i=0;i<inbandStreams.length;i+=1){var eventStream=new Dash.vo.EventStream;if(eventStream.timescale=1,!inbandStreams[i].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";eventStream.schemeIdUri=inbandStreams[i].schemeIdUri,inbandStreams[i].hasOwnProperty("timescale")&&(eventStream.timescale=inbandStreams[i].timescale),inbandStreams[i].hasOwnProperty("value")&&(eventStream.value=inbandStreams[i].value),eventStreams.push(eventStream)}return eventStreams},getEventStreamForRepresentation:function(manifest,representation){var eventStreams=[],inbandStreams=manifest.Period_asArray[representation.adaptation.period.index].AdaptationSet_asArray[representation.adaptation.index].Representation_asArray[representation.index].InbandEventStream_asArray;if(inbandStreams)for(var i=0;i<inbandStreams.length;i++){var eventStream=new Dash.vo.EventStream;if(eventStream.timescale=1,eventStream.representation=representation,!inbandStreams[i].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";eventStream.schemeIdUri=inbandStreams[i].schemeIdUri,inbandStreams[i].hasOwnProperty("timescale")&&(eventStream.timescale=inbandStreams[i].timescale),inbandStreams[i].hasOwnProperty("value")&&(eventStream.value=inbandStreams[i].value),eventStreams.push(eventStream)}return eventStreams}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var findRepresentationIndexInPeriodArray=function(periodArray,representationId){var period,adaptationSet,adaptationSetArray,representation,representationArray,periodArrayIndex,adaptationSetArrayIndex,representationArrayIndex;for(periodArrayIndex=0;periodArrayIndex<periodArray.length;periodArrayIndex+=1)for(period=periodArray[periodArrayIndex],adaptationSetArray=period.AdaptationSet_asArray,adaptationSetArrayIndex=0;adaptationSetArrayIndex<adaptationSetArray.length;adaptationSetArrayIndex+=1)for(adaptationSet=adaptationSetArray[adaptationSetArrayIndex],representationArray=adaptationSet.Representation_asArray,representationArrayIndex=0;representationArrayIndex<representationArray.length;representationArrayIndex+=1)if(representation=representationArray[representationArrayIndex],representationId===representation.id)return representationArrayIndex;return-1},findRepresentionInPeriodArray=function(periodArray,representationId){var period,adaptationSet,adaptationSetArray,representation,representationArray,periodArrayIndex,adaptationSetArrayIndex,representationArrayIndex;for(periodArrayIndex=0;periodArrayIndex<periodArray.length;periodArrayIndex+=1)for(period=periodArray[periodArrayIndex],adaptationSetArray=period.AdaptationSet_asArray,adaptationSetArrayIndex=0;adaptationSetArrayIndex<adaptationSetArray.length;adaptationSetArrayIndex+=1)for(adaptationSet=adaptationSetArray[adaptationSetArrayIndex],representationArray=adaptationSet.Representation_asArray,representationArrayIndex=0;representationArrayIndex<representationArray.length;representationArrayIndex+=1)if(representation=representationArray[representationArrayIndex],representationId===representation.id)return representation;return null},adaptationIsType=function(adaptation,bufferType){return this.manifestExt.getIsTypeOf(adaptation,bufferType)},findMaxBufferIndex=function(periodArray,bufferType){var period,adaptationSet,adaptationSetArray,representationArray,periodArrayIndex,adaptationSetArrayIndex;for(periodArrayIndex=0;periodArrayIndex<periodArray.length;periodArrayIndex+=1)for(period=periodArray[periodArrayIndex],adaptationSetArray=period.AdaptationSet_asArray,adaptationSetArrayIndex=0;adaptationSetArrayIndex<adaptationSetArray.length;adaptationSetArrayIndex+=1)if(adaptationSet=adaptationSetArray[adaptationSetArrayIndex],representationArray=adaptationSet.Representation_asArray,adaptationIsType.call(this,adaptationSet,bufferType))return representationArray.length;return-1},getBandwidthForRepresentation=function(representationId){var representation,self=this,manifest=self.manifestModel.getValue(),periodArray=manifest.Period_asArray;return representation=findRepresentionInPeriodArray.call(self,periodArray,representationId),null===representation?null:representation.bandwidth},getIndexForRepresentation=function(representationId){var representationIndex,self=this,manifest=self.manifestModel.getValue(),periodArray=manifest.Period_asArray;return representationIndex=findRepresentationIndexInPeriodArray.call(self,periodArray,representationId)},getMaxIndexForBufferType=function(bufferType){var maxIndex,self=this,manifest=self.manifestModel.getValue(),periodArray=manifest.Period_asArray;return maxIndex=findMaxBufferIndex.call(this,periodArray,bufferType)},getCurrentRepresentationSwitch=function(metrics){if(null===metrics)return null;var repSwitchLength,repSwitchLastIndex,currentRepSwitch,repSwitch=metrics.RepSwitchList;return null===repSwitch||repSwitch.length<=0?null:(repSwitchLength=repSwitch.length,repSwitchLastIndex=repSwitchLength-1,currentRepSwitch=repSwitch[repSwitchLastIndex])},getCurrentBufferLevel=function(metrics){if(null===metrics)return null;var bufferLevelLength,bufferLevelLastIndex,currentBufferLevel,bufferLevel=metrics.BufferLevel;return null===bufferLevel||bufferLevel.length<=0?null:(bufferLevelLength=bufferLevel.length,bufferLevelLastIndex=bufferLevelLength-1,currentBufferLevel=bufferLevel[bufferLevelLastIndex])},getCurrentPlaybackRate=function(metrics){if(null===metrics)return null;var trace,currentRate,playList=metrics.PlayList;return null===playList||playList.length<=0?null:(trace=playList[playList.length-1].trace,null===trace||trace.length<=0?null:currentRate=trace[trace.length-1].playbackspeed)},getCurrentHttpRequest=function(metrics){if(null===metrics)return null;var httpListLength,httpListLastIndex,httpList=metrics.HttpList,currentHttpList=null;if(null===httpList||httpList.length<=0)return null;for(httpListLength=httpList.length,httpListLastIndex=httpListLength-1;httpListLastIndex>0;){if(httpList[httpListLastIndex].responsecode){currentHttpList=httpList[httpListLastIndex];break}httpListLastIndex-=1}return currentHttpList},getHttpRequests=function(metrics){return null===metrics?[]:metrics.HttpList?metrics.HttpList:[]},getCurrentDroppedFrames=function(metrics){if(null===metrics)return null;var droppedFramesLength,droppedFramesLastIndex,currentDroppedFrames,droppedFrames=metrics.DroppedFrames;return null===droppedFrames||droppedFrames.length<=0?null:(droppedFramesLength=droppedFrames.length,droppedFramesLastIndex=droppedFramesLength-1,currentDroppedFrames=droppedFrames[droppedFramesLastIndex])},getCurrentSchedulingInfo=function(metrics){if(null===metrics)return null;var ln,lastIdx,currentSchedulingInfo,schedulingInfo=metrics.SchedulingInfo;return null===schedulingInfo||schedulingInfo.length<=0?null:(ln=schedulingInfo.length,lastIdx=ln-1,currentSchedulingInfo=schedulingInfo[lastIdx])},getCurrentManifestUpdate=function(metrics){if(null===metrics)return null;var ln,lastIdx,currentManifestUpdate,manifestUpdate=metrics.ManifestUpdate;return null===manifestUpdate||manifestUpdate.length<=0?null:(ln=manifestUpdate.length,lastIdx=ln-1,currentManifestUpdate=manifestUpdate[lastIdx])},getCurrentDVRInfo=function(metrics){if(null===metrics)return null;var dvrInfoLastIndex,dvrInfo=metrics.DVRInfo,curentDVRInfo=null;return null===dvrInfo||dvrInfo.length<=0?null:(dvrInfoLastIndex=dvrInfo.length-1,curentDVRInfo=dvrInfo[dvrInfoLastIndex])};return{manifestModel:void 0,manifestExt:void 0,getBandwidthForRepresentation:getBandwidthForRepresentation,getIndexForRepresentation:getIndexForRepresentation,getMaxIndexForBufferType:getMaxIndexForBufferType,getCurrentRepresentationSwitch:getCurrentRepresentationSwitch,getCurrentBufferLevel:getCurrentBufferLevel,getCurrentPlaybackRate:getCurrentPlaybackRate,getCurrentHttpRequest:getCurrentHttpRequest,getHttpRequests:getHttpRequests,getCurrentDroppedFrames:getCurrentDroppedFrames,getCurrentSchedulingInfo:getCurrentSchedulingInfo,getCurrentDVRInfo:getCurrentDVRInfo,getCurrentManifestUpdate:getCurrentManifestUpdate}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.DashParser=function(){"use strict";var SECONDS_IN_YEAR=31536e3,SECONDS_IN_MONTH=2592e3,SECONDS_IN_DAY=86400,SECONDS_IN_HOUR=3600,SECONDS_IN_MIN=60,MINUTES_IN_HOUR=60,MILLISECONDS_IN_SECONDS=1e3,durationRegex=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,datetimeRegex=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,numericRegex=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,matchers=[{type:"duration",test:function(str){return durationRegex.test(str)
},converter:function(str){var match=durationRegex.exec(str);return parseFloat(match[2]||0)*SECONDS_IN_YEAR+parseFloat(match[4]||0)*SECONDS_IN_MONTH+parseFloat(match[6]||0)*SECONDS_IN_DAY+parseFloat(match[8]||0)*SECONDS_IN_HOUR+parseFloat(match[10]||0)*SECONDS_IN_MIN+parseFloat(match[12]||0)}},{type:"datetime",test:function(str){return datetimeRegex.test(str)},converter:function(str){var utcDate,match=datetimeRegex.exec(str);if(utcDate=Date.UTC(parseInt(match[1],10),parseInt(match[2],10)-1,parseInt(match[3],10),parseInt(match[4],10),parseInt(match[5],10),match[6]&&parseInt(match[6],10)||0,match[7]&&parseFloat(match[7])*MILLISECONDS_IN_SECONDS||0),match[9]&&match[10]){var timezoneOffset=parseInt(match[9],10)*MINUTES_IN_HOUR+parseInt(match[10],10);utcDate+=("+"===match[8]?-1:1)*timezoneOffset*SECONDS_IN_MIN*MILLISECONDS_IN_SECONDS}return new Date(utcDate)}},{type:"numeric",test:function(str){return numericRegex.test(str)},converter:function(str){return parseFloat(str)}}],getCommonValuesMap=function(){var adaptationSet,representation,subRepresentation,common;return common=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],adaptationSet={},adaptationSet.name="AdaptationSet",adaptationSet.isRoot=!1,adaptationSet.isArray=!0,adaptationSet.parent=null,adaptationSet.children=[],adaptationSet.properties=common,representation={},representation.name="Representation",representation.isRoot=!1,representation.isArray=!0,representation.parent=adaptationSet,representation.children=[],representation.properties=common,adaptationSet.children.push(representation),subRepresentation={},subRepresentation.name="SubRepresentation",subRepresentation.isRoot=!1,subRepresentation.isArray=!0,subRepresentation.parent=representation,subRepresentation.children=[],subRepresentation.properties=common,representation.children.push(subRepresentation),adaptationSet},getSegmentValuesMap=function(){var period,adaptationSet,representation,common;return common=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],period={},period.name="Period",period.isRoot=!1,period.isArray=!0,period.parent=null,period.children=[],period.properties=common,adaptationSet={},adaptationSet.name="AdaptationSet",adaptationSet.isRoot=!1,adaptationSet.isArray=!0,adaptationSet.parent=period,adaptationSet.children=[],adaptationSet.properties=common,period.children.push(adaptationSet),representation={},representation.name="Representation",representation.isRoot=!1,representation.isArray=!0,representation.parent=adaptationSet,representation.children=[],representation.properties=common,adaptationSet.children.push(representation),period},getBaseUrlValuesMap=function(){var mpd,period,adaptationSet,representation,common;return common=[{name:"BaseURL",merge:!0,mergeFunction:function(parentValue,childValue){var mergedValue;return mergedValue=0===childValue.indexOf("http://")||0===childValue.indexOf("https://")?childValue:parentValue+childValue}}],mpd={},mpd.name="mpd",mpd.isRoot=!0,mpd.isArray=!0,mpd.parent=null,mpd.children=[],mpd.properties=common,period={},period.name="Period",period.isRoot=!1,period.isArray=!0,period.parent=null,period.children=[],period.properties=common,mpd.children.push(period),adaptationSet={},adaptationSet.name="AdaptationSet",adaptationSet.isRoot=!1,adaptationSet.isArray=!0,adaptationSet.parent=period,adaptationSet.children=[],adaptationSet.properties=common,period.children.push(adaptationSet),representation={},representation.name="Representation",representation.isRoot=!1,representation.isArray=!0,representation.parent=adaptationSet,representation.children=[],representation.properties=common,adaptationSet.children.push(representation),mpd},getDashMap=function(){var result=[];return result.push(getCommonValuesMap()),result.push(getSegmentValuesMap()),result.push(getBaseUrlValuesMap()),result},internalParse=function(data,baseUrl){var manifest,converter=new X2JS(matchers,"",!0),iron=new ObjectIron(getDashMap()),start=new Date,json=null,ironed=null;try{manifest=converter.xml_str2json(data),json=new Date,manifest.hasOwnProperty("BaseURL")?(manifest.BaseURL=manifest.BaseURL_asArray[0],0!==manifest.BaseURL.toString().indexOf("http")&&(manifest.BaseURL=baseUrl+manifest.BaseURL)):manifest.BaseURL=baseUrl,iron.run(manifest),ironed=new Date,this.debug.log("Parsing complete: ( xml2json: "+(json.getTime()-start.getTime())+"ms, objectiron: "+(ironed.getTime()-json.getTime())+"ms, total: "+(ironed.getTime()-start.getTime())/1e3+"s)")}catch(err){return this.errHandler.manifestError("parsing the manifest failed","parse",data),null}return manifest};return{debug:void 0,errHandler:void 0,parse:internalParse}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.FragmentExtensions=function(){"use strict";var parseTFDT=function(ab){for(var base_media_decode_time,version,size,type,i,c,d=new DataView(ab),pos=0;"tfdt"!==type&&pos<d.byteLength;){for(size=d.getUint32(pos),pos+=4,type="",i=0;4>i;i+=1)c=d.getInt8(pos),type+=String.fromCharCode(c),pos+=1;"moof"!==type&&"traf"!==type&&"tfdt"!==type&&(pos+=size-8)}if(pos===d.byteLength)throw"Error finding live offset.";return version=d.getUint8(pos),this.debug.log("position: "+pos),0===version?(pos+=4,base_media_decode_time=d.getUint32(pos,!1)):(pos+=size-16,base_media_decode_time=utils.Math.to64BitNumber(d.getUint32(pos+4,!1),d.getUint32(pos,!1))),{version:version,base_media_decode_time:base_media_decode_time}},parseSIDX=function(ab){for(var version,timescale,earliest_presentation_time,i,type,size,charCode,d=new DataView(ab),pos=0;"sidx"!==type&&pos<d.byteLength;){for(size=d.getUint32(pos),pos+=4,type="",i=0;4>i;i+=1)charCode=d.getInt8(pos),type+=String.fromCharCode(charCode),pos+=1;"moof"!==type&&"traf"!==type&&"sidx"!==type?pos+=size-8:"sidx"===type&&(pos-=8)}return version=d.getUint8(pos+8),pos+=12,timescale=d.getUint32(pos+4,!1),pos+=8,earliest_presentation_time=0===version?d.getUint32(pos,!1):utils.Math.to64BitNumber(d.getUint32(pos+4,!1),d.getUint32(pos,!1)),{earliestPresentationTime:earliest_presentation_time,timescale:timescale}},loadFragment=function(media){var url,errorStr,parsed,self=this,request=new XMLHttpRequest,loaded=!1;url=media,request.onloadend=function(){loaded||(errorStr="Error loading fragment: "+url,self.notify(self.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(errorStr)))},request.onload=function(){loaded=!0,parsed=parseTFDT(request.response),self.notify(self.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,parsed)},request.onerror=function(){errorStr="Error loading fragment: "+url,self.notify(self.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,null,new Error(errorStr))},request.responseType="arraybuffer",request.open("GET",url),request.send(null)};return{debug:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},loadFragment:loadFragment,parseTFDT:parseTFDT,parseSIDX:parseSIDX}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.RepresentationController=function(){"use strict";var currentRepresentation,data=null,dataIndex=-1,updating=!0,availableRepresentations=[],updateData=function(dataValue,adaptation,type){var self=this;if(updating=!0,self.notify(self.eventList.ENAME_DATA_UPDATE_STARTED),availableRepresentations=updateRepresentations.call(self,adaptation),currentRepresentation=getRepresentationForQuality.call(self,self.abrController.getQualityFor(type)),data=dataValue,"video"!==type&&"audio"!==type)return self.notify(self.eventList.ENAME_DATA_UPDATE_COMPLETED,data,currentRepresentation),void addRepresentationSwitch.call(self);for(var i=0;i<availableRepresentations.length;i+=1)self.indexHandler.updateRepresentation(availableRepresentations[i],!0)},addRepresentationSwitch=function(){var now=new Date,currentRepresentation=this.getCurrentRepresentation(),currentVideoTime=this.streamProcessor.playbackController.getTime();this.metricsModel.addTrackSwitch(currentRepresentation.adaptation.type,now,currentVideoTime,currentRepresentation.id)},getRepresentationForQuality=function(quality){return availableRepresentations[quality]},isAllRepresentationsUpdated=function(){for(var i=0,ln=availableRepresentations.length;ln>i;i+=1)if(null===availableRepresentations[i].segmentAvailabilityRange||null===availableRepresentations[i].initialization)return!1;return!0},updateRepresentations=function(adaptation){var reps,self=this,manifest=self.manifestModel.getValue();return dataIndex=self.manifestExt.getIndexForAdaptation(data,manifest,adaptation.period.index),reps=self.manifestExt.getRepresentationsForAdaptation(manifest,adaptation)},updateAvailabilityWindow=function(isDynamic){for(var rep,self=this,i=0,ln=availableRepresentations.length;ln>i;i+=1)rep=availableRepresentations[i],rep.segmentAvailabilityRange=self.timelineConverter.calcSegmentAvailabilityRange(rep,isDynamic)},onRepresentationUpdated=function(sender,representation){for(var repInfo,self=this,r=representation,metrics=self.metricsModel.getMetricsFor("stream"),manifestUpdateInfo=self.metricsExt.getCurrentManifestUpdate(metrics),alreadyAdded=!1,i=0;i<manifestUpdateInfo.trackInfo.length;i+=1)if(repInfo=manifestUpdateInfo.trackInfo[i],repInfo.index===r.index&&repInfo.mediaType===self.streamProcessor.getType()){alreadyAdded=!0;break}alreadyAdded||self.metricsModel.addManifestUpdateTrackInfo(manifestUpdateInfo,r.id,r.index,r.adaptation.period.index,self.streamProcessor.getType(),r.presentationTimeOffset,r.startNumber,r.segmentInfoType),isAllRepresentationsUpdated()&&(updating=!1,self.metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{latency:currentRepresentation.segmentAvailabilityRange.end-self.streamProcessor.playbackController.getTime()}),this.notify(this.eventList.ENAME_DATA_UPDATE_COMPLETED,data,currentRepresentation),addRepresentationSwitch.call(self))},onWallclockTimeUpdated=function(sender,isDynamic){updateAvailabilityWindow.call(this,isDynamic)},onLiveEdgeFound=function(){updateAvailabilityWindow.call(this,!0),this.indexHandler.updateRepresentation(currentRepresentation,!1)},onBufferLevelUpdated=function(sender){var streamProcessor=sender.streamProcessor,self=this,range=self.timelineConverter.calcSegmentAvailabilityRange(currentRepresentation,streamProcessor.isDynamic());self.metricsModel.addDVRInfo(streamProcessor.getType(),streamProcessor.playbackController.getTime(),streamProcessor.getStreamInfo().manifestInfo,range)},onQualityChanged=function(sender,type,oldQuality,newQuality){var self=this;type===self.streamProcessor.getType()&&(currentRepresentation=self.getRepresentationForQuality(newQuality),addRepresentationSwitch.call(self))};return{system:void 0,debug:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},setup:function(){this.qualityChanged=onQualityChanged,this.representationUpdated=onRepresentationUpdated,this.wallclockTimeUpdated=onWallclockTimeUpdated,this.liveEdgeFound=onLiveEdgeFound,this.bufferLevelUpdated=onBufferLevelUpdated},initialize:function(streamProcessor){this.streamProcessor=streamProcessor,this.indexHandler=streamProcessor.indexHandler},getData:function(){return data},getDataIndex:function(){return dataIndex},isUpdating:function(){return updating},updateData:updateData,getRepresentationForQuality:getRepresentationForQuality,getCurrentRepresentation:function(){return currentRepresentation}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.TimelineConverter=function(){"use strict";var clientServerTimeShift=0,isClientServerTimeSyncCompleted=!1,expectedLiveEdge=0/0,calcAvailabilityTimeFromPresentationTime=function(presentationTime,mpd,isDynamic,calculateEnd){var availabilityTime=0/0;return availabilityTime=calculateEnd?isDynamic&&mpd.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(mpd.availabilityStartTime.getTime()+1e3*(presentationTime+mpd.timeShiftBufferDepth)):mpd.availabilityEndTime:isDynamic?new Date(mpd.availabilityStartTime.getTime()+1e3*(presentationTime-clientServerTimeShift)):mpd.availabilityStartTime},calcAvailabilityStartTimeFromPresentationTime=function(presentationTime,mpd,isDynamic){return calcAvailabilityTimeFromPresentationTime.call(this,presentationTime,mpd,isDynamic)},calcAvailabilityEndTimeFromPresentationTime=function(presentationTime,mpd,isDynamic){return calcAvailabilityTimeFromPresentationTime.call(this,presentationTime,mpd,isDynamic,!0)},calcPresentationTimeFromWallTime=function(wallTime,period){return(wallTime.getTime()-period.mpd.availabilityStartTime.getTime()+1e3*clientServerTimeShift)/1e3},calcPresentationTimeFromMediaTime=function(mediaTime,representation){var presentationOffset=representation.presentationTimeOffset;return mediaTime-presentationOffset},calcMediaTimeFromPresentationTime=function(presentationTime,representation){var presentationOffset=representation.presentationTimeOffset;return presentationOffset+presentationTime},calcWallTimeForSegment=function(segment,isDynamic){var suggestedPresentationDelay,displayStartTime,wallTime;return isDynamic&&(suggestedPresentationDelay=segment.representation.adaptation.period.mpd.suggestedPresentationDelay,displayStartTime=segment.presentationStartTime+suggestedPresentationDelay,wallTime=new Date(segment.availabilityStartTime.getTime()+1e3*displayStartTime)),wallTime},calcSegmentAvailabilityRange=function(representation,isDynamic){var now,duration=representation.segmentDuration,start=representation.adaptation.period.start,end=start+representation.adaptation.period.duration,range={start:start,end:end};return isDynamic?isClientServerTimeSyncCompleted&&!isNaN(duration)||!representation.segmentAvailabilityRange?(now=calcPresentationTimeFromWallTime(new Date((new Date).getTime()),representation.adaptation.period),start=Math.max(now-representation.adaptation.period.mpd.timeShiftBufferDepth,0),end=now,range={start:start,end:end}):representation.segmentAvailabilityRange:range},calcPeriodRelativeTimeFromMpdRelativeTime=function(representation,mpdRelativeTime){var periodStartTime=representation.adaptation.period.start;return mpdRelativeTime-periodStartTime},calcMpdRelativeTimeFromPeriodRelativeTime=function(representation,periodRelativeTime){var periodStartTime=representation.adaptation.period.start;return periodRelativeTime+periodStartTime},onLiveEdgeFound=function(sender,actualLiveEdge,searchTime){isClientServerTimeSyncCompleted||(clientServerTimeShift=actualLiveEdge-(expectedLiveEdge+searchTime),isClientServerTimeSyncCompleted=!0)},calcMSETimeOffset=function(representation){var presentationOffset=representation.presentationTimeOffset,periodStart=representation.adaptation.period.start;return periodStart-presentationOffset},reset=function(){clientServerTimeShift=0,isClientServerTimeSyncCompleted=!1,expectedLiveEdge=0/0};return{notifier:void 0,uriQueryFragModel:void 0,setup:function(){this.liveEdgeFound=onLiveEdgeFound},calcAvailabilityStartTimeFromPresentationTime:calcAvailabilityStartTimeFromPresentationTime,calcAvailabilityEndTimeFromPresentationTime:calcAvailabilityEndTimeFromPresentationTime,calcPresentationTimeFromWallTime:calcPresentationTimeFromWallTime,calcPresentationTimeFromMediaTime:calcPresentationTimeFromMediaTime,calcPeriodRelativeTimeFromMpdRelativeTime:calcPeriodRelativeTimeFromMpdRelativeTime,calcMpdRelativeTimeFromPeriodRelativeTime:calcMpdRelativeTimeFromPeriodRelativeTime,calcMediaTimeFromPresentationTime:calcMediaTimeFromPresentationTime,calcSegmentAvailabilityRange:calcSegmentAvailabilityRange,calcWallTimeForSegment:calcWallTimeForSegment,calcMSETimeOffset:calcMSETimeOffset,reset:reset,isTimeSyncCompleted:function(){return isClientServerTimeSyncCompleted},getClientTimeOffset:function(){return clientServerTimeShift},getExpectedLiveEdge:function(){return expectedLiveEdge},setExpectedLiveEdge:function(value){expectedLiveEdge=value}}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1,this.type=null},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Event=function(){"use strict";this.duration=0/0,this.presentationTime=0/0,this.id=0/0,this.messageData="",this.eventStream=null,this.presentationTimeDelta=0/0},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=0/0,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=0/0,this.start=0/0,this.mpd=null},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=0/0,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=0/0,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=0/0,this.replacementTime=null,this.replacementNumber=0/0,this.mediaStartTime=0/0,this.presentationStartTime=0/0,this.availabilityStartTime=0/0,this.availabilityEndTime=0/0,this.availabilityIdx=0/0,this.wallStartTime=0/0,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},MediaPlayer.dependencies.AbrController=function(){"use strict";var autoSwitchBitrate=!0,topQualities={},qualityDict={},confidenceDict={},getInternalQuality=function(type){var quality;return qualityDict.hasOwnProperty(type)||(qualityDict[type]=Math.floor(getTopQualityIndex(type)/2)),quality=qualityDict[type]},setInternalQuality=function(type,value){qualityDict[type]=value},getInternalConfidence=function(type){var confidence;return confidenceDict.hasOwnProperty(type)||(confidenceDict[type]=0),confidence=confidenceDict[type]},setInternalConfidence=function(type,value){confidenceDict[type]=value},setTopQualityIndex=function(type,value){topQualities[type]=value},getTopQualityIndex=function(type){var idx;return topQualities.hasOwnProperty(type)||(topQualities[type]=0),idx=topQualities[type]},onDataUpdateCompleted=function(sender,data,trackData){var max,self=this,mediaInfo=this.adapter.convertDataToTrack(trackData).mediaInfo,type=mediaInfo.type;max=mediaInfo.trackCount-1,getTopQualityIndex(type)!==max&&(setTopQualityIndex(type,max),self.notify(self.eventList.ENAME_TOP_QUALITY_INDEX_CHANGED,type,max))};return{debug:void 0,adapter:void 0,abrRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_QUALITY_CHANGED:"qualityChanged",ENAME_TOP_QUALITY_INDEX_CHANGED:"topQualityIndexChanged"},setup:function(){this.dataUpdateCompleted=onDataUpdateCompleted},getAutoSwitchBitrate:function(){return autoSwitchBitrate},setAutoSwitchBitrate:function(value){autoSwitchBitrate=value},getPlaybackQuality:function(streamProcessor){var quality,oldQuality,rules,confidence,self=this,type=streamProcessor.getType(),callback=function(res){var topQualityIdx=getTopQualityIndex(type);quality=res.value,confidence=res.confidence,0>quality&&(quality=0),quality>topQualityIdx&&(quality=topQualityIdx),oldQuality=getInternalQuality(type),quality!==oldQuality&&(setInternalQuality(type,quality),setInternalConfidence(type,confidence),self.notify(self.eventList.ENAME_QUALITY_CHANGED,type,oldQuality,quality))};quality=getInternalQuality(type),confidence=getInternalConfidence(type),autoSwitchBitrate&&(self.abrRulesCollection.downloadRatioRule&&self.abrRulesCollection.downloadRatioRule.setStreamProcessor(streamProcessor),rules=self.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),self.rulesController.applyRules(rules,streamProcessor,callback.bind(self),quality,function(currentValue,newValue){return Math.min(currentValue,newValue)}))},setPlaybackQuality:function(type,newPlaybackQuality){var quality=getInternalQuality(type),isInt=null!==newPlaybackQuality&&!isNaN(newPlaybackQuality)&&newPlaybackQuality%1===0;if(!isInt)throw"argument is not an integer";newPlaybackQuality!==quality&&newPlaybackQuality>=0&&topQualities.hasOwnProperty(type)&&newPlaybackQuality<=topQualities[type]&&(setInternalQuality(type,newPlaybackQuality),this.notify(this.eventList.ENAME_QUALITY_CHANGED,type,quality,newPlaybackQuality))},getQualityFor:function(type){return getInternalQuality(type)},getConfidenceFor:function(type){return getInternalConfidence(type)},isPlayingAtTopQuality:function(){var isAtTop,self=this,audioQuality=self.getQualityFor("audio"),videoQuality=self.getQualityFor("video");return isAtTop=audioQuality===getTopQualityIndex("audio")&&videoQuality===getTopQualityIndex("video")},reset:function(){var rule,rules=this.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),ln=rules.length,i=0;for(i;ln>i;i+=1)rule=rules[i],"function"==typeof rule.reset&&rule.reset();autoSwitchBitrate=!0,topQualities={},qualityDict={},confidenceDict={}}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.BufferController=function(){"use strict";var mediaSource,type,minBufferTime,appendedBytesInfo,STALL_THRESHOLD=.5,QUOTA_EXCEEDED_ERROR_CODE=22,initializationData=[],requiredQuality=0,currentQuality=-1,isBufferingCompleted=!1,bufferLevel=0,criticalBufferLevel=Number.POSITIVE_INFINITY,maxAppendedIndex=-1,lastIndex=-1,buffer=null,hasSufficientBuffer=null,isBufferLevelOutrun=!1,isAppendingInProgress=!1,pendingMedia=[],inbandEventFound=!1,waitingForInit=function(){var loadingReqs=this.streamProcessor.getFragmentModel().getLoadingRequests();return currentQuality>requiredQuality&&(hasReqsForQuality(pendingMedia,currentQuality)||hasReqsForQuality(loadingReqs,currentQuality))?!1:currentQuality!==requiredQuality},hasReqsForQuality=function(arr,quality){var i=0,ln=arr.length;for(i;ln>i;i+=1)if(arr[i].quality===quality)return!0;return!1},sortArrayByProperty=function(array,sortProp){var compare=function(obj1,obj2){return obj1[sortProp]<obj2[sortProp]?-1:obj1[sortProp]>obj2[sortProp]?1:0};array.sort(compare)},onInitializationLoaded=function(sender,model,bytes,quality){var self=this;model===self.streamProcessor.getFragmentModel()&&(self.debug.log("Initialization finished loading: "+type),initializationData[quality]=bytes,quality===requiredQuality&&waitingForInit.call(self)&&switchInitData.call(self))},onMediaLoaded=function(sender,model,bytes,quality,index){if(model===this.streamProcessor.getFragmentModel()){var events,request=this.streamProcessor.getFragmentModel().getExecutedRequestForQualityAndIndex(quality,index),currentTrack=this.streamProcessor.getTrackForQuality(quality),eventStreamMedia=this.adapter.getEventsFor(currentTrack.mediaInfo,this.streamProcessor),eventStreamTrack=this.adapter.getEventsFor(currentTrack,this.streamProcessor);(eventStreamMedia.length>0||eventStreamTrack.length>0)&&(events=handleInbandEvents.call(this,bytes,request,eventStreamMedia,eventStreamTrack),this.streamProcessor.getEventController().addInbandEvents(events)),bytes=deleteInbandEvents.call(this,bytes),pendingMedia.push({bytes:bytes,quality:quality,index:index}),sortArrayByProperty(pendingMedia,"index"),appendNext.call(this)}},appendToBuffer=function(data,quality,index){isAppendingInProgress=!0,appendedBytesInfo={quality:quality,index:index};var self=this,isInit=isNaN(index);return quality!==requiredQuality&&isInit||quality!==currentQuality&&!isInit?void onMediaRejected.call(self,quality,index):void self.sourceBufferExt.append(buffer,data)},onAppended=function(sender,sourceBuffer,data,error){if(buffer===sourceBuffer){var ranges,self=this;if(error)return error.code===QUOTA_EXCEEDED_ERROR_CODE&&(pendingMedia.unshift({bytes:data,quality:appendedBytesInfo.quality,index:appendedBytesInfo.index}),criticalBufferLevel=.8*getTotalBufferedTime.call(self),self.notify(self.eventList.ENAME_QUOTA_EXCEEDED,criticalBufferLevel),clearBuffer.call(self)),void(isAppendingInProgress=!1);if(updateBufferLevel.call(self),hasEnoughSpaceToAppend.call(self)||(self.notify(self.eventList.ENAME_QUOTA_EXCEEDED,criticalBufferLevel),clearBuffer.call(self)),ranges=self.sourceBufferExt.getAllRanges(buffer),ranges&&ranges.length>0){var i,len;for(i=0,len=ranges.length;len>i;i+=1)self.debug.log("Buffered "+type+" Range: "+ranges.start(i)+" - "+ranges.end(i))}onAppendToBufferCompleted.call(self,appendedBytesInfo.quality,appendedBytesInfo.index),self.notify(self.eventList.ENAME_BYTES_APPENDED,appendedBytesInfo.quality,appendedBytesInfo.index)}},updateBufferLevel=function(){var self=this,currentTime=self.playbackController.getTime();return bufferLevel=self.sourceBufferExt.getBufferLength(buffer,currentTime),self.notify(self.eventList.ENAME_BUFFER_LEVEL_UPDATED,bufferLevel),checkGapBetweenBuffers.call(self),checkIfSufficientBuffer.call(self),STALL_THRESHOLD>bufferLevel&&notifyIfSufficientBufferStateChanged.call(self,!1),!0},handleInbandEvents=function(data,request,mediaInbandEvents,trackInbandEvents){var identifier,size,event,inbandEvents,events=[],i=0,expTwo=Math.pow(256,2),expThree=Math.pow(256,3),fragmentStarttime=Math.max(isNaN(request.startTime)?0:request.startTime,0),eventStreams=[];inbandEventFound=!1,inbandEvents=mediaInbandEvents.concat(trackInbandEvents);for(var loop=0;loop<inbandEvents.length;loop++)eventStreams[inbandEvents[loop].schemeIdUri]=inbandEvents[loop];for(;i<data.length&&(identifier=String.fromCharCode(data[i+4],data[i+5],data[i+6],data[i+7]),size=data[i]*expThree+data[i+1]*expTwo+256*data[i+2]+1*data[i+3],"moov"!=identifier&&"moof"!=identifier);){if("emsg"==identifier){inbandEventFound=!0;for(var eventBox=["","",0,0,0,0,""],arrIndex=0,j=i+12;size+i>j;)0===arrIndex||1==arrIndex||6==arrIndex?(0!==data[j]?eventBox[arrIndex]+=String.fromCharCode(data[j]):arrIndex+=1,j+=1):(eventBox[arrIndex]=data[j]*expThree+data[j+1]*expTwo+256*data[j+2]+1*data[j+3],j+=4,arrIndex+=1);event=this.adapter.getEvent(eventBox,eventStreams,fragmentStarttime),event&&events.push(event)}i+=size}return events},deleteInbandEvents=function(data){if(!inbandEventFound)return data;for(var identifier,size,length=data.length,i=0,j=0,expTwo=Math.pow(256,2),expThree=Math.pow(256,3),modData=new Uint8Array(data.length);length>i;){if(identifier=String.fromCharCode(data[i+4],data[i+5],data[i+6],data[i+7]),size=data[i]*expThree+data[i+1]*expTwo+256*data[i+2]+1*data[i+3],"emsg"!=identifier)for(var l=i;i+size>l;l++)modData[j]=data[l],j+=1;i+=size}return modData.subarray(0,j)},checkGapBetweenBuffers=function(){var leastLevel=getLeastBufferLevel.call(this),acceptableGap=2*minBufferTime,actualGap=bufferLevel-leastLevel;actualGap>=acceptableGap&&!isBufferLevelOutrun?(isBufferLevelOutrun=!0,this.notify(this.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):acceptableGap/2>actualGap&&isBufferLevelOutrun&&(this.notify(this.eventList.ENAME_BUFFER_LEVEL_BALANCED),isBufferLevelOutrun=!1,appendNext.call(this))},getLeastBufferLevel=function(){var videoMetrics=this.metricsModel.getReadOnlyMetricsFor("video"),videoBufferLevel=this.metricsExt.getCurrentBufferLevel(videoMetrics),audioMetrics=this.metricsModel.getReadOnlyMetricsFor("audio"),audioBufferLevel=this.metricsExt.getCurrentBufferLevel(audioMetrics),leastLevel=null;return leastLevel=null===videoBufferLevel||null===audioBufferLevel?null!==audioBufferLevel?audioBufferLevel.level:null!==videoBufferLevel?videoBufferLevel.level:null:Math.min(audioBufferLevel.level,videoBufferLevel.level)},hasEnoughSpaceToAppend=function(){var self=this,totalBufferedTime=getTotalBufferedTime.call(self);return criticalBufferLevel>totalBufferedTime},clearBuffer=function(){var removeStart,removeEnd,range,req,self=this,currentTime=self.playbackController.getTime();buffer&&(req=self.fragmentController.getExecutedRequestForTime(self.streamProcessor.getFragmentModel(),currentTime),removeEnd=req&&!isNaN(req.startTime)?req.startTime:Math.floor(currentTime),range=self.sourceBufferExt.getBufferRange(buffer,currentTime),null===range&&buffer.buffered.length>0&&(removeEnd=buffer.buffered.end(buffer.buffered.length-1)),removeStart=buffer.buffered.start(0),self.sourceBufferExt.remove(buffer,removeStart,removeEnd,mediaSource))},onRemoved=function(sender,sourceBuffer,removeStart,removeEnd){buffer===sourceBuffer&&(updateBufferLevel.call(this),this.notify(this.eventList.ENAME_BUFFER_CLEARED,removeStart,removeEnd,hasEnoughSpaceToAppend.call(this)),hasEnoughSpaceToAppend.call(this)||setTimeout(clearBuffer.bind(this),1e3*minBufferTime))},getTotalBufferedTime=function(){var ln,i,self=this,ranges=self.sourceBufferExt.getAllRanges(buffer),totalBufferedTime=0;if(!ranges)return totalBufferedTime;for(i=0,ln=ranges.length;ln>i;i+=1)totalBufferedTime+=ranges.end(i)-ranges.start(i);return totalBufferedTime},checkIfBufferingCompleted=function(){var isLastIdxAppended=maxAppendedIndex===lastIndex-1;isLastIdxAppended&&!isBufferingCompleted&&(isBufferingCompleted=!0,this.notify(this.eventList.ENAME_BUFFERING_COMPLETED))},checkIfSufficientBuffer=function(){var timeToEnd=this.playbackController.getTimeToStreamEnd(),minLevel=this.streamProcessor.isDynamic()?minBufferTime/2:minBufferTime;minLevel>bufferLevel&&(timeToEnd>minBufferTime||minBufferTime>=timeToEnd&&!isBufferingCompleted)?notifyIfSufficientBufferStateChanged.call(this,!1):notifyIfSufficientBufferStateChanged.call(this,!0)},notifyIfSufficientBufferStateChanged=function(state){hasSufficientBuffer!==state&&(hasSufficientBuffer=state,this.debug.log(hasSufficientBuffer?"Got enough "+type+" buffer to start.":"Waiting for more "+type+" buffer before starting playback."),this.eventBus.dispatchEvent({type:hasSufficientBuffer?"bufferLoaded":"bufferStalled",data:{bufferType:type}}),this.notify(this.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,state))},updateBufferTimestampOffset=function(MSETimeOffset){buffer.timestampOffset!==MSETimeOffset&&(buffer.timestampOffset=MSETimeOffset)},updateBufferState=function(){var self=this;updateBufferLevel.call(self),appendNext.call(self)},appendNext=function(){waitingForInit.call(this)?switchInitData.call(this):appendNextMedia.call(this)},onAppendToBufferCompleted=function(quality,index){isAppendingInProgress=!1,isNaN(index)?onInitAppended.call(this,quality):onMediaAppended.call(this,index),appendNext.call(this)},onMediaRejected=function(quality,index){isAppendingInProgress=!1,this.notify(this.eventList.ENAME_BYTES_REJECTED,quality,index),appendNext.call(this)},onInitAppended=function(quality){currentQuality=quality},onMediaAppended=function(index){maxAppendedIndex=Math.max(index,maxAppendedIndex),checkIfBufferingCompleted.call(this)
},appendNextMedia=function(){var data;0===pendingMedia.length||isBufferLevelOutrun||isAppendingInProgress||waitingForInit.call(this)||!hasEnoughSpaceToAppend.call(this)||(data=pendingMedia.shift(),appendToBuffer.call(this,data.bytes,data.quality,data.index))},onDataUpdateCompleted=function(sender,data,trackData){var bufferLength,self=this;updateBufferTimestampOffset.call(self,trackData.MSETimeOffset),bufferLength=self.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,minBufferTime!==bufferLength&&(self.setMinBufferTime(bufferLength),self.notify(self.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,bufferLength))},onStreamCompleted=function(sender,model,request){var self=this;model===self.streamProcessor.getFragmentModel()&&(lastIndex=request.index,checkIfBufferingCompleted.call(self))},onQualityChanged=function(sender,typeValue,oldQuality,newQuality){if(type===typeValue){var self=this;requiredQuality!==newQuality&&(updateBufferTimestampOffset.call(self,self.streamProcessor.getTrackForQuality(newQuality).MSETimeOffset),requiredQuality=newQuality,waitingForInit.call(self)&&switchInitData.call(self))}},switchInitData=function(){var self=this;if(initializationData[requiredQuality]){if(isAppendingInProgress)return;appendToBuffer.call(self,initializationData[requiredQuality],requiredQuality)}else self.notify(self.eventList.ENAME_INIT_REQUESTED,requiredQuality)},onWallclockTimeUpdated=function(){appendNext.call(this)},onPlaybackRateChanged=function(){checkIfSufficientBuffer.call(this)};return{manifestModel:void 0,sourceBufferExt:void 0,eventBus:void 0,bufferMax:void 0,metricsModel:void 0,metricsExt:void 0,adapter:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested",ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},setup:function(){this.dataUpdateCompleted=onDataUpdateCompleted,this.initFragmentLoaded=onInitializationLoaded,this.mediaFragmentLoaded=onMediaLoaded,this.streamCompleted=onStreamCompleted,this.qualityChanged=onQualityChanged,this.playbackProgress=updateBufferState,this.playbackSeeking=updateBufferState,this.playbackTimeUpdated=updateBufferState,this.playbackRateChanged=onPlaybackRateChanged,this.wallclockTimeUpdated=onWallclockTimeUpdated,onAppended=onAppended.bind(this),onRemoved=onRemoved.bind(this),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,this,onAppended),this.sourceBufferExt.subscribe(this.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,onRemoved)},initialize:function(typeValue,buffer,source,streamProcessor){var self=this;type=typeValue,self.setMediaSource(source),self.setBuffer(buffer),self.streamProcessor=streamProcessor,self.fragmentController=streamProcessor.fragmentController,self.scheduleController=streamProcessor.scheduleController,self.playbackController=streamProcessor.playbackController},getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(value){this.streamProcessor=value},getBuffer:function(){return buffer},setBuffer:function(value){buffer=value},getBufferLevel:function(){return bufferLevel},getMinBufferTime:function(){return minBufferTime},setMinBufferTime:function(value){minBufferTime=value},getCriticalBufferLevel:function(){return criticalBufferLevel},setMediaSource:function(value){mediaSource=value},isBufferingCompleted:function(){return isBufferingCompleted},reset:function(errored){var self=this;initializationData=[],criticalBufferLevel=Number.POSITIVE_INFINITY,hasSufficientBuffer=null,minBufferTime=null,currentQuality=-1,requiredQuality=0,self.sourceBufferExt.unsubscribe(self.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,self,onAppended),self.sourceBufferExt.unsubscribe(self.sourceBufferExt.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,self,onRemoved),appendedBytesInfo=null,isBufferLevelOutrun=!1,isAppendingInProgress=!1,pendingMedia=[],errored||(self.sourceBufferExt.abort(mediaSource,buffer),self.sourceBufferExt.removeSourceBuffer(mediaSource,buffer)),buffer=null}}},MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=8,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,supportsMediaSource:function(){"use strict";var hasWebKit="WebKitMediaSource"in window,hasMediaSource="MediaSource"in window;return hasWebKit||hasMediaSource},supportsMediaKeys:function(){"use strict";var hasWebKit="WebKitMediaKeys"in window,hasMs="MSMediaKeys"in window,hasMediaSource="MediaKeys"in window;return hasWebKit||hasMs||hasMediaSource},supportsCodec:function(element,codec){"use strict";if(!(element instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var canPlay=element.canPlayType(codec);return"probably"===canPlay||"maybe"===canPlay}},MediaPlayer.utils.Debug=function(){"use strict";var logToBrowserConsole=!0;return{eventBus:void 0,setLogToBrowserConsole:function(value){logToBrowserConsole=value},getLogToBrowserConsole:function(){return logToBrowserConsole},log:function(message){logToBrowserConsole&&console.log(message),this.eventBus.dispatchEvent({type:"log",message:message})}}},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";return{eventBus:void 0,capabilityError:function(err){this.eventBus.dispatchEvent({type:"error",error:"capability",event:err})},downloadError:function(id,url,request){this.eventBus.dispatchEvent({type:"error",error:"download",event:{id:id,url:url,request:request}})},manifestError:function(message,id,manifest){this.eventBus.dispatchEvent({type:"error",error:"manifestError",event:{message:message,id:id,manifest:manifest}})},closedCaptionsError:function(message,id,ccContent){this.eventBus.dispatchEvent({type:"error",error:"cc",event:{message:message,id:id,cc:ccContent}})},mediaSourceError:function(err){this.eventBus.dispatchEvent({type:"error",error:"mediasource",event:err})},mediaKeySessionError:function(err){this.eventBus.dispatchEvent({type:"error",error:"key_session",event:err})},mediaKeyMessageError:function(err){this.eventBus.dispatchEvent({type:"error",error:"key_message",event:err})},mediaKeySystemSelectionError:function(err){this.eventBus.dispatchEvent({type:"error",error:"key_system_selection",event:err})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.utils.EventBus=function(){"use strict";var registrations,getListeners=function(type,useCapture){var captype=(useCapture?"1":"0")+type;return captype in registrations||(registrations[captype]=[]),registrations[captype]},init=function(){registrations={}};return init(),{addEventListener:function(type,listener,useCapture){var listeners=getListeners(type,useCapture),idx=listeners.indexOf(listener);-1===idx&&listeners.push(listener)},removeEventListener:function(type,listener,useCapture){var listeners=getListeners(type,useCapture),idx=listeners.indexOf(listener);-1!==idx&&listeners.splice(idx,1)},dispatchEvent:function(evt){for(var listeners=getListeners(evt.type,!1).slice(),i=0;i<listeners.length;i++)listeners[i].call(this,evt);return!evt.defaultPrevented}}},MediaPlayer.dependencies.EventController=function(){"use strict";var inlineEvents=[],inbandEvents=[],activeEvents=[],eventInterval=null,refreshDelay=100,presentationTimeThreshold=refreshDelay/1e3,MPD_RELOAD_SCHEME="urn:mpeg:dash:event:2012",MPD_RELOAD_VALUE=1,reset=function(){null!==eventInterval&&(clearInterval(eventInterval),eventInterval=null),inlineEvents=null,inbandEvents=null,activeEvents=null},clear=function(){null!==eventInterval&&(clearInterval(eventInterval),eventInterval=null)},start=function(){var self=this;self.debug.log("Start Event Controller"),isNaN(refreshDelay)||(eventInterval=setInterval(onEventTimer.bind(this),refreshDelay))},addInlineEvents=function(values){var self=this;inlineEvents=[],values&&values.length>0&&(inlineEvents=values),self.debug.log("Added "+values.length+" inline events")},addInbandEvents=function(values){for(var self=this,i=0;i<values.length;i++){var event=values[i];inbandEvents[event.id]=event,self.debug.log("Add inband event with id "+event.id)}},onEventTimer=function(){triggerEvents.call(this,inbandEvents),triggerEvents.call(this,inlineEvents),removeEvents.call(this)},triggerEvents=function(events){var presentationTime,self=this,currentVideoTime=this.videoModel.getCurrentTime();if(events)for(var j=0;j<events.length;j++){var curr=events[j];void 0!==curr&&(presentationTime=curr.presentationTime/curr.eventStream.timescale,(0===presentationTime||currentVideoTime>=presentationTime&&presentationTime+presentationTimeThreshold>currentVideoTime)&&(self.debug.log("Start Event at "+currentVideoTime),curr.duration>0&&activeEvents.push(curr),curr.eventStream.schemeIdUri==MPD_RELOAD_SCHEME&&curr.eventStream.value==MPD_RELOAD_VALUE&&refreshManifest.call(this),events.splice(j,1)))}},removeEvents=function(){var self=this;if(activeEvents)for(var currentVideoTime=this.videoModel.getCurrentTime(),i=0;i<activeEvents.length;i++){var curr=activeEvents[i];null!==curr&&(curr.duration+curr.presentationTime)/curr.eventStream.timescale<currentVideoTime&&(self.debug.log("Remove Event at time "+currentVideoTime),curr=null,activeEvents.splice(i,1))}},refreshManifest=function(){var self=this,manifest=self.manifestModel.getValue(),url=manifest.url;manifest.hasOwnProperty("Location")&&(url=manifest.Location),self.debug.log("Refresh manifest @ "+url),self.manifestLoader.load(url)};return{manifestModel:void 0,manifestLoader:void 0,debug:void 0,system:void 0,errHandler:void 0,videoModel:void 0,addInlineEvents:addInlineEvents,addInbandEvents:addInbandEvents,reset:reset,clear:clear,start:start,getVideoModel:function(){return this.videoModel},setVideoModel:function(value){this.videoModel=value},initialize:function(videoModel){this.setVideoModel(videoModel)}}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.dependencies.FragmentController=function(){"use strict";var fragmentModels=[],inProgress=!1,findModel=function(context){for(var ln=fragmentModels.length,i=0;ln>i;i++)if(fragmentModels[i].getContext()==context)return fragmentModels[i];return null},getRequestsToLoad=function(current,callback){var self=this,streamProcessor=fragmentModels[0].getContext().streamProcessor,streamId=streamProcessor.getStreamInfo().id,rules=self.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES);-1!==rules.indexOf(this.scheduleRulesCollection.sameTimeRequestRule)&&this.scheduleRulesCollection.sameTimeRequestRule.setFragmentModels(fragmentModels,streamId),self.rulesController.applyRules(rules,streamProcessor,callback,current,function(currentValue,newValue){return newValue})},onFragmentLoadingStart=function(sender,request){var self=this;self.isInitializationRequest(request)?self.notify(self.eventList.ENAME_INIT_FRAGMENT_LOADING_START,sender,request):self.notify(self.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,sender,request)},onFragmentLoadingCompleted=function(sender,request,response){var self=this,bytes=self.process(response);return null===bytes?void self.debug.log("No "+request.mediaType+" bytes to push."):(self.isInitializationRequest(request)?self.notify(self.eventList.ENAME_INIT_FRAGMENT_LOADED,sender,bytes,request.quality):self.notify(self.eventList.ENAME_MEDIA_FRAGMENT_LOADED,sender,bytes,request.quality,request.index),void executeRequests.call(this))},onStreamCompleted=function(sender,request){this.notify(this.eventList.ENAME_STREAM_COMPLETED,sender,request)},onBufferLevelBalanced=function(){executeRequests.call(this)},onGetRequests=function(result){var mediaType,r,m,i,j,reqsToExecute=result.value;for(i=0;i<reqsToExecute.length;i+=1)if(r=reqsToExecute[i])for(j=0;j<fragmentModels.length;j+=1)m=fragmentModels[j],mediaType=m.getContext().streamProcessor.getType(),r.mediaType===mediaType&&(r instanceof MediaPlayer.vo.FragmentRequest||(r=m.getPendingRequestForTime(r.startTime)),m.executeRequest(r));inProgress=!1},executeRequests=function(request){inProgress||(inProgress=!0,getRequestsToLoad.call(this,request,onGetRequests.bind(this)))};return{system:void 0,debug:void 0,scheduleRulesCollection:void 0,rulesController:void 0,fragmentLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"},setup:function(){this.fragmentLoadingStarted=onFragmentLoadingStart,this.fragmentLoadingCompleted=onFragmentLoadingCompleted,this.streamCompleted=onStreamCompleted,this.bufferLevelBalanced=onBufferLevelBalanced},process:function(bytes){var result=null;return null!==bytes&&void 0!==bytes&&bytes.byteLength>0&&(result=new Uint8Array(bytes)),result},getModel:function(context){if(!context)return null;var model=findModel(context);return model||(model=this.system.getObject("fragmentModel"),model.setContext(context),fragmentModels.push(model)),model},detachModel:function(model){var idx=fragmentModels.indexOf(model);idx>-1&&fragmentModels.splice(idx,1)},isFragmentLoadedOrPending:function(context,request){var isLoaded,fragmentModel=findModel(context);return fragmentModel?isLoaded=fragmentModel.isFragmentLoadedOrPending(request):!1},getPendingRequests:function(context){var fragmentModel=findModel(context);return fragmentModel?fragmentModel.getPendingRequests():null},getLoadingRequests:function(context){var fragmentModel=findModel(context);return fragmentModel?fragmentModel.getLoadingRequests():null},isInitializationRequest:function(request){return request&&request.type&&-1!==request.type.toLowerCase().indexOf("initialization")},getLoadingTime:function(context){var fragmentModel=findModel(context);return fragmentModel?fragmentModel.getLoadingTime():null},getExecutedRequestForTime:function(model,time){return model?model.getExecutedRequestForTime(time):null},removeExecutedRequest:function(model,request){model&&model.removeExecutedRequest(request)},removeExecutedRequestsBeforeTime:function(model,time){model&&model.removeExecutedRequestsBeforeTime(time)},cancelPendingRequestsForModel:function(model){model&&model.cancelPendingRequests()},abortRequestsForModel:function(model){model&&model.abortRequests(),executeRequests.call(this)},prepareFragmentForLoading:function(context,request){var fragmentModel=findModel(context);fragmentModel&&request&&fragmentModel.addRequest(request)&&executeRequests.call(this,request)},executePendingRequests:function(){executeRequests.call(this)},resetModel:function(model){this.abortRequestsForModel(model),this.cancelPendingRequestsForModel(model)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var RETRY_ATTEMPTS=10,RETRY_INTERVAL=750,xhrs=[],doLoad=function(request,remainingAttempts){var req=new XMLHttpRequest,httpRequestMetrics=null,firstProgress=!0,needFailureReport=!0,lastTraceTime=null,self=this;xhrs.push(req),request.requestStartDate=new Date,httpRequestMetrics=self.metricsModel.addHttpRequest(request.mediaType,null,request.type,request.url,null,request.range,request.requestStartDate,null,null,null,null,request.duration),self.metricsModel.appendHttpTrace(httpRequestMetrics,request.requestStartDate,request.requestStartDate.getTime()-request.requestStartDate.getTime(),[0]),lastTraceTime=request.requestStartDate,req.open("GET",self.tokenAuthentication.addTokenAsQueryArg(request.url),!0),req.responseType="arraybuffer",req=self.tokenAuthentication.setTokenInRequestHeader(req),request.range&&req.setRequestHeader("Range","bytes="+request.range),req.onprogress=function(event){var currentTime=new Date;firstProgress&&(firstProgress=!1,(!event.lengthComputable||event.lengthComputable&&event.total!=event.loaded)&&(request.firstByteDate=currentTime,httpRequestMetrics.tresponse=currentTime)),self.metricsModel.appendHttpTrace(httpRequestMetrics,currentTime,currentTime.getTime()-lastTraceTime.getTime(),[req.response?req.response.byteLength:0]),lastTraceTime=currentTime},req.onload=function(){if(!(req.status<200||req.status>299)){needFailureReport=!1;var latency,download,currentTime=new Date,bytes=req.response;request.firstByteDate||(request.firstByteDate=request.requestStartDate),request.requestEndDate=currentTime,latency=request.firstByteDate.getTime()-request.requestStartDate.getTime(),download=request.requestEndDate.getTime()-request.firstByteDate.getTime(),self.debug.log("loaded "+request.mediaType+":"+request.type+":"+request.startTime+" ("+req.status+", "+latency+"ms, "+download+"ms)"),httpRequestMetrics.tresponse=request.firstByteDate,httpRequestMetrics.tfinish=request.requestEndDate,httpRequestMetrics.responsecode=req.status,self.metricsModel.appendHttpTrace(httpRequestMetrics,currentTime,currentTime.getTime()-lastTraceTime.getTime(),[bytes?bytes.byteLength:0]),lastTraceTime=currentTime,self.notify(self.eventList.ENAME_LOADING_COMPLETED,request,bytes)}},req.onloadend=req.onerror=function(){if(-1!==xhrs.indexOf(req)&&(xhrs.splice(xhrs.indexOf(req),1),needFailureReport)){needFailureReport=!1;var latency,download,currentTime=new Date,bytes=req.response;if(request.firstByteDate||(request.firstByteDate=request.requestStartDate),request.requestEndDate=currentTime,latency=request.firstByteDate.getTime()-request.requestStartDate.getTime(),download=request.requestEndDate.getTime()-request.firstByteDate.getTime(),self.debug.log("failed "+request.mediaType+":"+request.type+":"+request.startTime+" ("+req.status+", "+latency+"ms, "+download+"ms)"),httpRequestMetrics.tresponse=request.firstByteDate,httpRequestMetrics.tfinish=request.requestEndDate,httpRequestMetrics.responsecode=req.status,self.metricsModel.appendHttpTrace(httpRequestMetrics,currentTime,currentTime.getTime()-lastTraceTime.getTime(),[bytes?bytes.byteLength:0]),lastTraceTime=currentTime,remainingAttempts>0){var interval=RETRY_INTERVAL*(RETRY_ATTEMPTS-remainingAttempts+1);self.debug.log("Failed loading fragment: "+request.mediaType+":"+request.type+":"+request.startTime+", retry in "+interval+"ms attempts: "+remainingAttempts),remainingAttempts--,setTimeout(function(){doLoad.call(self,request,remainingAttempts)},interval)}else self.debug.log("Failed loading fragment: "+request.mediaType+":"+request.type+":"+request.startTime+" no retry attempts left"),self.errHandler.downloadError("content",request.url,req),self.notify(self.eventList.ENAME_LOADING_COMPLETED,request,null,new Error("failed loading fragment"))}},req.send()},checkForExistence=function(request){var self=this,req=new XMLHttpRequest,isSuccessful=!1;req.open("HEAD",request.url,!0),req.onload=function(){req.status<200||req.status>299||(isSuccessful=!0,self.notify(self.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!0,request))},req.onloadend=req.onerror=function(){isSuccessful||self.notify(self.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,request)},req.send()};return{metricsModel:void 0,errHandler:void 0,debug:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},load:function(req){req?doLoad.call(this,req,RETRY_ATTEMPTS):this.notify(this.eventList.ENAME_LOADING_COMPLETED,req,null,new Error("request is null"))},checkForExistence:function(req){return req?void checkForExistence.call(this,req):void this.notify(this.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,!1,req)},abort:function(){var i,req,ln=xhrs.length;for(i=0;ln>i;i+=1)req=xhrs[i],xhrs[i]=null,req.abort(),req=null;xhrs=[]}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var context,executedRequests=[],pendingRequests=[],loadingRequests=[],rejectedRequests=[],isLoadingPostponed=!1,loadCurrentFragment=function(request){var self=this;self.notify(self.eventList.ENAME_FRAGMENT_LOADING_STARTED,request),self.fragmentLoader.load(request)},removeExecutedRequest=function(request){var idx=executedRequests.indexOf(request);-1!==idx&&executedRequests.splice(idx,1)},getRequestForTime=function(arr,time){var i,lastIdx=arr.length-1,start=0/0,end=0/0,req=null;for(i=lastIdx;i>=0;i-=1)if(req=arr[i],start=req.startTime,end=start+req.duration,!isNaN(start)&&!isNaN(end)&&time>=start&&end>time||isNaN(start)&&isNaN(time))return req;return null},addSchedulingInfoMetrics=function(request,state){if(request){var mediaType=request.mediaType,now=new Date,type=request.type,startTime=request.startTime,availabilityStartTime=request.availabilityStartTime,duration=request.duration,quality=request.quality,range=request.range;this.metricsModel.addSchedulingInfo(mediaType,now,type,startTime,availabilityStartTime,duration,quality,range,state)}},onLoadingCompleted=function(sender,request,response,error){loadingRequests.splice(loadingRequests.indexOf(request),1),response&&!error?(executedRequests.push(request),addSchedulingInfoMetrics.call(this,request,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,request,response)):(addSchedulingInfoMetrics.call(this,request,MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE),this.notify(this.eventList.ENAME_FRAGMENT_LOADING_FAILED,request))},onBytesRejected=function(sender,quality,index){var req=this.getExecutedRequestForQualityAndIndex(quality,index);req&&(this.removeExecutedRequest(req),isNaN(index)||(rejectedRequests.push(req),addSchedulingInfoMetrics.call(this,req,MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE)))},onBufferLevelOutrun=function(){isLoadingPostponed=!0},onBufferLevelBalanced=function(){isLoadingPostponed=!1};return{system:void 0,debug:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted",ENAME_FRAGMENT_LOADING_FAILED:"fragmentLoadingFailed"},setup:function(){this.bufferLevelOutrun=onBufferLevelOutrun,this.bufferLevelBalanced=onBufferLevelBalanced,this.bytesRejected=onBytesRejected,this.loadingCompleted=onLoadingCompleted},setLoader:function(value){this.fragmentLoader=value},setContext:function(value){context=value},getContext:function(){return context},getIsPostponed:function(){return isLoadingPostponed},addRequest:function(value){return!value||this.isFragmentLoadedOrPending(value)?!1:(pendingRequests.push(value),addSchedulingInfoMetrics.call(this,value,MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE),!0)},isFragmentLoadedOrPending:function(request){var isEqualComplete=function(req1,req2){return"complete"===req1.action&&req1.action===req2.action},isEqualMedia=function(req1,req2){return req1.url===req2.url&&req1.startTime===req2.startTime},isEqualInit=function(req1,req2){return isNaN(req1.index)&&isNaN(req2.index)&&req1.quality===req2.quality},check=function(arr){var req,i,isLoaded=!1,ln=arr.length;for(i=0;ln>i;i+=1)if(req=arr[i],isEqualMedia(request,req)||isEqualInit(request,req)||isEqualComplete(request,req)){isLoaded=!0;break}return isLoaded};return check(pendingRequests)||check(loadingRequests)||check(executedRequests)},getPendingRequests:function(){return pendingRequests},getLoadingRequests:function(){return loadingRequests},getExecutedRequests:function(){return executedRequests},getRejectedRequests:function(){return rejectedRequests},getLoadingTime:function(){var req,i,loadingTime=0;for(i=executedRequests.length-1;i>=0;i-=1)if(req=executedRequests[i],req.requestEndDate instanceof Date&&req.firstByteDate instanceof Date){loadingTime=req.requestEndDate.getTime()-req.firstByteDate.getTime();break}return loadingTime},getExecutedRequestForTime:function(time){return getRequestForTime(executedRequests,time)},getPendingRequestForTime:function(time){return getRequestForTime(pendingRequests,time)},getLoadingRequestForTime:function(time){return getRequestForTime(loadingRequests,time)},getExecutedRequestForQualityAndIndex:function(quality,index){var i,lastIdx=executedRequests.length-1,req=null;for(i=lastIdx;i>=0;i-=1)if(req=executedRequests[i],req.quality===quality&&req.index===index)return req;return null},removeExecutedRequest:function(request){removeExecutedRequest.call(this,request)},removeExecutedRequestsBeforeTime:function(time){var i,lastIdx=executedRequests.length-1,start=0/0,req=null;for(i=lastIdx;i>=0;i-=1)req=executedRequests[i],start=req.startTime,!isNaN(start)&&time>start&&removeExecutedRequest.call(this,req)},cancelPendingRequests:function(quality){var self=this,reqs=pendingRequests,canceled=reqs;return pendingRequests=[],void 0!==quality&&(pendingRequests=reqs.filter(function(request){return request.quality===quality?!1:(canceled.splice(canceled.indexOf(request),1),!0)})),canceled.forEach(function(request){addSchedulingInfoMetrics.call(self,request,MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE)}),canceled},abortRequests:function(){this.fragmentLoader.abort();for(var i=0,ln=loadingRequests.length;ln>i;i+=1)this.removeExecutedRequest(loadingRequests[i]);loadingRequests=[]},executeRequest:function(request){var self=this,idx=pendingRequests.indexOf(request);if(request&&-1!==idx)switch(pendingRequests.splice(idx,1),request.action){case"complete":executedRequests.push(request),addSchedulingInfoMetrics.call(self,request,MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE),self.notify(self.eventList.ENAME_STREAM_COMPLETED,request);break;case"download":loadingRequests.push(request),addSchedulingInfoMetrics.call(self,request,MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE),loadCurrentFragment.call(self,request);break;default:this.debug.log("Unknown request action.")}}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";var rules,isSearchStarted=!1,onSearchCompleted=function(req){var liveEdge=req.value,searchTime=((new Date).getTime()-this.streamProcessor.getStreamInfo().manifestInfo.loadedTime.getTime())/1e3;null!==liveEdge?this.notify(this.eventList.ENAME_LIVE_EDGE_FOUND,liveEdge,searchTime):this.notify(this.eventList.ENAME_LIVE_EDGE_SEARCH_ERROR,searchTime)},onStreamUpdated=function(){if(this.streamProcessor.isDynamic()&&!isSearchStarted){var self=this;rules=self.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES),isSearchStarted=!0,this.rulesController.applyRules(rules,self.streamProcessor,onSearchCompleted.bind(self),null,function(currentValue,newValue){return newValue})}};return{system:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_LIVE_EDGE_FOUND:"liveEdgeFound",ENAME_LIVE_EDGE_SEARCH_ERROR:"liveEdgeSearchError"},setup:function(){this.streamUpdated=onStreamUpdated},initialize:function(streamProcessor){this.streamProcessor=streamProcessor,this.fragmentLoader=streamProcessor.fragmentLoader,this.scheduleRulesCollection.liveEdgeBinarySearchRule&&this.scheduleRulesCollection.liveEdgeBinarySearchRule.setFinder(this),this.scheduleRulesCollection.liveEdgeBBCSearchRule&&this.scheduleRulesCollection.liveEdgeBBCSearchRule.setFinder(this)},abortSearch:function(){if(isSearchStarted=!1,rules)for(var i=0,ln=rules.length;ln>i;i+=1)rules[i].reset()}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var RETRY_ATTEMPTS=3,RETRY_INTERVAL=500,parseBaseUrl=function(url){var base=null;return-1!==url.indexOf("/")&&(-1!==url.indexOf("?")&&(url=url.substring(0,url.indexOf("?"))),base=url.substring(0,url.lastIndexOf("/")+1)),base},doLoad=function(url,remainingAttempts){var manifest,baseUrl=parseBaseUrl(url),request=new XMLHttpRequest,requestTime=new Date,loadedTime=null,needFailureReport=!0,onload=null,report=null,self=this;onload=function(){request.status<200||request.status>299||(needFailureReport=!1,loadedTime=new Date,self.tokenAuthentication.checkRequestHeaderForToken(request),self.metricsModel.addHttpRequest("stream",null,"MPD",url,null,null,requestTime,loadedTime,request.status,null,null),manifest=self.parser.parse(request.responseText,baseUrl),manifest?(manifest.url=url,manifest.loadedTime=loadedTime,self.metricsModel.addManifestUpdate("stream",manifest.type,requestTime,loadedTime,manifest.availabilityStartTime),self.notify(self.eventList.ENAME_MANIFEST_LOADED,manifest)):self.notify(self.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+url)))},report=function(){needFailureReport&&(needFailureReport=!1,self.metricsModel.addHttpRequest("stream",null,"MPD",url,null,null,requestTime,new Date,request.status,null,null),remainingAttempts>0?(self.debug.log("Failed loading manifest: "+url+", retry in "+RETRY_INTERVAL+"ms attempts: "+remainingAttempts),remainingAttempts--,setTimeout(function(){doLoad.call(self,url,remainingAttempts)},RETRY_INTERVAL)):(self.debug.log("Failed loading manifest: "+url+" no retry attempts left"),self.errHandler.downloadError("manifest",url,request),self.notify(self.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+url+" no retry attempts left"))))};try{request.onload=onload,request.onloadend=report,request.onerror=report,request.open("GET",url,!0),request.send()}catch(e){request.onerror()}};return{debug:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,tokenAuthentication:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_LOADED:"manifestLoaded"},load:function(url){doLoad.call(this,url,RETRY_ATTEMPTS)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.models.ManifestModel=function(){"use strict";var manifest;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_MANIFEST_UPDATED:"manifestUpdated"},getValue:function(){return manifest},setValue:function(value){manifest=value,this.eventBus.dispatchEvent({type:"manifestLoaded",data:value}),this.notify(this.eventList.ENAME_MANIFEST_UPDATED,value)}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var refreshDelay=0/0,refreshTimer=null,isStopped=!1,isUpdating=!1,clear=function(){null!==refreshTimer&&(clearInterval(refreshTimer),refreshTimer=null)},start=function(){clear.call(this),isNaN(refreshDelay)||(this.debug.log("Refresh manifest in "+refreshDelay+" seconds."),refreshTimer=setTimeout(onRefreshTimer.bind(this),Math.min(1e3*refreshDelay,Math.pow(2,31)-1),this))
},update=function(){var delay,timeSinceLastUpdate,self=this,manifest=self.manifestModel.getValue();void 0!==manifest&&null!==manifest&&(delay=self.manifestExt.getRefreshDelay(manifest),timeSinceLastUpdate=((new Date).getTime()-manifest.loadedTime.getTime())/1e3,refreshDelay=Math.max(delay-timeSinceLastUpdate,0),start.call(self))},onRefreshTimer=function(){var manifest,url,self=this;isUpdating||(isUpdating=!0,manifest=self.manifestModel.getValue(),url=manifest.url,manifest.hasOwnProperty("Location")&&(url=manifest.Location),self.manifestLoader.load(url))},onManifestLoaded=function(sender,manifest,error){error||(this.manifestModel.setValue(manifest),this.debug.log("Manifest has been refreshed."),isStopped||update.call(this))},onPlaybackStarted=function(){this.start()},onPlaybackPaused=function(){this.stop()},onStreamsComposed=function(){isUpdating=!1};return{debug:void 0,system:void 0,manifestModel:void 0,manifestExt:void 0,manifestLoader:void 0,setup:function(){update.call(this),this.streamsComposed=onStreamsComposed,this.manifestLoaded=onManifestLoaded,this.playbackStarted=onPlaybackStarted,this.playbackPaused=onPlaybackPaused},start:function(){isStopped=!1,update.call(this)},stop:function(){isStopped=!0,clear.call(this)}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var hasWebKit="WebKitMediaSource"in window,hasMediaSource="MediaSource"in window;return hasMediaSource?new MediaSource:hasWebKit?new WebKitMediaSource:null},attachMediaSource:function(source,videoModel){"use strict";videoModel.setSource(window.URL.createObjectURL(source))},detachMediaSource:function(videoModel){"use strict";videoModel.setSource("")},setDuration:function(source,value){"use strict";return source.duration=value,source.duration},signalEndOfStream:function(source){"use strict";"open"===source.readyState&&source.endOfStream()}},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:"metricsChanged",data:{}})},metricChanged:function(mediaType){this.eventBus.dispatchEvent({type:"metricChanged",data:{stream:mediaType}}),this.metricsChanged()},metricUpdated:function(mediaType,metricType,vo){this.eventBus.dispatchEvent({type:"metricUpdated",data:{stream:mediaType,metric:metricType,value:vo}}),this.metricChanged(mediaType)},metricAdded:function(mediaType,metricType,vo){this.eventBus.dispatchEvent({type:"metricAdded",data:{stream:mediaType,metric:metricType,value:vo}}),this.metricChanged(mediaType)},clearCurrentMetricsForType:function(type){delete this.streamMetrics[type],this.metricChanged(type)},clearAllCurrentMetrics:function(){var self=this;this.streamMetrics={},this.metricsChanged.call(self)},getReadOnlyMetricsFor:function(type){return this.streamMetrics.hasOwnProperty(type)?this.streamMetrics[type]:null},getMetricsFor:function(type){var metrics;return this.streamMetrics.hasOwnProperty(type)?metrics=this.streamMetrics[type]:(metrics=this.system.getObject("metrics"),this.streamMetrics[type]=metrics),metrics},addTcpConnection:function(mediaType,tcpid,dest,topen,tclose,tconnect){var vo=new MediaPlayer.vo.metrics.TCPConnection;return vo.tcpid=tcpid,vo.dest=dest,vo.topen=topen,vo.tclose=tclose,vo.tconnect=tconnect,this.getMetricsFor(mediaType).TcpList.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.TCP_CONNECTION,vo),vo},addHttpRequest:function(mediaType,tcpid,type,url,actualurl,range,trequest,tresponse,tfinish,responsecode,interval,mediaduration){var vo=new MediaPlayer.vo.metrics.HTTPRequest;return vo.stream=mediaType,vo.tcpid=tcpid,vo.type=type,vo.url=url,vo.actualurl=actualurl,vo.range=range,vo.trequest=trequest,vo.tresponse=tresponse,vo.tfinish=tfinish,vo.responsecode=responsecode,vo.interval=interval,vo.mediaduration=mediaduration,this.getMetricsFor(mediaType).HttpList.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.HTTP_REQUEST,vo),vo},appendHttpTrace:function(httpRequest,s,d,b){var vo=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return vo.s=s,vo.d=d,vo.b=b,httpRequest.trace.push(vo),this.metricUpdated(httpRequest.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,httpRequest),vo},addTrackSwitch:function(mediaType,t,mt,to,lto){var vo=new MediaPlayer.vo.metrics.TrackSwitch;return vo.t=t,vo.mt=mt,vo.to=to,vo.lto=lto,this.getMetricsFor(mediaType).RepSwitchList.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.TRACK_SWITCH,vo),vo},addBufferLevel:function(mediaType,t,level){var vo=new MediaPlayer.vo.metrics.BufferLevel;return vo.t=t,vo.level=level,this.getMetricsFor(mediaType).BufferLevel.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.BUFFER_LEVEL,vo),vo},addDVRInfo:function(mediaType,currentTime,mpd,range){var vo=new MediaPlayer.vo.metrics.DVRInfo;return vo.time=currentTime,vo.range=range,vo.manifestInfo=mpd,this.getMetricsFor(mediaType).DVRInfo.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.DVR_INFO,vo),vo},addDroppedFrames:function(mediaType,quality){var vo=new MediaPlayer.vo.metrics.DroppedFrames,list=this.getMetricsFor(mediaType).DroppedFrames;return quality?(vo.time=quality.creationTime,vo.droppedFrames=quality.droppedVideoFrames,list.length>0&&list[list.length-1]==vo?list[list.length-1]:(list.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.DROPPED_FRAMES,vo),vo)):(console.warn("No quality information provided"),vo)},addSchedulingInfo:function(mediaType,t,type,startTime,availabilityStartTime,duration,quality,range,state){var vo=new MediaPlayer.vo.metrics.SchedulingInfo;return vo.mediaType=mediaType,vo.t=t,vo.type=type,vo.startTime=startTime,vo.availabilityStartTime=availabilityStartTime,vo.duration=duration,vo.quality=quality,vo.range=range,vo.state=state,this.getMetricsFor(mediaType).SchedulingInfo.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.SCHEDULING_INFO,vo),vo},addManifestUpdate:function(mediaType,type,requestTime,fetchTime,availabilityStartTime,presentationStartTime,clientTimeOffset,currentTime,buffered,latency){var vo=new MediaPlayer.vo.metrics.ManifestUpdate,metrics=this.getMetricsFor("stream");return vo.mediaType=mediaType,vo.type=type,vo.requestTime=requestTime,vo.fetchTime=fetchTime,vo.availabilityStartTime=availabilityStartTime,vo.presentationStartTime=presentationStartTime,vo.clientTimeOffset=clientTimeOffset,vo.currentTime=currentTime,vo.buffered=buffered,vo.latency=latency,metrics.ManifestUpdate.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.MANIFEST_UPDATE,vo),vo},updateManifestUpdateInfo:function(manifestUpdate,updatedFields){for(var field in updatedFields)manifestUpdate[field]=updatedFields[field];this.metricUpdated(manifestUpdate.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,manifestUpdate)},addManifestUpdateStreamInfo:function(manifestUpdate,id,index,start,duration){var vo=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;return vo.id=id,vo.index=index,vo.start=start,vo.duration=duration,manifestUpdate.streamInfo.push(vo),this.metricUpdated(manifestUpdate.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,manifestUpdate),vo},addManifestUpdateTrackInfo:function(manifestUpdate,id,index,streamIndex,mediaType,presentationTimeOffset,startNumber,fragmentInfoType){var vo=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;return vo.id=id,vo.index=index,vo.streamIndex=streamIndex,vo.mediaType=mediaType,vo.startNumber=startNumber,vo.fragmentInfoType=fragmentInfoType,vo.presentationTimeOffset=presentationTimeOffset,manifestUpdate.trackInfo.push(vo),this.metricUpdated(manifestUpdate.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,manifestUpdate),vo},addPlayList:function(mediaType,start,mstart,starttype){var vo=new MediaPlayer.vo.metrics.PlayList;return vo.stream=mediaType,vo.start=start,vo.mstart=mstart,vo.starttype=starttype,this.getMetricsFor(mediaType).PlayList.push(vo),this.metricAdded(mediaType,this.adapter.metricsList.PLAY_LIST,vo),vo},appendPlayListTrace:function(playList,trackId,subreplevel,start,mstart,duration,playbackspeed,stopreason){var vo=new MediaPlayer.vo.metrics.PlayList.Trace;return vo.representationid=trackId,vo.subreplevel=subreplevel,vo.start=start,vo.mstart=mstart,vo.duration=duration,vo.playbackspeed=playbackspeed,vo.stopreason=stopreason,playList.trace.push(vo),this.metricUpdated(playList.stream,this.adapter.metricsList.PLAY_LIST_TRACE,playList),vo}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.dependencies.Notifier=function(){"use strict";var system,id=0,getId=function(){return this.id||(id+=1,this.id="_id_"+id),this.id},isEventSupported=function(eventName){var event,events=this.eventList;for(event in events)if(events[event]===eventName)return!0;return!1};return{system:void 0,setup:function(){system=this.system,system.mapValue("notify",this.notify),system.mapValue("subscribe",this.subscribe),system.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var args=[].slice.call(arguments);args.splice(1,0,this),args[0]+=getId.call(this),system.notify.apply(system,args)},subscribe:function(eventName,observer,handler,oneShot){if(!handler&&observer[eventName]&&(handler=observer[eventName]=observer[eventName].bind(observer)),!isEventSupported.call(this,eventName))throw"object does not support given event "+eventName;if(!observer)throw"observer object cannot be null or undefined";if(!handler)throw"event handler cannot be null or undefined";eventName+=getId.call(this),system.mapHandler(eventName,void 0,handler,oneShot)},unsubscribe:function(eventName,observer,handler){handler=handler||observer[eventName],eventName+=getId.call(this),system.unmapHandler(eventName,void 0,handler)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.PlaybackController=function(){"use strict";var wallclockTimeIntervalId,streamInfo,videoModel,trackInfo,isDynamic,WALLCLOCK_TIME_UPDATE_INTERVAL=1e3,currentTime=0,liveStartTime=0/0,getStreamStartTime=function(streamInfo){var presentationStartTime,startTimeOffset=parseInt(this.uriQueryFragModel.getURIFragmentData.s);return isDynamic?(!isNaN(startTimeOffset)&&startTimeOffset>1262304e3&&(presentationStartTime=startTimeOffset-streamInfo.manifestInfo.availableFrom.getTime()/1e3,(presentationStartTime>liveStartTime||presentationStartTime<liveStartTime-streamInfo.manifestInfo.DVRWindowSize)&&(presentationStartTime=null)),presentationStartTime=presentationStartTime||liveStartTime):presentationStartTime=!isNaN(startTimeOffset)&&startTimeOffset<streamInfo.duration&&startTimeOffset>=0?startTimeOffset:streamInfo.start,presentationStartTime},getActualPresentationTime=function(){var actualTime,self=this,currentTime=self.getTime(),metrics=self.metricsModel.getMetricsFor(trackInfo.mediaInfo.type),DVRMetrics=self.metricsExt.getCurrentDVRInfo(metrics),DVRWindow=DVRMetrics?DVRMetrics.range:null;return DVRWindow?currentTime>=DVRWindow.start&&currentTime<=DVRWindow.end?currentTime:actualTime=Math.max(DVRWindow.end-2*streamInfo.manifestInfo.minBufferTime,DVRWindow.start):0/0},startUpdatingWallclockTime=function(){var self=this,tick=function(){onWallclockTime.call(self)};null!==wallclockTimeIntervalId&&stopUpdatingWallclockTime.call(this),wallclockTimeIntervalId=setInterval(tick,WALLCLOCK_TIME_UPDATE_INTERVAL)},stopUpdatingWallclockTime=function(){clearInterval(wallclockTimeIntervalId),wallclockTimeIntervalId=null},initialStart=function(){var initialSeekTime=getStreamStartTime.call(this,streamInfo);this.debug.log("Starting playback at offset: "+initialSeekTime),this.seek(initialSeekTime)},updateCurrentTime=function(){if(!this.isPaused()&&isDynamic){var currentTime=this.getTime(),actualTime=getActualPresentationTime.call(this),timeChanged=!isNaN(actualTime)&&actualTime!==currentTime;timeChanged&&this.seek(actualTime)}},onDataUpdateCompleted=function(sender,mediaData,TrackData){trackInfo=this.adapter.convertDataToTrack(TrackData),streamInfo=trackInfo.mediaInfo.streamInfo,isDynamic=sender.streamProcessor.isDynamic(),updateCurrentTime.call(this)},onLiveEdgeFound=function(){0!==videoModel.getElement().readyState&&initialStart.call(this)},removeAllListeners=function(){videoModel&&(videoModel.unlisten("play",onPlaybackStart),videoModel.unlisten("pause",onPlaybackPaused),videoModel.unlisten("error",onPlaybackError),videoModel.unlisten("seeking",onPlaybackSeeking),videoModel.unlisten("seeked",onPlaybackSeeked),videoModel.unlisten("timeupdate",onPlaybackTimeUpdated),videoModel.unlisten("progress",onPlaybackProgress),videoModel.unlisten("ratechange",onPlaybackRateChanged),videoModel.unlisten("loadedmetadata",onPlaybackMetaDataLoaded))},onPlaybackStart=function(){updateCurrentTime.call(this),this.notify(this.eventList.ENAME_PLAYBACK_STARTED,this.getTime())},onPlaybackPaused=function(){this.notify(this.eventList.ENAME_PLAYBACK_PAUSED)},onPlaybackSeeking=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,this.getTime(),!1)},onPlaybackSeeked=function(){this.notify(this.eventList.ENAME_PLAYBACK_SEEKED)},onPlaybackTimeUpdated=function(){var time=this.getTime();time!==currentTime&&(currentTime=time,this.notify(this.eventList.ENAME_PLAYBACK_TIME_UPDATED,this.getTimeToStreamEnd()))},onPlaybackProgress=function(){var lastRange,bufferEndTime,remainingUnbufferedDuration,ranges=videoModel.getElement().buffered;ranges.length&&(lastRange=ranges.length-1,bufferEndTime=ranges.end(lastRange),remainingUnbufferedDuration=getStreamStartTime.call(this,streamInfo)+streamInfo.duration-bufferEndTime),this.notify(this.eventList.ENAME_PLAYBACK_PROGRESS,videoModel.getElement().buffered,remainingUnbufferedDuration)},onPlaybackRateChanged=function(){this.notify(this.eventList.ENAME_PLAYBACK_RATE_CHANGED)},onPlaybackMetaDataLoaded=function(){this.debug.log("Got loadmetadata event."),(!isDynamic||this.timelineConverter.isTimeSyncCompleted())&&initialStart.call(this),this.notify(this.eventList.ENAME_PLAYBACK_METADATA_LOADED),startUpdatingWallclockTime.call(this)},onPlaybackError=function(event){this.notify(this.eventList.ENAME_PLAYBACK_ERROR,event.srcElement.error)},onWallclockTime=function(){this.notify(this.eventList.ENAME_WALLCLOCK_TIME_UPDATED,isDynamic,new Date)},setupVideoModel=function(model){videoModel=model,videoModel.listen("play",onPlaybackStart),videoModel.listen("pause",onPlaybackPaused),videoModel.listen("error",onPlaybackError),videoModel.listen("seeking",onPlaybackSeeking),videoModel.listen("seeked",onPlaybackSeeked),videoModel.listen("timeupdate",onPlaybackTimeUpdated),videoModel.listen("progress",onPlaybackProgress),videoModel.listen("ratechange",onPlaybackRateChanged),videoModel.listen("loadedmetadata",onPlaybackMetaDataLoaded)};return{debug:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,eventList:{ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},setup:function(){this.dataUpdateCompleted=onDataUpdateCompleted,this.liveEdgeFound=onLiveEdgeFound,onPlaybackStart=onPlaybackStart.bind(this),onPlaybackPaused=onPlaybackPaused.bind(this),onPlaybackError=onPlaybackError.bind(this),onPlaybackSeeking=onPlaybackSeeking.bind(this),onPlaybackSeeked=onPlaybackSeeked.bind(this),onPlaybackTimeUpdated=onPlaybackTimeUpdated.bind(this),onPlaybackProgress=onPlaybackProgress.bind(this),onPlaybackRateChanged=onPlaybackRateChanged.bind(this),onPlaybackMetaDataLoaded=onPlaybackMetaDataLoaded.bind(this)},initialize:function(streamInfoValue,model){streamInfo=streamInfoValue,videoModel!==model&&(removeAllListeners.call(this),setupVideoModel.call(this,model))},getTimeToStreamEnd:function(){var currentTime=videoModel.getCurrentTime();return getStreamStartTime.call(this,streamInfo)+streamInfo.duration-currentTime},getStreamId:function(){return streamInfo.id},getStreamDuration:function(){return streamInfo.duration},getTime:function(){return videoModel.getCurrentTime()},getPlaybackRate:function(){return videoModel.getPlaybackRate()},setLiveStartTime:function(value){liveStartTime=value},start:function(){videoModel.play()},isPaused:function(){return videoModel.isPaused()},pause:function(){videoModel&&videoModel.pause()},isSeeking:function(){return videoModel.getElement().seeking},seek:function(time){time!==this.getTime()&&(videoModel.setCurrentTime(time),this.notify(this.eventList.ENAME_PLAYBACK_SEEKING,time,!0))},reset:function(){stopUpdatingWallclockTime.call(this),removeAllListeners.call(this),videoModel=null,streamInfo=null,currentTime=0,liveStartTime=0/0}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var element=null,keySystems=null,teardownKeySystem=function(kid){var self=this;self.protectionModel.removeKeySystem(kid)},selectKeySystem=function(mediaInfo){for(var self=this,codec=mediaInfo.codec,contentProtection=mediaInfo.contentProtection,ks=0;ks<keySystems.length;++ks)for(var cp=0;cp<contentProtection.length;++cp)if(keySystems[ks].isSupported(contentProtection[cp])&&self.protectionExt.supportsCodec(keySystems[ks].keysTypeString,codec)){var kid=contentProtection[cp].KID;return kid||(kid="unknown"),self.protectionModel.addKeySystem(kid,contentProtection[cp],keySystems[ks]),self.debug.log("DRM: Selected Key System: "+keySystems[ks].keysTypeString+" For KID: "+kid),kid}throw new Error("DRM: The protection system for this content is not supported.")},ensureKeySession=function(kid,codec,eventInitData){var self=this,session=null,initData=null;self.protectionModel.needToAddKeySession(kid)&&(initData=self.protectionModel.getInitData(kid),!initData&&eventInitData?(initData=eventInitData,self.debug.log("DRM: Using initdata from needskey event. length: "+initData.length)):initData&&self.debug.log("DRM: Using initdata from prheader in mpd. length: "+initData.length),initData?(session=self.protectionModel.addKeySession(kid,codec,initData),self.debug.log("DRM: Added Key Session ["+session.sessionId+"] for KID: "+kid+" type: "+codec+" initData length: "+initData.length)):self.debug.log("DRM: initdata is null."))},updateFromMessage=function(kid,session,msg,laURL){this.protectionModel.updateFromMessage(kid,session,msg,laURL)};return{system:void 0,debug:void 0,capabilities:void 0,protectionModel:void 0,protectionExt:void 0,setup:function(){keySystems=this.protectionExt.getKeySystems()},init:function(videoModel,protectionModel){this.videoModel=videoModel,this.protectionModel=protectionModel,element=this.videoModel.getElement()},selectKeySystem:selectKeySystem,ensureKeySession:ensureKeySession,updateFromMessage:updateFromMessage,teardownKeySystem:teardownKeySystem}},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict"},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_KEY_SYSTEM_UPDATE_COMPLETED:"keySystemUpdateCompleted"},supportsCodec:function(mediaKeysString,codec){"use strict";var hasWebKit="WebKitMediaKeys"in window,hasMs="MSMediaKeys"in window,hasMediaSource="MediaKeys"in window;return hasMediaSource?MediaKeys.isTypeSupported(mediaKeysString,codec):hasWebKit?WebKitMediaKeys.isTypeSupported(mediaKeysString,codec):hasMs?MSMediaKeys.isTypeSupported(mediaKeysString,codec):!1},createMediaKeys:function(mediaKeysString){"use strict";var hasWebKit="WebKitMediaKeys"in window,hasMs="MSMediaKeys"in window,hasMediaSource="MediaKeys"in window;return hasMediaSource?new MediaKeys(mediaKeysString):hasWebKit?new WebKitMediaKeys(mediaKeysString):hasMs?new MSMediaKeys(mediaKeysString):null},setMediaKey:function(element,mediaKeys){var hasWebKit="WebKitSetMediaKeys"in element,hasMs="msSetMediaKeys"in element,hasStd="SetMediaKeys"in element;return hasStd?element.SetMediaKeys(mediaKeys):hasWebKit?element.WebKitSetMediaKeys(mediaKeys):hasMs?element.msSetMediaKeys(mediaKeys):void this.debug.log("no setmediakeys function in element")},createSession:function(mediaKeys,mediaCodec,initData){return mediaKeys.createSession(mediaCodec,initData)},getKeySystems:function(){var self=this,playreadyGetUpdate=function(msg,laURL){var decodedChallenge=null,headers=[],parser=new DOMParser,xmlDoc=parser.parseFromString(msg,"application/xml");if(xmlDoc.getElementsByTagName("Challenge")[0]){var Challenge=xmlDoc.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;Challenge&&(decodedChallenge=BASE64.decode(Challenge))}else self.notify(self.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, can not find Challenge in keyMessage"));var headerNameList=xmlDoc.getElementsByTagName("name"),headerValueList=xmlDoc.getElementsByTagName("value");headerNameList.length!=headerValueList.length&&self.notify(self.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error("DRM: playready update, invalid header name/value pair in keyMessage"));for(var i=0;i<headerNameList.length;i++)headers[i]={name:headerNameList[i].childNodes[0].nodeValue,value:headerValueList[i].childNodes[0].nodeValue};var xhr=new XMLHttpRequest;xhr.onload=function(){200==xhr.status?self.notify(self.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,new Uint8Array(xhr.response)):self.notify(self.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR status is "'+xhr.statusText+'" ('+xhr.status+"), expected to be 200. readyState is "+xhr.readyState))},xhr.onabort=function(){self.notify(self.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR aborted. status is "'+xhr.statusText+'" ('+xhr.status+"), readyState is "+xhr.readyState))},xhr.onerror=function(){self.notify(self.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,null,new Error('DRM: playready update, XHR error. status is "'+xhr.statusText+'" ('+xhr.status+"), readyState is "+xhr.readyState))},xhr.open("POST",laURL),xhr.responseType="arraybuffer",headers&&headers.forEach(function(hdr){xhr.setRequestHeader(hdr.name,hdr.value)}),xhr.send(decodedChallenge)},playReadyNeedToAddKeySession=function(initData,keySessions){return null===initData&&0===keySessions.length},playreadyGetInitData=function(data){var byteCursor=0,PROSize=0,PSSHSize=0,PSSHBoxType=new Uint8Array([112,115,115,104,0,0,0,0]),playreadySystemID=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),uint8arraydecodedPROHeader=null,PSSHBoxBuffer=null,PSSHBox=null,PSSHData=null;if("pro"in data)uint8arraydecodedPROHeader=BASE64.decodeArray(data.pro.__text);else{if(!("prheader"in data))return null;uint8arraydecodedPROHeader=BASE64.decodeArray(data.prheader.__text)}return PROSize=uint8arraydecodedPROHeader.length,PSSHSize=4+PSSHBoxType.length+playreadySystemID.length+4+PROSize,PSSHBoxBuffer=new ArrayBuffer(PSSHSize),PSSHBox=new Uint8Array(PSSHBoxBuffer),PSSHData=new DataView(PSSHBoxBuffer),PSSHData.setUint32(byteCursor,PSSHSize),byteCursor+=4,PSSHBox.set(PSSHBoxType,byteCursor),byteCursor+=PSSHBoxType.length,PSSHBox.set(playreadySystemID,byteCursor),byteCursor+=playreadySystemID.length,PSSHData.setUint32(byteCursor,PROSize),byteCursor+=4,PSSHBox.set(uint8arraydecodedPROHeader,byteCursor),byteCursor+=PROSize,PSSHBox};return[{schemeIdUri:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",keysTypeString:"com.microsoft.playready",isSupported:function(data){return this.schemeIdUri===data.schemeIdUri.toLowerCase()},needToAddKeySession:playReadyNeedToAddKeySession,getInitData:playreadyGetInitData,getUpdate:playreadyGetUpdate},{schemeIdUri:"urn:mpeg:dash:mp4protection:2011",keysTypeString:"com.microsoft.playready",isSupported:function(data){return this.schemeIdUri===data.schemeIdUri.toLowerCase()&&"cenc"===data.value.toLowerCase()},needToAddKeySession:playReadyNeedToAddKeySession,getInitData:function(){return null},getUpdate:playreadyGetUpdate},{schemeIdUri:"urn:uuid:00000000-0000-0000-0000-000000000000",keysTypeString:"webkit-org.w3.clearkey",isSupported:function(data){return this.schemeIdUri===data.schemeIdUri.toLowerCase()},needToAddKeySession:function(){return!0},getInitData:function(){return null},getUpdate:function(msg){return msg}}]},addKey:function(element,type,key,data,id){element.webkitAddKey(type,key,data,id)},generateKeyRequest:function(element,type,data){element.webkitGenerateKeyRequest(type,data)},listenToNeedKey:function(videoModel,listener){videoModel.listen("webkitneedkey",listener),videoModel.listen("msneedkey",listener),videoModel.listen("needKey",listener)},listenToKeyError:function(source,listener){source.addEventListener("webkitkeyerror",listener,!1),source.addEventListener("mskeyerror",listener,!1),source.addEventListener("keyerror",listener,!1)},listenToKeyMessage:function(source,listener){source.addEventListener("webkitkeymessage",listener,!1),source.addEventListener("mskeymessage",listener,!1),source.addEventListener("keymessage",listener,!1)},listenToKeyAdded:function(source,listener){source.addEventListener("webkitkeyadded",listener,!1),source.addEventListener("mskeyadded",listener,!1),source.addEventListener("keyadded",listener,!1)},unlistenToKeyError:function(source,listener){source.removeEventListener("webkitkeyerror",listener),source.removeEventListener("mskeyerror",listener),source.removeEventListener("keyerror",listener)},unlistenToKeyMessage:function(source,listener){source.removeEventListener("webkitkeymessage",listener),source.removeEventListener("mskeymessage",listener),source.removeEventListener("keymessage",listener)},unlistenToKeyAdded:function(source,listener){source.removeEventListener("webkitkeyadded",listener),source.removeEventListener("mskeyadded",listener),source.removeEventListener("keyadded",listener)}},MediaPlayer.models.ProtectionModel=function(){"use strict";var session,element=null,keyAddedListener=null,keyErrorListener=null,keyMessageListener=null,keySystems=[],onKeySystemUpdateCompleted=function(sender,data,error){error||session.update(data)};return{system:void 0,protectionExt:void 0,setup:function(){this.keySystemUpdateCompleted=onKeySystemUpdateCompleted},init:function(videoModel){this.videoModel=videoModel,element=this.videoModel.getElement()},addKeySession:function(kid,mediaCodec,initData){var session=null;return session=this.protectionExt.createSession(keySystems[kid].keys,mediaCodec,initData),this.protectionExt.listenToKeyAdded(session,keyAddedListener),this.protectionExt.listenToKeyError(session,keyErrorListener),this.protectionExt.listenToKeyMessage(session,keyMessageListener),keySystems[kid].initData=initData,keySystems[kid].keySessions.push(session),session},addKeySystem:function(kid,contentProtectionData,keySystemDesc){var keysLocal=null;keysLocal=this.protectionExt.createMediaKeys(keySystemDesc.keysTypeString),this.protectionExt.setMediaKey(element,keysLocal),keySystems[kid]={kID:kid,contentProtection:contentProtectionData,keySystem:keySystemDesc,keys:keysLocal,initData:null,keySessions:[]}},removeKeySystem:function(kid){if(null!==kid&&void 0!==keySystems[kid]&&0!==keySystems[kid].keySessions.length){for(var keySessions=keySystems[kid].keySessions,kss=0;kss<keySessions.length;++kss)this.protectionExt.unlistenToKeyError(keySessions[kss],keyErrorListener),this.protectionExt.unlistenToKeyAdded(keySessions[kss],keyAddedListener),this.protectionExt.unlistenToKeyMessage(keySessions[kss],keyMessageListener),keySessions[kss].close();keySystems[kid]=void 0}},needToAddKeySession:function(kid){var keySystem=null;return keySystem=keySystems[kid],keySystem.keySystem.needToAddKeySession(keySystem.initData,keySystem.keySessions)},getInitData:function(kid){var keySystem=null;return keySystem=keySystems[kid],keySystem.keySystem.getInitData(keySystem.contentProtection)},updateFromMessage:function(kid,sessionValue,msg,laURL){session=sessionValue,keySystems[kid].keySystem.getUpdate(msg,laURL)},listenToNeedKey:function(listener){this.protectionExt.listenToNeedKey(this.videoModel,listener)},listenToKeyError:function(listener){keyErrorListener=listener;for(var ks=0;ks<keySystems.length;++ks)for(var keySessions=keySystems[ks].keySessions,kss=0;kss<keySessions.length;++kss)this.protectionExt.listenToKeyError(keySessions[kss],listener)},listenToKeyMessage:function(listener){keyMessageListener=listener;for(var ks=0;ks<keySystems.length;++ks)for(var keySessions=keySystems[ks].keySessions,kss=0;kss<keySessions.length;++kss)this.protectionExt.listenToKeyMessage(keySessions[kss],listener)},listenToKeyAdded:function(listener){keyAddedListener=listener;for(var ks=0;ks<keySystems.length;++ks)for(var keySessions=keySystems[ks].keySessions,kss=0;kss<keySessions.length;++kss)this.protectionExt.listenToKeyAdded(keySessions[kss],listener)}}},MediaPlayer.models.ProtectionModel.prototype={constructor:MediaPlayer.models.ProtectionModel},MediaPlayer.dependencies.ScheduleController=function(){"use strict";var type,ready,fragmentModel,isDynamic,currentTrackInfo,fragmentsToLoad=0,initialPlayback=!0,lastValidationTime=null,isStopped=!1,playListMetrics=null,playListTraceMetrics=null,playListTraceMetricsClosed=!0,clearPlayListTraceMetrics=function(endTime,stopreason){var duration=0,startTime=null;playListTraceMetricsClosed===!1&&(startTime=playListTraceMetrics.start,duration=endTime.getTime()-startTime.getTime(),playListTraceMetrics.duration=duration,playListTraceMetrics.stopreason=stopreason,playListTraceMetricsClosed=!0)},doStart=function(){if(ready){isStopped=!1;var currentTime=new Date;clearPlayListTraceMetrics(currentTime,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),playListMetrics=this.metricsModel.addPlayList(type,currentTime,0,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON),initialPlayback&&(initialPlayback=!1),this.debug.log("ScheduleController "+type+" start."),validate.call(this)}},startOnReady=function(){initialPlayback&&getInitRequest.call(this,currentTrackInfo.quality),doStart.call(this)},doStop=function(cancelPending){isStopped||(isStopped=!0,this.debug.log("ScheduleController "+type+" stop."),cancelPending&&this.fragmentController.cancelPendingRequestsForModel(fragmentModel),clearPlayListTraceMetrics(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},getNextFragment=function(callback){var self=this,rules=self.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);self.rulesController.applyRules(rules,self.streamProcessor,callback,null,function(currentValue,newValue){return newValue})},getInitRequest=function(quality){var request,self=this;return request=self.adapter.getInitRequest(self.streamProcessor,quality),null!==request&&self.fragmentController.prepareFragmentForLoading(self,request),request},getRequiredFragmentCount=function(callback){var self=this,rules=self.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);self.rulesController.applyRules(rules,self.streamProcessor,callback,fragmentsToLoad,function(currentValue,newValue){return Math.min(currentValue,newValue)})},replaceCanceledPendingRequests=function(canceledRequests){var request,time,i,ln=canceledRequests.length;for(i=0;ln>i;i+=1)request=canceledRequests[i],time=request.startTime+request.duration/2,request=this.adapter.getFragmentRequestForTime(this.streamProcessor,currentTrackInfo,time,!1),this.fragmentController.prepareFragmentForLoading(this,request)
},onGetRequiredFragmentCount=function(result){var self=this;return fragmentsToLoad=result.value,0>=fragmentsToLoad?void self.fragmentController.executePendingRequests():(self.abrController.getPlaybackQuality(self.streamProcessor),void getNextFragment.call(self,onNextFragment.bind(self)))},onNextFragment=function(result){var request=result.value;null===request||request instanceof MediaPlayer.vo.FragmentRequest||(request=this.adapter.getFragmentRequestForTime(this.streamProcessor,currentTrackInfo,request.startTime)),request&&(fragmentsToLoad--,this.fragmentController.prepareFragmentForLoading(this,request))},validate=function(){var now=(new Date).getTime(),isEnoughTimeSinceLastValidation=lastValidationTime?now-lastValidationTime>this.fragmentController.getLoadingTime(this):!0;!isEnoughTimeSinceLastValidation||isStopped||this.playbackController.isPaused()&&(!this.scheduleWhilePaused||isDynamic)||(lastValidationTime=now,getRequiredFragmentCount.call(this,onGetRequiredFragmentCount.bind(this)))},clearMetrics=function(){var self=this;null!==type&&""!==type&&self.metricsModel.clearCurrentMetricsForType(type)},onDataUpdateCompleted=function(sender,mediaData,trackData){currentTrackInfo=this.adapter.convertDataToTrack(trackData),isDynamic||(ready=!0),ready&&startOnReady.call(this)},onStreamCompleted=function(sender,model){model===this.streamProcessor.getFragmentModel()&&(this.debug.log(type+" Stream is complete."),clearPlayListTraceMetrics(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))},onMediaFragmentLoadingStart=function(sender,model){var self=this;model===self.streamProcessor.getFragmentModel()&&validate.call(self)},onBytesError=function(){doStop.call(this)},onBytesAppended=function(){addPlaylistTraceMetrics.call(this)},onDataUpdateStarted=function(){doStop.call(this,!1)},onInitRequested=function(sender,quality){getInitRequest.call(this,quality)},onBufferCleared=function(sender,startTime,endTime,hasEnoughSpace){this.fragmentController.removeExecutedRequestsBeforeTime(fragmentModel,endTime),hasEnoughSpace&&doStart.call(this)},onBufferLevelStateChanged=function(sender,hasSufficientBuffer){var self=this;hasSufficientBuffer||self.playbackController.isSeeking()||(self.debug.log("Stalling "+type+" Buffer: "+type),clearPlayListTraceMetrics(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},onBufferLevelUpdated=function(sender,newBufferLevel){var self=this;self.metricsModel.addBufferLevel(type,new Date,newBufferLevel),validate.call(this)},onQuotaExceeded=function(){doStop.call(this,!1)},onQualityChanged=function(sender,typeValue,oldQuality,newQuality){if(type===typeValue){var canceledReqs,self=this;if(canceledReqs=fragmentModel.cancelPendingRequests(oldQuality),currentTrackInfo=self.streamProcessor.getTrackForQuality(newQuality),null===currentTrackInfo||void 0===currentTrackInfo)throw"Unexpected error!";replaceCanceledPendingRequests.call(self,canceledReqs),clearPlayListTraceMetrics(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}},addPlaylistTraceMetrics=function(){var self=this,currentVideoTime=self.playbackController.getTime(),rate=self.playbackController.getPlaybackRate(),currentTime=new Date;playListTraceMetricsClosed===!0&&currentTrackInfo&&playListMetrics&&(playListTraceMetricsClosed=!1,playListTraceMetrics=self.metricsModel.appendPlayListTrace(playListMetrics,currentTrackInfo.id,null,currentTime,currentVideoTime,null,rate,null))},onClosedCaptioningRequested=function(sender,quality){var self=this,req=getInitRequest.call(self,quality);fragmentModel.executeRequest(req)},onPlaybackStarted=function(){doStart.call(this)},onPlaybackSeeking=function(sender,time){initialPlayback||this.fragmentController.cancelPendingRequestsForModel(fragmentModel);var currentTime,metrics=this.metricsModel.getMetricsFor("stream"),manifestUpdateInfo=this.metricsExt.getCurrentManifestUpdate(metrics);this.debug.log("ScheduleController "+type+" seek: "+time),currentTime=new Date,clearPlayListTraceMetrics(currentTime,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),playListMetrics=this.metricsModel.addPlayList(type,currentTime,time,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),doStart.call(this),this.metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{latency:currentTrackInfo.DVRWindow.end-this.playbackController.getTime()})},onPlaybackRateChanged=function(){addPlaylistTraceMetrics.call(this)},onWallclockTimeUpdated=function(){validate.call(this)},onLiveEdgeFound=function(sender,liveEdgeTime){var request,actualStartTime,self=this,manifestInfo=currentTrackInfo.mediaInfo.streamInfo.manifestInfo,startTime=liveEdgeTime-Math.min(2*manifestInfo.minBufferTime,manifestInfo.DVRWindowSize/2),metrics=self.metricsModel.getMetricsFor("stream"),manifestUpdateInfo=self.metricsExt.getCurrentManifestUpdate(metrics);request=self.adapter.getFragmentRequestForTime(self.streamProcessor,currentTrackInfo,startTime),actualStartTime=request.startTime+request.duration/2,self.playbackController.setLiveStartTime(actualStartTime),self.metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{currentTime:actualStartTime,presentationStartTime:liveEdgeTime,latency:liveEdgeTime-actualStartTime,clientTimeOffset:self.timelineConverter.getClientTimeOffset()}),ready=!0,startOnReady.call(self)};return{debug:void 0,system:void 0,metricsModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,eventList:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this.liveEdgeFound=onLiveEdgeFound,this.qualityChanged=onQualityChanged,this.dataUpdateStarted=onDataUpdateStarted,this.dataUpdateCompleted=onDataUpdateCompleted,this.mediaFragmentLoadingStart=onMediaFragmentLoadingStart,this.fragmentLoadingFailed=onBytesError,this.streamCompleted=onStreamCompleted,this.bufferCleared=onBufferCleared,this.bytesAppended=onBytesAppended,this.bufferLevelStateChanged=onBufferLevelStateChanged,this.bufferLevelUpdated=onBufferLevelUpdated,this.initRequested=onInitRequested,this.quotaExceeded=onQuotaExceeded,this.closedCaptioningRequested=onClosedCaptioningRequested,this.playbackStarted=onPlaybackStarted,this.playbackSeeking=onPlaybackSeeking,this.playbackRateChanged=onPlaybackRateChanged,this.wallclockTimeUpdated=onWallclockTimeUpdated},initialize:function(typeValue,streamProcessor){var self=this;type=typeValue,self.streamProcessor=streamProcessor,self.playbackController=streamProcessor.playbackController,self.fragmentController=streamProcessor.fragmentController,self.liveEdgeFinder=streamProcessor.liveEdgeFinder,self.bufferController=streamProcessor.bufferController,isDynamic=streamProcessor.isDynamic(),fragmentModel=this.fragmentController.getModel(this),self.scheduleRulesCollection.bufferLevelRule&&self.scheduleRulesCollection.bufferLevelRule.setScheduleController(self),self.scheduleRulesCollection.pendingRequestsRule&&self.scheduleRulesCollection.pendingRequestsRule.setScheduleController(self),self.scheduleRulesCollection.playbackTimeRule&&self.scheduleRulesCollection.playbackTimeRule.setScheduleController(self)},getFragmentModel:function(){return fragmentModel},reset:function(){var self=this;doStop.call(self,!0),self.bufferController.unsubscribe(self.bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,self.scheduleRulesCollection.bufferLevelRule),self.bufferController.unsubscribe(self.bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,self.scheduleRulesCollection.bufferLevelRule),self.fragmentController.abortRequestsForModel(fragmentModel),self.fragmentController.detachModel(fragmentModel),clearMetrics.call(self),fragmentsToLoad=0},start:doStart,stop:doStop}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.errHandler=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"}},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(mediaSource,mediaInfo){"use strict";var self=this,codec=mediaInfo.codec,buffer=null;try{buffer=mediaSource.addSourceBuffer(codec)}catch(ex){if(!mediaInfo.isText)throw ex;buffer=self.system.getObject("textSourceBuffer")}return buffer},removeSourceBuffer:function(mediaSource,buffer){"use strict";try{mediaSource.removeSourceBuffer(buffer)}catch(ex){}},getBufferRange:function(buffer,time,tolerance){"use strict";var len,i,ranges=null,start=0,end=0,firstStart=null,lastEnd=null,gap=0,toler=tolerance||.15;try{ranges=buffer.buffered}catch(ex){return null}if(null!==ranges){for(i=0,len=ranges.length;len>i;i+=1)if(start=ranges.start(i),end=ranges.end(i),null===firstStart)gap=Math.abs(start-time),time>=start&&end>time?(firstStart=start,lastEnd=end):toler>=gap&&(firstStart=start,lastEnd=end);else{if(gap=start-lastEnd,!(toler>=gap))break;lastEnd=end}if(null!==firstStart)return{start:firstStart,end:lastEnd}}return null},getAllRanges:function(buffer){var ranges=null;try{return ranges=buffer.buffered}catch(ex){return null}},getBufferLength:function(buffer,time,tolerance){"use strict";var range,length,self=this;return range=self.getBufferRange(buffer,time,tolerance),length=null===range?0:range.end-time},waitForUpdateEnd:function(buffer,callback){"use strict";var intervalId,CHECK_INTERVAL=50,checkIsUpdateEnded=function(){buffer.updating||(clearInterval(intervalId),callback(!0))},updateEndHandler=function(){buffer.updating||(buffer.removeEventListener("updateend",updateEndHandler,!1),callback(!0))};if(!buffer.updating)return void callback(!0);if("function"==typeof buffer.addEventListener)try{buffer.addEventListener("updateend",updateEndHandler,!1)}catch(err){intervalId=setInterval(checkIsUpdateEnded,CHECK_INTERVAL)}else intervalId=setInterval(checkIsUpdateEnded,CHECK_INTERVAL)},append:function(buffer,bytes){var self=this,appendMethod="append"in buffer?"append":"appendBuffer"in buffer?"appendBuffer":null;if(appendMethod)try{self.waitForUpdateEnd(buffer,function(){buffer[appendMethod](bytes),self.waitForUpdateEnd(buffer,function(){self.notify(self.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,buffer,bytes)})})}catch(err){self.notify(self.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,buffer,bytes,err)}},remove:function(buffer,start,end,mediaSource){var self=this;try{start>=0&&end>start&&"ended"!==mediaSource.readyState&&buffer.remove(start,end),this.waitForUpdateEnd(buffer,function(){self.notify(self.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,buffer,start,end)})}catch(err){self.notify(self.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,buffer,start,end,err)}},abort:function(mediaSource,buffer){"use strict";try{"open"===mediaSource.readyState&&buffer.abort()}catch(ex){}}},MediaPlayer.dependencies.Stream=function(){"use strict";var manifest,mediaSource,needKeyListener,keyMessageListener,keyAddedListener,keyErrorListener,mediaInfos={},streamProcessors=[],autoPlay=!0,initialized=!1,loaded=!1,errored=!1,kid=null,initData=[],updating=!0,streamInfo=null,eventController=null,play=function(){initialized&&this.playbackController.start()},pause=function(){this.playbackController.pause()},seek=function(time){initialized&&(this.debug.log("Do seek: "+time),this.playbackController.seek(time))},onMediaSourceNeedsKey=function(event){var type,self=this,mediaInfo=mediaInfos.video,videoCodec=mediaInfos?mediaInfos.video.codec:null;if(type="msneedkey"!==event.type?event.type:videoCodec,initData.push({type:type,initData:event.initData}),this.debug.log("DRM: Key required for - "+type),mediaInfo&&videoCodec&&!kid)try{kid=self.protectionController.selectKeySystem(mediaInfo)}catch(error){pause.call(self),self.debug.log(error),self.errHandler.mediaKeySystemSelectionError(error)}kid&&self.protectionController.ensureKeySession(kid,type,event.initData)},onMediaSourceKeyMessage=function(event){var self=this,session=null,bytes=null,msg=null,laURL=null;this.debug.log("DRM: Got a key message..."),session=event.target,bytes=new Uint16Array(event.message.buffer),msg=String.fromCharCode.apply(null,bytes),laURL=event.destinationURL,self.protectionController.updateFromMessage(kid,session,msg,laURL)},onMediaSourceKeyAdded=function(){this.debug.log("DRM: Key added.")},onMediaSourceKeyError=function(){var msg,session=event.target;switch(msg="DRM: MediaKeyError - sessionId: "+session.sessionId+" errorCode: "+session.error.code+" systemErrorCode: "+session.error.systemCode+" [",session.error.code){case 1:msg+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:msg+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:msg+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:msg+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:msg+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:msg+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}msg+="]",this.debug.log(msg),this.errHandler.mediaKeySessionError(msg)},setUpMediaSource=function(mediaSourceArg,callback){var self=this,onMediaSourceOpen=function(e){self.debug.log("MediaSource is open!"),self.debug.log(e),mediaSourceArg.removeEventListener("sourceopen",onMediaSourceOpen),mediaSourceArg.removeEventListener("webkitsourceopen",onMediaSourceOpen),callback(mediaSourceArg)};mediaSourceArg.addEventListener("sourceopen",onMediaSourceOpen,!1),mediaSourceArg.addEventListener("webkitsourceopen",onMediaSourceOpen,!1),self.mediaSourceExt.attachMediaSource(mediaSourceArg,self.videoModel)},tearDownMediaSource=function(){var processor,self=this,ln=streamProcessors.length,i=0;for(i;ln>i;i+=1)processor=streamProcessors[i],processor.reset(errored),processor=null;eventController&&eventController.reset(),streamProcessors=[],mediaSource&&self.mediaSourceExt.detachMediaSource(self.videoModel),initialized=!1,kid=null,initData=[],mediaInfos={},mediaSource=null,manifest=null},initializeMediaForType=function(type,manifest){var mimeType,codec,processor,self=this,getCodecOrMimeType=function(mediaInfo){return mediaInfo.codec},mediaInfo=self.adapter.getMediaInfoForType(manifest,streamInfo,type);if("text"===type)return console.log("Skipping"),console.log(type),void console.log(manifest);if(null!==mediaInfo){var contentProtectionData,codecOrMime=getCodecOrMimeType.call(self,mediaInfo),buffer=null;if(codecOrMime===mimeType)try{buffer=self.sourceBufferExt.createSourceBuffer(mediaSource,mediaInfo)}catch(e){self.errHandler.mediaSourceError("Error creating "+type+" source buffer.")}else if(codec=codecOrMime,self.debug.log(type+" codec: "+codec),mediaInfos[type]=mediaInfo,contentProtectionData=mediaInfo.contentProtection,contentProtectionData&&!self.capabilities.supportsMediaKeys())self.errHandler.capabilityError("mediakeys");else if(self.capabilities.supportsCodec(self.videoModel.getElement(),codec))try{buffer=self.sourceBufferExt.createSourceBuffer(mediaSource,mediaInfo)}catch(e){self.errHandler.mediaSourceError("Error creating "+type+" source buffer.")}else{var msg=type+"Codec ("+codec+") is not supported.";self.errHandler.manifestError(msg,"codec",manifest),self.debug.log(msg)}null===buffer?self.debug.log("No buffer was created, skipping "+type+" data."):(processor=self.system.getObject("streamProcessor"),streamProcessors.push(processor),processor.initialize(mimeType||type,buffer,self.videoModel,self.fragmentController,self.playbackController,mediaSource,self,eventController),processor.setMediaInfo(mediaInfo),self.adapter.updateData(processor))}else self.debug.log("No "+type+" data.")},initializeMediaSource=function(){var events,self=this;eventController=self.system.getObject("eventController"),eventController.initialize(self.videoModel),events=self.adapter.getEventsFor(streamInfo),eventController.addInlineEvents(events),initializeMediaForType.call(self,"video",manifest),initializeMediaForType.call(self,"audio",manifest),initializeMediaForType.call(self,"text",manifest)},initializePlayback=function(){var manifestDuration,mediaDuration,self=this;manifestDuration=streamInfo.manifestInfo.duration,mediaDuration=self.mediaSourceExt.setDuration(mediaSource,manifestDuration),self.debug.log("Duration successfully set to: "+mediaDuration),initialized=!0,checkIfInitializationCompleted.call(self)},onLoad=function(){this.debug.log("element loaded!"),loaded=!0,startAutoPlay.call(this)},startAutoPlay=function(){initialized&&loaded&&0===streamInfo.index&&(eventController.start(),autoPlay&&play.call(this))},checkIfInitializationCompleted=function(){var self=this,ln=streamProcessors.length,i=0;if(initialized){for(i;ln>i;i+=1)if(console.log(streamProcessors[i]),streamProcessors[i].isUpdating())return;updating=!1,self.notify(self.eventList.ENAME_STREAM_UPDATED)}},onError=function(sender,error){var code=error.code,msg="";if(-1!==code){switch(code){case 1:msg="MEDIA_ERR_ABORTED";break;case 2:msg="MEDIA_ERR_NETWORK";break;case 3:msg="MEDIA_ERR_DECODE";break;case 4:msg="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:msg="MEDIA_ERR_ENCRYPTED"}errored=!0,this.debug.log("Video Element Error: "+msg),this.debug.log(error),this.errHandler.mediaSourceError(msg),this.reset()}},doLoad=function(manifestResult){var mediaSourceResult,self=this,onMediaSourceSetup=function(mediaSourceResult){if(mediaSource=mediaSourceResult,initializeMediaSource.call(self),0===streamProcessors.length){var msg="No streams to play.";self.errHandler.manifestError(msg,"nostreams",manifest),self.debug.log(msg)}else console.log("Starting "),console.log(streamProcessors[0].getType()),self.liveEdgeFinder.initialize(streamProcessors[0]),self.liveEdgeFinder.subscribe(self.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,self.playbackController),initializePlayback.call(self),startAutoPlay.call(self)};manifest=manifestResult,mediaSourceResult=self.mediaSourceExt.createMediaSource(),setUpMediaSource.call(self,mediaSourceResult,onMediaSourceSetup)},onBufferingCompleted=function(){var processors=getAudioVideoProcessors(),ln=processors.length,i=0;for(i;ln>i;i+=1)if(!processors[i].isBufferingCompleted())return;mediaSource&&this.mediaSourceExt.signalEndOfStream(mediaSource)},onDataUpdateCompleted=function(){checkIfInitializationCompleted.call(this)},onKeySystemUpdateCompleted=function(sender,data,error){error&&(pause.call(this),this.debug.log(error),this.errHandler.mediaKeyMessageError(error))},getAudioVideoProcessors=function(){var type,proc,arr=[],i=0,ln=streamProcessors.length;for(i;ln>i;i+=1)proc=streamProcessors[i],type=proc.getType(),("audio"===type||"video"===type)&&arr.push(proc);return arr},updateData=function(updatedStreamInfo){var mediaInfo,events,processor,self=this,ln=streamProcessors.length,i=0;for(updating=!0,manifest=self.manifestModel.getValue(),streamInfo=updatedStreamInfo,self.debug.log("Manifest updated... set new data on buffers."),eventController&&(events=self.adapter.getEventsFor(streamInfo),eventController.addInlineEvents(events)),i;ln>i;i+=1)processor=streamProcessors[i],mediaInfo=self.adapter.getMediaInfoForType(manifest,streamInfo,processor.getType()),processor.setMediaInfo(mediaInfo),this.adapter.updateData(processor)};return{system:void 0,manifestModel:void 0,mediaSourceExt:void 0,sourceBufferExt:void 0,adapter:void 0,fragmentController:void 0,playbackController:void 0,protectionModel:void 0,protectionController:void 0,protectionExt:void 0,capabilities:void 0,debug:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAM_UPDATED:"streamUpdated"},setup:function(){this.bufferingCompleted=onBufferingCompleted,this.dataUpdateCompleted=onDataUpdateCompleted,this.playbackError=onError,this.playbackMetaDataLoaded=onLoad,this.keySystemUpdateCompleted=onKeySystemUpdateCompleted},load:function(manifest){doLoad.call(this,manifest)},setVideoModel:function(value){this.videoModel=value},initProtection:function(){needKeyListener=onMediaSourceNeedsKey.bind(this),keyMessageListener=onMediaSourceKeyMessage.bind(this),keyAddedListener=onMediaSourceKeyAdded.bind(this),keyErrorListener=onMediaSourceKeyError.bind(this),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(this.getVideoModel()),this.protectionController=this.system.getObject("protectionController"),this.protectionController.init(this.videoModel,this.protectionModel),this.protectionModel.listenToNeedKey(needKeyListener),this.protectionModel.listenToKeyMessage(keyMessageListener),this.protectionModel.listenToKeyError(keyErrorListener),this.protectionModel.listenToKeyAdded(keyAddedListener),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.subscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this)},getVideoModel:function(){return this.videoModel},setAutoPlay:function(value){autoPlay=value},getAutoPlay:function(){return autoPlay},reset:function(){pause.call(this),tearDownMediaSource.call(this),this.protectionController&&this.protectionController.teardownKeySystem(kid),this.protectionModel&&this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this.protectionModel),this.protectionExt.unsubscribe(this.protectionExt.eventList.ENAME_KEY_SYSTEM_UPDATE_COMPLETED,this),this.protectionController=void 0,this.protectionModel=void 0,this.fragmentController=void 0,this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_ERROR,this),this.playbackController.unsubscribe(this.playbackController.eventList.ENAME_PLAYBACK_METADATA_LOADED,this),this.playbackController.reset(),this.liveEdgeFinder.abortSearch(),this.liveEdgeFinder.unsubscribe(this.liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,this.playbackController),loaded=!1},getDuration:function(){return streamInfo.duration},getStartTime:function(){return streamInfo.start},getStreamIndex:function(){return streamInfo.index},getId:function(){return streamInfo.id},setStreamInfo:function(stream){streamInfo=stream},getStreamInfo:function(){return streamInfo},startEventController:function(){eventController.start()},resetEventController:function(){eventController.reset()},setPlaybackController:function(value){this.playbackController=value,value.initialize(streamInfo,this.videoModel)},getPlaybackController:function(){return this.playbackController},isUpdating:function(){return updating},updateData:updateData,play:play,seek:seek,pause:pause}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.StreamController=function(){"use strict";var activeStream,streams=[],STREAM_BUFFER_END_THRESHOLD=6,STREAM_END_THRESHOLD=.2,autoPlay=!0,isStreamSwitchingInProgress=!1,play=function(){activeStream.play()},pause=function(){activeStream.pause()},seek=function(time){activeStream.seek(time)},switchVideoModel=function(fromStream,toStream){var activeVideoElement=fromStream.getVideoModel().getElement(),newVideoElement=toStream.getVideoModel().getElement();newVideoElement.parentNode||activeVideoElement.parentNode.insertBefore(newVideoElement,activeVideoElement),activeVideoElement.style.width="0px",newVideoElement.style.width="100%",copyVideoProperties(activeVideoElement,newVideoElement),detachVideoEvents.call(this,fromStream),attachVideoEvents.call(this,toStream)},attachVideoEvents=function(stream){var playbackCtrl=stream.getPlaybackController();playbackCtrl.subscribe(playbackCtrl.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),playbackCtrl.subscribe(playbackCtrl.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),playbackCtrl.subscribe(playbackCtrl.eventList.ENAME_PLAYBACK_SEEKING,this),playbackCtrl.subscribe(playbackCtrl.eventList.ENAME_PLAYBACK_TIME_UPDATED,this),playbackCtrl.subscribe(playbackCtrl.eventList.ENAME_PLAYBACK_PROGRESS,this)},detachVideoEvents=function(stream){var self=this,playbackCtrl=stream.getPlaybackController();setTimeout(function(){playbackCtrl.unsubscribe(playbackCtrl.eventList.ENAME_PLAYBACK_STARTED,self.manifestUpdater),playbackCtrl.unsubscribe(playbackCtrl.eventList.ENAME_PLAYBACK_PAUSED,self.manifestUpdater),playbackCtrl.unsubscribe(playbackCtrl.eventList.ENAME_PLAYBACK_SEEKING,self),playbackCtrl.unsubscribe(playbackCtrl.eventList.ENAME_PLAYBACK_TIME_UPDATED,self),playbackCtrl.unsubscribe(playbackCtrl.eventList.ENAME_PLAYBACK_PROGRESS,self)},1)},copyVideoProperties=function(fromVideoElement,toVideoElement){["controls","loop","muted","volume"].forEach(function(prop){toVideoElement[prop]=fromVideoElement[prop]})},onProgress=function(sender,ranges,remainingUnbufferedDuration){!remainingUnbufferedDuration||remainingUnbufferedDuration>=STREAM_BUFFER_END_THRESHOLD||onStreamBufferingEnd()},onTimeupdate=function(sender,timeToStreamEnd){var self=this;self.metricsModel.addDroppedFrames("video",self.videoExt.getPlaybackQuality(activeStream.getVideoModel().getElement())),getNextStream()&&(activeStream.getVideoModel().getElement().seeking||STREAM_END_THRESHOLD>timeToStreamEnd&&switchStream.call(this,activeStream,getNextStream()))},onSeeking=function(sender,seekingTime){var seekingStream=getStreamForTime(seekingTime);seekingStream&&seekingStream!==activeStream&&switchStream.call(this,activeStream,seekingStream,seekingTime)},onStreamBufferingEnd=function(){var nextStream=getNextStream();nextStream&&nextStream.seek(nextStream.getStartTime())},getNextStream=function(){var nextIndex=activeStream.getStreamIndex()+1;return nextIndex<streams.length?streams[nextIndex]:null},getStreamForTime=function(time){var duration=0,stream=null,ln=streams.length;ln>0&&(duration+=streams[0].getStartTime());for(var i=0;ln>i;i++)if(stream=streams[i],duration+=stream.getDuration(),duration>time)return stream;return null},createVideoModel=function(){var model=this.system.getObject("videoModel"),video=document.createElement("video");return model.setElement(video),model},removeVideoElement=function(element){element.parentNode&&element.parentNode.removeChild(element)},switchStream=function(from,to,seekTo){!isStreamSwitchingInProgress&&from&&to&&from!==to&&(isStreamSwitchingInProgress=!0,from.pause(),activeStream=to,switchVideoModel.call(this,from,to),seek(seekTo?from.getPlaybackController().getTime():to.getStartTime()),play(),from.resetEventController(),activeStream.startEventController(),isStreamSwitchingInProgress=!1)},composeStreams=function(){var playbackCtrl,streamInfo,pLen,sLen,pIdx,sIdx,streamsInfo,stream,self=this,manifest=self.manifestModel.getValue(),metrics=self.metricsModel.getMetricsFor("stream"),manifestUpdateInfo=self.metricsExt.getCurrentManifestUpdate(metrics);if(manifest){streamsInfo=self.adapter.getStreamsInfo(manifest);try{if(0===streamsInfo.length)throw new Error("There are no streams");for(self.metricsModel.updateManifestUpdateInfo(manifestUpdateInfo,{currentTime:self.videoModel.getCurrentTime(),buffered:self.videoModel.getElement().buffered,presentationStartTime:streamsInfo[0].start,clientTimeOffset:self.timelineConverter.getClientTimeOffset()}),pIdx=0,pLen=streamsInfo.length;pLen>pIdx;pIdx+=1){for(streamInfo=streamsInfo[pIdx],sIdx=0,sLen=streams.length;sLen>sIdx;sIdx+=1)streams[sIdx].getId()===streamInfo.id&&(stream=streams[sIdx],stream.updateData(streamInfo));stream||(stream=self.system.getObject("stream"),playbackCtrl=self.system.getObject("playbackController"),stream.setStreamInfo(streamInfo),stream.setVideoModel(0===pIdx?self.videoModel:createVideoModel.call(self)),stream.setPlaybackController(playbackCtrl),playbackCtrl.subscribe(playbackCtrl.eventList.ENAME_PLAYBACK_ERROR,stream),playbackCtrl.subscribe(playbackCtrl.eventList.ENAME_PLAYBACK_METADATA_LOADED,stream),stream.initProtection(),stream.setAutoPlay(autoPlay),stream.load(manifest),stream.subscribe(stream.eventList.ENAME_STREAM_UPDATED,self),streams.push(stream)),self.metricsModel.addManifestUpdateStreamInfo(manifestUpdateInfo,streamInfo.id,streamInfo.index,streamInfo.start,streamInfo.duration),stream=null}activeStream||(activeStream=streams[0],attachVideoEvents.call(self,activeStream),activeStream.subscribe(activeStream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder))}catch(e){self.errHandler.manifestError(e.message,"nostreamscomposed",self.manifestModel.getValue()),self.reset()}}},onStreamUpdated=function(){var self=this,ln=streams.length,i=0;for(i;ln>i;i+=1)if(streams[i].isUpdating())return;self.notify(self.eventList.ENAME_STREAMS_COMPOSED)},onManifestLoaded=function(sender,manifest,error){error?this.reset():(this.manifestModel.setValue(manifest),this.debug.log("Manifest has loaded."),composeStreams.call(this))};return{system:void 0,videoModel:void 0,manifestLoader:void 0,manifestUpdater:void 0,manifestModel:void 0,adapter:void 0,debug:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_STREAMS_COMPOSED:"streamsComposed"},setup:function(){this.manifestLoaded=onManifestLoaded,this.streamUpdated=onStreamUpdated,this.playbackSeeking=onSeeking,this.playbackProgress=onProgress,this.playbackTimeUpdated=onTimeupdate},setAutoPlay:function(value){autoPlay=value},getAutoPlay:function(){return autoPlay},getVideoModel:function(){return this.videoModel},setVideoModel:function(value){this.videoModel=value},load:function(url){this.manifestLoader.load(url)},reset:function(){activeStream&&detachVideoEvents.call(this,activeStream);for(var i=0,ln=streams.length;ln>i;i++){var stream=streams[i];stream.unsubscribe(stream.eventList.ENAME_STREAM_UPDATED,this),stream.reset(),stream!==activeStream&&removeVideoElement(stream.getVideoModel().getElement())}streams=[],this.manifestUpdater.stop(),this.metricsModel.clearAllCurrentMetrics(),this.manifestModel.setValue(null),this.timelineConverter.reset(),this.adapter.reset(),isStreamSwitchingInProgress=!1,activeStream=null},play:play,seek:seek,pause:pause}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var isDynamic,stream,mediaInfo,type,eventController,createBufferControllerForType=function(type){var self=this,controllerName="video"===type||"audio"===type?"bufferController":"textController";return self.system.getObject(controllerName)};return{system:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,eventList:void 0,abrController:void 0,baseURLExt:void 0,adapter:void 0,initialize:function(typeValue,buffer,videoModel,fragmentController,playbackController,mediaSource,streamValue,eventControllerValue){var fragmentModel,self=this,trackController=self.system.getObject("trackController"),scheduleController=self.system.getObject("scheduleController"),liveEdgeFinder=self.liveEdgeFinder,abrController=self.abrController,indexHandler=self.indexHandler,baseUrlExt=self.baseURLExt,fragmentLoader=this.system.getObject("fragmentLoader"),bufferController=createBufferControllerForType.call(self,typeValue);stream=streamValue,type=typeValue,eventController=eventControllerValue,isDynamic=stream.getStreamInfo().manifestInfo.isDynamic,self.bufferController=bufferController,self.playbackController=playbackController,self.scheduleController=scheduleController,self.trackController=trackController,self.videoModel=videoModel,self.fragmentController=fragmentController,self.fragmentLoader=fragmentLoader,trackController.subscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,bufferController),fragmentController.subscribe(fragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,bufferController),bufferController.subscribe(bufferController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,scheduleController),("video"===type||"audio"===type)&&(abrController.subscribe(abrController.eventList.ENAME_QUALITY_CHANGED,bufferController),abrController.subscribe(abrController.eventList.ENAME_QUALITY_CHANGED,trackController),abrController.subscribe(abrController.eventList.ENAME_QUALITY_CHANGED,scheduleController),liveEdgeFinder.subscribe(liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),liveEdgeFinder.subscribe(liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,trackController),liveEdgeFinder.subscribe(liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,scheduleController),trackController.subscribe(trackController.eventList.ENAME_DATA_UPDATE_STARTED,scheduleController),trackController.subscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,scheduleController),trackController.subscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,abrController),trackController.subscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,stream),playbackController.streamProcessor||(playbackController.streamProcessor=self,trackController.subscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,playbackController)),fragmentController.subscribe(fragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,bufferController),fragmentController.subscribe(fragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,scheduleController),fragmentController.subscribe(fragmentController.eventList.ENAME_STREAM_COMPLETED,scheduleController),fragmentController.subscribe(fragmentController.eventList.ENAME_STREAM_COMPLETED,bufferController),fragmentController.subscribe(fragmentController.eventList.ENAME_STREAM_COMPLETED,scheduleController.scheduleRulesCollection.bufferLevelRule),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,videoModel),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_CLEARED,scheduleController),bufferController.subscribe(bufferController.eventList.ENAME_BYTES_APPENDED,scheduleController),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,scheduleController),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,trackController),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,scheduleController),bufferController.subscribe(bufferController.eventList.ENAME_INIT_REQUESTED,scheduleController),bufferController.subscribe(bufferController.eventList.ENAME_BUFFERING_COMPLETED,stream),bufferController.subscribe(bufferController.eventList.ENAME_QUOTA_EXCEEDED,scheduleController),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,scheduleController.scheduleRulesCollection.bufferLevelRule),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,scheduleController.scheduleRulesCollection.bufferLevelRule),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_PROGRESS,bufferController),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,bufferController),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,bufferController),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,scheduleController),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_SEEKING,bufferController),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_SEEKING,scheduleController),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_STARTED,scheduleController),playbackController.subscribe(playbackController.eventList.ENAME_PLAYBACK_SEEKING,scheduleController.scheduleRulesCollection.playbackTimeRule),isDynamic&&playbackController.subscribe(playbackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,trackController),playbackController.subscribe(playbackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,bufferController),playbackController.subscribe(playbackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,scheduleController),baseUrlExt.subscribe(baseUrlExt.eventList.ENAME_INITIALIZATION_LOADED,indexHandler),baseUrlExt.subscribe(baseUrlExt.eventList.ENAME_SEGMENTS_LOADED,indexHandler)),indexHandler.initialize(this),bufferController.initialize(type,buffer,mediaSource,self),scheduleController.initialize(type,this),fragmentModel=this.getFragmentModel(),fragmentModel.setLoader(fragmentLoader),fragmentModel.subscribe(fragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,fragmentController),fragmentModel.subscribe(fragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,fragmentController),fragmentModel.subscribe(fragmentModel.eventList.ENAME_STREAM_COMPLETED,fragmentController),fragmentModel.subscribe(fragmentModel.eventList.ENAME_FRAGMENT_LOADING_FAILED,scheduleController),fragmentLoader.subscribe(fragmentLoader.eventList.ENAME_LOADING_COMPLETED,fragmentModel),("video"===type||"audio"===type)&&(bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,fragmentModel),bufferController.subscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,fragmentModel),bufferController.subscribe(bufferController.eventList.ENAME_BYTES_REJECTED,fragmentModel)),trackController.initialize(this)
},isUpdating:function(){return this.trackController.isUpdating()},getType:function(){return type},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},getStreamInfo:function(){return stream.getStreamInfo()},setMediaInfo:function(value){mediaInfo=value},getMediaInfo:function(){return mediaInfo},getEventController:function(){return eventController},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getCurrentTrack:function(){return this.adapter.getCurrentTrackInfo(this.trackController)},getTrackForQuality:function(quality){return this.adapter.getTrackInfoForQuality(this.trackController,quality)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},isDynamic:function(){return isDynamic},reset:function(errored){var self=this,bufferController=self.bufferController,trackController=self.trackController,scheduleController=self.scheduleController,liveEdgeFinder=self.liveEdgeFinder,fragmentController=self.fragmentController,abrController=self.abrController,playbackController=self.playbackController,indexHandler=this.indexHandler,baseUrlExt=this.baseURLExt,fragmentModel=this.getFragmentModel(),fragmentLoader=this.fragmentLoader,videoModel=self.videoModel;abrController.unsubscribe(abrController.eventList.ENAME_QUALITY_CHANGED,bufferController),abrController.unsubscribe(abrController.eventList.ENAME_QUALITY_CHANGED,trackController),abrController.unsubscribe(abrController.eventList.ENAME_QUALITY_CHANGED,scheduleController),liveEdgeFinder.unsubscribe(liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,this.timelineConverter),liveEdgeFinder.unsubscribe(liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,scheduleController),liveEdgeFinder.unsubscribe(liveEdgeFinder.eventList.ENAME_LIVE_EDGE_FOUND,trackController),trackController.unsubscribe(trackController.eventList.ENAME_DATA_UPDATE_STARTED,scheduleController),trackController.unsubscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,bufferController),trackController.unsubscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,scheduleController),trackController.unsubscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,abrController),trackController.unsubscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,stream),trackController.unsubscribe(trackController.eventList.ENAME_DATA_UPDATE_COMPLETED,playbackController),fragmentController.unsubscribe(fragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,bufferController),fragmentController.unsubscribe(fragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,bufferController),fragmentController.unsubscribe(fragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,scheduleController),fragmentController.unsubscribe(fragmentController.eventList.ENAME_STREAM_COMPLETED,scheduleController),fragmentController.unsubscribe(fragmentController.eventList.ENAME_STREAM_COMPLETED,bufferController),fragmentController.unsubscribe(fragmentController.eventList.ENAME_STREAM_COMPLETED,scheduleController.scheduleRulesCollection.bufferLevelRule),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,videoModel),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_CLEARED,scheduleController),bufferController.unsubscribe(bufferController.eventList.ENAME_BYTES_APPENDED,scheduleController),bufferController.unsubscribe(bufferController.eventList.ENAME_BYTES_REJECTED,scheduleController),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,scheduleController),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,trackController),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,scheduleController),bufferController.unsubscribe(bufferController.eventList.ENAME_INIT_REQUESTED,scheduleController),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFERING_COMPLETED,stream),bufferController.unsubscribe(bufferController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,scheduleController),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,scheduleController.scheduleRulesCollection.bufferLevelRule),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,scheduleController.scheduleRulesCollection.bufferLevelRule),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_PROGRESS,bufferController),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,bufferController),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,bufferController),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,scheduleController),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_SEEKING,bufferController),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_SEEKING,scheduleController),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_STARTED,scheduleController),playbackController.unsubscribe(playbackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,trackController),playbackController.unsubscribe(playbackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,bufferController),playbackController.unsubscribe(playbackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,scheduleController),playbackController.unsubscribe(playbackController.eventList.ENAME_PLAYBACK_SEEKING,scheduleController.scheduleRulesCollection.playbackTimeRule),baseUrlExt.unsubscribe(baseUrlExt.eventList.ENAME_INITIALIZATION_LOADED,indexHandler),baseUrlExt.unsubscribe(baseUrlExt.eventList.ENAME_SEGMENTS_LOADED,indexHandler),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,fragmentModel),bufferController.unsubscribe(bufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,fragmentModel),bufferController.unsubscribe(bufferController.eventList.ENAME_BYTES_REJECTED,fragmentModel),fragmentModel.unsubscribe(fragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,fragmentController),fragmentModel.unsubscribe(fragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,fragmentController),fragmentModel.unsubscribe(fragmentModel.eventList.ENAME_STREAM_COMPLETED,fragmentController),fragmentModel.unsubscribe(fragmentModel.eventList.ENAME_FRAGMENT_LOADING_FAILED,scheduleController),fragmentLoader.unsubscribe(fragmentLoader.eventList.ENAME_LOADING_COMPLETED,fragmentModel),fragmentController.resetModel(fragmentModel),indexHandler.reset(),this.bufferController.reset(errored),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.trackController=null,this.videoModel=null,this.fragmentController=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.utils.TokenAuthentication=function(){"use strict";var tokenAuthentication={type:MediaPlayer.utils.TokenAuthentication.TYPE_QUERY};return{debug:void 0,getTokenAuthentication:function(){return tokenAuthentication},setTokenAuthentication:function(object){tokenAuthentication=object},checkRequestHeaderForToken:function(request){void 0!==tokenAuthentication.name&&null!==request.getResponseHeader(tokenAuthentication.name)&&(tokenAuthentication.token=request.getResponseHeader(tokenAuthentication.name),this.debug.log(tokenAuthentication.name+" received: "+tokenAuthentication.token))},addTokenAsQueryArg:function(url){if(void 0!==tokenAuthentication.name&&void 0!==tokenAuthentication.token&&tokenAuthentication.type===MediaPlayer.utils.TokenAuthentication.TYPE_QUERY){var modifier=-1===url.indexOf("?")?"?":"&";url+=modifier+tokenAuthentication.name+"="+tokenAuthentication.token,this.debug.log(tokenAuthentication.name+" is being appended on the request url with a value of : "+tokenAuthentication.token)}return url},setTokenInRequestHeader:function(request){return tokenAuthentication.type===MediaPlayer.utils.TokenAuthentication.TYPE_HEADER&&(request.setRequestHeader(tokenAuthentication.name,tokenAuthentication.token),this.debug.log(tokenAuthentication.name+" is being set in the request header with a value of : "+tokenAuthentication.token)),request}}},MediaPlayer.utils.TokenAuthentication.TYPE_QUERY="query",MediaPlayer.utils.TokenAuthentication.TYPE_HEADER="header",MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var URIFragmentDataVO=new MediaPlayer.vo.URIFragmentData,URIQueryData=[],parseURI=function(uri){function reduceArray(previousValue,currentValue,index,array){var arr=array[0].split(/[=]/);return array.push({key:arr[0],value:arr[1]}),array.shift(),array}function mapArray(currentValue,index,array){return index>0&&(isQuery&&0===URIQueryData.length?URIQueryData=array[index].split(/[&]/):isFragment&&(URIFragmentData=array[index].split(/[&]/))),array}if(!uri)return null;var mappedArr,URIFragmentData=[],testQuery=new RegExp(/[?]/),testFragment=new RegExp(/[#]/),isQuery=testQuery.test(uri),isFragment=testFragment.test(uri);return mappedArr=uri.split(/[?#]/).map(mapArray),URIQueryData.length>0&&(URIQueryData=URIQueryData.reduce(reduceArray,null)),URIFragmentData.length>0&&(URIFragmentData=URIFragmentData.reduce(reduceArray,null),URIFragmentData.forEach(function(object){URIFragmentDataVO[object.key]=object.value})),uri};return{parseURI:parseURI,getURIFragmentData:URIFragmentDataVO,getURIQueryData:URIQueryData,reset:function(){URIFragmentDataVO=new MediaPlayer.vo.URIFragmentData,URIQueryData=[]}}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.models.VideoModel=function(){"use strict";var element,stalledStreams=[],isStalled=function(){return stalledStreams.length>0},addStalledStream=function(type){null!==type&&(element.playbackRate=0,stalledStreams[type]!==!0&&(stalledStreams.push(type),stalledStreams[type]=!0))},removeStalledStream=function(type){if(null!==type){stalledStreams[type]=!1;var index=stalledStreams.indexOf(type);-1!==index&&stalledStreams.splice(index,1),isStalled()===!1&&(element.playbackRate=1)}},stallStream=function(type,isStalled){isStalled?addStalledStream(type):removeStalledStream(type)},onBufferLevelStateChanged=function(sender,hasSufficientBuffer){var type=sender.streamProcessor.getType();stallStream.call(this,type,!hasSufficientBuffer)};return{system:void 0,setup:function(){this.bufferLevelStateChanged=onBufferLevelStateChanged},play:function(){element.play()},pause:function(){element.pause()},isPaused:function(){return element.paused},getPlaybackRate:function(){return element.playbackRate},setPlaybackRate:function(value){element.playbackRate=value},getCurrentTime:function(){return element.currentTime},setCurrentTime:function(currentTime){element.currentTime!=currentTime&&(element.currentTime=currentTime)},listen:function(type,callback){element.addEventListener(type,callback,!1)},unlisten:function(type,callback){element.removeEventListener(type,callback,!1)},getElement:function(){return element},setElement:function(value){element=value},setSource:function(source){element.src=source}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(videoElement){var hasWebKit="webkitDroppedFrameCount"in videoElement,hasQuality="getVideoPlaybackQuality"in videoElement,result=null;return hasQuality?result=videoElement.getVideoPlaybackQuality():hasWebKit&&(result={droppedVideoFrames:videoElement.webkitDroppedFrameCount,creationTime:new Date}),result}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.utils.TTMLParser=function(){"use strict";var ttml,SECONDS_IN_HOUR=3600,SECONDS_IN_MIN=60,timingRegex=/^(0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])((\.[0-9][0-9][0-9])|(:[0-9][0-9]))$/,parseTimings=function(timingStr){var timeParts,parsedTime,frameRate,test=timingRegex.test(timingStr);if(!test)return 0/0;if(timeParts=timingStr.split(":"),parsedTime=parseFloat(timeParts[0])*SECONDS_IN_HOUR+parseFloat(timeParts[1])*SECONDS_IN_MIN+parseFloat(timeParts[2]),timeParts[3]){if(frameRate=ttml.tt.frameRate,!frameRate||isNaN(frameRate))return 0/0;parsedTime+=parseFloat(timeParts[3])/frameRate}return parsedTime},passStructuralConstraints=function(){var passed=!1,hasTt=ttml.hasOwnProperty("tt"),hasHead=hasTt?ttml.tt.hasOwnProperty("head"):!1,hasLayout=hasHead?ttml.tt.head.hasOwnProperty("layout"):!1,hasStyling=hasHead?ttml.tt.head.hasOwnProperty("styling"):!1,hasBody=hasTt?ttml.tt.hasOwnProperty("body"):!1,hasProfile=hasHead?ttml.tt.head.hasOwnProperty("profile"):!1;return hasTt&&hasHead&&hasLayout&&hasStyling&&hasBody&&(passed=!0),passed&&(passed=hasProfile&&"http://www.w3.org/ns/ttml/profile/sdp-us"===ttml.tt.head.profile.use),passed},getNamespacePrefix=function(json,ns){var r=Object.keys(json).filter(function(k){return"xmlns"===k.split(":")[0]&&json[k]===ns}).map(function(k){return k.split(":")[1]});return 1!=r.length?null:r[0]},internalParse=function(data){var errorMsg,cues,cue,startTime,endTime,nsttp,i,captionArray=[],converter=new X2JS([],"",!1);if(ttml=converter.xml_str2json(data),!passStructuralConstraints())throw errorMsg="TTML document has incorrect structure";if(nsttp=getNamespacePrefix(ttml.tt,"http://www.w3.org/ns/ttml#parameter"),ttml.tt.hasOwnProperty(nsttp+":frameRate")&&(ttml.tt.frameRate=parseInt(ttml.tt[nsttp+":frameRate"],10)),cues=ttml.tt.body.div_asArray[0].p_asArray,!cues||0===cues.length)throw errorMsg="TTML document does not contain any cues";for(i=0;i<cues.length;i+=1){if(cue=cues[i],startTime=parseTimings(cue.begin),endTime=parseTimings(cue.end),isNaN(startTime)||isNaN(endTime))throw errorMsg="TTML document has incorrect timing value";captionArray.push({start:startTime,end:endTime,data:cue.__text})}return captionArray};return{parse:internalParse}},MediaPlayer.dependencies.TextController=function(){var mediaSource,buffer,type,initialized=!1,onDataUpdateCompleted=function(){initialized||(buffer.hasOwnProperty("initialize")&&buffer.initialize(type,this),initialized=!0),this.notify(this.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,0)},onInitFragmentLoaded=function(sender,model,bytes){var self=this;model===self.streamProcessor.getFragmentModel()&&null!==bytes&&self.sourceBufferExt.append(buffer,bytes,self.videoModel)};return{sourceBufferExt:void 0,debug:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,eventList:{ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"},setup:function(){this.dataUpdateCompleted=onDataUpdateCompleted,this.initFragmentLoaded=onInitFragmentLoaded},initialize:function(typeValue,buffer,source,streamProcessor){var self=this;type=typeValue,self.setBuffer(buffer),self.setMediaSource(source),self.videoModel=streamProcessor.videoModel,self.trackController=streamProcessor.trackController,self.streamProcessor=streamProcessor},getBuffer:function(){return buffer},setBuffer:function(value){buffer=value},setMediaSource:function(value){mediaSource=value},reset:function(errored){errored||(this.sourceBufferExt.abort(mediaSource,buffer),this.sourceBufferExt.removeSourceBuffer(mediaSource,buffer))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextSourceBuffer=function(){var mediaInfo,mimeType;return{system:void 0,eventBus:void 0,errHandler:void 0,initialize:function(type,bufferController){mimeType=type,this.videoModel=bufferController.videoModel,mediaInfo=bufferController.streamProcessor.getCurrentTrack().mediaInfo},append:function(bytes){var result,label,lang,self=this,ccContent=String.fromCharCode.apply(null,new Uint16Array(bytes));try{result=self.getParser().parse(ccContent),label=mediaInfo.id,lang=mediaInfo.lang,self.getTextTrackExtensions().addTextTrack(self.videoModel.getElement(),result,label,lang,!0),self.eventBus.dispatchEvent({type:"updateend"})}catch(e){self.errHandler.closedCaptionsError(e,"parse",ccContent)}},abort:function(){this.getTextTrackExtensions().deleteCues(this.videoModel.getElement())},getParser:function(){var parser;return"text/vtt"===mimeType?parser=this.system.getObject("vttParser"):"application/ttml+xml"===mimeType&&(parser=this.system.getObject("ttmlParser")),parser},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(type,listener,useCapture){this.eventBus.addEventListener(type,listener,useCapture)},removeEventListener:function(type,listener,useCapture){this.eventBus.removeEventListener(type,listener,useCapture)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var Cue;return{setup:function(){Cue=window.VTTCue||window.TextTrackCue},addTextTrack:function(video,captionData,label,scrlang,isDefaultTrack){var track=video.addTextTrack("captions",label,scrlang);track.default=isDefaultTrack,track.mode="showing";for(var item in captionData){var currentItem=captionData[item];track.addCue(new Cue(currentItem.start,currentItem.end,currentItem.data))}return track},deleteCues:function(video){for(var i=0,firstValidTrack=!1;!firstValidTrack;){if(null!==video.textTracks[i].cues){firstValidTrack=!0;break}i++}for(var track=video.textTracks[i],cues=track.cues,lastIdx=cues.length-1,i=lastIdx;i>=0;i--)track.removeCue(cues[i]);track.mode="disabled",track.default=!1}}},MediaPlayer.utils.VTTParser=function(){"use strict";var convertCuePointTimes=function(time){var timeArray=time.split(":"),len=timeArray.length-1;return time=60*parseInt(timeArray[len-1],10)+parseFloat(timeArray[len],10),2===len&&(time+=3600*parseInt(timeArray[0],10)),time};return{parse:function(data){var len,regExNewLine=/(?:\r\n|\r|\n)/gm,regExToken=/-->/,regExWhiteSpace=/(^[\s]+|[\s]+$)/g,captionArray=[];data=data.split(regExNewLine),len=data.length;for(var i=0;len>i;i++){var item=data[i];if(item.length>0&&"WEBVTT"!==item&&item.match(regExToken)){var cuePoints=item.split(regExToken),sublines=data[i+1];captionArray.push({start:convertCuePointTimes(cuePoints[0].replace(regExWhiteSpace,"")),end:convertCuePointTimes(cuePoints[1].replace(regExWhiteSpace,"")),data:sublines})}}return captionArray}}},MediaPlayer.rules.ABRRulesCollection=function(){"use strict";var qualitySwitchRules=[];return{downloadRatioRule:void 0,insufficientBufferRule:void 0,limitSwitchesRule:void 0,getRules:function(type){switch(type){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return qualitySwitchRules;default:return null}},setup:function(){qualitySwitchRules.push(this.downloadRatioRule),qualitySwitchRules.push(this.insufficientBufferRule),qualitySwitchRules.push(this.limitSwitchesRule)}}},MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules"},MediaPlayer.rules.DownloadRatioRule=function(){"use strict";var streamProcessors={},checkRatio=function(sp,newIdx,currentBandwidth){var newBandwidth=sp.getTrackForQuality(newIdx).bandwidth;return newBandwidth/currentBandwidth};return{debug:void 0,metricsExt:void 0,metricsModel:void 0,setStreamProcessor:function(streamProcessorValue){var type=streamProcessorValue.getType(),id=streamProcessorValue.getStreamInfo().id;streamProcessors[id]=streamProcessors[id]||{},streamProcessors[id][type]=streamProcessorValue},execute:function(context,callback){var downloadTime,totalTime,downloadRatio,totalRatio,switchRatio,oneDownBandwidth,oneUpBandwidth,currentBandwidth,i,switchRequest,self=this,streamId=context.getStreamInfo().id,mediaInfo=context.getMediaInfo(),mediaType=mediaInfo.type,current=context.getCurrentValue(),sp=streamProcessors[streamId][mediaType],metrics=self.metricsModel.getReadOnlyMetricsFor(mediaType),lastRequest=self.metricsExt.getCurrentHttpRequest(metrics),max=mediaInfo.trackCount-1,DOWNLOAD_RATIO_SAFETY_FACTOR=.75;if(null==lastRequest)return void callback(new MediaPlayer.rules.SwitchRequest(Math.floor(max/2)));if(!metrics)return void callback(new MediaPlayer.rules.SwitchRequest);if(totalTime=(lastRequest.tfinish.getTime()-lastRequest.trequest.getTime())/1e3,downloadTime=(lastRequest.tfinish.getTime()-lastRequest.tresponse.getTime())/1e3,0>=totalTime)return void callback(new MediaPlayer.rules.SwitchRequest);if(null===lastRequest.mediaduration||void 0===lastRequest.mediaduration||lastRequest.mediaduration<=0||isNaN(lastRequest.mediaduration))return void callback(new MediaPlayer.rules.SwitchRequest);if(totalRatio=lastRequest.mediaduration/totalTime,downloadRatio=lastRequest.mediaduration/downloadTime*DOWNLOAD_RATIO_SAFETY_FACTOR,isNaN(downloadRatio)||isNaN(totalRatio))return self.debug.log("The ratios are NaN, bailing."),void callback(new MediaPlayer.rules.SwitchRequest);if(isNaN(downloadRatio))switchRequest=new MediaPlayer.rules.SwitchRequest;else if(4>downloadRatio)current>0?(self.debug.log("We are not at the lowest bitrate, so switch down."),oneDownBandwidth=sp.getTrackForQuality(current-1).bandwidth,currentBandwidth=sp.getTrackForQuality(current).bandwidth,switchRatio=oneDownBandwidth/currentBandwidth,switchRatio>downloadRatio?(self.debug.log("Things must be going pretty bad, switch all the way down."),switchRequest=new MediaPlayer.rules.SwitchRequest(0)):(self.debug.log("Things could be better, so just switch down one index."),switchRequest=new MediaPlayer.rules.SwitchRequest(current-1))):switchRequest=new MediaPlayer.rules.SwitchRequest(current);else if(max>current)if(oneUpBandwidth=sp.getTrackForQuality(current+1).bandwidth,currentBandwidth=sp.getTrackForQuality(current).bandwidth,switchRatio=oneUpBandwidth/currentBandwidth,downloadRatio>=switchRatio)if(downloadRatio>100)self.debug.log("Tons of bandwidth available, go all the way up."),switchRequest=new MediaPlayer.rules.SwitchRequest(max-1);else if(downloadRatio>10)self.debug.log("Just enough bandwidth available, switch up one."),switchRequest=new MediaPlayer.rules.SwitchRequest(current+1);else{for(i=-1;(i+=1)<max&&!(downloadRatio<checkRatio.call(self,sp,i,currentBandwidth)););self.debug.log("Calculated ideal new quality index is: "+i),switchRequest=new MediaPlayer.rules.SwitchRequest(i)}else switchRequest=new MediaPlayer.rules.SwitchRequest;else switchRequest=new MediaPlayer.rules.SwitchRequest(max);callback(switchRequest)},reset:function(){streamProcessors={}}}},MediaPlayer.rules.DownloadRatioRule.prototype={constructor:MediaPlayer.rules.DownloadRatioRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var dryBufferHits=0,DRY_BUFFER_LIMIT=3;return{debug:void 0,metricsModel:void 0,execute:function(context,callback){var playlist,trace,self=this,mediaType=context.getMediaInfo().type,current=context.getCurrentValue(),metrics=self.metricsModel.getReadOnlyMetricsFor(mediaType),shift=!1,p=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT;return null===metrics.PlayList||void 0===metrics.PlayList||0===metrics.PlayList.length?void callback(new MediaPlayer.rules.SwitchRequest):(playlist=metrics.PlayList[metrics.PlayList.length-1],null===playlist||void 0===playlist||0===playlist.trace.length?void callback(new MediaPlayer.rules.SwitchRequest):(trace=playlist.trace[playlist.trace.length-2],null===trace||void 0===trace||null===trace.stopreason||void 0===trace.stopreason?void callback(new MediaPlayer.rules.SwitchRequest):(trace.stopreason===MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON&&(shift=!0,dryBufferHits+=1,self.debug.log("Number of times the buffer has run dry: "+dryBufferHits)),dryBufferHits>DRY_BUFFER_LIMIT&&(p=MediaPlayer.rules.SwitchRequest.prototype.STRONG,self.debug.log("Apply STRONG to buffer rule.")),void(shift?(self.debug.log("The buffer ran dry recently, switch down."),callback(new MediaPlayer.rules.SwitchRequest(current-1,p))):dryBufferHits>DRY_BUFFER_LIMIT?(self.debug.log("Too many dry buffer hits, quit switching bitrates."),callback(new MediaPlayer.rules.SwitchRequest(current,p))):callback(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,p))))))}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.LimitSwitchesRule=function(){"use strict";var lastCheckTime=0,qualitySwitchThreshold=2e3;return{debug:void 0,metricsModel:void 0,execute:function(context,callback){var delay,self=this,mediaType=context.getMediaInfo().type,current=context.getCurrentValue(),metrics=this.metricsModel.getReadOnlyMetricsFor(mediaType),manifestInfo=context.getManifestInfo(),lastIdx=metrics.RepSwitchList.length-1,rs=metrics.RepSwitchList[lastIdx],now=(new Date).getTime();return qualitySwitchThreshold=1e3*Math.min(manifestInfo.minBufferTime,manifestInfo.maxFragmentDuration),delay=now-lastCheckTime,qualitySwitchThreshold>delay&&now-rs.t.getTime()<qualitySwitchThreshold?(self.debug.log("Wait some time before allowing another switch."),void callback(new MediaPlayer.rules.SwitchRequest(current,MediaPlayer.rules.SwitchRequest.prototype.STRONG))):(lastCheckTime=now,void callback(new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.STRONG)))}}},MediaPlayer.rules.LimitSwitchesRule.prototype={constructor:MediaPlayer.rules.LimitSwitchesRule},MediaPlayer.rules.RulesContext=function(streamProcessor,currentValue){"use strict";var trackInfo=streamProcessor.getCurrentTrack();return{getStreamInfo:function(){return trackInfo.mediaInfo.streamInfo},getMediaInfo:function(){return trackInfo.mediaInfo},getTrackInfo:function(){return trackInfo},getCurrentValue:function(){return currentValue},getManifestInfo:function(){return trackInfo.mediaInfo.streamInfo.manifestInfo}}},MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext},MediaPlayer.rules.BufferLevelRule=function(){"use strict";var isBufferLevelOutran={},isCompleted={},scheduleController={},getCurrentHttpRequestLatency=function(metrics){var httpRequest=this.metricsExt.getCurrentHttpRequest(metrics);return null!==httpRequest?(httpRequest.tresponse.getTime()-httpRequest.trequest.getTime())/1e3:0},decideBufferLength=function(minBufferTime,duration){var minBufferTarget;return minBufferTarget=isNaN(duration)||MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME<duration&&duration>minBufferTime?Math.max(MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME,minBufferTime):minBufferTime>=duration?Math.min(duration,MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME):Math.min(duration,minBufferTime)},getRequiredBufferLength=function(isDynamic,duration,streamProcessor){var self=this,criticalBufferLevel=streamProcessor.bufferController.getCriticalBufferLevel(),minBufferTarget=decideBufferLength.call(this,streamProcessor.bufferController.getMinBufferTime(),duration),currentBufferTarget=minBufferTarget,bufferMax=streamProcessor.bufferController.bufferMax,vmetrics=self.metricsModel.getReadOnlyMetricsFor("video"),ametrics=self.metricsModel.getReadOnlyMetricsFor("audio"),isLongFormContent=duration>=MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD,requiredBufferLength=0;return bufferMax===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN?requiredBufferLength=minBufferTarget:bufferMax===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY?requiredBufferLength=duration:bufferMax===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED&&(!isDynamic&&self.abrController.isPlayingAtTopQuality()&&(currentBufferTarget=isLongFormContent?MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM:MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY),requiredBufferLength=currentBufferTarget+Math.max(getCurrentHttpRequestLatency.call(self,vmetrics),getCurrentHttpRequestLatency.call(self,ametrics))),requiredBufferLength=Math.min(requiredBufferLength,criticalBufferLevel)},isCompletedT=function(streamId,type){return isCompleted[streamId]&&isCompleted[streamId][type]},isBufferLevelOutranT=function(streamId,type){return isBufferLevelOutran[streamId]&&isBufferLevelOutran[streamId][type]},onStreamCompleted=function(sender,model,request){var streamId=model.getContext().streamProcessor.getStreamInfo().id;isCompleted[streamId]=isCompleted[streamId]||{},isCompleted[streamId][request.mediaType]=!0},onBufferLevelOutrun=function(sender){var streamId=sender.streamProcessor.getStreamInfo().id;isBufferLevelOutran[streamId]=isBufferLevelOutran[streamId]||{},isBufferLevelOutran[streamId][sender.streamProcessor.getType()]=!0},onBufferLevelBalanced=function(sender){var streamId=sender.streamProcessor.getStreamInfo().id;isBufferLevelOutran[streamId]=isBufferLevelOutran[streamId]||{},isBufferLevelOutran[streamId][sender.streamProcessor.getType()]=!1};return{metricsExt:void 0,metricsModel:void 0,abrController:void 0,setup:function(){this.bufferLevelOutrun=onBufferLevelOutrun,this.bufferLevelBalanced=onBufferLevelBalanced,this.streamCompleted=onStreamCompleted},setScheduleController:function(scheduleControllerValue){var id=scheduleControllerValue.streamProcessor.getStreamInfo().id;scheduleController[id]=scheduleController[id]||{},scheduleController[id][scheduleControllerValue.streamProcessor.getType()]=scheduleControllerValue},execute:function(context,callback){var streamInfo=context.getStreamInfo(),streamId=streamInfo.id,mediaType=context.getMediaInfo().type;if(isBufferLevelOutranT(streamId,mediaType))return void callback(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var fragmentCount,metrics=this.metricsModel.getReadOnlyMetricsFor(mediaType),bufferLevel=this.metricsExt.getCurrentBufferLevel(metrics)?this.metricsExt.getCurrentBufferLevel(metrics).level:0,scheduleCtrl=scheduleController[streamId][mediaType],track=scheduleCtrl.streamProcessor.getCurrentTrack(),isDynamic=scheduleCtrl.streamProcessor.isDynamic(),rate=this.metricsExt.getCurrentPlaybackRate(metrics),duration=streamInfo.duration,bufferedDuration=bufferLevel/Math.max(rate,1),fragmentDuration=track.fragmentDuration,currentTime=scheduleCtrl.playbackController.getTime(),timeToEnd=isDynamic?Number.POSITIVE_INFINITY:duration-currentTime,requiredBufferLength=Math.min(getRequiredBufferLength.call(this,isDynamic,duration,scheduleCtrl),timeToEnd),remainingDuration=Math.max(requiredBufferLength-bufferedDuration,0);fragmentCount=Math.ceil(remainingDuration/fragmentDuration),bufferedDuration>=timeToEnd&&!isCompletedT(streamId,mediaType)&&(fragmentCount=fragmentCount||1),callback(new MediaPlayer.rules.SwitchRequest(fragmentCount,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){isBufferLevelOutran={},isCompleted={},scheduleController={}}}},MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule},MediaPlayer.rules.LiveEdgeBBCSearchRule=function(){"use strict";var finder,callback,SEARCH_TIME_SPAN=600,liveEdgeInitialSearchPosition=0/0,liveEdgeSearchRange=null,liveEdgeSearchStep=0/0,trackInfo=null,useBinarySearch=!1,fragmentDuration=0/0,p=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,findLiveEdge=function(searchTime,onSuccess,onError,request){var req,self=this;if(null===request)req=self.adapter.generateFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),findLiveEdge.call(self,searchTime,onSuccess,onError,req);else{var handler=function(sender,isExist,request){finder.fragmentLoader.unsubscribe(finder.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,self,handler),isExist?onSuccess.call(self,request,searchTime):onError.call(self,request,searchTime)};finder.fragmentLoader.subscribe(finder.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,self,handler),finder.fragmentLoader.checkForExistence(request)}},onSearchForFragmentFailed=function(request,lastSearchTime){var searchTime,req,searchInterval;
return useBinarySearch?void binarySearch.call(this,!1,lastSearchTime):(searchInterval=lastSearchTime-liveEdgeInitialSearchPosition,searchTime=searchInterval>0?liveEdgeInitialSearchPosition-searchInterval:liveEdgeInitialSearchPosition+Math.abs(searchInterval)+liveEdgeSearchStep,void(searchTime<liveEdgeSearchRange.start&&searchTime>liveEdgeSearchRange.end?(console.log("I AM GIVING UP"),callback(new MediaPlayer.rules.SwitchRequest(liveEdgeInitialSearchPosition,p))):(req=this.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),findLiveEdge.call(this,searchTime,onSearchForFragmentSucceeded,onSearchForFragmentFailed,req))))},onSearchForFragmentSucceeded=function(request,lastSearchTime){var req,searchTime,startTime=request.startTime,self=this;if(!useBinarySearch){if(!trackInfo.fragmentDuration)return console.log("I THINK IT IS AT (1) "+startTime),void callback(new MediaPlayer.rules.SwitchRequest(startTime,p));if(useBinarySearch=!0,liveEdgeSearchRange.end=startTime+2*liveEdgeSearchStep,lastSearchTime===liveEdgeInitialSearchPosition)return searchTime=lastSearchTime+fragmentDuration,req=self.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),void findLiveEdge.call(self,searchTime,function(){binarySearch.call(self,!0,searchTime)},function(){console.log("I THINK IT IS AT (2) "+searchTime),callback(new MediaPlayer.rules.SwitchRequest(searchTime,p))},req)}binarySearch.call(this,!0,lastSearchTime)},binarySearch=function(lastSearchSucceeded,lastSearchTime){var isSearchCompleted,req,searchTime;lastSearchSucceeded?liveEdgeSearchRange.start=lastSearchTime:liveEdgeSearchRange.end=lastSearchTime,isSearchCompleted=Math.floor(liveEdgeSearchRange.end-liveEdgeSearchRange.start)<=fragmentDuration,isSearchCompleted?(console.log("DID THE LAST SEARCH SUCCEED? "+lastSearchSucceeded),console.log("I THINK IT IS AT (3) "+(lastSearchSucceeded?lastSearchTime:lastSearchTime-fragmentDuration)),callback(new MediaPlayer.rules.SwitchRequest(lastSearchSucceeded?lastSearchTime:lastSearchTime-fragmentDuration,p))):(searchTime=(liveEdgeSearchRange.start+liveEdgeSearchRange.end)/2,req=this.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),findLiveEdge.call(this,searchTime,onSearchForFragmentSucceeded,onSearchForFragmentFailed,req))};return{metricsExt:void 0,adapter:void 0,setFinder:function(liveEdgeFinder){finder=liveEdgeFinder},execute:function(context,callbackFunc){var request,DVRWindow,self=this;return callback=callbackFunc,trackInfo=finder.streamProcessor.getCurrentTrack(),fragmentDuration=trackInfo.fragmentDuration,DVRWindow=trackInfo.DVRWindow,liveEdgeInitialSearchPosition=Date.now()/1e3,console.log("HELLO "+DVRWindow.end),console.log("GOODBYE "+Date.now()),trackInfo.useCalculatedLiveEdgeTime?void callback(new MediaPlayer.rules.SwitchRequest(liveEdgeInitialSearchPosition,p)):(liveEdgeSearchRange={start:Math.max(0,liveEdgeInitialSearchPosition-SEARCH_TIME_SPAN),end:liveEdgeInitialSearchPosition+SEARCH_TIME_SPAN},liveEdgeSearchStep=Math.floor((DVRWindow.end-DVRWindow.start)/2),liveEdgeSearchStep>liveEdgeSearchRange.end-liveEdgeSearchRange.start&&(liveEdgeSearchStep=(liveEdgeSearchRange.end-liveEdgeSearchRange.start)/10),request=self.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,liveEdgeInitialSearchPosition),void findLiveEdge.call(self,liveEdgeInitialSearchPosition,onSearchForFragmentSucceeded,onSearchForFragmentFailed,request))},reset:function(){liveEdgeInitialSearchPosition=0/0,liveEdgeSearchRange=null,liveEdgeSearchStep=0/0,trackInfo=null,useBinarySearch=!1,fragmentDuration=0/0,finder=null}}},MediaPlayer.rules.LiveEdgeBBCSearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBBCSearchRule},MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){"use strict";var finder,callback,SEARCH_TIME_SPAN=43200,liveEdgeInitialSearchPosition=0/0,liveEdgeSearchRange=null,liveEdgeSearchStep=0/0,trackInfo=null,useBinarySearch=!1,fragmentDuration=0/0,p=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,findLiveEdge=function(searchTime,onSuccess,onError,request){var req,self=this;if(null===request)req=self.adapter.generateFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),findLiveEdge.call(self,searchTime,onSuccess,onError,req);else{var handler=function(sender,isExist,request){finder.fragmentLoader.unsubscribe(finder.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,self,handler),isExist?onSuccess.call(self,request,searchTime):onError.call(self,request,searchTime)};finder.fragmentLoader.subscribe(finder.fragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,self,handler),finder.fragmentLoader.checkForExistence(request)}},onSearchForFragmentFailed=function(request,lastSearchTime){var searchTime,req,searchInterval;return useBinarySearch?void binarySearch.call(this,!1,lastSearchTime):(searchInterval=lastSearchTime-liveEdgeInitialSearchPosition,searchTime=searchInterval>0?liveEdgeInitialSearchPosition-searchInterval:liveEdgeInitialSearchPosition+Math.abs(searchInterval)+liveEdgeSearchStep,void(searchTime<liveEdgeSearchRange.start&&searchTime>liveEdgeSearchRange.end?callback(new MediaPlayer.rules.SwitchRequest(null,p)):(req=this.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),findLiveEdge.call(this,searchTime,onSearchForFragmentSucceeded,onSearchForFragmentFailed,req))))},onSearchForFragmentSucceeded=function(request,lastSearchTime){var req,searchTime,startTime=request.startTime,self=this;if(!useBinarySearch){if(!trackInfo.fragmentDuration)return void callback(new MediaPlayer.rules.SwitchRequest(startTime,p));if(useBinarySearch=!0,liveEdgeSearchRange.end=startTime+2*liveEdgeSearchStep,lastSearchTime===liveEdgeInitialSearchPosition)return searchTime=lastSearchTime+fragmentDuration,req=self.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),void findLiveEdge.call(self,searchTime,function(){binarySearch.call(self,!0,searchTime)},function(){callback(new MediaPlayer.rules.SwitchRequest(searchTime,p))},req)}binarySearch.call(this,!0,lastSearchTime)},binarySearch=function(lastSearchSucceeded,lastSearchTime){var isSearchCompleted,req,searchTime;lastSearchSucceeded?liveEdgeSearchRange.start=lastSearchTime:liveEdgeSearchRange.end=lastSearchTime,isSearchCompleted=Math.floor(liveEdgeSearchRange.end-liveEdgeSearchRange.start)<=fragmentDuration,isSearchCompleted?callback(new MediaPlayer.rules.SwitchRequest(lastSearchSucceeded?lastSearchTime:lastSearchTime-fragmentDuration,p)):(searchTime=(liveEdgeSearchRange.start+liveEdgeSearchRange.end)/2,req=this.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,searchTime),findLiveEdge.call(this,searchTime,onSearchForFragmentSucceeded,onSearchForFragmentFailed,req))};return{metricsExt:void 0,adapter:void 0,setFinder:function(liveEdgeFinder){finder=liveEdgeFinder},execute:function(context,callbackFunc){var request,DVRWindow,self=this;return callback=callbackFunc,trackInfo=finder.streamProcessor.getCurrentTrack(),fragmentDuration=trackInfo.fragmentDuration,DVRWindow=trackInfo.DVRWindow,liveEdgeInitialSearchPosition=DVRWindow.end,trackInfo.useCalculatedLiveEdgeTime?void callback(new MediaPlayer.rules.SwitchRequest(liveEdgeInitialSearchPosition,p)):(liveEdgeSearchRange={start:Math.max(0,liveEdgeInitialSearchPosition-SEARCH_TIME_SPAN),end:liveEdgeInitialSearchPosition+SEARCH_TIME_SPAN},liveEdgeSearchStep=Math.floor((DVRWindow.end-DVRWindow.start)/2),request=self.adapter.getFragmentRequestForTime(finder.streamProcessor,trackInfo,liveEdgeInitialSearchPosition),void findLiveEdge.call(self,liveEdgeInitialSearchPosition,onSearchForFragmentSucceeded,onSearchForFragmentFailed,request))},reset:function(){liveEdgeInitialSearchPosition=0/0,liveEdgeSearchRange=null,liveEdgeSearchStep=0/0,trackInfo=null,useBinarySearch=!1,fragmentDuration=0/0,finder=null}}},MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule},MediaPlayer.rules.PendingRequestsRule=function(){"use strict";var LIMIT=1,scheduleController={};return{metricsExt:void 0,setScheduleController:function(scheduleControllerValue){var streamId=scheduleControllerValue.streamProcessor.getStreamInfo().id;scheduleController[streamId]=scheduleController[streamId]||{},scheduleController[streamId][scheduleControllerValue.streamProcessor.getType()]=scheduleControllerValue},execute:function(context,callback){var mediaType=context.getMediaInfo().type,streamId=context.getStreamInfo().id,current=context.getCurrentValue(),sc=scheduleController[streamId][mediaType],model=sc.getFragmentModel(),pendingRequests=model.getPendingRequests(),loadingRequests=model.getLoadingRequests(),rejectedRequests=model.getRejectedRequests(),rLn=rejectedRequests.length,ln=pendingRequests.length+loadingRequests.length,count=Math.max(current-ln,0);return rLn>0?void callback(new MediaPlayer.rules.SwitchRequest(rLn,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):ln>LIMIT?void callback(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):0===current?void callback(new MediaPlayer.rules.SwitchRequest(count,MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE)):void callback(new MediaPlayer.rules.SwitchRequest(count,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){scheduleController={}}}},MediaPlayer.rules.PendingRequestsRule.prototype={constructor:MediaPlayer.rules.PendingRequestsRule},MediaPlayer.rules.PlaybackTimeRule=function(){"use strict";var seekTarget={},scheduleController={},onPlaybackSeeking=function(sender,time){var streamId=sender.getStreamId();seekTarget[streamId]=seekTarget[streamId]||{},seekTarget[streamId].audio=time,seekTarget[streamId].video=time};return{adapter:void 0,sourceBufferExt:void 0,setup:function(){this.playbackSeeking=onPlaybackSeeking},setScheduleController:function(scheduleControllerValue){var streamId=scheduleControllerValue.streamProcessor.getStreamInfo().id;scheduleController[streamId]=scheduleController[streamId]||{},scheduleController[streamId][scheduleControllerValue.streamProcessor.getType()]=scheduleControllerValue},execute:function(context,callback){var range,time,request,mediaType=context.getMediaInfo().type,streamId=context.getStreamInfo().id,sc=scheduleController[streamId][mediaType],streamProcessor=scheduleController[streamId][mediaType].streamProcessor,track=streamProcessor.getCurrentTrack(),st=seekTarget[streamId]?seekTarget[streamId][mediaType]:null,p=st?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,rejected=sc.getFragmentModel().getRejectedRequests().shift(),keepIdx=!!rejected&&!st,currentTime=this.adapter.getIndexHandlerTime(streamProcessor),playbackTime=streamProcessor.playbackController.getTime(),rejectedEnd=rejected?rejected.startTime+rejected.duration:null,useRejected=rejected&&(rejectedEnd>playbackTime&&rejected.startTime<=currentTime||isNaN(currentTime));if(time=st||(useRejected?rejected.startTime+rejected.duration/2:currentTime),isNaN(time))return void callback(new MediaPlayer.rules.SwitchRequest(null,p));for(seekTarget[streamId]&&(seekTarget[streamId][mediaType]=null),range=this.sourceBufferExt.getBufferRange(streamProcessor.bufferController.getBuffer(),time),null!==range&&(time=range.end),request=this.adapter.getFragmentRequestForTime(streamProcessor,track,time,keepIdx);request&&streamProcessor.fragmentController.isFragmentLoadedOrPending(sc,request);){if("complete"===request.action){request=null,this.adapter.setIndexHandlerTime(streamProcessor,0/0);break}request=this.adapter.getNextFragmentRequest(streamProcessor,track)}request&&!useRejected&&this.adapter.setIndexHandlerTime(streamProcessor,request.startTime+request.duration),callback(new MediaPlayer.rules.SwitchRequest(request,p))},reset:function(){seekTarget={},scheduleController={}}}},MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule},MediaPlayer.rules.RulesController=function(){"use strict";var rules={},ruleMandatoryProperties=["execute"],isRuleTypeSupported=function(ruleType){return ruleType===this.SCHEDULING_RULE||ruleType===this.ABR_RULE},isRule=function(obj){var ln=ruleMandatoryProperties.length,i=0;for(i;ln>i;i+=1)if(!obj.hasOwnProperty(ruleMandatoryProperties[i]))return!1;return!0},getRulesContext=function(streamProcessor,currentValue){return new MediaPlayer.rules.RulesContext(streamProcessor,currentValue)},normalizeRule=function(rule){var exec=rule.execute.bind(rule);return rule.execute=function(context,callback){var normalizedCallback=function(result){callback.call(rule,new MediaPlayer.rules.SwitchRequest(result.value,result.priority))};exec(context,normalizedCallback)},"function"!=typeof rule.reset&&(rule.reset=function(){}),rule},updateRules=function(currentRulesCollection,newRulesCollection,override){var rule,ruleSubType,subTypeRuleSet,ruleArr,ln,i;for(ruleSubType in newRulesCollection)if(ruleArr=newRulesCollection[ruleSubType],ln=ruleArr.length)for(i=0;ln>i;i+=1)rule=ruleArr[i],isRule.call(this,rule)&&(rule=normalizeRule.call(this,rule),subTypeRuleSet=currentRulesCollection.getRules(ruleSubType),override&&(subTypeRuleSet.length=0),subTypeRuleSet.push(rule))};return{system:void 0,debug:void 0,SCHEDULING_RULE:0,ABR_RULE:1,initialize:function(){rules[this.ABR_RULE]=this.system.getObject("abrRulesCollection"),rules[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection")},setRules:function(ruleType,rulesCollection){isRuleTypeSupported.call(this,ruleType)&&rulesCollection&&updateRules.call(this,rules[ruleType],rulesCollection,!0)},addRules:function(ruleType,rulesCollection){isRuleTypeSupported.call(this,ruleType)&&rulesCollection&&updateRules.call(this,rules[ruleType],rulesCollection,!1)},applyRules:function(rulesArr,streamProcessor,callback,current,overrideFunc){var rule,i,rulesCount=rulesArr.length,ln=rulesCount,values={},rulesContext=getRulesContext.call(this,streamProcessor,current),callbackFunc=function(result){var value,confidence;result.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(values[result.priority]=overrideFunc(values[result.priority],result.value)),--rulesCount||(values[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(confidence=MediaPlayer.rules.SwitchRequest.prototype.WEAK,value=values[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),values[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(confidence=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,value=values[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),values[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(confidence=MediaPlayer.rules.SwitchRequest.prototype.STRONG,value=values[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),confidence!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&confidence!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(confidence=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),callback({value:value||current,confidence:confidence}))};for(values[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,values[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,values[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,i=0;ln>i;i+=1)rule=rulesArr[i],isRule.call(this,rule)?rule.execute(rulesContext,callbackFunc):rulesCount--},reset:function(){rules={}}}},MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController},MediaPlayer.rules.SameTimeRequestRule=function(){"use strict";var LOADING_REQUEST_THRESHOLD=4,findClosestToTime=function(fragmentModels,time){var req,r,pendingReqs,j,pln,i=0,ln=fragmentModels.length;for(i;ln>i;i+=1)for(pendingReqs=fragmentModels[i].getPendingRequests(),sortRequestsByProperty.call(this,pendingReqs,"index"),j=0,pln=pendingReqs.length;pln>j;j++){if(req=pendingReqs[j],isNaN(req.startTime)&&"complete"!==req.action){r=req;break}req.startTime>time&&(!r||req.startTime<r.startTime)&&(r=req)}return r||req},getForTime=function(fragmentModels,currentTime){var req,i,ln=fragmentModels.length,r=null;for(i=0;ln>i;i+=1)req=fragmentModels[i].getPendingRequestForTime(currentTime),req&&(!r||req.startTime>r.startTime)&&(r=req);return r},sortRequestsByProperty=function(requestsArray,sortProp){var compare=function(req1,req2){return req1[sortProp]<req2[sortProp]||isNaN(req1[sortProp])&&"complete"!==req1.action?-1:req1[sortProp]>req2[sortProp]?1:0};requestsArray.sort(compare)};return{setFragmentModels:function(fragmentModels,streamid){this.fragmentModels=this.fragmentModels||{},this.fragmentModels[streamid]=fragmentModels},execute:function(context,callback){var type,model,sameTimeReq,mIdx,req,currentTime,reqForCurrentTime,pendingReqs,loadingLength,streamId=context.getStreamInfo().id,current=context.getCurrentValue(),p=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,fragmentModels=this.fragmentModels[streamId],wallclockTime=new Date,time=null,mLength=fragmentModels?fragmentModels.length:null,shouldWait=!1,reqsToExecute=[];if(!fragmentModels||!mLength)return void callback(new MediaPlayer.rules.SwitchRequest([],p));if(currentTime=Math.round(100*fragmentModels[0].getContext().playbackController.getTime())/100,reqForCurrentTime=getForTime(fragmentModels,currentTime),req=reqForCurrentTime||findClosestToTime(fragmentModels,currentTime)||current,!req)return void callback(new MediaPlayer.rules.SwitchRequest([],p));for(mIdx=0;mLength>mIdx;mIdx+=1)if(model=fragmentModels[mIdx],type=model.getContext().streamProcessor.getType(),("video"===type||"audio"===type)&&(pendingReqs=model.getPendingRequests(),loadingLength=model.getLoadingRequests().length,!model.getIsPostponed()||isNaN(req.startTime))){if(loadingLength>LOADING_REQUEST_THRESHOLD)return void callback(new MediaPlayer.rules.SwitchRequest([],p));if(time=time||(req===reqForCurrentTime?currentTime:req.startTime),-1===pendingReqs.indexOf(req)){if(sameTimeReq=model.getPendingRequestForTime(time))reqsToExecute.push(sameTimeReq);else if(sameTimeReq=model.getLoadingRequestForTime(time)||model.getExecutedRequestForTime(time),!sameTimeReq){shouldWait=!0;break}}else reqsToExecute.push(req)}return reqsToExecute=reqsToExecute.filter(function(req){return"complete"===req.action||wallclockTime.getTime()>=req.availabilityStartTime.getTime()}),shouldWait?void callback(new MediaPlayer.rules.SwitchRequest([],p)):void callback(new MediaPlayer.rules.SwitchRequest(reqsToExecute,p))}}},MediaPlayer.rules.SameTimeRequestRule.prototype={constructor:MediaPlayer.rules.SameTimeRequestRule},MediaPlayer.rules.ScheduleRulesCollection=function(){"use strict";var fragmentsToScheduleRules=[],fragmentsToExecuteRules=[],liveEdgeRules=[],nextFragmentRules=[];return{bufferLevelRule:void 0,pendingRequestsRule:void 0,playbackTimeRule:void 0,sameTimeRequestRule:void 0,liveEdgeBinarySearchRule:void 0,liveEdgeBBCSearchRule:void 0,getRules:function(type){switch(type){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return fragmentsToScheduleRules;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return nextFragmentRules;case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES:return fragmentsToExecuteRules;case MediaPlayer.rules.ScheduleRulesCollection.prototype.LIVE_EDGE_RULES:return liveEdgeRules;default:return null}},setup:function(){fragmentsToScheduleRules.push(this.bufferLevelRule),fragmentsToScheduleRules.push(this.pendingRequestsRule),nextFragmentRules.push(this.playbackTimeRule),fragmentsToExecuteRules.push(this.sameTimeRequestRule),liveEdgeRules.push(this.liveEdgeBBCSearchRule)}}},MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules",FRAGMENTS_TO_EXECUTE_RULES:"fragmentsToExecuteRules",LIVE_EDGE_RULES:"liveEdgeRules"},MediaPlayer.rules.SwitchRequest=function(v,p){"use strict";this.value=v,this.priority=p,void 0===this.value&&(this.value=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.vo.FragmentRequest=function(){"use strict";this.action="download",this.startTime=0/0,this.mediaType=null,this.type=null,this.duration=0/0,this.timescale=0/0,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=0/0,this.index=0/0,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null},MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.ManifestInfo=function(){"use strict";this.DVRWindowSize=0/0,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=0/0,this.duration=0/0,this.isDynamic=!1,this.maxFragmentDuration=null},MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo},MediaPlayer.vo.MediaInfo=function(){"use strict";this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.trackCount=0,this.lang=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null},MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=0/0,this.duration=0/0,this.manifestInfo=null},MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo},MediaPlayer.vo.TrackInfo=function(){"use strict";this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null,this.manifestInfo=null},MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){"use strict";this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.TrackSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.TrackSwitch.prototype={constructor:MediaPlayer.vo.metrics.TrackSwitch},MediaPlayer.vo.metrics.SchedulingInfo=function(){"use strict";this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo},MediaPlayer.vo.metrics.SchedulingInfo.PENDING_STATE="pending",MediaPlayer.vo.metrics.SchedulingInfo.LOADING_STATE="loading",MediaPlayer.vo.metrics.SchedulingInfo.EXECUTED_STATE="executed",MediaPlayer.vo.metrics.SchedulingInfo.REJECTED_STATE="rejected",MediaPlayer.vo.metrics.SchedulingInfo.CANCELED_STATE="canceled",MediaPlayer.vo.metrics.SchedulingInfo.FAILED_STATE="failed",MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection};
//# sourceMappingURL=dash.all.js.map